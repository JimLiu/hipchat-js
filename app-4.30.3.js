/*! Copyright Â© 2017 Atlassian */
!function(e){function t(n){if(a[n])return a[n].exports;var i=a[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){"use strict";!function(){var e=a(1),t=a(99),n=$("body"),i=new e({el:document.getElementById("hipchat"),base_url:void 0,client_type:"web",client_version_id:"4.30.3",client_os_version_id:[t.browser.userAgent().browser.name||"unknown",t.browser.userAgent().browser.major||1].join(" "),asset_base_uri:window.assetBaseUri,is_guest:!(!window.HC||!window.HC.is_guest),html5_routing_enabled:!0,initState:n.data("init-state"),feature_flags:n.data("feature-flags")});n.removeAttr("data-init-state data-feature-flags").removeData(["initState","featureFlags"]),i.render()}()},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t={base_url:"",video_base_url:"https://hipchat.com/video/join",client_type:B["default"].WEB,client_os_version_id:"unknown os version",client_version_id:"0",asset_base_uri:"",video_chat_uri:"",is_guest:!1,read_only_mode:!1,read_only_input_markdown:"",html5_routing_enabled:!0,health_check_enabled:!0,keyboard_shortcuts:null,app_config_overrides:{},native_feature_flags:{},release_dialog_content:{},ui:{}};k["default"].clientSubType.isNative(e.client_subtype)&&(e.native_feature_flags=_.clone(e.feature_flags));var a=e.initState||{};delete e.initState;var n=_.defaultsDeep(e,t),i=_.merge(n,a),o=new T["default"](i);g["default"].configure({config:o,asset_base_uri:o.asset_base_uri,client_type:o.client_type,video_chat_uri:o.video_chat_uri,client_subtype:o.client_subtype,client_version_id:o.client_version_id,html5_routing_enabled:o.html5_routing_enabled,release_dialog_content:o.release_dialog_content}),U["default"].setOAuthTokenCallback(a.onRefreshOAuthAccessToken),s["default"].debug("[HipChatClient]","config received",s["default"].sanitize(C["default"].getAll())),y["default"].set({notification_permission:N["default"].getNotificationPermission()}),G["default"].initialize({doHealthCheck:!!o.health_check_enabled}),window.HC=new O["default"]({is_guest:o.is_guest}),$(document).trigger("hc-ready",window.HC),A["default"].initialize(o.asset_base_uri,o.app_config_overrides),k["default"].emoticons.asset_base_uri=o.asset_base_uri,k["default"].emoticons.web_server=o.web_server,o.smileys&&k["default"].emoticons.addSmileys(o.smileys);var r={client_type:o.client_type,client_subtype:o.client_subtype,client_version_id:o.client_version_id,client_os_version_id:o.client_os_version_id};_.get(o,"feature_flags.btf")||new f["default"](a,r),p["default"].dispatch("analytics-hc-client-start"),(0,w["default"])(o),c["default"].dispatch("hipchat-client-configured");var u=new q["default"](function(e,t){N["default"].onUnrecoverableError(e,t)});u.addRule("invariant",{detect:function(e){return"Invariant Violation"===e.name||/^Invariant Violation/.test(e.message)},threshold:3,time:5e3}),u.install(),l["default"].track()}a(2),a(3);var o=a(90),s=n(o),r=a(187),l=n(r),u=a(9),c=n(u),d=a(188),f=n(d),h=a(173),p=n(h),m=a(190),g=n(m),v=a(96),y=n(v),b=a(255),w=n(b),R=a(99),k=n(R),E=a(169),C=n(E),S=a(201),T=n(S),x=a(180),A=n(x),I=a(93),N=n(I),M=a(294),O=n(M),D=a(307),P=n(D),j=a(627),L=n(j),F=a(208),U=n(F),H=a(212),B=n(H),z=a(632),q=n(z),V=a(218),G=n(V);a(633),a(290),a(635),window.hc_client_launch_time=window.hc_client_launch_time||(new Date).getTime(),window.onerror=s["default"].error.bind(s["default"]),i.prototype.render=function(e){var t=e||document.querySelector("#hipchat"),a=C["default"].isGuest()?L["default"]:P["default"];ReactDOM.render(React.createElement(a,{is_guest:C["default"].isGuest()}),t);$(window).on("beforeunload",function(){c["default"].dispatch("unload-app")}).blur(function(){c["default"].dispatch("application-blurred")}).focus(function(){c["default"].dispatch("application-focused")})},e.exports=i},function(e,t){"use strict";function a(){window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a(),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(4),o=n(i),s=a(5),r=n(s),l=a(9),u=a(90),c=function(){function e(){(0,o["default"])(this,e),this.registerCallbacks()}return(0,r["default"])(e,[{key:"registerCallbacks",value:function(){$(document).on("hc-ready",function(e,t){u.debug("[event: hc-ready]","window.HC",{verbose:t})}).on("app-state-ready",function(){u.debug("[event: app-state-ready]")}),l.register({"app-state-connected":function(){u.debug("[event: app-state-connected]")},"app-state-reconnected":function(){u.debug("[event: app-state-reconnected]")},"attempt-disconnect":function(e){u.debug("[event: attempt-disconnect]",e)},"attempt-reconnect":function(){u.debug("[event: attempt-reconnect]")},"application-blurred":function(){u.isVerbose()&&u.debug("[event: application-blurred]")},"application-focused":function(){u.isVerbose()&&u.debug("[event: application-focused]")},"unload-app":function(){u.debug("[event: unload-app]")},"exit-app":function(e){u.debug("[event: exit-app]",e)},signout:function(){u.debug("[event: signout]")},"upload-successful":function(e){u.debug("[event: upload-successful]",u.sanitize(e))},"upload-failed":function(e){u.debug("[event: upload-failed]",e)},"file-error":function(e){u.debug("[event: file-error]",u.sanitize(e))},"request-profile":function(e){u.isVerbose()&&u.debug("[event: request-profile]",e)},"send-user-state-message":function(e){u.debug("[event: send-user-state-message]",e)},"unmark-participant":function(e){u.isVerbose()&&u.debug("[event: unmark-participant]",e)},"mark-participant-unknown":function(e){u.isVerbose()&&u.debug("[event: mark-participant-unknown]",e)},"fetch-presences":function(e){u.isVerbose()&&u.debug("[event: fetch-presences]",e)},"filter-presences":function(e){u.isVerbose()&&u.debug("[event: filter-presences]",e)},"update-presence":function(e){u.debug("[event: update-presence]",e)},"set-route":function(e){u.debug("[event: set-route]",e)},"fetch-previous":function(e){u.debug("[event: fetch-previous]",e)},"requesting-ancient-history":function(e){u.debug("[event: requesting-ancient-history]",e)},"close-room":function(e){u.debug("[event: close-room]",e)},"room-closed":function(e){u.debug("[event: room-closed]",e)},"open-room":function(e){u.debug("[event: open-room]",e)},"room-deleted":function(e){u.debug("[event: room-deleted]",e)},"DAL:handle-created-room":function(e){u.debug("[event: DAL:handle-created-room]",e)},"API:update-room":function(e){u.debug("[event: API:update-room]",e)},"update-room-order":function(e){u.debug("[event: update-room-order]",e)},"focus-video-window":function(e){u.debug("[event: focus-video-window]",e)},"new-active-chat":function(e){u.debug("[event: new-active-chat]",e)},"open-chat-by-mention-name":function(e){u.debug("[event: open-chat-by-mention-name]",e)},"join-room":function(e){u.debug("[event: join-room]",e)},"DAL:handle-joined-rooms":function(e){u.isVerbose()&&u.debug("[event: DAL:handle-joined-rooms]",e)},"save-client-preferences":function(e){u.debug("[event: save-client-preferences]",e)},"edit-topic":function(){u.debug("[event: edit-topic]")},"delete-room":function(e){u.debug("[event: delete-room]",e)},"set-guest-access":function(e){u.debug("[event: set-guest-access]",e)},"navigate-rooms":function(e){u.debug("[event: navigate-rooms]",e)},"add-link-from-message":function(e){u.isVerbose()&&u.debug("[event: add-link-from-message]",e)},"add-file-from-message":function(e){u.isVerbose()&&u.debug("[event: add-file-from-message]",u.sanitize(e))},"remove-room-participant":function(e){u.debug("[event: remove-room-participant]",e)},"guest-access-revoked":function(){u.debug("[event: guest-access-revoked]")},"user-removed":function(e){u.debug("[event: user-removed]",e)},"add-room-visitor":function(e){u.debug("[event: add-room-visitor]",e)},"room-presence-received":function(e){u.isVerbose()&&u.debug("[event: room-presence-received]",e)},"chat-fully-initialized":function(e){u.debug("[event: chat-fully-initialized]",e)},"archive-room":function(e){u.debug("[event: archive-room]",e)},"unarchive-room":function(e){u.debug("[event: unarchive-room]",e)},"room-archived":function(e){u.debug("[event: room-archived]",e)},"room-unarchived":function(e){u.debug("[event: room-unarchived]",e)},"show-flag":function(e){u.debug("[event: show-flag]",e)},"show-modal-dialog":function(e){u.debug("[event: show-modal-dialog]",e)},"files-fetched":function(e){u.debug("[event: files-fetched]",e)},"links-fetched":function(e){u.debug("[event: links-fetched]",e)},"hide-modal-dialog":function(){u.debug("[event: hide-modal-dialog]")},"remove-flag":function(e){u.debug("[event: remove-flag]",e)},"show-integration-view":function(e){u.debug("[event: show-integration-view]",e)},"refresh-integrations":function(e){u.debug("[event: refresh-integrations]",e)},"integration-update":function(e){u.debug("[event: integration-update]",e)},"search-history":function(e){u.debug("[event: search-history]",e)},"set-search-text":function(e){u.debug("[event: set-search-text]",e)},"blur-search":function(){u.debug("[event: blur-search]")},"video-window-event":function(e){u.debug("[event: video-window-event]",e)},"missed-call":function(e){u.debug("[event: missed-call]",e)},"enable-dark-feature":function(e){u.debug("[event: enable-dark-feature]",e)},"dismiss-notification-banner":function(){u.debug("[event: dismiss-notification-banner]")},"dismiss-notification-banner-forever":function(){u.debug("[event: dismiss-notification-banner-forever]")},"request-notification-permission":function(){u.debug("[event: request-notification-permission]")},"resend-message":function(e){u.debug("[event: resend-message]",e)},"groupchat-invite-accepted":function(e){u.debug("[event: groupchat-invite-accepted]",e)},"error-message-received":function(e){u.debug("[event: error-message-received]",e)},"replacement-message-received":function(e){u.debug("[event: replacement-message-received]",e)},"handle-cached-room":function(e){u.debug("[event: handle-cached-room]",e)},"groupchat-invite-received":function(e){u.debug("[event: groupchat-invite-received]",e)},"private-chat-invite-received":function(e){u.debug("[event: private-chat-invite-received]",e)},"guest-access-enabled":function(e){u.debug("[event: guest-access-enabled]",e)},"remove-chat-state-message":function(e){u.debug("[event: remove-chat-state-message]",e)}})}}]),e}();e.exports=new c},function(e,t){"use strict";t.__esModule=!0,t["default"]=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=a(6),o=n(i);t["default"]=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,o["default"])(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}()},function(e,t,a){e.exports={"default":a(7),__esModule:!0}},function(e,t,a){var n=a(8);e.exports=function(e,t,a){return n.setDesc(e,t,a)}},function(e,t){var a=Object;e.exports={create:a.create,getProto:a.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:a.getOwnPropertyDescriptor,setDesc:a.defineProperty,setDescs:a.defineProperties,getKeys:a.keys,getNames:a.getOwnPropertyNames,getSymbols:a.getOwnPropertySymbols,each:[].forEach}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(47),h=n(f),p=a(51),_=n(p),m=a(58),g=n(m),v=function(e){function t(){return(0,r["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,_["default"])(t,e),(0,u["default"])(t,[{key:"dispatch",value:function(e){for(var n,i,s=a(90),r=arguments.length,l=Array(r>1?r-1:0),u=1;r>u;u++)l[u-1]=arguments[u];(n=s.type("app-dispatcher:"+e)).log.apply(n,l),(i=(0,h["default"])((0,o["default"])(t.prototype),"dispatch",this)).call.apply(i,[this,e].concat(l))}}]),t}(g["default"]);t["default"]=new v,e.exports=t["default"]},function(e,t,a){e.exports={"default":a(11),__esModule:!0}},function(e,t,a){a(12),e.exports=a(18).Object.getPrototypeOf},function(e,t,a){var n=a(13);a(15)("getPrototypeOf",function(e){return function(t){return e(n(t))}})},function(e,t,a){var n=a(14);e.exports=function(e){return Object(n(e))}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,a){var n=a(16),i=a(18),o=a(21);e.exports=function(e,t){var a=(i.Object||{})[e]||Object[e],s={};s[e]=t(a),n(n.S+n.F*o(function(){a(1)}),"Object",s)}},function(e,t,a){var n=a(17),i=a(18),o=a(19),s="prototype",r=function(e,t,a){var l,u,c,d=e&r.F,f=e&r.G,h=e&r.S,p=e&r.P,_=e&r.B,m=e&r.W,g=f?i:i[t]||(i[t]={}),v=f?n:h?n[t]:(n[t]||{})[s];f&&(a=t);for(l in a)u=!d&&v&&l in v,u&&l in g||(c=u?v[l]:a[l],g[l]=f&&"function"!=typeof v[l]?a[l]:_&&u?o(c,n):m&&v[l]==c?function(e){var t=function(t){return this instanceof e?new e(t):e(t)};return t[s]=e[s],t}(c):p&&"function"==typeof c?o(Function.call,c):c,p&&((g[s]||(g[s]={}))[l]=c))};r.F=1,r.G=2,r.S=4,r.P=8,r.B=16,r.W=32,e.exports=r},function(e,t){var a=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=a)},function(e,t){var a=e.exports={version:"1.2.6"};"number"==typeof __e&&(__e=a)},function(e,t,a){var n=a(20);e.exports=function(e,t,a){if(n(e),void 0===t)return e;switch(a){case 1:return function(a){return e.call(t,a)};case 2:return function(a,n){return e.call(t,a,n)};case 3:return function(a,n,i){return e.call(t,a,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e){try{return!!e()}catch(t){return!0}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=a(23),o=n(i);t["default"]=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":(0,o["default"])(t))&&"function"!=typeof t?e:t}},function(e,t,a){"use strict";var n=a(24)["default"];t["default"]=function(e){return e&&e.constructor===n?"symbol":typeof e},t.__esModule=!0},function(e,t,a){e.exports={"default":a(25),__esModule:!0}},function(e,t,a){a(26),a(46),e.exports=a(18).Symbol},function(e,t,a){"use strict";var n=a(8),i=a(17),o=a(27),s=a(28),r=a(16),l=a(29),u=a(21),c=a(32),d=a(33),f=a(35),h=a(34),p=a(36),_=a(40),m=a(41),g=a(42),v=a(43),y=a(37),b=a(31),w=n.getDesc,R=n.setDesc,k=n.create,E=_.get,C=i.Symbol,S=i.JSON,T=S&&S.stringify,x=!1,A=h("_hidden"),I=n.isEnum,N=c("symbol-registry"),M=c("symbols"),O="function"==typeof C,D=Object.prototype,P=s&&u(function(){return 7!=k(R({},"a",{get:function(){return R(this,"a",{value:7}).a}})).a})?function(e,t,a){var n=w(D,t);n&&delete D[t],R(e,t,a),n&&e!==D&&R(D,t,n)}:R,j=function(e){var t=M[e]=k(C.prototype);return t._k=e,s&&x&&P(D,e,{configurable:!0,set:function(t){o(this,A)&&o(this[A],e)&&(this[A][e]=!1),P(this,e,b(1,t))}}),t},L=function(e){return"symbol"==typeof e},F=function(e,t,a){return a&&o(M,t)?(a.enumerable?(o(e,A)&&e[A][t]&&(e[A][t]=!1),a=k(a,{enumerable:b(0,!1)})):(o(e,A)||R(e,A,b(1,{})),e[A][t]=!0),P(e,t,a)):R(e,t,a)},U=function(e,t){v(e);for(var a,n=m(t=y(t)),i=0,o=n.length;o>i;)F(e,a=n[i++],t[a]);return e},H=function(e,t){return void 0===t?k(e):U(k(e),t)},B=function(e){var t=I.call(this,e);return t||!o(this,e)||!o(M,e)||o(this,A)&&this[A][e]?t:!0},z=function(e,t){var a=w(e=y(e),t);return!a||!o(M,t)||o(e,A)&&e[A][t]||(a.enumerable=!0),a},q=function(e){for(var t,a=E(y(e)),n=[],i=0;a.length>i;)o(M,t=a[i++])||t==A||n.push(t);return n},V=function(e){for(var t,a=E(y(e)),n=[],i=0;a.length>i;)o(M,t=a[i++])&&n.push(M[t]);return n},G=function(e){if(void 0!==e&&!L(e)){for(var t,a,n=[e],i=1,o=arguments;o.length>i;)n.push(o[i++]);return t=n[1],"function"==typeof t&&(a=t),!a&&g(t)||(t=function(e,t){return a&&(t=a.call(this,e,t)),L(t)?void 0:t}),n[1]=t,T.apply(S,n)}},W=u(function(){var e=C();return"[null]"!=T([e])||"{}"!=T({a:e})||"{}"!=T(Object(e))});O||(C=function(){if(L(this))throw TypeError("Symbol is not a constructor");return j(f(arguments.length>0?arguments[0]:void 0))},l(C.prototype,"toString",function(){return this._k}),L=function(e){return e instanceof C},n.create=H,n.isEnum=B,n.getDesc=z,n.setDesc=F,n.setDescs=U,n.getNames=_.get=q,n.getSymbols=V,s&&!a(45)&&l(D,"propertyIsEnumerable",B,!0));var $={"for":function(e){return o(N,e+="")?N[e]:N[e]=C(e)},keyFor:function(e){return p(N,e)},useSetter:function(){x=!0},useSimple:function(){x=!1}};n.each.call("hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),function(e){var t=h(e);$[e]=O?t:j(t)}),x=!0,r(r.G+r.W,{Symbol:C}),r(r.S,"Symbol",$),r(r.S+r.F*!O,"Object",{create:H,defineProperty:F,defineProperties:U,getOwnPropertyDescriptor:z,getOwnPropertyNames:q,getOwnPropertySymbols:V}),S&&r(r.S+r.F*(!O||W),"JSON",{stringify:G}),d(C,"Symbol"),d(Math,"Math",!0),d(i.JSON,"JSON",!0)},function(e,t){var a={}.hasOwnProperty;e.exports=function(e,t){return a.call(e,t)}},function(e,t,a){e.exports=!a(21)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,a){e.exports=a(30)},function(e,t,a){var n=a(8),i=a(31);e.exports=a(28)?function(e,t,a){return n.setDesc(e,t,i(1,a))}:function(e,t,a){return e[t]=a,e}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,a){var n=a(17),i="__core-js_shared__",o=n[i]||(n[i]={});e.exports=function(e){return o[e]||(o[e]={})}},function(e,t,a){var n=a(8).setDesc,i=a(27),o=a(34)("toStringTag");e.exports=function(e,t,a){e&&!i(e=a?e:e.prototype,o)&&n(e,o,{configurable:!0,value:t})}},function(e,t,a){var n=a(32)("wks"),i=a(35),o=a(17).Symbol;e.exports=function(e){return n[e]||(n[e]=o&&o[e]||(o||i)("Symbol."+e))}},function(e,t){var a=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++a+n).toString(36))}},function(e,t,a){var n=a(8),i=a(37);e.exports=function(e,t){for(var a,o=i(e),s=n.getKeys(o),r=s.length,l=0;r>l;)if(o[a=s[l++]]===t)return a}},function(e,t,a){var n=a(38),i=a(14);e.exports=function(e){return n(i(e))}},function(e,t,a){var n=a(39);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t){var a={}.toString;e.exports=function(e){return a.call(e).slice(8,-1)}},function(e,t,a){var n=a(37),i=a(8).getNames,o={}.toString,s="object"==typeof window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],r=function(e){try{return i(e)}catch(t){return s.slice()}};e.exports.get=function(e){return s&&"[object Window]"==o.call(e)?r(e):i(n(e))}},function(e,t,a){var n=a(8);e.exports=function(e){var t=n.getKeys(e),a=n.getSymbols;if(a)for(var i,o=a(e),s=n.isEnum,r=0;o.length>r;)s.call(e,i=o[r++])&&t.push(i);return t}},function(e,t,a){var n=a(39);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,a){var n=a(44);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){e.exports=!0},function(e,t){},function(e,t,a){"use strict";var n=a(48)["default"];t["default"]=function(e,t,a){for(var i=!0;i;){var o=e,s=t,r=a;i=!1,null===o&&(o=Function.prototype);var l=n(o,s);if(void 0!==l){if("value"in l)return l.value;var u=l.get;if(void 0===u)return;return u.call(r)}var c=Object.getPrototypeOf(o);if(null===c)return;e=c,t=s,a=r,i=!0,l=c=void 0}},t.__esModule=!0},function(e,t,a){e.exports={"default":a(49),__esModule:!0}},function(e,t,a){var n=a(8);a(50),e.exports=function(e,t){return n.getDesc(e,t)}},function(e,t,a){var n=a(37);a(15)("getOwnPropertyDescriptor",function(e){return function(t,a){return e(n(t),a)}})},function(e,t,a){"use strict";var n=a(52)["default"],i=a(54)["default"];t["default"]=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=n(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(i?i(e,t):e.__proto__=t)},t.__esModule=!0},function(e,t,a){e.exports={"default":a(53),__esModule:!0}},function(e,t,a){var n=a(8);e.exports=function(e,t){return n.create(e,t)}},function(e,t,a){e.exports={"default":a(55),__esModule:!0}},function(e,t,a){a(56),e.exports=a(18).Object.setPrototypeOf},function(e,t,a){var n=a(16);n(n.S,"Object",{setPrototypeOf:a(57).set})},function(e,t,a){var n=a(8).getDesc,i=a(44),o=a(43),s=function(e,t){if(o(e),!i(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,i){try{i=a(19)(Function.call,n(Object.prototype,"__proto__").set,2),i(e,[]),t=!(e instanceof Array)}catch(o){t=!0}return function(e,a){return s(e,a),t?e.__proto__=a:i(e,a),e}}({},!1):void 0),check:s}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(59),o=n(i),s=a(10),r=n(s),l=a(4),u=n(l),c=a(5),d=n(c),f=a(22),h=n(f),p=a(51),m=n(p),g=a(89).EventEmitter,v=function(e){function t(){(0,u["default"])(this,t);var e=(0,h["default"])(this,(0,r["default"])(t).call(this));return e.setMaxListeners(20),e}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"dispatch",value:function(e){for(var t=arguments.length,a=Array(t>1?t-1:0),n=1;t>n;n++)a[n-1]=arguments[n];this.emit.apply(this,["before:"+e].concat(a)),this.emit.apply(this,arguments),this.emit.apply(this,["after:"+e].concat(a))}},{key:"registerOnce",value:function(e,t){var a=this;if(_.isArray(e)){var n=e.map(function(e){return new o["default"](function(t){a.once(e,function(){for(var a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];t({action:e,data:n})})})});return o["default"].all(n).then(function(e){var a={};_.forEach(e,function(e){a[e.action]=e.data}),t(a)})}_.isString(e)?this.once(e,t):_.isObject(e)&&_.forOwn(e,function(e,t){a.once(t,e)})}},{key:"register",value:function(e,t){var a=this;_.isString(e)?this.on(e,t):_.isObject(e)&&_.forOwn(e,function(e,t){a.on(t,e)})}},{key:"unregister",value:function(e,t){var a=this;_.isString(e)?this.removeListener(e,t):_.isObject(e)&&_.forOwn(e,function(e,t){a.removeListener(t,e)})}}]),t}(g);e.exports=v},function(e,t,a){e.exports={"default":a(60),__esModule:!0}},function(e,t,a){a(46),a(61),a(67),a(71),e.exports=a(18).Promise},function(e,t,a){"use strict";var n=a(62)(!0);a(64)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,a=this._i;return a>=t.length?{value:void 0,done:!0}:(e=n(t,a),this._i+=e.length,{value:e,done:!1})})},function(e,t,a){var n=a(63),i=a(14);e.exports=function(e){return function(t,a){var o,s,r=String(i(t)),l=n(a),u=r.length;return 0>l||l>=u?e?"":void 0:(o=r.charCodeAt(l),55296>o||o>56319||l+1===u||(s=r.charCodeAt(l+1))<56320||s>57343?e?r.charAt(l):o:e?r.slice(l,l+2):(o-55296<<10)+(s-56320)+65536)}}},function(e,t){var a=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:a)(e)}},function(e,t,a){"use strict";var n=a(45),i=a(16),o=a(29),s=a(30),r=a(27),l=a(65),u=a(66),c=a(33),d=a(8).getProto,f=a(34)("iterator"),h=!([].keys&&"next"in[].keys()),p="@@iterator",_="keys",m="values",g=function(){return this};e.exports=function(e,t,a,v,y,b,w){u(a,t,v);var R,k,E=function(e){if(!h&&e in x)return x[e];switch(e){case _:return function(){return new a(this,e)};case m:return function(){return new a(this,e)}}return function(){return new a(this,e)}},C=t+" Iterator",S=y==m,T=!1,x=e.prototype,A=x[f]||x[p]||y&&x[y],I=A||E(y);if(A){var N=d(I.call(new e));c(N,C,!0),!n&&r(x,p)&&s(N,f,g),S&&A.name!==m&&(T=!0,I=function(){return A.call(this)})}if(n&&!w||!h&&!T&&x[f]||s(x,f,I),l[t]=I,l[C]=g,y)if(R={values:S?I:E(m),keys:b?I:E(_),entries:S?E("entries"):I},w)for(k in R)k in x||o(x,k,R[k]);else i(i.P+i.F*(h||T),t,R);return R}},function(e,t){e.exports={}},function(e,t,a){"use strict";var n=a(8),i=a(31),o=a(33),s={};a(30)(s,a(34)("iterator"),function(){return this}),e.exports=function(e,t,a){e.prototype=n.create(s,{next:i(1,a)}),o(e,t+" Iterator")}},function(e,t,a){a(68);var n=a(65);n.NodeList=n.HTMLCollection=n.Array},function(e,t,a){"use strict";var n=a(69),i=a(70),o=a(65),s=a(37);e.exports=a(64)(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,a=this._i++;return!e||a>=e.length?(this._t=void 0,i(1)):"keys"==t?i(0,a):"values"==t?i(0,e[a]):i(0,[a,e[a]])},"values"),o.Arguments=o.Array,n("keys"),n("values"),n("entries")},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,a){"use strict";var n,i=a(8),o=a(45),s=a(17),r=a(19),l=a(72),u=a(16),c=a(44),d=a(43),f=a(20),h=a(73),p=a(74),_=a(57).set,m=a(79),g=a(34)("species"),v=a(80),y=a(81),b="Promise",w=s.process,R="process"==l(w),k=s[b],E=function(e){var t=new k(function(){});return e&&(t.constructor=Object),k.resolve(t)===t},C=function(){function e(t){var a=new k(t);return _(a,e.prototype),a}var t=!1;try{if(t=k&&k.resolve&&E(),_(e,k),e.prototype=i.create(k.prototype,{constructor:{value:e}}),e.resolve(5).then(function(){})instanceof e||(t=!1),t&&a(28)){var n=!1;k.resolve(i.setDesc({},"then",{get:function(){n=!0}})),t=n}}catch(o){t=!1}return t}(),S=function(e,t){return o&&e===k&&t===n?!0:m(e,t)},T=function(e){var t=d(e)[g];return void 0!=t?t:e},x=function(e){var t;return c(e)&&"function"==typeof(t=e.then)?t:!1},A=function(e){var t,a;this.promise=new e(function(e,n){if(void 0!==t||void 0!==a)throw TypeError("Bad Promise constructor");t=e,a=n}),this.resolve=f(t),this.reject=f(a)},I=function(e){try{e()}catch(t){return{error:t}}},N=function(e,t){if(!e.n){e.n=!0;var a=e.c;y(function(){for(var n=e.v,i=1==e.s,o=0,r=function(t){var a,o,s=i?t.ok:t.fail,r=t.resolve,l=t.reject;try{s?(i||(e.h=!0),a=s===!0?n:s(n),a===t.promise?l(TypeError("Promise-chain cycle")):(o=x(a))?o.call(a,r,l):r(a)):l(n)}catch(u){l(u)}};a.length>o;)r(a[o++]);a.length=0,e.n=!1,t&&setTimeout(function(){var t,a,i=e.p;M(i)&&(R?w.emit("unhandledRejection",n,i):(t=s.onunhandledrejection)?t({promise:i,reason:n}):(a=s.console)&&a.error&&a.error("Unhandled promise rejection",n)),e.a=void 0},1)})}},M=function(e){var t,a=e._d,n=a.a||a.c,i=0;if(a.h)return!1;for(;n.length>i;)if(t=n[i++],t.fail||!M(t.promise))return!1;return!0},O=function(e){var t=this;t.d||(t.d=!0,t=t.r||t,t.v=e,t.s=2,t.a=t.c.slice(),N(t,!0))},D=function(e){var t,a=this;if(!a.d){a.d=!0,a=a.r||a;try{if(a.p===e)throw TypeError("Promise can't be resolved itself");(t=x(e))?y(function(){var n={r:a,d:!1};try{t.call(e,r(D,n,1),r(O,n,1))}catch(i){O.call(n,i)}}):(a.v=e,a.s=1,N(a,!1))}catch(n){O.call({r:a,d:!1},n)}}};C||(k=function(e){f(e);var t=this._d={p:h(this,k,b),c:[],a:void 0,s:0,d:!1,v:void 0,h:!1,n:!1};try{e(r(D,t,1),r(O,t,1))}catch(a){O.call(t,a)}},a(86)(k.prototype,{then:function(e,t){var a=new A(v(this,k)),n=a.promise,i=this._d;return a.ok="function"==typeof e?e:!0,a.fail="function"==typeof t&&t,i.c.push(a),i.a&&i.a.push(a),i.s&&N(i,!1),n},"catch":function(e){return this.then(void 0,e)}})),u(u.G+u.W+u.F*!C,{Promise:k}),a(33)(k,b),a(87)(b),n=a(18)[b],u(u.S+u.F*!C,b,{reject:function(e){var t=new A(this),a=t.reject;return a(e),t.promise}}),u(u.S+u.F*(!C||E(!0)),b,{resolve:function(e){if(e instanceof k&&S(e.constructor,this))return e;var t=new A(this),a=t.resolve;return a(e),t.promise}}),u(u.S+u.F*!(C&&a(88)(function(e){k.all(e)["catch"](function(){})})),b,{all:function(e){var t=T(this),a=new A(t),n=a.resolve,o=a.reject,s=[],r=I(function(){p(e,!1,s.push,s);var a=s.length,r=Array(a);a?i.each.call(s,function(e,i){var s=!1;t.resolve(e).then(function(e){s||(s=!0,r[i]=e,--a||n(r))},o)}):n(r)});return r&&o(r.error),a.promise},race:function(e){var t=T(this),a=new A(t),n=a.reject,i=I(function(){p(e,!1,function(e){t.resolve(e).then(a.resolve,n)})});return i&&n(i.error),a.promise}})},function(e,t,a){var n=a(39),i=a(34)("toStringTag"),o="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,a,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(a=(t=Object(e))[i])?a:o?n(t):"Object"==(s=n(t))&&"function"==typeof t.callee?"Arguments":s}},function(e,t){e.exports=function(e,t,a){if(!(e instanceof t))throw TypeError(a+": use the 'new' operator!");return e}},function(e,t,a){var n=a(19),i=a(75),o=a(76),s=a(43),r=a(77),l=a(78);e.exports=function(e,t,a,u){var c,d,f,h=l(e),p=n(a,u,t?2:1),_=0;if("function"!=typeof h)throw TypeError(e+" is not iterable!");if(o(h))for(c=r(e.length);c>_;_++)t?p(s(d=e[_])[0],d[1]):p(e[_]);else for(f=h.call(e);!(d=f.next()).done;)i(f,p,d.value,t)}},function(e,t,a){var n=a(43);e.exports=function(e,t,a,i){try{return i?t(n(a)[0],a[1]):t(a)}catch(o){var s=e["return"];throw void 0!==s&&n(s.call(e)),o}}},function(e,t,a){var n=a(65),i=a(34)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||o[i]===e)}},function(e,t,a){var n=a(63),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t,a){var n=a(72),i=a(34)("iterator"),o=a(65);e.exports=a(18).getIteratorMethod=function(e){return void 0!=e?e[i]||e["@@iterator"]||o[n(e)]:void 0}},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},function(e,t,a){var n=a(43),i=a(20),o=a(34)("species");e.exports=function(e,t){var a,s=n(e).constructor;return void 0===s||void 0==(a=n(s)[o])?t:i(a)}},function(e,t,a){var n,i,o,s=a(17),r=a(82).set,l=s.MutationObserver||s.WebKitMutationObserver,u=s.process,c=s.Promise,d="process"==a(39)(u),f=function(){var e,t,a;for(d&&(e=u.domain)&&(u.domain=null,e.exit());n;)t=n.domain,a=n.fn,t&&t.enter(),a(),t&&t.exit(),n=n.next;i=void 0,e&&e.enter()};if(d)o=function(){u.nextTick(f)};else if(l){var h=1,p=document.createTextNode("");new l(f).observe(p,{characterData:!0}),o=function(){p.data=h=-h}}else o=c&&c.resolve?function(){c.resolve().then(f)}:function(){r.call(s,f)};e.exports=function(e){var t={fn:e,next:void 0,domain:d&&u.domain};i&&(i.next=t),n||(n=t,o()),i=t}},function(e,t,a){var n,i,o,s=a(19),r=a(83),l=a(84),u=a(85),c=a(17),d=c.process,f=c.setImmediate,h=c.clearImmediate,p=c.MessageChannel,_=0,m={},g="onreadystatechange",v=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},y=function(e){v.call(e.data)};f&&h||(f=function(e){for(var t=[],a=1;arguments.length>a;)t.push(arguments[a++]);return m[++_]=function(){r("function"==typeof e?e:Function(e),t)},n(_),_},h=function(e){delete m[e]},"process"==a(39)(d)?n=function(e){d.nextTick(s(v,e,1))}:p?(i=new p,o=i.port2,i.port1.onmessage=y,n=s(o.postMessage,o,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(n=function(e){c.postMessage(e+"","*")},c.addEventListener("message",y,!1)):n=g in u("script")?function(e){l.appendChild(u("script"))[g]=function(){l.removeChild(this),v.call(e)}}:function(e){setTimeout(s(v,e,1),0)}),e.exports={set:f,clear:h}},function(e,t){e.exports=function(e,t,a){var n=void 0===a;switch(t.length){case 0:return n?e():e.call(a);case 1:return n?e(t[0]):e.call(a,t[0]);case 2:return n?e(t[0],t[1]):e.call(a,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(a,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(a,t[0],t[1],t[2],t[3])}return e.apply(a,t)}},function(e,t,a){e.exports=a(17).document&&document.documentElement},function(e,t,a){var n=a(44),i=a(17).document,o=n(i)&&n(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,a){var n=a(29);e.exports=function(e,t){for(var a in t)n(e,a,t[a]);return e}},function(e,t,a){"use strict";var n=a(18),i=a(8),o=a(28),s=a(34)("species");e.exports=function(e){
var t=n[e];o&&t&&!t[s]&&i.setDesc(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,a){var n=a(34)("iterator"),i=!1;try{var o=[7][n]();o["return"]=function(){i=!0},Array.from(o,function(){throw 2})}catch(s){}e.exports=function(e,t){if(!t&&!i)return!1;var a=!1;try{var o=[7],s=o[n]();s.next=function(){a=!0},o[n]=function(){return s},e(o)}catch(r){}return a}},function(e,t){function a(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function i(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._maxListeners=void 0,a.defaultMaxListeners=10,a.prototype.setMaxListeners=function(e){if(!i(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},a.prototype.emit=function(e){var t,a,i,r,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(a=this._events[e],s(a))return!1;if(n(a))switch(arguments.length){case 1:a.call(this);break;case 2:a.call(this,arguments[1]);break;case 3:a.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),a.apply(this,r)}else if(o(a))for(r=Array.prototype.slice.call(arguments,1),u=a.slice(),i=u.length,l=0;i>l;l++)u[l].apply(this,r);return!0},a.prototype.addListener=function(e,t){var i;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(i=s(this._maxListeners)?a.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(e,t){function a(){this.removeListener(e,a),i||(i=!0,t.apply(this,arguments))}if(!n(t))throw TypeError("listener must be a function");var i=!1;return a.listener=t,this.on(e,a),this},a.prototype.removeListener=function(e,t){var a,i,s,r;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(a=this._events[e],s=a.length,i=-1,a===t||n(a.listener)&&a.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(a)){for(r=s;r-- >0;)if(a[r]===t||a[r].listener&&a[r].listener===t){i=r;break}if(0>i)return this;1===a.length?(a.length=0,delete this._events[e]):a.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},a.prototype.removeAllListeners=function(e){var t,a;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(a=this._events[e],n(a))this.removeListener(e,a);else if(a)for(;a.length;)this.removeListener(e,a[a.length-1]);return delete this._events[e],this},a.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},a.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},a.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}var o=a(91),s=i(o),r=a(4),l=i(r),u=a(5),c=i(u),d=a(93),f=i(d),h=a(99),p=i(h),m=a(161),g=i(m),v=a(169),y=i(v),b=a(186),w=i(b),R=a(163),k=n(R),E="[Strophe]",C="/^.*?$/",S="old-logger",T=function(){function e(){var t=this;(0,l["default"])(this,e),window.HC_LOG=window.HC_LOG||this.storage.getItem("logging"),window.HC_LOG_VERBOSE=window.HC_LOG_VERBOSE||!!this.storage.getItem("verbose-logging"),window.HC_LOG_CALL_STACK=window.HC_LOG_CALL_STACK||!!this.storage.getItem("logging-call-stack"),window.HC_LOG_FORCE_COLORS=window.HC_LOG_FORCE_COLORS||!!this.storage.getItem("logging-force-colors"),window.HC_LOG_FORCE_EXPANDED=window.HC_LOG_FORCE_EXPANDED||!!this.storage.getItem("logging-force-expanded"),this.verbose_mode_enabled=window.HC_LOG_VERBOSE,Strophe.log=function(e,a){if(t.isVerbose()||t.isNewLogger())switch(e){case Strophe.LogLevel.INFO:t.info(E,a),t.type("strophe").withFilter().info(a);break;case Strophe.LogLevel.WARN:t.warn(E,a),t.type("strophe").withFilter().warn(a);break;case Strophe.LogLevel.ERROR:case Strophe.LogLevel.FATAL:t.error(E,a),t.type("strophe").withFilter().error(a);break;default:t.debug(E,a),t.type("strophe").withFilter().debug(a)}},this.verbose_mode_reminder_logged=!1,this.colors=["maroon","olive","green","purple","teal","navy"],this.levels=["error","warn","info","debug","log"],this.resetLogger()}return(0,c["default"])(e,[{key:"error",value:function(){for(var e=arguments.length,t=Array(e),a=0;e>a;a++)t[a]=arguments[a];return t.unshift("error"),this.doLog.apply(this,t)}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),a=0;e>a;a++)t[a]=arguments[a];return t.unshift("warn"),this.doLog.apply(this,t)}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),a=0;e>a;a++)t[a]=arguments[a];return t.unshift("info"),this.doLog.apply(this,t)}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),a=0;e>a;a++)t[a]=arguments[a];return t.unshift("debug"),this.doLog.apply(this,t)}},{key:"log",value:function(){for(var e=arguments.length,t=Array(e),a=0;e>a;a++)t[a]=arguments[a];return t.unshift("log"),this.doLog.apply(this,t)}},{key:"logXML",value:function(e,t){try{if(!this.shouldLogXML())return;for(var a=0;a<e.childNodes.length;a++){var n=this.sanitizeXML(e.childNodes[a]),i=p["default"].xml.toString(n),o="[XML "+t+"] "+i;if(o.length>k.XMPP_LOG_MAX_CHARS){var s=o.length-k.XMPP_LOG_MAX_CHARS,r=o.substring(0,Math.min(k.XMPP_LOG_MAX_CHARS,o.length));this.debug(r+"... [truncated "+s+" chars]")}else this.debug(o)}}catch(l){"console"in window&&console.error(l.message),f["default"].onLogMessage("[ERROR] "+l.message)}}},{key:"type",value:function(e){return this._log_type=e,this}},{key:"desc",value:function(e){return this._log_description=e,this}},{key:"withCallStack",value:function(){return this._log_call_stack=!0,this}},{key:"alwaysExpanded",value:function(){return this._log_always_expanded=!0,this}},{key:"withFilter",value:function(){return this._log_with_filter=!0,this}},{key:"isNewLogger",value:function(){return window.HC_LOG&&1!==Number(window.HC_LOG)&&(""+window.HC_LOG).length}},{key:"doLog",value:function(){for(var e=this,t=arguments.length,a=Array(t),n=0;t>n;n++)a[n]=arguments[n];var i=+new Date,o=i-(this.prevTime||i);this.prevTime=i,this.updateVerboseMode(window.HC_LOG_VERBOSE);try{var r=a.shift(),l=_.map(_.filter(a,"verbose"),"verbose");if(l.length>0&&(a=_.reject(a,"verbose"),this.isVerbose()?l.forEach(function(e){a.push(e)}):(a.push("[verbose]"),this.verbose_mode_reminder_logged||(this.verbose_mode_reminder_logged=!0,this.info("Enable Verbose Mode for complete logs - window.HC_LOG_VERBOSE")))),window.HC_LOG||this.storage.removeItem("logging"),window.HC_LOG_CALL_STACK||this.storage.removeItem("logging-call-stack"),window.HC_LOG_FORCE_COLORS||this.storage.removeItem("logging-force-colors"),window.HC_LOG_FORCE_EXPANDED||this.storage.removeItem("logging-force-expanded"),"console"in window&&window.HC_LOG){var u=void 0;if(this.storage.setItem("logging",window.HC_LOG),window.HC_LOG_CALL_STACK&&this.storage.setItem("logging-call-stack",!0),window.HC_LOG_FORCE_COLORS&&this.storage.setItem("logging-force-colors",!0),window.HC_LOG_FORCE_EXPANDED&&this.storage.setItem("logging-force-expanded",!0),this._log_type||(this._log_type=S,this._log_description='Migrate me to new logger system or skip with HC_LOG="*,-*'+S+'"',this._log_call_stack=!0),this.isNewLogger()&&this._log_type){if("log"!==r&&"debug"!==r&&(this._log_type=r+":"+this._log_type),this._log_types!==window.HC_LOG){this._log_types=window.HC_LOG;var c=(""+window.HC_LOG).split(",").map(function(e){return e.trim()}),d=function(e){return new RegExp("^"+e.replace(/\*/g,".*?")+"$")};this._ignoreFilters=c.filter(function(e){return 0===e.indexOf("-")}).map(function(e){return e.slice(1)}).map(d),this._filters=c.filter(function(e){return 0!==e.indexOf("-")}).map(d)}var h=!1;this._ignoreFilters.forEach(function(t){-1!==e._log_type.search(t)&&(h=!0)}),h||this._filters.forEach(function(t){(!e._log_with_filter||e._log_with_filter&&t.toString()!==C||e._log_type===S)&&-1!==e._log_type.search(t)&&(u=!0)})}if(u&&this._log_type){a=a.map(function(e){if(_.isFunction(e))return"[function call]";if(_.isPlainObject(e)||_.isArray(e))try{return JSON.parse((0,s["default"])(e))}catch(t){console.error(t)}return e}),this.evenLog=!this.evenLog,this.colorIndex=this.colorIndex||0;var m=[];p["default"].browser.is.chrome()||window.HC_LOG_FORCE_COLORS?m.push("%c"+this._log_type+" %c+"+o+"ms %c"+this._log_description,"color: "+(this.evenLog?"gray":"dimgray"),"color: "+this.colors[this.colorIndex],"color: blue"):m.push(this._log_type+" +"+o+"ms "+this._log_description),this.colorIndex>=this.colors.length-1?this.colorIndex=0:this.colorIndex++;var g=1===a.length&&_.isObject(a[0])&&!_.isEmpty(a[0])&&_.values(a[0]).every(function(e){return!_.isObject(e)}),v=a.every(function(e){return!_.isObject(e)}),y=this._log_type!==S&&!window.HC_LOG_FORCE_EXPANDED&&!this._log_always_expanded&&!g&&!v&&(a.some(_.isObject)||a.every(_.isEmpty))&&("log"===r||"debug"===r),b=y?console.groupCollapsed:console.group;b.apply(console,m),console[r].apply(console,a),(window.HC_LOG_CALL_STACK||this._log_call_stack)&&(console.trace?console.trace():console.log((new Error).stack)),console.groupEnd()}else 1!==Number(window.HC_LOG)||this._log_type&&this._log_type!==S||console[r].apply(console,a)}if(this.shouldLogToFile()&&(!this._log_type||this._log_type===S)){var w=this.formatLogMessage(r,a);f["default"].onLogMessage(w)}}catch(R){"console"in window&&console.error(R.message),f["default"].onLogMessage("[ERROR] "+R.message)}this.resetLogger()}},{key:"resetLogger",value:function(){this._log_type=null,this._log_description="",this._log_call_stack=!1,this._log_with_filter=!1,this._log_always_expanded=!1}},{key:"formatLogMessage",value:function(e,t){var a=this,n="["+e.toUpperCase()+"]",i=[];try{t.forEach(function(e){e=a.sanitize(e),_.isObject(e)&&(e=(0,s["default"])(e)),i.push(e)})}catch(o){return"Value cannot be logged."}return n+" "+i.join(" ")}},{key:"updateVerboseMode",value:function(e){e=!!e,e?this.storage.setItem("verbose-logging",!0):this.storage.removeItem("verbose-logging"),this.isVerbose()!==e&&(this.verbose_mode_enabled=e)}},{key:"isVerbose",value:function(){return this.verbose_mode_enabled}},{key:"shouldLogXML",value:function(){return this.shouldLogToFile()||this.isVerbose()}},{key:"shouldLogToFile",value:function(){return g["default"].shouldLog()||y["default"].shouldLogToFile()}},{key:"sanitize",value:function(e){return w["default"].sanitize(e)}},{key:"sanitizeXML",value:function(e){return w["default"].sanitizeXML(e)}},{key:"isNativeClient",value:function(){return p["default"].clientSubType.isNative(y["default"].get("client_subtype"))}},{key:"storage",get:function(){return this.isNativeClient()?window.localStorage:window.sessionStorage}}]),e}();e.exports=new T},function(e,t,a){e.exports={"default":a(92),__esModule:!0}},function(e,t,a){var n=a(18);e.exports=function(e){return(n.JSON&&n.JSON.stringify||JSON.stringify).apply(JSON,arguments)}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){}var o=a(59),s=n(o),r=a(9),l=n(r),u=a(94),c=n(u),d=a(95),f=n(d),h=a(171),p=n(h),_=a(176),m=n(_),g=a(177),v=n(g),y=a(99),b=n(y);i.prototype=c["default"].prototype,i.prototype.onNotification=function(e){this.notifier=this.notifier||a(180),this.notifier.notify(e)},i.prototype.onTotalUnreadCountUpdate=function(e,t){this.notifier=this.notifier||a(180),this.notifier.updateTotalUnreadCount(e,t)},i.prototype.getNotificationPermission=function(){return"undefined"!=typeof Notification?"default"!==Notification.permission:void 0},i.prototype.showPreferencesDialog=function(){f["default"].showSettingDialog()},i.prototype.onSignOut=function(e,t){var a=b["default"].getWindowLocation(),n=t.is_guest&&t.guest_key,i=n?b["default"].urls.guestSignOut(t.guest_key):b["default"].urls.signOut(),o=n?1e3:0;n&&e.leaveRoom(t.jid,t.type),e.terminateChatSession(!1),setTimeout(function(){a.href=i},o)},i.prototype.fetchPdfViewerResources=function(e,t){function a(e){var t=void 0;return"pdf-viewer"===e?(t=document.createElement("script"),t.async=!0,t.src=n[e]):"pdf-viewer-css"===e&&(t=document.createElement("link"),t.type="text/css",t.rel="stylesheet",t.href=n[e]),document.head.appendChild(t),new s["default"](function(e,a){t.onload=function(){e(t)},t.onerror=function(e){a(e)}})}var n={"pdf-viewer":t+"vendor/fileviewer-1.4.1/fileviewer-document.custom.min.js","pdf-viewer-css":t+"vendor/fileviewer-1.4.1/fileviewer-document.custom.min.css"};return s["default"].all([a(e),a(e+"-css")])},i.prototype.onStropheAuthFailed=function(e){l["default"].dispatch("signout")},i.prototype.onStrophePolicyViolation=function(e){$(document).trigger("app-error",e)},i.prototype.onReconnectionError=function(e){l["default"].dispatch("signout")},i.prototype.onLogInToAnotherTeam=function(){return window.open("https://www.hipchat.com/sign_in","_blank")},i.prototype.openInternalWindow=function(){var e;return(e=window).open.apply(e,arguments)},i.prototype.openExternalWindow=function(){var e;return(e=window).open.apply(e,arguments)},i.prototype.downloadFile=function(e){return v["default"].downloadFileAtUrl(e)},i.prototype.openExternalWindowWithPromise=function(e){var t=window.open("");return e.then(function(e){return t.location=e,t})["catch"](function(){t.close()})},i.prototype.initializeVideoWindow=function(){for(var e=arguments.length,t=Array(e),a=0;e>a;a++)t[a]=arguments[a];return new s["default"](function(e,a){try{e(new(Function.prototype.bind.apply(p["default"],[null].concat(t))))}catch(n){a(n)}})},i.prototype.prepareVideoWindow=function(e,t){try{var a=window.open("",e,t);return a.document.write('\n      <body style="\n        font-family: Helvetica Neue, Helvetica, Arial, sans-serif;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        margin: 0;\n        padding: 0;\n        ">\n        <p>'+m["default"].connecting+"</p>\n      </body>"),a}catch(n){return!1}},i.prototype.hasActiveVideoSession=function(){return new s["default"](function(e){e(!1)})},i.prototype.handleVideoCallInvite=function(e,t,a){return!1},i.prototype.dismissVideoCallInvite=function(){return!1},i.prototype.onChangeUserStatus=function(e){return!1},i.prototype.onChangeActiveChat=function(e){return!1},e.exports=new i},function(e,t,a){function n(e){return e&&e.__esModule?e:{"default":e}}var i,o=a(59),s=n(o);i=function(){function e(){}return e.prototype.onHostRequestTimeout=function(){return!1},e.prototype.focusApp=function(){return!1},e.prototype.onAppStateReady=function(e){return!1},e.prototype.onReconnectionError=function(e){return!1},e.prototype.onStropheAuthFailed=function(e){return!1},e.prototype.onStropheConnectionFailed=function(e){return!1},e.prototype.onStrophePolicyViolation=function(e){return!1},e.prototype.getNotificationPermission=function(){return!1},e.prototype.onDesktop4DialogShown=function(){return!1},e.prototype.onInternalTokenRefreshed=function(e){return!1},e.prototype.onLoginToAnotherTeam=function(){return!1},e.prototype.onLogMessage=function(e){return!1},e.prototype.onNotification=function(e){return!1},e.prototype.onPreferencesUpdated=function(e){return!1},e.prototype.onRoomActionsChanged=function(e){return!1},e.prototype.onSignOut=function(e,t){return!1},e.prototype.onTotalUnreadCountUpdate=function(e,t){return!1},e.prototype.openInternalWindow=function(e,t,a){return!1},e.prototype.openExternalWindow=function(e,t,a){return!1},e.prototype.openExternalWindowWithPromise=function(e){return e.then(function(e){return this.openExternalWindow(e)}.bind(this))},e.prototype.showFeedbackCollector=function(e){return!1},e.prototype.showFileChooser=function(){return!1},e.prototype.showPreferencesDialog=function(){return window.HC&&window.HC.api&&window.HC.api.showPreferencesDialog?(console.log("showPreferencesDialog - implementation not found - showing default preferences dialog"),window.HC.api.showPreferencesDialog()):!1},e.prototype.buttonClickedProxySettings=function(){return!1},e.prototype.onUnrecoverableError=function(e){return!1},e.prototype.onCloudLoginShow=function(){return!1},e.prototype.onServerLoginShow=function(){return!1},e.prototype.onLegacyDownloadLinkClicked=function(){return!1},e.prototype.onServerOauthLogin=function(){return!1},e.prototype.getLastServerUrl=function(){return!1},e.prototype.initializeVideoWindow=function(e,t,a,n){return new s["default"](function(e){e({focus:function(){},close:function(){}})})},e.prototype.prepareVideoWindow=function(e,t){return!1},e.prototype.handleVideoCallInvite=function(e,t,a){return!1},e.prototype.dismissVideoCallInvite=function(e){return!1},e.prototype.hasActiveVideoSession=function(){return new s["default"](function(e){e(!1)})},e.prototype.callPlaced=function(e,t){return!1},e.prototype.callAnswered=function(e,t){return!1},e.prototype.callDeclined=function(e,t){return!1},e.prototype.callHungup=function(e,t){return!1},e.prototype.addLiveCredentialsReceived=function(e){return!1},e.prototype.downloadFile=function(e){return!1},e.prototype.fetchPdfViewerResources=function(e,t){return new s["default"](function(e){e(!0)})},e.prototype.onChangeUserStatus=function(e){return!1},e.prototype.onChangeActiveChat=function(e){return!1},e}.call(t,a,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i),s=a(96),r=n(s);t["default"]={closeDialog:function(){o["default"].dispatch("hide-modal-dialog")},showAddonDialog:function(e){o["default"].dispatch("show-modal-dialog",{dialog_type:"addon-dialog",dialog_data:{addon_key:e.addon_key,module_key:e.module_key,addon_url:e.addon_url,addon_options:e.addon_options}})},showIntegrationDialog:function(e){o["default"].dispatch("show-modal-dialog",{dialog_type:"integration-dialog",dialog_data:e})},showIntegrationsManagementDialog:function(e){o["default"].dispatch("show-modal-dialog",{dialog_type:"integrations-management-dialog",dialog_data:e})},startBtnLoading:function(){o["default"].dispatch("modal-dialog-btn-loading",{loading:!0})},stopBtnLoading:function(){o["default"].dispatch("modal-dialog-btn-loading",{loading:!1})},showSettingDialog:function(e){o["default"].dispatch("show-modal-dialog",{dialog_type:"settings-dialog",dialog_data:e})},showInviteTeammatesDialog:function(e){var t=r["default"].get("user_is_admin"),a=r["default"].get("invite_url");(t||a)&&o["default"].dispatch("show-modal-dialog",{dialog_type:"invite-teammates-dialog",dialog_data:e||{}})},showInviteUsersDialog:function(e){o["default"].dispatch("show-modal-dialog",{dialog_type:"invite-users-dialog",dialog_data:e||!1})},showRemoveUsersDialog:function(){o["default"].dispatch("show-modal-dialog",{dialog_type:"remove-users-dialog",dialog_data:!1})},showCreateRoomDialog:function(e){o["default"].dispatch("show-modal-dialog",{dialog_type:"create-room-dialog",dialog_data:e||!1})},showRoomPrivacyDialog:function(e){o["default"].dispatch("show-modal-dialog",{dialog_type:"room-privacy-dialog",dialog_data:e})},showRenameRoomDialog:function(e){o["default"].dispatch("show-modal-dialog",{dialog_type:"rename-room-dialog",dialog_data:e})},showDeleteRoomDialog:function(e){o["default"].dispatch("show-modal-dialog",{dialog_type:"delete-room-dialog",dialog_data:e})},showArchiveRoomDialog:function(e){o["default"].dispatch("show-modal-dialog",{dialog_type:"archive-room-dialog",dialog_data:e})},showDisableGuestAccessDialog:function(){o["default"].dispatch("show-modal-dialog",{dialog_type:"disable-guest-dialog",dialog_data:!1})},showRoomNotificationsDialog:function(e){o["default"].dispatch("show-modal-dialog",{dialog_type:"room-notifications-dialog",dialog_data:e})},showKeyboardShortcutsDialog:function(e){o["default"].dispatch("show-modal-dialog",{dialog_type:"keyboard-shortcuts-dialog",dialog_data:{shortcuts:e}})},showQuickSwitcherDialog:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];o["default"].dispatch("show-modal-dialog",{dialog_type:"quick-switcher-dialog",dialog_data:{bgDismiss:!0,hideHint:e===!0}})},showReleaseNotesDialog:function(){o["default"].dispatch("show-modal-dialog",{dialog_type:"release-notes-dialog",dialog_data:{bgDismiss:!0}})},showDesktop4Dialog:function(e){o["default"].dispatch("show-modal-dialog",{dialog_type:"desktop-4-dialog",dialog_data:e})},showEditMessageDialog:function(e){e&&o["default"].dispatch("show-modal-dialog",{dialog_type:"edit-message-dialog",dialog_data:{bgDismiss:!1,message:e}})},showDeleteMessageDialog:function(e){e&&o["default"].dispatch("show-modal-dialog",{dialog_type:"delete-message-dialog",dialog_data:{bgDismiss:!1,message:e}})},showNotEditableDialog:function(e){e&&o["default"].dispatch("show-modal-dialog",{dialog_type:"not-editable-dialog",dialog_data:{action:e.action}})},showWelcomeDialog:function(){o["default"].dispatch("show-modal-dialog",{dialog_type:"welcome-dialog",dialog_data:!1})}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(59),o=n(i),s=a(10),r=n(s),l=a(4),u=n(l),c=a(5),d=n(c),f=a(22),h=n(f),p=a(51),m=n(p),g=a(97),v=n(g),y=a(144),b=n(y),w=a(9),R=n(w),k=a(121),E=n(k),C=a(161),S=n(C),T=function(e){function t(){return(0,u["default"])(this,t),(0,h["default"])(this,(0,r["default"])(t).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"getDefaults",value:function(){return{ready:!1,active_chat:!1,search_text:"",focus_search:!1,notification_supported:"undefined"!=typeof Notification,notification_dismissed:null,notification_dismissed_forever:null,notification_preference:!1,notification_permission:!1,user_is_admin:!1,invite_url:!1,feature_flags:{},web_server:E["default"].default_web_server,banner_shown:!1,client_subtype:!1}}},{key:"registerListeners",value:function(){var e=this;R["default"].registerOnce({"DAL:cache-configured":function(){o["default"].all([b["default"].get(b["default"].Keys.NOTIF_BANNER_DISMISSAL_COUNT),b["default"].get(b["default"].Keys.NOTIF_BANNER_DISMISSED_FOREVER)]).then(function(t){e.set({notification_dismissed:t[0],notification_dismissed_forever:t[1]})})},"app-state-ready":function(){e.set({ready:!0})},"hc-init":function(t){e.handleConfig(t)}}),R["default"].register({"updated:config":function(t){e.handleConfig(t)},"updated:client_subtype":function(t){t&&e.set({client_subtype:t})},"updated:active_chat":function(t){e.set({active_chat:t})},"updated:preferences":function(){e.set({notification_preference:S["default"].getShowToasters(),should_animate_avatar:S["default"].shouldAnimateAvatars()})},"updated:web_server":function(t){e.set("web_server",t)},"search-history":function(t){e.handleSearch(t)},"search-history-externally":function(t){e.handleSearch(t)},"set-search-text":function(t){e.set("search_text",t.text)},"request-notification-permission":function(){Notification.requestPermission()},"dismiss-notification-banner":function(){e.getDismissalCount().then(function(e){var t=e?e+1:1;b["default"].set(b["default"].Keys.NOTIF_BANNER_DISMISSAL_COUNT,t)})},"dismiss-notification-banner-forever":function(){b["default"].set(b["default"].Keys.NOTIF_BANNER_DISMISSED_FOREVER,!0)},"focus-search":function(){e.set("focus_search",!0)},"blur-search":function(){e.set("focus_search",!1)},"notification-banner-status":function(t){e.set("banner_shown",t.shown)}})}},{key:"handleConfig",value:function(e){this.set({user_is_admin:_.get(e,"is_admin",!1),invite_url:_.get(e,"invite_url",!1),feature_flags:_.get(e,"feature_flags",{})})}},{key:"handleSearch",value:function(){this.set("search_text","")}},{key:"getDismissalCount",value:function(){return b["default"].get(b["default"].Keys.NOTIF_BANNER_DISMISSAL_COUNT)}}]),t}(v["default"]);t["default"]=new T,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(51),h=n(f),p=a(98),m=n(p),g=function(e){function t(){(0,r["default"])(this,t);var e=(0,d["default"])(this,(0,o["default"])(t).call(this));return e.data=e.getDefaults(),e.registerListeners(),e._logger_name=_.kebabCase(e.constructor.name),e}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"has",value:function(e){return this.data.hasOwnProperty(e)}},{key:"get",value:function(e){return this.data[e]}},{key:"getAll",value:function(){return this.data}},{key:"setIfNotEqual",value:function(e,t){var a=e;void 0!==t&&(a={},a[e]=t),this.doSet(a,!0)}},{key:"set",value:function(e,t){var a=e;void 0!==t&&(a={},a[e]=t),this.doSet(a,!1)}},{key:"doSet",value:function(e,t){var n=this,i={},o=!1;_.keys(e).forEach(function(s){var r=!t||t&&!_.isEqual(e[s],n.data[s]);if(r){o=!0;var l=n.get(s),u=e[s];n.data[s]=u,i[s]=u,n.emit("change:"+s,u,l);var c=a(90);c.type(n._logger_name+":data:"+s).withFilter().withCallStack().log({new_value:u,old_value:l})}}),(!t||t&&o)&&this.emit("change",i)}},{key:"unset",value:function(e){if(this.has(e)){var t=this.get(e);delete this.data[e],this.emit("change:"+e,void 0,t)}}},{key:"clear",value:function(){var e=this,t={};_.keys(this.data).forEach(function(a){t[a]=e.get(a),e.unset(a)}),this.emit("change",t)}},{key:"registerListeners",value:function(){}},{key:"getDefaults",value:function(){return{}}},{key:"reset",value:function(){this.data=this.getDefaults()}}]),t}(m["default"]);e.exports=g},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(47),h=n(f),p=a(51),_=n(p),m=a(99),g=a(89).EventEmitter,v=function(e){function t(){return(0,r["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,_["default"])(t,e),(0,u["default"])(t,[{key:"on",value:function(e,a){var n=this;m.toArray(e).forEach(function(e){return(0,h["default"])((0,o["default"])(t.prototype),"on",n).call(n,e,a)})}},{key:"once",value:function(e,a){var n=this;m.toArray(e).forEach(function(e){return(0,h["default"])((0,o["default"])(t.prototype),"once",n).call(n,e,a)})}},{key:"off",value:function(e,a){var n=this;m.toArray(e).forEach(function(e){return(0,h["default"])((0,o["default"])(t.prototype),"removeListener",n).call(n,e,a)})}}]),t}(g);e.exports=v},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(59),o=n(i),s=a(100),r=n(s),l=a(103),u=n(l),c=a(105),d=n(c),f=a(110),h=n(f),p=a(122),m=n(p),g=a(109),v=n(g),y=a(125),b=n(y),w=a(126),R=n(w),k=a(132),E=n(k),C=a(133),S=n(C),T=a(141),x=n(T),A=a(121),I=n(A),N=a(142),M=n(N),O=x["default"].connect_api_version,D=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},P={TRUNCATE_CHARS:800,TRUNCATE_LINES:6,emoticons:h["default"].init(),file:m["default"],jid:v["default"],room:b["default"],user:R["default"],browser:S["default"],video:E["default"],platform:C.platform,clientSubType:C.clientSubType,roster_names:{},now:function(){return(new Date).getTime()},decorrelatedJitter:function(e,t,a,n){return Math.min(e,D(t,a*n))},escapeRegEx:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return e.replace(/[-\\^$*+?.()|\[\]{}]/g,"\\$&")},getWindowLocation:function(){return window.location},url:{clearWebCookies:function(e){return _.isString(e)?"https://"+e+"/users/clear_cookies":void 0},revokeOauth2Token:function(e,t){return _.isString(e)&&t?"https://"+e+"/v2/oauth/token/"+t:void 0},featureFlagsAPI:function(e){return _.isString(e)?e+"/api/features":void 0},networkCheckAPI:function(e){return _.isString(e)?"https://"+e+"/v2/health-check":void 0}},mergeAndSquash:function(e,t){var a=_.merge(e,t);return"jid"in a&&(a.key=a.jid.split("@")[0]),_.forEach(a,function(e,t){/^_/.test(t)&&a.hasOwnProperty(t.substring(1))&&delete a[t]}),a},camelToSnake:function(e){return e.replace(/\W+/g,"_").replace(/([a-z\d])([A-Z])/g,"$1_$2").toLowerCase()},coerceBoolean:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];switch(e){case!0:case"true":case"True":case 1:case"1":return!0;case!1:case"false":case"False":case 0:case"0":return!1;default:return t}},generateMID:function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var a=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?a:7&a|8).toString(16)});return t},validateMID:function(e){var t=/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/i;return t.test(e)},getAttachToMid:function(e){return _.get(e,"attach-to.id")},isAttachedCardsCollapsed:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];return _.get(e,"is_attached_cards_collapsed",t)},getRealMid:function(e){return e.split("-link")[0]},format_time:function(e,t){var a=t?"HH:mm":"h:mm A";return e?(e=/^-?\d*\.?\d*$/.test(e)?u["default"].unix(e):(0,u["default"])(e),this.getCurrentTime().isSame(e,"day")||(a="MMM-D "+a),e.format(a)):this.getCurrentTime().format(a)},getTimestampFromIsoDate:function(e){var t=(0,u["default"])(e),a=e?t.unix():0,n=e?e.split(".")[1].split(/\+\d\d|Z/)[0]:0;return Number(a+"."+n)},getCurrentTime:function(){return(0,u["default"])()},getDateDiff:function(e,t,a){var n=(0,u["default"])(e),i=(0,u["default"])(t);return i.diff(n,a)},format_time_for_history:function(e){var t=u["default"].utc(e,"X"),a=t.format("YYYY-MM-DDTHH:mm:ss"),n=t.format("SSSSSS");return a+"Z "+n},format_time_for_separator:function(e){return u["default"].unix(e).format("dddd MMMM D, YYYY")},getMoment:function(e){var t=e?(0,u["default"])(e):(0,u["default"])();return parseInt(t.format("x"),10)/1e3},toArray:function(e){return _.isArray(e)?e:[e]},escape:function(e){return e?(e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;")):e},get_roster_name:function(e){var t="";if(!_.isEmpty(P.roster_names)){var a=" "+(0,r["default"])(P.roster_names).join(" ")+" ",n=new RegExp("\\s"+e+"\\s","i"),i=n.exec(a);i&&(t=P.roster_names[i[0].trim()])}return t},formatMessageBody:function(e){return e},replaceEmoteMessage:function(e,t){return e.replace(I["default"].emote_regex,t+" ")},escapeAndLinkify:function(e,t){var a=this;if(!e)return e;"string"!=typeof e&&(e=e.toString()),t=_.defaults(t||{},{name_tag_regex:null,mention_regex:null,escape_whitespace:!1,matches:null,do_escape:!0,do_linkify:!0,do_emoticons:!0,do_word_breaks:!0,do_mentions:!0,do_hex_colors:!0});var n=_.result(t,"name_tag_regex"),i=_.result(t,"mention_regex"),o=_.result(t,"guest_regex"),s=_.result(t,"escape_whitespace"),r=_.result(t,"matches"),l=_.result(t,"do_escape"),u=_.result(t,"do_linkify"),c=_.result(t,"do_emoticons"),f=_.result(t,"do_word_breaks"),p=_.result(t,"do_mentions"),m=_.result(t,"do_hex_colors"),g="\n",v=" ";return e=e.split(g).map(function(e){return e.split(v).map(function(e){l&&(e=a.escape(e));var t=!1;if(u){var s=[];e=d["default"].linkify(e,s,{truncate_length:100,
no_referrer:!0,add_wbrs:f}),t=!_.isEmpty(s),r=_.union(r,s)}if(m&&(e=e.replace(/(?:^)(#[\da-fA-F]{6})\b/gm,"$1 <span class='hexPreview' style='background-color: $1'>&nbsp;</span>")),!t&&c&&(e=h["default"].render(e)),!t&&p){var g=void 0,v=void 0,y=void 0;if(n&&(g=e.match(n),g&&g.length)){var b=g[0].substr(1),w=_.escape(P.get_roster_name(b)).replace("@","&#64;"),R="<span class='hc-mention-user hc-mention-me' aria-label='"+w+"'>@$1</span>";e=e.replace(n,R)}if(i&&(v=e.match(i),v&&v[0])){var k=v[0].substr(1),E=_.escape(P.get_roster_name(k)).replace("@","&#64;"),C="<span class='hc-mention-user'><a onClick='HC.Actions.AppActions.openChatByMentionName(this)' aria-label='"+E+"' data-mention-name='$1'>@$1</a></span>";e=e.replace(i,C)}if(o&&(y=e.match(o),y&&y[0]&&!g&&!v)){var S=y[0].substr(1),T=_.escape(P.get_roster_name(S)).replace("@","&#64;"),x="<span class='hc-mention-user'><a title='"+T+"' data-mention-name='$1'>@$1</a></span>";e=e.replace(o,x)}}return e}).join(v)}).join(g),s&&(e=e.replace(/\r\n/g,"\n").replace(/[\r\n\u2028]/g,"<br />")),r&&0===r.length&&f&&!/[<>]/.test(e)&&(e=e.replace(/(,)/g,"$1<wbr>"),e=e.replace(/([^<>\s&;]{70})/g,"$1<wbr>")),s&&(-1!==e.indexOf("  ")&&(e=e.replace(/ {2}/g,"&ensp;&ensp;")),-1!==e.indexOf("	")&&(e=e.replace(/\t/g,"&ensp;&ensp;"))),e},getNumberOfLines:function(e){var t=e.match(/<br\s*\/?>/);return t&&0!==t.length||(t=e.match(/[\n\r\u2028]+.+/g)),t?t.length+1:1},messageShouldBeTruncated:function(e){return P.getNumberOfLines(e)>=P.TRUNCATE_LINES||e.length>=P.TRUNCATE_CHARS},fetch:function(e,t){return e||t},formatNumber:function(e){return"string"!=typeof e&&e.toString&&(e=e.toString()),e.replace(/\B(?=(\d{3})+(?!\d))/g,",")||e},formatMultilineBlock:function(e){var t=e.match(/\n.+/gm);if(!t)return e;var a=t.length+1;if(a>1)for(t=e.match(/^( {2}|\t)/gm);t&&t.length===a;)e=e.replace(/^( {2}|\t)/gm,""),t=e.match(/^( {2}|\t)/gm);return e},isFormattedMessage:function(e){return"monospace"===e.format||"code"===e.format||"quotation"===e.format},isHistoryMessage:function(e){return"undefined"!=typeof e.delay&&!e.id},getSenderFromMeta:function(e){var t;switch(e){case"video":t="Video";break;case"twitter_status":case"twitter_user":t="Twitter";break;case"link":t="Link";break;default:t="HipChat"}return t},getCaretPosition:function(e){if("selectionStart"in e)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange(),a=document.selection.createRange().text.length;return t.moveStart("character",-e.value.length),t.text.length-a}},getEndSelection:function(e){return e.selectionEnd},setCaretPosition:function(e,t){try{if(e.createTextRange){var a=e.createTextRange();a.move("character",t),a.select()}else _.isUndefined(e.selectionStart)?e.focus():(e.focus(),e.setSelectionRange(t,t),e.focus())}catch(n){}},scrollIntoViewIfNeeded:function(e,t,a){if(a=0===arguments.length?!0:!!a,e){if("scrollIntoViewIfNeeded"in e)return void e.scrollIntoViewIfNeeded(a);var n=window.getComputedStyle(t,null),i=parseInt(n.getPropertyValue("border-top-width"),10)||0,o=parseInt(n.getPropertyValue("border-left-width"),10)||0,s=e.offsetTop-t.offsetTop<t.scrollTop,r=e.offsetTop-t.offsetTop+e.clientHeight-i>t.scrollTop+t.clientHeight,l=e.offsetLeft-t.offsetLeft<t.scrollLeft,u=e.offsetLeft-t.offsetLeft+e.clientWidth-o>t.scrollLeft+t.clientWidth,c=s&&!r;(s||r)&&a&&(t.scrollTop=e.offsetTop-t.offsetTop-t.clientHeight/2-i+e.clientHeight/2),(l||u)&&a&&(t.scrollLeft=e.offsetLeft-t.offsetLeft-t.clientWidth/2-o+e.clientWidth/2),(s||r||l||u)&&!a&&e.scrollIntoView(c)}},createSafePredicate:function(e,t){return function(){try{return e.apply(t,arguments)}catch(a){return!0}}},appendQueryParameter:function(e,t,a){if(_.startsWith(e,"data:"))return e;var n=M["default"].parse(e);return n.setParameterValues(t,a),n.toString()},setHashFragment:function(e,t){if(_.startsWith(e,"data:"))return e;var a=M["default"].parse(e);return a.setFragment(t),a.toString()},addConnectApiVersionToUrl:function(e){return this.appendQueryParameter(e,"connect_client_api_version",O)},strings:{ellipsis:function j(e,t){var a,j="...";return _.isString(e)&&(e=e.trim(),e.length>t?(a=e.substring(0,t-j.length),a=a.trim(),a=a.concat(j)):a=e),a||""},splitUnit:function(e){var t=e.match("(^[0-9.]+)(.*)$");return t?{num:Number(t[1]),unit:t[2]}:null},stripHiddenCharacters:function(e){return"string"!=typeof e?e:e.replace(/(?:[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g,"")}},roster:{format_for_select2:function(e,t){var a,n=_.keys(t),i=_.difference(n,e);return a=_.sortBy(_.map(i,function(e){return t[e]}),function(e){return e.name}),_.map(a,function(e){return{id:e.jid,text:e.name}})},get_non_guest_users:function(e){return _.transform(e,function(e,t,a){return t.is_guest||(e[a]=t),e})}},highlight_matches:function(e,t){var a=_.escape(e);if(_.isString(t))return t=_.escape(t),a.replace(t,"<strong>"+t+"</strong>");var n=0;return _.reduce(t,function(e,t){t=_.escape(t);var i=a.indexOf(t,n),o=a.slice(n,i);return n=i+t.length,e.concat(o+"<strong>"+t+"</strong>")},"").concat(a.slice(n))},promise:{defer:function(){var e={};return e.promise=new o["default"](function(t,a){e.resolve=t,e.reject=a}),e}},alphaNumeric:function(e){var t="abcdefghijklmnopqrstuvwxyz0123456789",a="";return _.times(e,function(){a+=t.charAt(Math.floor(Math.random()*t.length))}),a},timings:{getPerfTiming:function(){var e=["unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"];if(window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart){var t={};return e.forEach(function(e){var a=window.performance.timing[e]-window.performance.timing.navigationStart;a>0&&(t[e]=a)}),t}return{}},now:function(){return window.performance?window.performance.now():Date.now()}},keyCode:{LeftArrow:37,UpArrow:38,RightArrow:39,DownArrow:40,Home:36,End:35,Enter:13,Esc:27,Tab:9,PageUp:33,PageDown:34,Delete:46,Backspace:8,Space:32,isSelected:function(e){return e.shiftKey&&(e.keyCode===this.LeftArrow||e.keyCode===this.RightArrow)},isModified:function(e){return e.shiftKey||e.ctrlKey||e.altKey||e.metaKey}},getFixedHtml:function(e){var t=document.createElement("div");return t.innerHTML=e,t.innerHTML},urls:{signOut:function(){return"/home?src=chat_exit"},guestSignOut:function(e){return e?"/g"+e+"?src=chat_exit":void 0}},request:{getXHR:function(){return new XMLHttpRequest},simplePost:function(e){var t=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1],a=arguments.length<=2||void 0===arguments[2]?this.getXHR():arguments[2];_.isString(e)&&a&&(a.open("POST",e,!0),a.onreadystatechange=function(){4===a.readyState&&t(a.responseText)},a.send())}},image:{load:function(e,t){return new o["default"](function(a,n){var i=new Image,o=null,s=function(){o&&clearTimeout(o),i.onload=i.onerror=null};i.onload=function(){s(),a(i)},i.onerror=function(){s(),n()},o=setTimeout(function(){s(),n()},t),i.src=e})},changeSrc:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?1e4:arguments[2];return new o["default"](function(n,i){var o=setTimeout(function(){e.onload=e.onerror=null,i()},a);e.onload=function(){e._isLoaded=!0,clearTimeout(o),n(e)},e.onerror=function(){clearTimeout(o),i.apply(void 0,arguments)},e.src=t})},resizeImage:function(e){var t=this,a=arguments.length<=1||void 0===arguments[1]?150:arguments[1],n=arguments.length<=2||void 0===arguments[2]?100:arguments[2];return new o["default"](function(i,o){var s=document.createElement("canvas"),r=void 0;t.load(e,I["default"].message_image_loading_timeout).then(function(e){var l=void 0,u=void 0;r=e.naturalWidth/e.naturalHeight,r>=1&&e.naturalWidth>a?(u=e.naturalHeight*(a/e.naturalWidth),l=a):e.naturalHeight>n?(l=e.naturalWidth*(n/e.naturalHeight),u=n):(l=e.naturalWidth,u=e.naturalHeight),s.width=l,s.height=u;var c=s.getContext("2d");if(c.drawImage(e,0,0,l,u),s.toBlob)s.toBlob(i);else if(s.msToBlob){var d=s.msToBlob();i(d)}else if(s.toDataURL&&t._checkImageSize(e)){var f=s.toDataURL();i(P.file.base64_to_blob(f))}else o(new Error("Could not save processed image"))})})},_checkImageSize:function(e){return e.naturalHeight<=I["default"].max_image_size_for_base64&&e.naturalWidth<=I["default"].max_image_size_for_base64}},features:{reconcileFeatureFlags:function(e,t){var a=_.isObject(e)?e:{},n=_.isObject(t)?t:{};return _.assign({},n,a)},btf_capabilities:function(e){var t=e.hasOwnProperty("xmpp_compression"),a=e.hasOwnProperty("web_client_reconnect_header"),n={};return n.nonce=t,n.oauth=a,n}},dom:{findParentMatching:function(e,t){for(var a=arguments.length<=2||void 0===arguments[2]?null:arguments[2],n=e,i=null;n;){if(t(n)){i=n;break}if(n.parentElement===document.body||a&&n.parentElement===a)break;n=n.parentElement}return i},matchers:{tag:function(e){return function(t){return t.tagName===e.toUpperCase()}}}},xml:{toString:function(e){return(new XMLSerializer).serializeToString(e)}},mouseButton:{left:1,middle:2,right:3}};t["default"]=P,e.exports=t["default"]},function(e,t,a){e.exports={"default":a(101),__esModule:!0}},function(e,t,a){a(102),e.exports=a(18).Object.keys},function(e,t,a){var n=a(13);a(15)("keys",function(e){return function(t){return e(n(t))}})},function(e,t,a){(function(e){!function(t,a){e.exports=a()}(this,function(){"use strict";function t(){return Qa.apply(null,arguments)}function a(e){Qa=e}function n(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function i(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function o(e,t){var a,n=[];for(a=0;a<e.length;++a)n.push(t(e[a],a));return n}function s(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function r(e,t){for(var a in t)s(t,a)&&(e[a]=t[a]);return s(t,"toString")&&(e.toString=t.toString),s(t,"valueOf")&&(e.valueOf=t.valueOf),e}function l(e,t,a,n){return Pe(e,t,a,n,!0).utc()}function u(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function c(e){return null==e._pf&&(e._pf=u()),e._pf}function d(e){if(null==e._isValid){var t=c(e);e._isValid=!(isNaN(e._d.getTime())||!(t.overflow<0)||t.empty||t.invalidMonth||t.invalidWeekday||t.nullInput||t.invalidFormat||t.userInvalidated),e._strict&&(e._isValid=e._isValid&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour)}return e._isValid}function f(e){var t=l(NaN);return null!=e?r(c(t),e):c(t).userInvalidated=!0,t}function h(e){return void 0===e}function p(e,t){var a,n,i;if(h(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),h(t._i)||(e._i=t._i),h(t._f)||(e._f=t._f),h(t._l)||(e._l=t._l),h(t._strict)||(e._strict=t._strict),h(t._tzm)||(e._tzm=t._tzm),h(t._isUTC)||(e._isUTC=t._isUTC),h(t._offset)||(e._offset=t._offset),h(t._pf)||(e._pf=c(t)),h(t._locale)||(e._locale=t._locale),Za.length>0)for(a in Za)n=Za[a],i=t[n],h(i)||(e[n]=i);return e}function _(e){p(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),en===!1&&(en=!0,t.updateOffset(this),en=!1)}function m(e){return e instanceof _||null!=e&&null!=e._isAMomentObject}function g(e){return 0>e?Math.ceil(e):Math.floor(e)}function v(e){var t=+e,a=0;return 0!==t&&isFinite(t)&&(a=g(t)),a}function y(e,t,a){var n,i=Math.min(e.length,t.length),o=Math.abs(e.length-t.length),s=0;for(n=0;i>n;n++)(a&&e[n]!==t[n]||!a&&v(e[n])!==v(t[n]))&&s++;return s+o}function b(e){t.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function w(e,t){var a=!0;return r(function(){return a&&(b(e+"\nArguments: "+Array.prototype.slice.call(arguments).join(", ")+"\n"+(new Error).stack),a=!1),t.apply(this,arguments)},t)}function R(e,t){tn[e]||(b(t),tn[e]=!0)}function k(e){return e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function E(e){return"[object Object]"===Object.prototype.toString.call(e)}function C(e){var t,a;for(a in e)t=e[a],k(t)?this[a]=t:this["_"+a]=t;this._config=e,this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function S(e,t){var a,n=r({},e);for(a in t)s(t,a)&&(E(e[a])&&E(t[a])?(n[a]={},r(n[a],e[a]),r(n[a],t[a])):null!=t[a]?n[a]=t[a]:delete n[a]);return n}function T(e){null!=e&&this.set(e)}function x(e){return e?e.toLowerCase().replace("_","-"):e}function A(e){for(var t,a,n,i,o=0;o<e.length;){for(i=x(e[o]).split("-"),t=i.length,a=x(e[o+1]),a=a?a.split("-"):null;t>0;){if(n=I(i.slice(0,t).join("-")))return n;if(a&&a.length>=t&&y(i,a,!0)>=t-1)break;t--}o++}return null}function I(t){var a=null;if(!nn[t]&&"undefined"!=typeof e&&e&&e.exports)try{a=an._abbr,!function(){var e=new Error('Cannot find module "./locale"');throw e.code="MODULE_NOT_FOUND",e}(),N(a)}catch(n){}return nn[t]}function N(e,t){var a;return e&&(a=h(t)?D(e):M(e,t),a&&(an=a)),an._abbr}function M(e,t){return null!==t?(t.abbr=e,null!=nn[e]?(R("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale"),t=S(nn[e]._config,t)):null!=t.parentLocale&&(null!=nn[t.parentLocale]?t=S(nn[t.parentLocale]._config,t):R("parentLocaleUndefined","specified parentLocale is not defined yet")),nn[e]=new T(t),N(e),nn[e]):(delete nn[e],null)}function O(e,t){if(null!=t){var a;null!=nn[e]&&(t=S(nn[e]._config,t)),a=new T(t),a.parentLocale=nn[e],nn[e]=a,N(e)}else null!=nn[e]&&(null!=nn[e].parentLocale?nn[e]=nn[e].parentLocale:null!=nn[e]&&delete nn[e]);return nn[e]}function D(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return an;if(!n(e)){if(t=I(e))return t;e=[e]}return A(e)}function P(){return Object.keys(nn)}function j(e,t){var a=e.toLowerCase();on[a]=on[a+"s"]=on[t]=e}function L(e){return"string"==typeof e?on[e]||on[e.toLowerCase()]:void 0}function F(e){var t,a,n={};for(a in e)s(e,a)&&(t=L(a),t&&(n[t]=e[a]));return n}function U(e,a){return function(n){return null!=n?(B(this,e,n),t.updateOffset(this,a),this):H(this,e)}}function H(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function B(e,t,a){e.isValid()&&e._d["set"+(e._isUTC?"UTC":"")+t](a)}function z(e,t){var a;if("object"==typeof e)for(a in e)this.set(a,e[a]);else if(e=L(e),k(this[e]))return this[e](t);return this}function q(e,t,a){var n=""+Math.abs(e),i=t-n.length,o=e>=0;return(o?a?"+":"":"-")+Math.pow(10,Math.max(0,i)).toString().substr(1)+n}function V(e,t,a,n){var i=n;"string"==typeof n&&(i=function(){return this[n]()}),e&&(un[e]=i),t&&(un[t[0]]=function(){return q(i.apply(this,arguments),t[1],t[2])}),a&&(un[a]=function(){return this.localeData().ordinal(i.apply(this,arguments),e)})}function G(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function W(e){var t,a,n=e.match(sn);for(t=0,a=n.length;a>t;t++)un[n[t]]?n[t]=un[n[t]]:n[t]=G(n[t]);return function(i){var o="";for(t=0;a>t;t++)o+=n[t]instanceof Function?n[t].call(i,e):n[t];return o}}function $(e,t){return e.isValid()?(t=Y(t,e.localeData()),ln[t]=ln[t]||W(t),ln[t](e)):e.localeData().invalidDate()}function Y(e,t){function a(e){return t.longDateFormat(e)||e}var n=5;for(rn.lastIndex=0;n>=0&&rn.test(e);)e=e.replace(rn,a),rn.lastIndex=0,n-=1;return e}function K(e,t,a){Tn[e]=k(t)?t:function(e,n){return e&&a?a:t}}function X(e,t){return s(Tn,e)?Tn[e](t._strict,t._locale):new RegExp(J(e))}function J(e){return Q(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,a,n,i){return t||a||n||i}))}function Q(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Z(e,t){var a,n=t;for("string"==typeof e&&(e=[e]),"number"==typeof t&&(n=function(e,a){a[t]=v(e)}),a=0;a<e.length;a++)xn[e[a]]=n}function ee(e,t){Z(e,function(e,a,n,i){n._w=n._w||{},t(e,n._w,n,i)})}function te(e,t,a){null!=t&&s(xn,e)&&xn[e](t,a._a,a,e)}function ae(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function ne(e,t){return n(this._months)?this._months[e.month()]:this._months[Fn.test(t)?"format":"standalone"][e.month()]}function ie(e,t){return n(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[Fn.test(t)?"format":"standalone"][e.month()]}function oe(e,t,a){var n,i,o;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),n=0;12>n;n++){if(i=l([2e3,n]),a&&!this._longMonthsParse[n]&&(this._longMonthsParse[n]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[n]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),a||this._monthsParse[n]||(o="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[n]=new RegExp(o.replace(".",""),"i")),a&&"MMMM"===t&&this._longMonthsParse[n].test(e))return n;if(a&&"MMM"===t&&this._shortMonthsParse[n].test(e))return n;if(!a&&this._monthsParse[n].test(e))return n}}function se(e,t){var a;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=v(t);else if(t=e.localeData().monthsParse(t),"number"!=typeof t)return e;return a=Math.min(e.date(),ae(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,a),e}function re(e){return null!=e?(se(this,e),t.updateOffset(this,!0),this):H(this,"Month")}function le(){return ae(this.year(),this.month())}function ue(e){return this._monthsParseExact?(s(this,"_monthsRegex")||de.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex}function ce(e){return this._monthsParseExact?(s(this,"_monthsRegex")||de.call(this),e?this._monthsStrictRegex:this._monthsRegex):this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex}function de(){function e(e,t){return t.length-e.length}var t,a,n=[],i=[],o=[];for(t=0;12>t;t++)a=l([2e3,t]),n.push(this.monthsShort(a,"")),i.push(this.months(a,"")),o.push(this.months(a,"")),o.push(this.monthsShort(a,""));for(n.sort(e),i.sort(e),o.sort(e),t=0;12>t;t++)n[t]=Q(n[t]),i[t]=Q(i[t]),o[t]=Q(o[t]);this._monthsRegex=new RegExp("^("+o.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+i.join("|")+")$","i"),this._monthsShortStrictRegex=new RegExp("^("+n.join("|")+")$","i")}function fe(e){var t,a=e._a;return a&&-2===c(e).overflow&&(t=a[In]<0||a[In]>11?In:a[Nn]<1||a[Nn]>ae(a[An],a[In])?Nn:a[Mn]<0||a[Mn]>24||24===a[Mn]&&(0!==a[On]||0!==a[Dn]||0!==a[Pn])?Mn:a[On]<0||a[On]>59?On:a[Dn]<0||a[Dn]>59?Dn:a[Pn]<0||a[Pn]>999?Pn:-1,c(e)._overflowDayOfYear&&(An>t||t>Nn)&&(t=Nn),c(e)._overflowWeeks&&-1===t&&(t=jn),c(e)._overflowWeekday&&-1===t&&(t=Ln),c(e).overflow=t),e}function he(e){var t,a,n,i,o,s,r=e._i,l=qn.exec(r)||Vn.exec(r);if(l){for(c(e).iso=!0,t=0,a=Wn.length;a>t;t++)if(Wn[t][1].exec(l[1])){i=Wn[t][0],n=Wn[t][2]!==!1;break}if(null==i)return void(e._isValid=!1);if(l[3]){for(t=0,a=$n.length;a>t;t++)if($n[t][1].exec(l[3])){o=(l[2]||" ")+$n[t][0];break}if(null==o)return void(e._isValid=!1)}if(!n&&null!=o)return void(e._isValid=!1);if(l[4]){if(!Gn.exec(l[4]))return void(e._isValid=!1);s="Z"}e._f=i+(o||"")+(s||""),xe(e)}else e._isValid=!1}function pe(e){var a=Yn.exec(e._i);return null!==a?void(e._d=new Date(+a[1])):(he(e),void(e._isValid===!1&&(delete e._isValid,t.createFromInputFallback(e))))}function _e(e,t,a,n,i,o,s){var r=new Date(e,t,a,n,i,o,s);return 100>e&&e>=0&&isFinite(r.getFullYear())&&r.setFullYear(e),r}function me(e){var t=new Date(Date.UTC.apply(null,arguments));return 100>e&&e>=0&&isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e),t}function ge(e){return ve(e)?366:365}function ve(e){return e%4===0&&e%100!==0||e%400===0}function ye(){return ve(this.year())}function be(e,t,a){var n=7+t-a,i=(7+me(e,0,n).getUTCDay()-t)%7;return-i+n-1}function we(e,t,a,n,i){var o,s,r=(7+a-n)%7,l=be(e,n,i),u=1+7*(t-1)+r+l;return 0>=u?(o=e-1,s=ge(o)+u):u>ge(e)?(o=e+1,s=u-ge(e)):(o=e,s=u),{year:o,dayOfYear:s}}function Re(e,t,a){var n,i,o=be(e.year(),t,a),s=Math.floor((e.dayOfYear()-o-1)/7)+1;return 1>s?(i=e.year()-1,n=s+ke(i,t,a)):s>ke(e.year(),t,a)?(n=s-ke(e.year(),t,a),i=e.year()+1):(i=e.year(),n=s),{week:n,year:i}}function ke(e,t,a){var n=be(e,t,a),i=be(e+1,t,a);return(ge(e)-n+i)/7}function Ee(e,t,a){return null!=e?e:null!=t?t:a}function Ce(e){var a=new Date(t.now());return e._useUTC?[a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()]:[a.getFullYear(),a.getMonth(),a.getDate()]}function Se(e){var t,a,n,i,o=[];if(!e._d){for(n=Ce(e),e._w&&null==e._a[Nn]&&null==e._a[In]&&Te(e),e._dayOfYear&&(i=Ee(e._a[An],n[An]),e._dayOfYear>ge(i)&&(c(e)._overflowDayOfYear=!0),a=me(i,0,e._dayOfYear),e._a[In]=a.getUTCMonth(),e._a[Nn]=a.getUTCDate()),t=0;3>t&&null==e._a[t];++t)e._a[t]=o[t]=n[t];for(;7>t;t++)e._a[t]=o[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[Mn]&&0===e._a[On]&&0===e._a[Dn]&&0===e._a[Pn]&&(e._nextDay=!0,e._a[Mn]=0),e._d=(e._useUTC?me:_e).apply(null,o),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[Mn]=24)}}function Te(e){var t,a,n,i,o,s,r,l;t=e._w,null!=t.GG||null!=t.W||null!=t.E?(o=1,s=4,a=Ee(t.GG,e._a[An],Re(je(),1,4).year),n=Ee(t.W,1),i=Ee(t.E,1),(1>i||i>7)&&(l=!0)):(o=e._locale._week.dow,s=e._locale._week.doy,a=Ee(t.gg,e._a[An],Re(je(),o,s).year),n=Ee(t.w,1),null!=t.d?(i=t.d,(0>i||i>6)&&(l=!0)):null!=t.e?(i=t.e+o,(t.e<0||t.e>6)&&(l=!0)):i=o),1>n||n>ke(a,o,s)?c(e)._overflowWeeks=!0:null!=l?c(e)._overflowWeekday=!0:(r=we(a,n,i,o,s),e._a[An]=r.year,e._dayOfYear=r.dayOfYear)}function xe(e){if(e._f===t.ISO_8601)return void he(e);e._a=[],c(e).empty=!0;var a,n,i,o,s,r=""+e._i,l=r.length,u=0;for(i=Y(e._f,e._locale).match(sn)||[],a=0;a<i.length;a++)o=i[a],n=(r.match(X(o,e))||[])[0],n&&(s=r.substr(0,r.indexOf(n)),s.length>0&&c(e).unusedInput.push(s),r=r.slice(r.indexOf(n)+n.length),u+=n.length),un[o]?(n?c(e).empty=!1:c(e).unusedTokens.push(o),te(o,n,e)):e._strict&&!n&&c(e).unusedTokens.push(o);c(e).charsLeftOver=l-u,r.length>0&&c(e).unusedInput.push(r),c(e).bigHour===!0&&e._a[Mn]<=12&&e._a[Mn]>0&&(c(e).bigHour=void 0),e._a[Mn]=Ae(e._locale,e._a[Mn],e._meridiem),Se(e),fe(e)}function Ae(e,t,a){var n;return null==a?t:null!=e.meridiemHour?e.meridiemHour(t,a):null!=e.isPM?(n=e.isPM(a),n&&12>t&&(t+=12),n||12!==t||(t=0),t):t}function Ie(e){var t,a,n,i,o;if(0===e._f.length)return c(e).invalidFormat=!0,void(e._d=new Date(NaN));for(i=0;i<e._f.length;i++)o=0,t=p({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[i],xe(t),d(t)&&(o+=c(t).charsLeftOver,o+=10*c(t).unusedTokens.length,c(t).score=o,(null==n||n>o)&&(n=o,a=t));r(e,a||t)}function Ne(e){if(!e._d){var t=F(e._i);e._a=o([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),Se(e)}}function Me(e){var t=new _(fe(Oe(e)));return t._nextDay&&(t.add(1,"d"),t._nextDay=void 0),t}function Oe(e){var t=e._i,a=e._f;return e._locale=e._locale||D(e._l),null===t||void 0===a&&""===t?f({nullInput:!0}):("string"==typeof t&&(e._i=t=e._locale.preparse(t)),m(t)?new _(fe(t)):(n(a)?Ie(e):a?xe(e):i(t)?e._d=t:De(e),d(e)||(e._d=null),e))}function De(e){var a=e._i;void 0===a?e._d=new Date(t.now()):i(a)?e._d=new Date(+a):"string"==typeof a?pe(e):n(a)?(e._a=o(a.slice(0),function(e){return parseInt(e,10)}),Se(e)):"object"==typeof a?Ne(e):"number"==typeof a?e._d=new Date(a):t.createFromInputFallback(e)}function Pe(e,t,a,n,i){var o={};return"boolean"==typeof a&&(n=a,a=void 0),o._isAMomentObject=!0,o._useUTC=o._isUTC=i,o._l=a,o._i=e,o._f=t,o._strict=n,Me(o)}function je(e,t,a,n){return Pe(e,t,a,n,!1)}function Le(e,t){var a,i;if(1===t.length&&n(t[0])&&(t=t[0]),!t.length)return je();for(a=t[0],i=1;i<t.length;++i)t[i].isValid()&&!t[i][e](a)||(a=t[i]);return a}function Fe(){var e=[].slice.call(arguments,0);return Le("isBefore",e)}function Ue(){var e=[].slice.call(arguments,0);return Le("isAfter",e)}function He(e){var t=F(e),a=t.year||0,n=t.quarter||0,i=t.month||0,o=t.week||0,s=t.day||0,r=t.hour||0,l=t.minute||0,u=t.second||0,c=t.millisecond||0;this._milliseconds=+c+1e3*u+6e4*l+36e5*r,this._days=+s+7*o,this._months=+i+3*n+12*a,this._data={},this._locale=D(),this._bubble()}function Be(e){return e instanceof He}function ze(e,t){V(e,0,0,function(){var e=this.utcOffset(),a="+";return 0>e&&(e=-e,a="-"),a+q(~~(e/60),2)+t+q(~~e%60,2)})}function qe(e,t){var a=(t||"").match(e)||[],n=a[a.length-1]||[],i=(n+"").match(Zn)||["-",0,0],o=+(60*i[1])+v(i[2]);return"+"===i[0]?o:-o}function Ve(e,a){var n,o;return a._isUTC?(n=a.clone(),o=(m(e)||i(e)?+e:+je(e))-+n,n._d.setTime(+n._d+o),t.updateOffset(n,!1),n):je(e).local()}function Ge(e){return 15*-Math.round(e._d.getTimezoneOffset()/15)}function We(e,a){var n,i=this._offset||0;return this.isValid()?null!=e?("string"==typeof e?e=qe(En,e):Math.abs(e)<16&&(e=60*e),!this._isUTC&&a&&(n=Ge(this)),this._offset=e,this._isUTC=!0,null!=n&&this.add(n,"m"),i!==e&&(!a||this._changeInProgress?ut(this,nt(e-i,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,t.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?i:Ge(this):null!=e?this:NaN}function $e(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}function Ye(e){return this.utcOffset(0,e)}function Ke(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Ge(this),"m")),this}function Xe(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(qe(kn,this._i)),this}function Je(e){return this.isValid()?(e=e?je(e).utcOffset():0,(this.utcOffset()-e)%60===0):!1}function Qe(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Ze(){if(!h(this._isDSTShifted))return this._isDSTShifted;var e={};if(p(e,this),e=Oe(e),e._a){var t=e._isUTC?l(e._a):je(e._a);this._isDSTShifted=this.isValid()&&y(e._a,t.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted}function et(){return this.isValid()?!this._isUTC:!1}function tt(){return this.isValid()?this._isUTC:!1}function at(){return this.isValid()?this._isUTC&&0===this._offset:!1}function nt(e,t){var a,n,i,o=e,r=null;return Be(e)?o={ms:e._milliseconds,d:e._days,M:e._months}:"number"==typeof e?(o={},t?o[t]=e:o.milliseconds=e):(r=ei.exec(e))?(a="-"===r[1]?-1:1,o={y:0,d:v(r[Nn])*a,h:v(r[Mn])*a,m:v(r[On])*a,s:v(r[Dn])*a,ms:v(r[Pn])*a}):(r=ti.exec(e))?(a="-"===r[1]?-1:1,o={y:it(r[2],a),M:it(r[3],a),w:it(r[4],a),d:it(r[5],a),h:it(r[6],a),m:it(r[7],a),s:it(r[8],a)}):null==o?o={}:"object"==typeof o&&("from"in o||"to"in o)&&(i=st(je(o.from),je(o.to)),o={},o.ms=i.milliseconds,o.M=i.months),n=new He(o),Be(e)&&s(e,"_locale")&&(n._locale=e._locale),n}function it(e,t){var a=e&&parseFloat(e.replace(",","."));return(isNaN(a)?0:a)*t}function ot(e,t){var a={milliseconds:0,months:0};return a.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(a.months,"M").isAfter(t)&&--a.months,a.milliseconds=+t-+e.clone().add(a.months,"M"),a}function st(e,t){var a;return e.isValid()&&t.isValid()?(t=Ve(t,e),e.isBefore(t)?a=ot(e,t):(a=ot(t,e),a.milliseconds=-a.milliseconds,a.months=-a.months),a):{milliseconds:0,months:0}}function rt(e){return 0>e?-1*Math.round(-1*e):Math.round(e)}function lt(e,t){return function(a,n){var i,o;return null===n||isNaN(+n)||(R(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period)."),o=a,a=n,n=o),a="string"==typeof a?+a:a,i=nt(a,n),ut(this,i,e),this}}function ut(e,a,n,i){var o=a._milliseconds,s=rt(a._days),r=rt(a._months);e.isValid()&&(i=null==i?!0:i,o&&e._d.setTime(+e._d+o*n),s&&B(e,"Date",H(e,"Date")+s*n),r&&se(e,H(e,"Month")+r*n),i&&t.updateOffset(e,s||r))}function ct(e,t){var a=e||je(),n=Ve(a,this).startOf("day"),i=this.diff(n,"days",!0),o=-6>i?"sameElse":-1>i?"lastWeek":0>i?"lastDay":1>i?"sameDay":2>i?"nextDay":7>i?"nextWeek":"sameElse",s=t&&(k(t[o])?t[o]():t[o]);return this.format(s||this.localeData().calendar(o,this,je(a)))}function dt(){return new _(this)}function ft(e,t){var a=m(e)?e:je(e);return this.isValid()&&a.isValid()?(t=L(h(t)?"millisecond":t),"millisecond"===t?+this>+a:+a<+this.clone().startOf(t)):!1}function ht(e,t){var a=m(e)?e:je(e);return this.isValid()&&a.isValid()?(t=L(h(t)?"millisecond":t),"millisecond"===t?+a>+this:+this.clone().endOf(t)<+a):!1}function pt(e,t,a){return this.isAfter(e,a)&&this.isBefore(t,a)}function _t(e,t){var a,n=m(e)?e:je(e);return this.isValid()&&n.isValid()?(t=L(t||"millisecond"),"millisecond"===t?+this===+n:(a=+n,+this.clone().startOf(t)<=a&&a<=+this.clone().endOf(t))):!1}function mt(e,t){return this.isSame(e,t)||this.isAfter(e,t)}function gt(e,t){return this.isSame(e,t)||this.isBefore(e,t)}function vt(e,t,a){var n,i,o,s;return this.isValid()?(n=Ve(e,this),n.isValid()?(i=6e4*(n.utcOffset()-this.utcOffset()),t=L(t),"year"===t||"month"===t||"quarter"===t?(s=yt(this,n),"quarter"===t?s/=3:"year"===t&&(s/=12)):(o=this-n,s="second"===t?o/1e3:"minute"===t?o/6e4:"hour"===t?o/36e5:"day"===t?(o-i)/864e5:"week"===t?(o-i)/6048e5:o),a?s:g(s)):NaN):NaN}function yt(e,t){var a,n,i=12*(t.year()-e.year())+(t.month()-e.month()),o=e.clone().add(i,"months");return 0>t-o?(a=e.clone().add(i-1,"months"),n=(t-o)/(o-a)):(a=e.clone().add(i+1,"months"),n=(t-o)/(a-o)),-(i+n)}function bt(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function wt(){var e=this.clone().utc();return 0<e.year()&&e.year()<=9999?k(Date.prototype.toISOString)?this.toDate().toISOString():$(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):$(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function Rt(e){var a=$(this,e||t.defaultFormat);return this.localeData().postformat(a)}function kt(e,t){return this.isValid()&&(m(e)&&e.isValid()||je(e).isValid())?nt({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function Et(e){return this.from(je(),e)}function Ct(e,t){return this.isValid()&&(m(e)&&e.isValid()||je(e).isValid())?nt({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function St(e){return this.to(je(),e)}function Tt(e){var t;return void 0===e?this._locale._abbr:(t=D(e),null!=t&&(this._locale=t),this)}function xt(){return this._locale}function At(e){switch(e=L(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.weekday(0),"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this}function It(e){return e=L(e),void 0===e||"millisecond"===e?this:this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms")}function Nt(){return+this._d-6e4*(this._offset||0)}function Mt(){return Math.floor(+this/1e3)}function Ot(){return this._offset?new Date(+this):this._d}function Dt(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]}function Pt(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}}function jt(){return this.isValid()?this.toISOString():null}function Lt(){return d(this)}function Ft(){return r({},c(this))}function Ut(){return c(this).overflow}function Ht(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}function Bt(e,t){V(0,[e,e.length],0,t)}function zt(e){return Wt.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function qt(e){return Wt.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)}function Vt(){return ke(this.year(),1,4)}function Gt(){var e=this.localeData()._week;return ke(this.year(),e.dow,e.doy)}function Wt(e,t,a,n,i){var o;return null==e?Re(this,n,i).year:(o=ke(e,n,i),t>o&&(t=o),$t.call(this,e,t,a,n,i))}function $t(e,t,a,n,i){var o=we(e,t,a,n,i),s=me(o.year,0,o.dayOfYear);return this.year(s.getUTCFullYear()),this.month(s.getUTCMonth()),this.date(s.getUTCDate()),this}function Yt(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3);
}function Kt(e){return Re(e,this._week.dow,this._week.doy).week}function Xt(){return this._week.dow}function Jt(){return this._week.doy}function Qt(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")}function Zt(e){var t=Re(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")}function ea(e,t){return"string"!=typeof e?e:isNaN(e)?(e=t.weekdaysParse(e),"number"==typeof e?e:null):parseInt(e,10)}function ta(e,t){return n(this._weekdays)?this._weekdays[e.day()]:this._weekdays[this._weekdays.isFormat.test(t)?"format":"standalone"][e.day()]}function aa(e){return this._weekdaysShort[e.day()]}function na(e){return this._weekdaysMin[e.day()]}function ia(e,t,a){var n,i,o;for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),n=0;7>n;n++){if(i=je([2e3,1]).day(n),a&&!this._fullWeekdaysParse[n]&&(this._fullWeekdaysParse[n]=new RegExp("^"+this.weekdays(i,"").replace(".",".?")+"$","i"),this._shortWeekdaysParse[n]=new RegExp("^"+this.weekdaysShort(i,"").replace(".",".?")+"$","i"),this._minWeekdaysParse[n]=new RegExp("^"+this.weekdaysMin(i,"").replace(".",".?")+"$","i")),this._weekdaysParse[n]||(o="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[n]=new RegExp(o.replace(".",""),"i")),a&&"dddd"===t&&this._fullWeekdaysParse[n].test(e))return n;if(a&&"ddd"===t&&this._shortWeekdaysParse[n].test(e))return n;if(a&&"dd"===t&&this._minWeekdaysParse[n].test(e))return n;if(!a&&this._weekdaysParse[n].test(e))return n}}function oa(e){if(!this.isValid())return null!=e?this:NaN;var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=ea(e,this.localeData()),this.add(e-t,"d")):t}function sa(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")}function ra(e){return this.isValid()?null==e?this.day()||7:this.day(this.day()%7?e:e-7):null!=e?this:NaN}function la(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")}function ua(){return this.hours()%12||12}function ca(e,t){V(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function da(e,t){return t._meridiemParse}function fa(e){return"p"===(e+"").toLowerCase().charAt(0)}function ha(e,t,a){return e>11?a?"pm":"PM":a?"am":"AM"}function pa(e,t){t[Pn]=v(1e3*("0."+e))}function _a(){return this._isUTC?"UTC":""}function ma(){return this._isUTC?"Coordinated Universal Time":""}function ga(e){return je(1e3*e)}function va(){return je.apply(null,arguments).parseZone()}function ya(e,t,a){var n=this._calendar[e];return k(n)?n.call(t,a):n}function ba(e){var t=this._longDateFormat[e],a=this._longDateFormat[e.toUpperCase()];return t||!a?t:(this._longDateFormat[e]=a.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e])}function wa(){return this._invalidDate}function Ra(e){return this._ordinal.replace("%d",e)}function ka(e){return e}function Ea(e,t,a,n){var i=this._relativeTime[a];return k(i)?i(e,t,a,n):i.replace(/%d/i,e)}function Ca(e,t){var a=this._relativeTime[e>0?"future":"past"];return k(a)?a(t):a.replace(/%s/i,t)}function Sa(e,t,a,n){var i=D(),o=l().set(n,t);return i[a](o,e)}function Ta(e,t,a,n,i){if("number"==typeof e&&(t=e,e=void 0),e=e||"",null!=t)return Sa(e,t,a,i);var o,s=[];for(o=0;n>o;o++)s[o]=Sa(e,o,a,i);return s}function xa(e,t){return Ta(e,t,"months",12,"month")}function Aa(e,t){return Ta(e,t,"monthsShort",12,"month")}function Ia(e,t){return Ta(e,t,"weekdays",7,"day")}function Na(e,t){return Ta(e,t,"weekdaysShort",7,"day")}function Ma(e,t){return Ta(e,t,"weekdaysMin",7,"day")}function Oa(){var e=this._data;return this._milliseconds=Ci(this._milliseconds),this._days=Ci(this._days),this._months=Ci(this._months),e.milliseconds=Ci(e.milliseconds),e.seconds=Ci(e.seconds),e.minutes=Ci(e.minutes),e.hours=Ci(e.hours),e.months=Ci(e.months),e.years=Ci(e.years),this}function Da(e,t,a,n){var i=nt(t,a);return e._milliseconds+=n*i._milliseconds,e._days+=n*i._days,e._months+=n*i._months,e._bubble()}function Pa(e,t){return Da(this,e,t,1)}function ja(e,t){return Da(this,e,t,-1)}function La(e){return 0>e?Math.floor(e):Math.ceil(e)}function Fa(){var e,t,a,n,i,o=this._milliseconds,s=this._days,r=this._months,l=this._data;return o>=0&&s>=0&&r>=0||0>=o&&0>=s&&0>=r||(o+=864e5*La(Ha(r)+s),s=0,r=0),l.milliseconds=o%1e3,e=g(o/1e3),l.seconds=e%60,t=g(e/60),l.minutes=t%60,a=g(t/60),l.hours=a%24,s+=g(a/24),i=g(Ua(s)),r+=i,s-=La(Ha(i)),n=g(r/12),r%=12,l.days=s,l.months=r,l.years=n,this}function Ua(e){return 4800*e/146097}function Ha(e){return 146097*e/4800}function Ba(e){var t,a,n=this._milliseconds;if(e=L(e),"month"===e||"year"===e)return t=this._days+n/864e5,a=this._months+Ua(t),"month"===e?a:a/12;switch(t=this._days+Math.round(Ha(this._months)),e){case"week":return t/7+n/6048e5;case"day":return t+n/864e5;case"hour":return 24*t+n/36e5;case"minute":return 1440*t+n/6e4;case"second":return 86400*t+n/1e3;case"millisecond":return Math.floor(864e5*t)+n;default:throw new Error("Unknown unit "+e)}}function za(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*v(this._months/12)}function qa(e){return function(){return this.as(e)}}function Va(e){return e=L(e),this[e+"s"]()}function Ga(e){return function(){return this._data[e]}}function Wa(){return g(this.days()/7)}function $a(e,t,a,n,i){return i.relativeTime(t||1,!!a,e,n)}function Ya(e,t,a){var n=nt(e).abs(),i=Bi(n.as("s")),o=Bi(n.as("m")),s=Bi(n.as("h")),r=Bi(n.as("d")),l=Bi(n.as("M")),u=Bi(n.as("y")),c=i<zi.s&&["s",i]||1>=o&&["m"]||o<zi.m&&["mm",o]||1>=s&&["h"]||s<zi.h&&["hh",s]||1>=r&&["d"]||r<zi.d&&["dd",r]||1>=l&&["M"]||l<zi.M&&["MM",l]||1>=u&&["y"]||["yy",u];return c[2]=t,c[3]=+e>0,c[4]=a,$a.apply(null,c)}function Ka(e,t){return void 0===zi[e]?!1:void 0===t?zi[e]:(zi[e]=t,!0)}function Xa(e){var t=this.localeData(),a=Ya(this,!e,t);return e&&(a=t.pastFuture(+this,a)),t.postformat(a)}function Ja(){var e,t,a,n=qi(this._milliseconds)/1e3,i=qi(this._days),o=qi(this._months);e=g(n/60),t=g(e/60),n%=60,e%=60,a=g(o/12),o%=12;var s=a,r=o,l=i,u=t,c=e,d=n,f=this.asSeconds();return f?(0>f?"-":"")+"P"+(s?s+"Y":"")+(r?r+"M":"")+(l?l+"D":"")+(u||c||d?"T":"")+(u?u+"H":"")+(c?c+"M":"")+(d?d+"S":""):"P0D"}var Qa,Za=t.momentProperties=[],en=!1,tn={};t.suppressDeprecationWarnings=!1;var an,nn={},on={},sn=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,rn=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,ln={},un={},cn=/\d/,dn=/\d\d/,fn=/\d{3}/,hn=/\d{4}/,pn=/[+-]?\d{6}/,_n=/\d\d?/,mn=/\d\d\d\d?/,gn=/\d\d\d\d\d\d?/,vn=/\d{1,3}/,yn=/\d{1,4}/,bn=/[+-]?\d{1,6}/,wn=/\d+/,Rn=/[+-]?\d+/,kn=/Z|[+-]\d\d:?\d\d/gi,En=/Z|[+-]\d\d(?::?\d\d)?/gi,Cn=/[+-]?\d+(\.\d{1,3})?/,Sn=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Tn={},xn={},An=0,In=1,Nn=2,Mn=3,On=4,Dn=5,Pn=6,jn=7,Ln=8;V("M",["MM",2],"Mo",function(){return this.month()+1}),V("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),V("MMMM",0,0,function(e){return this.localeData().months(this,e)}),j("month","M"),K("M",_n),K("MM",_n,dn),K("MMM",function(e,t){return t.monthsShortRegex(e)}),K("MMMM",function(e,t){return t.monthsRegex(e)}),Z(["M","MM"],function(e,t){t[In]=v(e)-1}),Z(["MMM","MMMM"],function(e,t,a,n){var i=a._locale.monthsParse(e,n,a._strict);null!=i?t[In]=i:c(a).invalidMonth=e});var Fn=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/,Un="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Hn="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),Bn=Sn,zn=Sn,qn=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?/,Vn=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?/,Gn=/Z|[+-]\d\d(?::?\d\d)?/,Wn=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],$n=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Yn=/^\/?Date\((\-?\d+)/i;t.createFromInputFallback=w("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),V("Y",0,0,function(){var e=this.year();return 9999>=e?""+e:"+"+e}),V(0,["YY",2],0,function(){return this.year()%100}),V(0,["YYYY",4],0,"year"),V(0,["YYYYY",5],0,"year"),V(0,["YYYYYY",6,!0],0,"year"),j("year","y"),K("Y",Rn),K("YY",_n,dn),K("YYYY",yn,hn),K("YYYYY",bn,pn),K("YYYYYY",bn,pn),Z(["YYYYY","YYYYYY"],An),Z("YYYY",function(e,a){a[An]=2===e.length?t.parseTwoDigitYear(e):v(e)}),Z("YY",function(e,a){a[An]=t.parseTwoDigitYear(e)}),Z("Y",function(e,t){t[An]=parseInt(e,10)}),t.parseTwoDigitYear=function(e){return v(e)+(v(e)>68?1900:2e3)};var Kn=U("FullYear",!1);t.ISO_8601=function(){};var Xn=w("moment().min is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(){var e=je.apply(null,arguments);return this.isValid()&&e.isValid()?this>e?this:e:f()}),Jn=w("moment().max is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(){var e=je.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:f()}),Qn=function(){return Date.now?Date.now():+new Date};ze("Z",":"),ze("ZZ",""),K("Z",En),K("ZZ",En),Z(["Z","ZZ"],function(e,t,a){a._useUTC=!0,a._tzm=qe(En,e)});var Zn=/([\+\-]|\d\d)/gi;t.updateOffset=function(){};var ei=/^(\-)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?\d*)?$/,ti=/^(-)?P(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)W)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?$/;nt.fn=He.prototype;var ai=lt(1,"add"),ni=lt(-1,"subtract");t.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";var ii=w("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});V(0,["gg",2],0,function(){return this.weekYear()%100}),V(0,["GG",2],0,function(){return this.isoWeekYear()%100}),Bt("gggg","weekYear"),Bt("ggggg","weekYear"),Bt("GGGG","isoWeekYear"),Bt("GGGGG","isoWeekYear"),j("weekYear","gg"),j("isoWeekYear","GG"),K("G",Rn),K("g",Rn),K("GG",_n,dn),K("gg",_n,dn),K("GGGG",yn,hn),K("gggg",yn,hn),K("GGGGG",bn,pn),K("ggggg",bn,pn),ee(["gggg","ggggg","GGGG","GGGGG"],function(e,t,a,n){t[n.substr(0,2)]=v(e)}),ee(["gg","GG"],function(e,a,n,i){a[i]=t.parseTwoDigitYear(e)}),V("Q",0,"Qo","quarter"),j("quarter","Q"),K("Q",cn),Z("Q",function(e,t){t[In]=3*(v(e)-1)}),V("w",["ww",2],"wo","week"),V("W",["WW",2],"Wo","isoWeek"),j("week","w"),j("isoWeek","W"),K("w",_n),K("ww",_n,dn),K("W",_n),K("WW",_n,dn),ee(["w","ww","W","WW"],function(e,t,a,n){t[n.substr(0,1)]=v(e)});var oi={dow:0,doy:6};V("D",["DD",2],"Do","date"),j("date","D"),K("D",_n),K("DD",_n,dn),K("Do",function(e,t){return e?t._ordinalParse:t._ordinalParseLenient}),Z(["D","DD"],Nn),Z("Do",function(e,t){t[Nn]=v(e.match(_n)[0],10)});var si=U("Date",!0);V("d",0,"do","day"),V("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),V("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),V("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),V("e",0,0,"weekday"),V("E",0,0,"isoWeekday"),j("day","d"),j("weekday","e"),j("isoWeekday","E"),K("d",_n),K("e",_n),K("E",_n),K("dd",Sn),K("ddd",Sn),K("dddd",Sn),ee(["dd","ddd","dddd"],function(e,t,a,n){var i=a._locale.weekdaysParse(e,n,a._strict);null!=i?t.d=i:c(a).invalidWeekday=e}),ee(["d","e","E"],function(e,t,a,n){t[n]=v(e)});var ri="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),li="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),ui="Su_Mo_Tu_We_Th_Fr_Sa".split("_");V("DDD",["DDDD",3],"DDDo","dayOfYear"),j("dayOfYear","DDD"),K("DDD",vn),K("DDDD",fn),Z(["DDD","DDDD"],function(e,t,a){a._dayOfYear=v(e)}),V("H",["HH",2],0,"hour"),V("h",["hh",2],0,ua),V("hmm",0,0,function(){return""+ua.apply(this)+q(this.minutes(),2)}),V("hmmss",0,0,function(){return""+ua.apply(this)+q(this.minutes(),2)+q(this.seconds(),2)}),V("Hmm",0,0,function(){return""+this.hours()+q(this.minutes(),2)}),V("Hmmss",0,0,function(){return""+this.hours()+q(this.minutes(),2)+q(this.seconds(),2)}),ca("a",!0),ca("A",!1),j("hour","h"),K("a",da),K("A",da),K("H",_n),K("h",_n),K("HH",_n,dn),K("hh",_n,dn),K("hmm",mn),K("hmmss",gn),K("Hmm",mn),K("Hmmss",gn),Z(["H","HH"],Mn),Z(["a","A"],function(e,t,a){a._isPm=a._locale.isPM(e),a._meridiem=e}),Z(["h","hh"],function(e,t,a){t[Mn]=v(e),c(a).bigHour=!0}),Z("hmm",function(e,t,a){var n=e.length-2;t[Mn]=v(e.substr(0,n)),t[On]=v(e.substr(n)),c(a).bigHour=!0}),Z("hmmss",function(e,t,a){var n=e.length-4,i=e.length-2;t[Mn]=v(e.substr(0,n)),t[On]=v(e.substr(n,2)),t[Dn]=v(e.substr(i)),c(a).bigHour=!0}),Z("Hmm",function(e,t,a){var n=e.length-2;t[Mn]=v(e.substr(0,n)),t[On]=v(e.substr(n))}),Z("Hmmss",function(e,t,a){var n=e.length-4,i=e.length-2;t[Mn]=v(e.substr(0,n)),t[On]=v(e.substr(n,2)),t[Dn]=v(e.substr(i))});var ci=/[ap]\.?m?\.?/i,di=U("Hours",!0);V("m",["mm",2],0,"minute"),j("minute","m"),K("m",_n),K("mm",_n,dn),Z(["m","mm"],On);var fi=U("Minutes",!1);V("s",["ss",2],0,"second"),j("second","s"),K("s",_n),K("ss",_n,dn),Z(["s","ss"],Dn);var hi=U("Seconds",!1);V("S",0,0,function(){return~~(this.millisecond()/100)}),V(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),V(0,["SSS",3],0,"millisecond"),V(0,["SSSS",4],0,function(){return 10*this.millisecond()}),V(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),V(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),V(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),V(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),V(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),j("millisecond","ms"),K("S",vn,cn),K("SS",vn,dn),K("SSS",vn,fn);var pi;for(pi="SSSS";pi.length<=9;pi+="S")K(pi,wn);for(pi="S";pi.length<=9;pi+="S")Z(pi,pa);var _i=U("Milliseconds",!1);V("z",0,0,"zoneAbbr"),V("zz",0,0,"zoneName");var mi=_.prototype;mi.add=ai,mi.calendar=ct,mi.clone=dt,mi.diff=vt,mi.endOf=It,mi.format=Rt,mi.from=kt,mi.fromNow=Et,mi.to=Ct,mi.toNow=St,mi.get=z,mi.invalidAt=Ut,mi.isAfter=ft,mi.isBefore=ht,mi.isBetween=pt,mi.isSame=_t,mi.isSameOrAfter=mt,mi.isSameOrBefore=gt,mi.isValid=Lt,mi.lang=ii,mi.locale=Tt,mi.localeData=xt,mi.max=Jn,mi.min=Xn,mi.parsingFlags=Ft,mi.set=z,mi.startOf=At,mi.subtract=ni,mi.toArray=Dt,mi.toObject=Pt,mi.toDate=Ot,mi.toISOString=wt,mi.toJSON=jt,mi.toString=bt,mi.unix=Mt,mi.valueOf=Nt,mi.creationData=Ht,mi.year=Kn,mi.isLeapYear=ye,mi.weekYear=zt,mi.isoWeekYear=qt,mi.quarter=mi.quarters=Yt,mi.month=re,mi.daysInMonth=le,mi.week=mi.weeks=Qt,mi.isoWeek=mi.isoWeeks=Zt,mi.weeksInYear=Gt,mi.isoWeeksInYear=Vt,mi.date=si,mi.day=mi.days=oa,mi.weekday=sa,mi.isoWeekday=ra,mi.dayOfYear=la,mi.hour=mi.hours=di,mi.minute=mi.minutes=fi,mi.second=mi.seconds=hi,mi.millisecond=mi.milliseconds=_i,mi.utcOffset=We,mi.utc=Ye,mi.local=Ke,mi.parseZone=Xe,mi.hasAlignedHourOffset=Je,mi.isDST=Qe,mi.isDSTShifted=Ze,mi.isLocal=et,mi.isUtcOffset=tt,mi.isUtc=at,mi.isUTC=at,mi.zoneAbbr=_a,mi.zoneName=ma,mi.dates=w("dates accessor is deprecated. Use date instead.",si),mi.months=w("months accessor is deprecated. Use month instead",re),mi.years=w("years accessor is deprecated. Use year instead",Kn),mi.zone=w("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",$e);var gi=mi,vi={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},yi={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},bi="Invalid date",wi="%d",Ri=/\d{1,2}/,ki={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},Ei=T.prototype;Ei._calendar=vi,Ei.calendar=ya,Ei._longDateFormat=yi,Ei.longDateFormat=ba,Ei._invalidDate=bi,Ei.invalidDate=wa,Ei._ordinal=wi,Ei.ordinal=Ra,Ei._ordinalParse=Ri,Ei.preparse=ka,Ei.postformat=ka,Ei._relativeTime=ki,Ei.relativeTime=Ea,Ei.pastFuture=Ca,Ei.set=C,Ei.months=ne,Ei._months=Un,Ei.monthsShort=ie,Ei._monthsShort=Hn,Ei.monthsParse=oe,Ei._monthsRegex=zn,Ei.monthsRegex=ce,Ei._monthsShortRegex=Bn,Ei.monthsShortRegex=ue,Ei.week=Kt,Ei._week=oi,Ei.firstDayOfYear=Jt,Ei.firstDayOfWeek=Xt,Ei.weekdays=ta,Ei._weekdays=ri,Ei.weekdaysMin=na,Ei._weekdaysMin=ui,Ei.weekdaysShort=aa,Ei._weekdaysShort=li,Ei.weekdaysParse=ia,Ei.isPM=fa,Ei._meridiemParse=ci,Ei.meridiem=ha,N("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,a=1===v(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+a}}),t.lang=w("moment.lang is deprecated. Use moment.locale instead.",N),t.langData=w("moment.langData is deprecated. Use moment.localeData instead.",D);var Ci=Math.abs,Si=qa("ms"),Ti=qa("s"),xi=qa("m"),Ai=qa("h"),Ii=qa("d"),Ni=qa("w"),Mi=qa("M"),Oi=qa("y"),Di=Ga("milliseconds"),Pi=Ga("seconds"),ji=Ga("minutes"),Li=Ga("hours"),Fi=Ga("days"),Ui=Ga("months"),Hi=Ga("years"),Bi=Math.round,zi={s:45,m:45,h:22,d:26,M:11},qi=Math.abs,Vi=He.prototype;Vi.abs=Oa,Vi.add=Pa,Vi.subtract=ja,Vi.as=Ba,Vi.asMilliseconds=Si,Vi.asSeconds=Ti,Vi.asMinutes=xi,Vi.asHours=Ai,Vi.asDays=Ii,Vi.asWeeks=Ni,Vi.asMonths=Mi,Vi.asYears=Oi,Vi.valueOf=za,Vi._bubble=Fa,Vi.get=Va,Vi.milliseconds=Di,Vi.seconds=Pi,Vi.minutes=ji,Vi.hours=Li,Vi.days=Fi,Vi.weeks=Wa,Vi.months=Ui,Vi.years=Hi,Vi.humanize=Xa,Vi.toISOString=Ja,Vi.toString=Ja,Vi.toJSON=Ja,Vi.locale=Tt,Vi.localeData=xt,Vi.toIsoString=w("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Ja),Vi.lang=ii,V("X",0,0,"unix"),V("x",0,0,"valueOf"),K("x",Rn),K("X",Cn),Z("X",function(e,t,a){a._d=new Date(1e3*parseFloat(e,10))}),Z("x",function(e,t,a){a._d=new Date(v(e))}),t.version="2.12.0",a(je),t.fn=gi,t.min=Fe,t.max=Ue,t.now=Qn,t.utc=l,t.unix=ga,t.months=xa,t.isDate=i,t.locale=N,t.invalid=f,t.duration=nt,t.isMoment=m,t.weekdays=Ia,t.parseZone=va,t.localeData=D,t.isDuration=Be,t.monthsShort=Aa,t.weekdaysMin=Ma,t.defineLocale=M,t.updateLocale=O,t.locales=P,t.weekdaysShort=Na,t.normalizeUnits=L,t.relativeTimeThreshold=Ka,t.prototype=gi;var Gi=t;return Gi})}).call(t,a(104)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(106),o=n(i),s=a(108),r=n(s),l=4,u={simple_word:new RegExp(o["default"].simple_word,"gi"),url:new RegExp(o["default"].url,"gi"),email:new RegExp(o["default"].email,"gi")};t["default"]={linkify:function(e,t,a){return u.simple_word.lastIndex=0,e.length>=l&&!u.simple_word.test(e)&&(e=this.match_and_replace(e,!0,t,a)),e},match_and_replace:function(e,t,a,n){var i=0,s=0,l=0,c=0,d=/<\/a>/i,f=u.url;f.lastIndex=0;for(var h=new RegExp("^"+o["default"].email+"$","gi"),p=n.hasOwnProperty("add_wbrs")?n.add_wbrs:null,_=n.hasOwnProperty("truncate_length")?n.truncate_length:100,m=n.hasOwnProperty("link_target")?n.link_target:"_blank",g=n.hasOwnProperty("link_titles")?n.link_titles:null,v=n.hasOwnProperty("no_referrer")?n.no_referrer:null,y={},b=20,w=0;(y=f.exec(e))&&(w++,!(w>b));){i=y.index;var R=e.substring(s,i);if(R.search(/<a/i)>=0){d.lastIndex=s;var k=e.substring(s,e.length).search(d);if(0>k)return e;c=k+s,f.lastIndex=c+4,s=c+4}else{if(y[0]=r["default"].wrapped_url_fix(e,y[0]),!r["default"].url_should_be_replaced(e,y[0]))break;l=y[0].length;var E=e.substr(i,l),C=E.search(/&(gt|lt)$/);if(C>0&&e.length>i+l&&";"===e[i+l]){var S=E.length-C;l-=S,E=e.substr(i,l)}var T=E,x=h.test(T);!t||y[2]||x||(T="http://"+T);var A="<a";if(m&&(A+=' target="'+m+'"'),v&&(A+=' rel="noopener noreferrer"'),A+=' href="',x&&(A+="mailto:"),T=T.replace(/"/g,"%22"),A+=T+'"',g){var I=x?"Email "+T:T;A+=' title="'+I+'"'}_&&E.length>_&&(E=E.substr(0,_)+"..."),p&&(E=E.replace(new RegExp("([/=])","g"),"<wbr>$1")),A+=">"+E+"</a>",a&&a.push(T),e=e.slice(0,i)+A+e.slice(i+l,e.length),f.lastIndex=i+A.length,s=i+A.length}}return e}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(107),o=n(i),s=["py","sh"],r=_.pullAll(o["default"],s).join("|"),l={required_url_protocol:"((?:(?!javascript|file|vbscript|view-source|resource|about|chrome|livescript|mocha|data)[a-z][\\w\\-]+:)(?:/{1,3}))",optional_url_protocol:"((?:(?!javascript|file|vbscript|view-source|resource|about|chrome|livescript|mocha|data)[a-z][\\w\\-]+:)?(?:/{1,3}))?",optional_user_pass_auth:"(?:\\S+(?::\\S*)?@.+)?",ip_address_exclusion:"(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})",ip_dotted_notation:"(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))",host_name:"(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)",domain_name:"(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)?",tld_identifier:"(?:\\.(?:"+r+"))\\.?(?:"+r+")?",tld_matcher:"(?:\\.(?:[a-zA-Z]{2,12}))\\.?",port_number:"(?::\\d{2,5})?",resource_path:"(?:(?:,\\-|,\\+|[/?#:'()])\\S*)?"};t["default"]={simple_word:"^[a-zA-Z0-9]*$",email:"[a-z0-9]+(?:[.\\-+][a-z0-9!#$%&'*+=?^_`{|}~\\-]+)*@(?:[a-z0-9](?:[a-z0-9\\-]*[a-z0-9])?[.])+[a-z0-9](?:[a-z0-9\\-]*[a-z0-9])?",url:"\\b(?:("+l.required_url_protocol+l.optional_user_pass_auth+"(?:[a-zA-Z\\u00a1-\\uffff0-9_\\-.()]+)"+l.port_number+l.resource_path+")|("+l.optional_url_protocol+l.optional_user_pass_auth+"(?:localhost|"+l.ip_dotted_notation+"|"+l.host_name+l.domain_name+l.tld_identifier+")"+l.port_number+l.resource_path+"))",protocol:l.required_url_protocol,url_end_punctuation:"[\\s`!?()\\[\\]:{};'\".,<>Â«Â»ââââ&]",invite_user_url:"^\\s*http(s?)://((\\w+).)?hipchat\\.com/invite/(\\d+)/(\\w+)((\\?utm_campaign\\=company_room_link)?)\\s*$"},e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=["aero","arpa","asia","biz","cat","com","coop","corp","edu","gov","green","info","int","io","jobs","local","mil","mobi","museum","name","net","org","post","pro","rocks","tel","travel","xxx","ac","ad","ae","af","ag","ai","al","am","an","ao","aq","ar","as","at","au","aw","ax","az","ba","bb","bd","be","bf","bg","bh","bi","bj","bm","bn","bo","br","bs","bt","bv","bw","by","bz","ca","cc","cd","cf","cg","ch","ci","ck","cl","cm","cn","co","cr","cs","cu","cv","cx","cy","cz","dd","de","dj","dk","dm","do","dz","ec","ee","eg","eh","er","es","et","eu","fi","fj","fk","fm","fo","fr","ga","gb","gd","ge","gf","gg","gh","gi","gl","gm","gn","gp","gq","gr","gs","gt","gu","gw","gy","hk","hm","hn","hr","ht","hu","id","ie","il","im","in","iq","ir","is","it","je","jm","jo","jp","ke","kg","kh","ki","km","kn","kp","kr","kw","ky","kz","la","lb","lc","li","lk","lr","ls","lt","lu","lv","ly","ma","mc","md","me","mg","mh","mk","ml","mm","mn","mo","mp","mq","mr","ms","mt","mu","mv","mw","mx","my","mz","na","nc","ne","nf","ng","ni","nl","no","np","nr","nu","nz","om","pa","pe","pf","pg","ph","pk","pl","pm","pn","pr","ps","pt","pw","py","qa","qc","qs","re","ro","rs","ru","rw","sa","sb","sc","sd","se","sg","sh","si","sj","ja","sk","sl","sm","sn","so","sr","ss","st","su","sv","sx","sy","sz","tc","td","tf","tg","th","tj","tk","tl","tm","tn","to","tp","tr","tt","tv","tw","tz","ua","ug","uk","us","uy","uz","va","vc","ve","vg","vi","vn","vu","wf","ws","ye","yt","yu","za","zm","zw"],e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(103),o=n(i),s=a(106),r=n(s),l=a(109),u=n(l);t["default"]={url_regex:new RegExp(r["default"].url,"i"),urls_regex:new RegExp(r["default"].url,"gi"),url_end_punct_regex:new RegExp(r["default"].url_end_punctuation),paired_punctuation:{"}":"{",")":"(",">":"<"},remove_query_string:function(e){return e.split(/[?#]/)[0]},create_link_object:function(e,t,a,n){var i=new RegExp(r["default"].protocol,"i");return i.test(a)||(a="http://"+a),{date:o["default"].utc(1e3*t).toDate(),group_id:u["default"].group_id(e),id:_.uniqueId(),user_name:n,url:a,display_url:a.replace(/.*?:\/\//g,"")}},get_urls_from_string:function(e){return e.match(this.urls_regex)},contains_url:function(e){return this.url_regex.test(e)},remove_resolution:function(e){return e.replace(/@\d+x/i,"")},wrapped_url_fix:function(e,t){var a=e.indexOf(t),n=e.charAt(a+(t.length-1)),i=this.url_end_punct_regex.test(n);return i&&this._should_slice(e,t)?this.wrapped_url_fix(e,t.slice(0,-1)):t},_num_of_chars_balanced:function(e,t){var a=this.paired_punctuation[t],n=new RegExp("["+a+"]","g"),i=new RegExp("["+t+"]","g"),o=e.match(n)||[],s=e.match(i)||[];return o.length===s.length},_should_slice:function(e,t){var a=e.indexOf(t),n=e.charAt(a+(t.length-1));return this.paired_punctuation[n]?!this._num_of_chars_balanced(t,n):!0},url_should_be_replaced:function(e,t){var a=e.indexOf(t),n=e.charAt(a+t.length);return!n||this.url_end_punct_regex.test(n)},identify_invite_link:function(e){var t=new RegExp(r["default"].invite_user_url);return t.test(e)}},e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={display_names:{},is_private_chat:function(e){return/@chat/.test(e)},is_room:function(e){return/@conf/.test(e)},is_lobby:function(e){return"lobby"===e||/^lobby@/.test(e)},is_search:function(e){return"search"===e||/^search@/.test(e)},is_chat:function(e){return(this.is_private_chat(e)||this.is_room(e))&&!this.is_lobby(e)&&!this.is_search(e)},bare_jid:function(e){return e?e.split("/")[0]:!1},domain:function(e){return e?e.split("@")[1].split("/")[0]:!1},group_id:function(e){var t=this.node(e),a=t.substr(0,t.indexOf("_"));return parseInt(a,10)},is_private_room:function(e){return"private"===e},is_public_room:function(e){return"public"===e},node:function(e){return e?e.split("@")[0]:!1},resource:function(e){var t=e.indexOf("/");return-1===t?null:e.substr(t+1)},room_name:function(e){var t=this.node(e),a=t.substr(t.indexOf("_")+1);return a},sanitize:function(e){return e.replace("\\","\\\\")},user_id:function(e){var t=this.node(e);if(t){var a=t.substr(t.indexOf("_")+1);if(a.match(/[0123456789]+/))return parseInt(a,10)}return null},user_name:function(e){return e.split("/")[1]},get_display_name:function(e,t){if("undefined"==typeof t&&(t="Unknown"),!e||"undefined"==typeof e)return t;e=this.bare_jid(e);var a=this.display_names[e];return a?a.name:t},build_group_jid:function(e,t,a){return t+"_"+("string"==typeof e?e.toLowerCase():e)+"@"+a}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t="(?:<([A-Z][A-Z0-9]*)\\b.*?(?:\\/>|<\\/\\1>)|(&[a-zA-Z0-9]{2,6};)(?!:-\\()|";return t+=1!==e.indexOf("(")?"(?:\\s|^)("+e+")(?!\\w))":"("+e+"))",new RegExp(t,"gim")}var o=a(111),s=n(o),r=a(114),l=n(r),u=a(117),c=n(u),d=a(121),f=n(d),h=/\([A-Z0-9]+\)/gim,p={path_prefix:"/",emoticons:{},smileys:{},asset_base_uri:"",web_server:"",specials:{scumbag:"_scumbagify",dealwithit:"_shadesify"},init:function(){return this.addSmileys(this.emoticons),this},addSmileys:function(e){var t=this;return _.each(e,function(e,a){":"===e.shortcut?e.shortcut=":\\":"&gt;:-("===e.shortcut&&(e.shortcut=">:-("),_.isRegExp(e.regex)||(e.regex=i(e.regex)),t.smileys[a]=e}),this.smileys},add:function(e,t,a,n,i){var o="("+t+")";this.emoticons[o]={file:e,height:a,width:n,shortcut:"("+t+")",type:i}},addBulk:function(e){var t=this,a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return this.emoticons=_.cloneDeep(a),_.each(e,function(e){t.add(e.path,e.shortcut,e.h,e.w,e.type)}),this.emoticons},removeBulk:function(e){for(var t=this,a={},n=[].concat((0,c["default"])(this.getEmoticonsKeys(e))),i=0;i<n.length;i++){var o=n[i];a[o]=!0}return _.forIn(this.emoticons,function(e,n){a[n]||delete t.emoticons[n]}),this.emoticons},getEmoticonsKeys:s["default"].mark(function m(e){var t,a,n,i,o,r;return s["default"].wrap(function(s){for(;;)switch(s.prev=s.next){case 0:t=!0,a=!1,n=void 0,s.prev=3,i=(0,l["default"])(e);case 5:if(t=(o=i.next()).done){s.next=12;break}return r=o.value,s.next=9,"("+r.shortcut+")";case 9:t=!0,s.next=5;break;case 12:s.next=18;break;case 14:s.prev=14,s.t0=s["catch"](3),a=!0,n=s.t0;case 18:s.prev=18,s.prev=19,!t&&i["return"]&&i["return"]();case 21:if(s.prev=21,!a){s.next=24;break}throw n;case 24:return s.finish(21);case 25:return s.finish(18);case 26:case"end":return s.stop()}},m,this,[[3,14,18,26],[19,,21,25]])}),getEmoticons:function(e){return e.match(h)||[]},getEmoticonsInfo:function(e){var t=this.getEmoticons(e);return _.filter(this.emoticons,function(e){return-1!==t.indexOf(e.shortcut)})},render:function(e){var t=this,a=this.getEmoticons(e);return a.length&&_.each(a,function(a){var n=t.emoticons[a.toLowerCase()];n&&(e=t._replaceWithImage(e,n))}),_.each(this.smileys,function(a){return e=t._replaceWithImage(e,a)}),e},_replaceWithImage:function(e,t){var a=this._generateSrc(t.file);return t.regex||(t.regex=i("\\("+t.shortcut+"\\)")),e.replace(t.regex,function(e,n,i,o){return o?'<img class="remoticon" aria-label="'+t.shortcut+'" alt="'+t.shortcut+'" height="'+t.height+'" width="'+t.width+'" src="'+a+'" onerror="if (HC.emoticon_resolution_helper) { HC.emoticon_resolution_helper(this); }" />':e})},renderConsole:function(e){var t=this;try{var a=this.getEmoticons(e),n="font-family: Helvetica Neue, Helvetica, Arial; font-size: 14px; font-weight: bold;",i="%c"+e,o=[n];a.forEach(function(e){var a=t._getEmoticonInfo(e,1);_.identity(a)&&(i=i.replace(a.regex,function(e,t,a,n){return n?"%c%c":void 0}),o.push("font-size: "+a.height+"px; padding-left: "+(a.width+5)+"px; line-height: 30px; background: url("+a.src+") no-repeat 0/auto "+a.height+"px;"),o.push(n))}),o.unshift(i),console.log.apply(console,o)}catch(s){console.log(e)}},_getEmoticonInfo:function(e,t){var a=this.smileys[e]||this.emoticons[e];if(a){var n=a.file;return a.regex||(a.regex=i("\\("+a.shortcut+"\\)")),{src:this._generateSrc(n,t),regex:a.regex,height:parseInt(a.height,10)>26?26:a.height,width:parseInt(a.width,10)>26?26:a.width}}},_generateSrc:function(e){var t=arguments.length<=1||void 0===arguments[1]?2:arguments[1];if(t>1){var a="@"+t+"x";-1===e.indexOf(a)&&(e=e.split(".").join(t>1?a+".":"."))}return this.path_prefix+"/"+e},_replaceSpecials:function(e){var t=this,a=$(e).find("img.remoticon");_.forOwn(this.specials,function(e,n){for(var i=0;i<a.length;i++)a[i].getAttribute("src").match("img/emoticons/"+n)&&a[i+1]&&a[i].nextSibling===a[i+1]&&a[i].getAttribute("src")!==a[i+1].getAttribute("src")&&t[e](a[i],a[i+1])})},_scumbagify:function(e,t){$(t).on("load",function(){var a=$(t).width();e.style.display="block",e.parentNode.style.position="relative",e.style.position="absolute",e.style.top=t.offsetTop-3+"px",e.style.left=t.offsetLeft+a/2-10+"px"})},_shadesify:function(e,t){$(e).attr({src:"https://"+this.web_server+"/wc/"+f["default"].shades_icon,width:18,height:"auto"}),$(t).on("load",function(){var a=$(t).width(),n=$(t).height();e.parentNode.style.position="relative",
e.style.display="block",e.style.position="absolute",e.style.top=t.offsetTop+n/2-3+"px",e.style.left=t.offsetLeft+a/2-9+"px",$(e).addClass("shadesify")})}};console&&(console.emote=function(e){p.renderConsole.call(p,e)}),e.exports=p},function(e,t,a){(function(t){var n="object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:this,i=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,o=i&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=a(112),i)n.regeneratorRuntime=o;else try{delete n.regeneratorRuntime}catch(s){n.regeneratorRuntime=void 0}e.exports={"default":e.exports,__esModule:!0}}).call(t,function(){return this}())},function(e,t,a){(function(t,n){"use strict";var i=a(24)["default"],o=a(52)["default"],s=a(54)["default"],r=a(59)["default"];!function(t){function a(e,t,a,n){var i=o((t||u).prototype),s=new v(n||[]);return i._invoke=_(e,a,s),i}function l(e,t,a){try{return{type:"normal",arg:e.call(t,a)}}catch(n){return{type:"throw",arg:n}}}function u(){}function c(){}function d(){}function f(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function h(e){this.arg=e}function p(e){function t(a,n,i,o){var s=l(e[a],e,n);if("throw"!==s.type){var u=s.arg,c=u.value;return c instanceof h?r.resolve(c.arg).then(function(e){t("next",e,i,o)},function(e){t("throw",e,i,o)}):r.resolve(c).then(function(e){u.value=e,i(u)},o)}o(s.arg)}function a(e,a){function n(){return new r(function(n,i){t(e,a,n,i)})}return i=i?i.then(n,n):n()}"object"==typeof n&&n.domain&&(t=n.domain.bind(t));var i;this._invoke=a}function _(e,t,a){var n=x;return function(i,o){if(n===I)throw new Error("Generator is already running");if(n===N){if("throw"===i)throw o;return b()}for(;;){var s=a.delegate;if(s){if("return"===i||"throw"===i&&s.iterator[i]===w){a.delegate=null;var r=s.iterator["return"];if(r){var u=l(r,s.iterator,o);if("throw"===u.type){i="throw",o=u.arg;continue}}if("return"===i)continue}var u=l(s.iterator[i],s.iterator,o);if("throw"===u.type){a.delegate=null,i="throw",o=u.arg;continue}i="next",o=w;var c=u.arg;if(!c.done)return n=A,c;a[s.resultName]=c.value,a.next=s.nextLoc,a.delegate=null}if("next"===i)n===A?a.sent=o:a.sent=w;else if("throw"===i){if(n===x)throw n=N,o;a.dispatchException(o)&&(i="next",o=w)}else"return"===i&&a.abrupt("return",o);n=I;var u=l(e,t,a);if("normal"===u.type){n=a.done?N:A;var c={value:u.arg,done:a.done};if(u.arg!==M)return c;a.delegate&&"next"===i&&(o=w)}else"throw"===u.type&&(n=N,i="throw",o=u.arg)}}}function m(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function g(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function v(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(m,this),this.reset(!0)}function y(e){if(e){var t=e[E];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,n=function i(){for(;++a<e.length;)if(R.call(e,a))return i.value=e[a],i.done=!1,i;return i.value=w,i.done=!0,i};return n.next=n}}return{next:b}}function b(){return{value:w,done:!0}}var w,R=Object.prototype.hasOwnProperty,k="function"==typeof i?i:{},E=k.iterator||"@@iterator",C=k.toStringTag||"@@toStringTag",S="object"==typeof e,T=t.regeneratorRuntime;if(T)return void(S&&(e.exports=T));T=t.regeneratorRuntime=S?e.exports:{},T.wrap=a;var x="suspendedStart",A="suspendedYield",I="executing",N="completed",M={},O=d.prototype=u.prototype;c.prototype=O.constructor=d,d.constructor=c,d[C]=c.displayName="GeneratorFunction",T.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return t?t===c||"GeneratorFunction"===(t.displayName||t.name):!1},T.mark=function(e){return s?s(e,d):(e.__proto__=d,C in e||(e[C]="GeneratorFunction")),e.prototype=o(O),e},T.awrap=function(e){return new h(e)},f(p.prototype),T.async=function(e,t,n,i){var o=new p(a(e,t,n,i));return T.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},f(O),O[E]=function(){return this},O[C]="Generator",O.toString=function(){return"[object Generator]"},T.keys=function(e){var t=[];for(var a in e)t.push(a);return t.reverse(),function n(){for(;t.length;){var a=t.pop();if(a in e)return n.value=a,n.done=!1,n}return n.done=!0,n}},T.values=y,v.prototype={constructor:v,reset:function(e){if(this.prev=0,this.next=0,this.sent=w,this.done=!1,this.delegate=null,this.tryEntries.forEach(g),!e)for(var t in this)"t"===t.charAt(0)&&R.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=w)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,n){return o.type="throw",o.arg=e,a.next=t,!!n}if(this.done)throw e;for(var a=this,n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var s=R.call(i,"catchLoc"),r=R.call(i,"finallyLoc");if(s&&r){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!r)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a];if(n.tryLoc<=this.prev&&R.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?this.next=i.finallyLoc:this.complete(o),M},complete:function(e,t){if("throw"===e.type)throw e.arg;"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=e.arg,this.next="end"):"normal"===e.type&&t&&(this.next=t)},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.finallyLoc===e)return this.complete(a.completion,a.afterLoc),g(a),M}},"catch":function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.tryLoc===e){var n=a.completion;if("throw"===n.type){var i=n.arg;g(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,a){return this.delegate={iterator:y(e),resultName:t,nextLoc:a},M}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:void 0)}).call(t,function(){return this}(),a(113))},function(e,t){function a(){u=!1,s.length?l=s.concat(l):c=-1,l.length&&n()}function n(){if(!u){var e=setTimeout(a);u=!0;for(var t=l.length;t;){for(s=l,l=[];++c<t;)s&&s[c].run();c=-1,t=l.length}s=null,u=!1,clearTimeout(e)}}function i(e,t){this.fun=e,this.array=t}function o(){}var s,r=e.exports={},l=[],u=!1,c=-1;r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];l.push(new i(e,t)),1!==l.length||u||setTimeout(n,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=o,r.addListener=o,r.once=o,r.off=o,r.removeListener=o,r.removeAllListeners=o,r.emit=o,r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,a){e.exports={"default":a(115),__esModule:!0}},function(e,t,a){a(67),a(61),e.exports=a(116)},function(e,t,a){var n=a(43),i=a(78);e.exports=a(18).getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return n(t.call(e))}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=a(118),o=n(i);t["default"]=function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return(0,o["default"])(e)}},function(e,t,a){e.exports={"default":a(119),__esModule:!0}},function(e,t,a){a(61),a(120),e.exports=a(18).Array.from},function(e,t,a){"use strict";var n=a(19),i=a(16),o=a(13),s=a(75),r=a(76),l=a(77),u=a(78);i(i.S+i.F*!a(88)(function(e){Array.from(e)}),"Array",{from:function(e){var t,a,i,c,d=o(e),f="function"==typeof this?this:Array,h=arguments,p=h.length,_=p>1?h[1]:void 0,m=void 0!==_,g=0,v=u(d);if(m&&(_=n(_,p>2?h[2]:void 0,2)),void 0==v||f==Array&&r(v))for(t=l(d.length),a=new f(t);t>g;g++)a[g]=m?_(d[g],g):d[g];else for(c=v.call(d),a=new f;!(i=c.next()).done;g++)a[g]=m?s(c,_,[i.value,g],!0):i.value;return a.length=g,a}})},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={analytics_publish_interval:3e4,analytics_save_interval:3e3,default_web_server:"www.hipchat.com",save_preferences_throttle_interval:5e3,max_upload_size:50,file_download_timeout:1e4,scroll_to_bottom_offset:5,frozen_scroll_offset:100,chat_scroll_duration:200,render_twitter_cards:!1,chat_room_idle_timeout_minutes:1,chat_room_trim_buffer:50,message_retrieval_chunk_size:50,composing_message_linger_timeout:6e3,sent_active_message_delay:2e3,sent_composing_message_interval:3e3,request_participant_presences_timeout:500,filter_participant_presences_timeout:5e3,fetch_room_participants_timeout:500,avatar_loading_timeout:3e3,set_active_rooms_timeout:500,room_participant_page_limit:500,message_image_size_check_interval:100,message_image_loading_timeout:1e4,message_image_max_size:8e3,max_image_size_for_base64:6500,initial_room_participants_limit:21,notification_limit:5,leave_room_message_confirmation_timeout:1e4,input_history_max:50,chat_history_fetching_attempts:5,chat_history_fetching_attempt_timeout:6e4,default_message_confirmation_timeout:75e3,flaky_network_message_timeout:12e3,reconnect_failures_before_showing_banner:5,flag_close_animation_time:1e3,notify_sound_asset:"assets/audio/notify",incoming_sound_asset:"assets/audio/incoming_call",outgoing_sound_asset:"assets/audio/outgoing_call",new_hotness_image_asset:"assets/img/embedded/new-hotness.gif",new_hotness_native_asset:"assets/img/embedded/new-hotness-no-animation.png",help_link_url:"https://help.hipchat.com",get_started_url:"https://confluence.atlassian.com/get-started-with-hipchat/get-started-with-hipchat-854033505.html",feedback_issue_url:"https://jira.atlassian.com/secure/CreateIssue.jspa?pid=18110&issuetype=10000",status_page_url:"https://status.hipchat.com/",notification_close_timeout:5e3,message_filter_predicate:_.constant(!0),outgoing_message_filter_predicate:_.constant(!0),notification_banner_slide:200,notification_title_max_character_length:33,notification_icon:"assets/img/embedded/notification.png",notification_attach_to_reorder_limit_mins:5,fetching_files_limit:100,fetching_links_limit:100,fetch_thumbnails_timeout:100,shades_icon:"assets/img/embedded/shades.png",select2_max_displayed_items:20,favicon_bg_color:"#707070",default_backdrop_dismiss_on_click:!0,default_theme:"light",default_density:"normal",default_chat_view:"classic_neue",default_name_display:"names",default_animated_avatars:"animated",default_notification_level:"loud",chat_input_id:"hc-message-input",favicon_bg_color_with_mention:"#3873AE",slash_replacement_regex:new RegExp("^s/([^/]+)/([^/]*)/?$"),integrations_base_url:"https://{base_url}/addons",integrations_url:"https://{base_url}/rooms/addons/{room_id}?required_user={user_id}&from_location_id={from_location_id}&source_id={source_id}",integrations_config_url:"https://{base_url}/addons/{addon_key}?room={room_id}",integrations_update_url:"https://{base_url}/addons/{addon_key}?room={room_id}&update=true",column_width_limits:{left:{max:450,min:95,"default":220},right:{max:450,min:95,"default":200}},video_width:960,video_height:540,min_video_width:640,min_video_height:360,default_connect_dialog_height:400,default_connect_dialog_width:600,connect_aui_dialog_chrome_height:122,default_connect_aui_dialog_vertical_mergin:170,onboarding:{rooms_threshold:5,oto_threshold:5},login_page_redirect_regex:new RegExp("(log|sign)[_-]?in","gi"),emoticon_regex:new RegExp(/[^\(a-zA-Z0-9\-\:'=]+/),emote_regex:/^(\/me\s|\/em\s)/,quote_regex:/^(\/quote\s)/,code_regex:/^(\/code\s)/,pre_regex:/^(\/pre\s*|\/monospace\s*)/,core_mentions:[{mention_name:"all",name:"All room members",isUser:!1,jid:"all@chat"},{mention_name:"here",name:"Available room members",isUser:!1,jid:"here@chat"},{mention_name:"HipChat",name:"HipChat",isUser:!0,jid:"hipchat@chat"}],spinner_colors:{light:"#000000",dark:"#c7c7c7"},missed_video_call_timeout:3e4,default_group_avatar_bg:"#59afe1",default_guest_avatar_bg:"#cccccc",delayed_video_message_timeout:3e3,max_message_text_length:Math.pow(2,15),max_file_description_length:1e3,max_topic_text_length:250,max_presence_text_length:1024,integrations:{persistent_store_max_size_bytes:102400,glance_remote_metadata_timeout:1e4,loading_indicator_delay_ms:100,signed_url_timeout:2e3,spinner_delay:100},dialog:{max_size_margin:160,filter_debounce_wait:250},modal_transition_allowance:250,people_glance:{full_key:"atlassian.hipchat.internal.people:people",addon_key:"atlassian.hipchat.internal.people",addon_version:"internal.people.1",key:"people",name:"Members",target:"people",type:"glance",icon:{aui_icon:"aui-icon aui-icon-small aui-iconfont-group"},weight:0,internal:!0,max_items_to_render_collapsed:24},files_glance:{full_key:"atlassian.hipchat.internal.files:files",addon_key:"atlassian.hipchat.internal.files",addon_version:"internal.files.1",key:"files",name:"Files",target:"files",type:"glance",icon:{aui_icon:"hipchat-icon-small icon-file"},weight:1,internal:!0},links_glance:{full_key:"atlassian.hipchat.internal.links:links",addon_key:"atlassian.hipchat.internal.links",addon_version:"internal.links.1",key:"links",name:"Links",target:"links",type:"glance",icon:{aui_icon:"hipchat-icon-small icon-link"},weight:2,internal:!0},max_unread_count:99,default_avatar_colors:["#88d3ff","#59afe1","#2774a0","#1a8cff","#b2e020","#8eb021","#2f7a0e","#0bbe30","#14892c","#005812","#fe5e50","#d04437","#88170c","#f6c342","#f79232","#b05600","#d39c3f","#815b3a","#594300","#a659f5","#654982","#3d1368","#f691b2","#f15c75","#be1733","#ff4f92","#ff0d6e","#b3003e","#ffe400","#ffae00","#00d2ff","#0096ff","#d84dff","#b400ff","#7e00ff","#ffd200","#ff7f00","#ff2f00"],tipsify:{window_margin:10,distance:5,delay:300,max_dom_traverse_depth:3},cards:{feedback_url:"https://docs.google.com/a/atlassian.com/forms/d/1vcNJHyni4mCwwljRskil_Xdz9o_ssgxeu-cD0pmv1ts/viewform?entry.640157496="},guest_access_information:{focus_and_select_delay:200,mouseout_delay:300},roster_panel:{group_title_item_height:39,person_item_height:26,breakpoints:{small:20,medium:100,large:500,xlarge:1/0}},edit_message_threshold:864e5,max_users_in_group_join_notification:10,welcome_dialog:{max_size_of_group_to_display:5,max_displayed_people:4,max_displayed_rooms:4,max_amount_of_people_icons:6,max_length_of_welcome_message:150},alert_flag_poll_interval:6e5},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(103),o=n(i),s=a(109),r=n(s),l=a(123),u=n(l),c=a(124),d=n(c),f={file_types:u["default"].init(),mime_types:d["default"].init(),is_gif:function(e){var t=f.get_extension(e);return"gif"===t.toLowerCase()},get_file_name:function(e){return _.isString(e)?e.split("/").pop():""},get_extension:function(e){var t=f.get_file_name(e),a=t.split(".").pop();return a===t?"":a.toLowerCase()},get_extension_for_mime_type:function(e){return f.mime_types[e]?f.mime_types[e]:3===e.split("/").pop().length?e.split("/").pop():void 0},get_file_type:function(e,t){var a,n=f.get_extension(e);return _.find(f.file_types,function(e,t){_.includes(e,n)&&(a=t)}),t?a||"text":a},get_size_string:function(e){if(!e)return"";var t=e>1024?0:2,a=Number(e/1024).toFixed(t),n="K";return e>1048576&&(t=1,a=Number(e/1048576).toFixed(t),n="MB"),a+n},get_selected_file_type:function(e){var t={major:"unknown",minor:"unknown"};if(e&&e.type&&e.type.indexOf("/")>-1){var a=e.type.toLowerCase().split("/");t.major=a[0],t.minor=a[1]}return t},get_icon_class:function(e){var t=f.get_file_type(e);return t?"icon-"+t:"icon-text"},clean_base64_type:function(e){var t;return _.isString(e)&&(t=e.replace("data:","").replace(";base64","")),t},get_base64_type:function(e){return _.isString(e)?f.clean_base64_type(e.split(",")[0]):void 0},get_base64_data:function(e){if(_.isString(e)){var t=e.split(",");if(_.isArray(t)&&t.length>1)return t[1]}},base64_to_blob:function(e){var t,a,n,i,o,s,r,l=arguments.length<=1||void 0===arguments[1]?null:arguments[1],u=512,c=[],d=[];if(_.isString(e)){n=f.get_base64_data(e),a=f.get_base64_type(e),i=atob(n);for(var h=0;h<i.length;h+=u){o=i.slice(h,h+u),s=new Array(o.length);for(var p=0;p<o.length;p++)s[p]=o.charCodeAt(p);c=new Uint8Array(s),d.push(c)}"application/octet-stream"===a&&(r=this.get_extension(l),"mp4"===r?a="video/mp4":"mov"===r&&(a="video/quicktime")),t=new Blob(d,{type:a})}return t},blob_to_file:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?new Date:arguments[2];return e instanceof Blob&&(e.lastModifiedDate=a,e.name=t?t:""),e},create_file_object:function(e,t,a,n){var i=_.uniqueId();return _.assign(t,{id:t.id||i,group_id:r["default"].group_id(e),user_name:n,date:o["default"].utc(1e3*a).toDate(),icon_class:f.get_icon_class(t.name)})}};t["default"]=f,e.exports=t["default"]},function(e,t){"use strict";e.exports={init:function(){return{audio:["aif","aiff","mp3","wav","wma"],code:["asp","coffee","css","html","htm","java","js","json","jsp","less","lib","php","prl","py","sass","sh","xml"],doc:["doc","docm","docx","dotm","dotx","gdoc","pages"],ai:["ai"],psd:["psd"],img:["bmp","gif","jpg","jpeg","png","tif","tiff"],pdf:["pdf"],presentation:["keynote","ppam","ppsm","ppsx","ppt","pptm","pptx"],spreadsheet:["numbers","ods","xlam","xls","xlsb","xlsm","xlsx","xltm","xltx"],vector:["dxf","eps","svg"],video:["flv","m4v","mov","mp4","wmv","webm","ogv"],zip:["apk","gz","rar","tar","zip","zipx"]}}}},function(e,t){"use strict";e.exports={init:function(){return{"image/jpg":"jpg","image/jpeg":"jpg","image/png":"png","image/gif":"gif","image/svg+xml":"svg","audio/mpeg3":"mpg3","audio/wav":"wav","application/pdf":"pdf","application/text":"txt","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","application/vnd.openxmlformats-officedocument.presentationml.presentation":"pptx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","video/mp4":"mp4","video/quicktime":"mov"}}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(109),o=n(i),s={get_room_name:function(e,t){return e[t]?e[t].name:"Unknown"},get_room_id:function(e,t){return e[t]?e[t].id:!1},detect_chat_type:function(e){return o["default"].is_room(e)?"groupchat":"chat"},is_archived:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return _.isBoolean(e.is_archived)?e.is_archived:!!parseInt(e.is_archived,10)||""===e.is_archived},is_guest:function(e){return _.get(e,"is_guest")},is_admin:function(e){return _.get(e,"is_group_admin")}};t["default"]=s,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(127),o=n(i),s=a(131),r=n(s),l=a(99),u=n(l),c={get_user_name:function(e,t,a){var n=t+"_"+a+"@",i="Unknown";return _.find(e,function(e,t){t.indexOf(n)>-1&&(i=e.name)}),i},get_user_status:function(e){var t;switch(e){case"chat":t=r["default"].available;break;case"away":t=r["default"].idle;break;case"xa":t=r["default"].away;break;case"dnd":t=r["default"].dnd;break;case"mobile":t=r["default"].mobile;break;default:t=r["default"].unavailable}return t},chat_header_status:function(e){var t;switch(e){case"chat":t=r["default"].available;break;case"away":t=r["default"].away;break;case"xa":t=r["default"].away;break;case"dnd":t=r["default"].dnd;break;case"mobile":t=r["default"].mobile;break;default:t=r["default"].unavailable}return t},format_idle_time:function(e){var t="",a=Math.floor(e/86400),n=Math.floor(e%86400/3600),i=Math.floor(e%86400%3600/60);return a>0&&(t=a+"d "),n>0&&(t+=n+"h "),i>0&&(t+=i+"m"),$.trim(t)},is_admin:function(e,t,a){var n=!1,i=Number(_.get(a,"user_id")||_.get(a,"id")),o=Number(t);return _.get(a,"is_admin")||_.get(a,"is_group_admin")?n=!0:i&&(e&&(n=_.some(e,function(e){return e===i})),!n&&o&&(n=o===i)),n},is_guest:function(e){return!("subscription"in e)},sort_users:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?null:arguments[2],n=new RegExp("^"+u["default"].escapeRegEx(t),"gmi"),i=e.reduce(function(e,i){var o=a?i[a]:i,s=o.trim().split(" "),r=s.some(function(e){return e.match(n)}),l=r?s.some(function(e){return e.toLowerCase()===t.toLowerCase()}):!1;return l?e.exact.push(i):r?e.highPriority.push(i):e.lowPriority.push(i),e},{exact:[],highPriority:[],lowPriority:[]}),s=i.exact,r=i.highPriority,l=i.lowPriority,c=function(e,t){var n=a?[e[a],t[a]]:[e,t],i=(0,o["default"])(n,2),s=i[0],r=i[1];return s.toLowerCase()>r.toLowerCase()};return s=s.sort(c),r=r.sort(c),l=l.sort(c),s.concat(r).concat(l)}};t["default"]=c,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=a(128),o=n(i),s=a(114),r=n(s);t["default"]=function(){function e(e,t){var a=[],n=!0,i=!1,o=void 0;try{for(var s,l=(0,r["default"])(e);!(n=(s=l.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(u){i=!0,o=u}finally{try{!n&&l["return"]&&l["return"]()}finally{if(i)throw o}}return a}return function(t,a){if(Array.isArray(t))return t;if((0,o["default"])(Object(t)))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},function(e,t,a){e.exports={"default":a(129),__esModule:!0}},function(e,t,a){a(67),a(61),e.exports=a(130)},function(e,t,a){var n=a(72),i=a(34)("iterator"),o=a(65);e.exports=a(18).isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||o.hasOwnProperty(n(t))}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={available:"Available",idle:"Idle",away:"Away",dnd:"Do Not Disturb",mobile:"Mobile",unavailable:"Unavailable"},e.exports=t["default"]},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(121),i={isVideoLink:function(e){var t=_.get(window,"HC.ApplicationStore.data.config.video_base_url","").replace(/https?\:\/\//,""),a=["hipchat.com/video/join","hipchat.me","enso.me/join"];t&&-1===a.indexOf(t)&&a.unshift(t);for(var n=0;n<a.length;n++){var i=a[n].replace(/\/join$/,"/(join|call|meeting)"),o=new RegExp("^(https?://)?(www\\.)?"+i+"/.*","i");if(o.test(e))return!0}return!1},get_video_window_props:function(){var e=i.size_window(n.video_width,n.video_height,n.min_video_width,n.min_video_height),t=e.width,a=e.height,o=t/n.video_width,s=a/n.video_height;1>o&&1>s?s>o?t=Math.floor(n.video_width*s):a=Math.floor(n.video_height*o):1>s?t=Math.floor(n.video_width*s):1>o&&(a=Math.floor(n.video_height*o));var r=i.center_window(t,a);return"resizable=yes,width="+t+",height="+a+",top="+r.top+",left="+r.left},size_window:function(e,t,a,n){var i=.9;return{width:Math.max(Math.min(Math.floor(window.screen.availWidth*i),e),a||100),height:Math.max(Math.min(Math.floor(window.screen.availHeight*i),t),n||100)}},center_window:function(e,t){var a=window,n=a.screen,i=null!==a.screenLeft&&void 0!==a.screenLeft?a.screenLeft:n.left,o=null!==a.screenTop&&void 0!==a.screenTop?a.screenTop:n.top;return{left:Math.floor((n.availWidth-e)/2)+i,top:Math.floor((n.availHeight-t)/3)+o}}};t["default"]=i,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.clientSubType=t.platform=void 0;var i=a(134),o=n(i),s=a(135),r=n(s),l=a(139),u=n(l),c={is:{ie_edge:function(){return _.includes(navigator.userAgent,"Edge")},ie:function(){return _.includes(navigator.userAgent,"MSIE")||_.includes(navigator.appVersion,"Trident/")},safari:function(){return _.includes(navigator.userAgent,"Safari")&&!c.is.chrome()},chrome:function(){return _.includes(navigator.userAgent,"Chrome")&&!c.is.ie_edge()},firefox:function(){return _.includes(navigator.userAgent,"Firefox")&&!c.is.ie_edge()}},family:function h(){var h=r["default"].UNKNOWN;return c.is.ie()?h=r["default"].IE:c.is.ie_edge()?h=r["default"].EDGE:c.is.safari()?h=r["default"].SAFARI:c.is.chrome()?h=r["default"].CHROME:c.is.firefox()&&(h=r["default"].FIREFOX),h},userAgent:function(){return c._userAgent||(c._userAgent=(0,u["default"])()),c._userAgent}},d={isMac:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return d._checkPlatform("MAC",e)},isWindows:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return d._checkPlatform("WIN",e)},isLinux:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return d._checkPlatform("LINUX",e)},_checkPlatform:function(e,t){return t||(t=navigator.platform),-1!==t.toUpperCase().indexOf(e)}},f={isNative:function(e){return f.isMac(e)||f.isQT(e)},isQT:function(e){return f.isWindows(e)||f.isLinux(e)||f.isQTMac(e)},isWindows:function(e){return e===o["default"].QT_WINDOWS},isQTMac:function(e){return e===o["default"].QT_MAC},isLinux:function(e){return e===o["default"].QT_LINUX},isMac:function(e){return e===o["default"].MAC_NATIVE}};t["default"]=c,t.platform=d,t.clientSubType=f},function(e,t){"use strict";e.exports={QT_WINDOWS:"windows",QT_MAC:"mac",QT_LINUX:"linux",MAC_NATIVE:"macweb"}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(136),o=n(i);t["default"]=(0,o["default"])({UNKNOWN:"unknown",IE:"ie",EDGE:"edge",SAFARI:"safari",CHROME:"chrome",FIREFOX:"firefox"}),e.exports=t["default"]},function(e,t,a){e.exports={"default":a(137),__esModule:!0}},function(e,t,a){a(138),e.exports=a(18).Object.freeze},function(e,t,a){var n=a(44);a(15)("freeze",function(e){return function(t){return e&&n(t)?e(t):t}})},function(e,t,a){var n;!function(i,o){"use strict";var s="0.7.10",r="",l="?",u="function",c="undefined",d="object",f="string",h="major",p="model",_="name",m="type",g="vendor",v="version",y="architecture",b="console",w="mobile",R="tablet",k="smarttv",E="wearable",C="embedded",S={extend:function(e,t){for(var a in t)-1!=="browser cpu device engine os".indexOf(a)&&t[a].length%2===0&&(e[a]=t[a].concat(e[a]));return e},has:function(e,t){return"string"==typeof e?-1!==t.toLowerCase().indexOf(e.toLowerCase()):!1},lowerize:function(e){return e.toLowerCase()},major:function(e){return typeof e===f?e.split(".")[0]:o}},T={rgx:function(){for(var e,t,a,n,i,s,r,l=0,f=arguments;l<f.length&&!s;){var h=f[l],p=f[l+1];if(typeof e===c){e={};for(n in p)p.hasOwnProperty(n)&&(i=p[n],typeof i===d?e[i[0]]=o:e[i]=o)}for(t=a=0;t<h.length&&!s;)if(s=h[t++].exec(this.getUA()))for(n=0;n<p.length;n++)r=s[++a],i=p[n],typeof i===d&&i.length>0?2==i.length?typeof i[1]==u?e[i[0]]=i[1].call(this,r):e[i[0]]=i[1]:3==i.length?typeof i[1]!==u||i[1].exec&&i[1].test?e[i[0]]=r?r.replace(i[1],i[2]):o:e[i[0]]=r?i[1].call(this,r,i[2]):o:4==i.length&&(e[i[0]]=r?i[3].call(this,r.replace(i[1],i[2])):o):e[i]=r?r:o;l+=2}return e},str:function(e,t){for(var a in t)if(typeof t[a]===d&&t[a].length>0){for(var n=0;n<t[a].length;n++)if(S.has(t[a][n],e))return a===l?o:a}else if(S.has(t[a],e))return a===l?o:a;return e}},x={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},A={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[_,v],[/\s(opr)\/([\w\.]+)/i],[[_,"Opera"],v],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i],[_,v],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[_,"IE"],v],[/(edge)\/((\d+)?[\w\.]+)/i],[_,v],[/(yabrowser)\/([\w\.]+)/i],[[_,"Yandex"],v],[/(comodo_dragon)\/([\w\.]+)/i],[[_,/_/g," "],v],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(qqbrowser)[\/\s]?([\w\.]+)/i],[_,v],[/(uc\s?browser)[\/\s]?([\w\.]+)/i,/ucweb.+(ucbrowser)[\/\s]?([\w\.]+)/i,/JUC.+(ucweb)[\/\s]?([\w\.]+)/i],[[_,"UCBrowser"],v],[/(dolfin)\/([\w\.]+)/i],[[_,"Dolphin"],v],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[_,"Chrome"],v],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[v,[_,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[v,[_,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[v,[_,"Facebook"]],[/fxios\/([\w\.-]+)/i],[v,[_,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[v,[_,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[v,_],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[_,[v,T.str,x.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[_,v],[/(navigator|netscape)\/([\w\.-]+)/i],[[_,"Netscape"],v],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[_,v]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[y,"amd64"]],[/(ia32(?=;))/i],[[y,S.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[y,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[y,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[y,/ower/,"",S.lowerize]],[/(sun4\w)[;\)]/i],[[y,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[y,S.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[p,g,[m,R]],[/applecoremedia\/[\w\.]+ \((ipad)/],[p,[g,"Apple"],[m,R]],[/(apple\s{0,1}tv)/i],[[p,"Apple TV"],[g,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[g,p,[m,R]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[p,[g,"Amazon"],[m,R]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[p,T.str,x.device.amazon.model],[g,"Amazon"],[m,w]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[p,g,[m,w]],[/\((ip[honed|\s\w*]+);/i],[p,[g,"Apple"],[m,w]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[g,p,[m,w]],[/\(bb10;\s(\w+)/i],[p,[g,"BlackBerry"],[m,w]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7)/i],[p,[g,"Asus"],[m,R]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[g,"Sony"],[p,"Xperia Tablet"],[m,R]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[g,"Sony"],[p,"Xperia Phone"],[m,w]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[g,p,[m,b]],[/android.+;\s(shield)\sbuild/i],[p,[g,"Nvidia"],[m,b]],[/(playstation\s[34portablevi]+)/i],[p,[g,"Sony"],[m,b]],[/(sprint\s(\w+))/i],[[g,T.str,x.device.sprint.vendor],[p,T.str,x.device.sprint.model],[m,w]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[g,p,[m,R]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[g,[p,/_/g," "],[m,w]],[/(nexus\s9)/i],[p,[g,"HTC"],[m,R]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[p,[g,"Microsoft"],[m,b]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[g,"Microsoft"],[m,w]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s[6])/i],[p,[g,"Motorola"],[m,w]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[p,[g,"Motorola"],[m,R]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[g,"Samsung"],p,[m,R]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[g,"Samsung"],p,[m,w]],[/(samsung);smarttv/i],[g,p,[m,k]],[/\(dtv[\);].+(aquos)/i],[p,[g,"Sharp"],[m,k]],[/sie-(\w+)*/i],[p,[g,"Siemens"],[m,w]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[g,"Nokia"],p,[m,w]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[p,[g,"Acer"],[m,R]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[g,"LG"],p,[m,R]],[/(lg) netcast\.tv/i],[g,p,[m,k]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[p,[g,"LG"],[m,w]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[p,[g,"Lenovo"],[m,R]],[/linux;.+((jolla));/i],[g,p,[m,w]],[/((pebble))app\/[\d\.]+\s/i],[g,p,[m,E]],[/android.+;\s(glass)\s\d/i],[p,[g,"Google"],[m,E]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus)?[\s_]*(?:\d\w)?)\s+build/i],[[p,/_/g," "],[g,"Xiaomi"],[m,w]],[/\s(tablet)[;\/\s]/i,/\s(mobile)[;\/\s]/i],[[m,S.lowerize],g,p]],
engine:[[/windows.+\sedge\/([\w\.]+)/i],[v,[_,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[_,v],[/rv\:([\w\.]+).*(gecko)/i],[v,_]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[_,v],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[_,[v,T.str,x.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[_,"Windows"],[v,T.str,x.os.windows.version]],[/\((bb)(10);/i],[[_,"BlackBerry"],v],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[_,v],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[_,"Symbian"],v],[/\((series40);/i],[_],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[_,"Firefox OS"],v],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[_,v],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[_,"Chromium OS"],v],[/(sunos)\s?([\w\.]+\d)*/i],[[_,"Solaris"],v],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[_,v],[/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[_,"iOS"],[v,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[_,"Mac OS"],[v,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[_,v]]},I=function(e,t){if(!(this instanceof I))return new I(e,t).getResult();var a=e||(i&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:r),n=t?S.extend(A,t):A;return this.getBrowser=function(){var e=T.rgx.apply(this,n.browser);return e.major=S.major(e.version),e},this.getCPU=function(){return T.rgx.apply(this,n.cpu)},this.getDevice=function(){return T.rgx.apply(this,n.device)},this.getEngine=function(){return T.rgx.apply(this,n.engine)},this.getOS=function(){return T.rgx.apply(this,n.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return a},this.setUA=function(e){return a=e,this},this.setUA(a),this};I.VERSION=s,I.BROWSER={NAME:_,MAJOR:h,VERSION:v},I.CPU={ARCHITECTURE:y},I.DEVICE={MODEL:p,VENDOR:g,TYPE:m,CONSOLE:b,MOBILE:w,SMARTTV:k,TABLET:R,WEARABLE:E,EMBEDDED:C},I.ENGINE={NAME:_,VERSION:v},I.OS={NAME:_,VERSION:v},typeof t!==c?(typeof e!==c&&e.exports&&(t=e.exports=I),t.UAParser=I):"function"===u&&a(140)?(n=function(){return I}.call(t,a,t,e),!(n!==o&&(e.exports=n))):i.UAParser=I;var N=i.jQuery||i.Zepto;if(typeof N!==c){var M=new I;N.ua=M.getResult(),N.ua.get=function(){return M.getUA()},N.ua.set=function(e){M.setUA(e);var t=M.getResult();for(var a in t)N.ua[a]=t[a]}}}("object"==typeof window?window:this)},function(e,t){(function(t){e.exports=t}).call(t,{})},function(e,t){e.exports={connect_api_version:1,minimum_connect_api_version:1}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(4),o=n(i),s=a(5),r=n(s),l=a(143),u=function(){function e(t){(0,o["default"])(this,e),this.uri=t}return(0,r["default"])(e,null,[{key:"getProtocol",value:function(e){var t=e.split(":");return t.length>0?t[0]:""}},{key:"parse",value:function(t){var a=l.URI.parse(t);return a?new e(a):null}}]),(0,r["default"])(e,[{key:"isHipchatNative",value:function(e){var t=l.URI.parse(e),a=this.uri.getDomain();return"hipchat"===this.uri.getScheme()&&("www.hipchat.com"===a||t.getDomain()===a)}},{key:"getRoom",value:function(){return this._nativePathElement("room")}},{key:"containsRoom",value:function(){return null!==this.getRoom()}},{key:"getUser",value:function(){return this._nativePathElement("user")}},{key:"containsUser",value:function(){return null!==this.getUser()}},{key:"getBase",value:function(){var e=l.URI.create(this.uri.getScheme(),this.uri.getCredentials(),this.uri.getDomain(),this.uri.getPort());return e.toString()}},{key:"getScheme",value:function(){return this.uri.getScheme()}},{key:"hasScheme",value:function(){return this.uri.hasScheme()}},{key:"getDomain",value:function(){return this.uri.getDomain()}},{key:"hasDomain",value:function(){return this.uri.hasDomain()}},{key:"getPort",value:function(){return this.uri.getPort()}},{key:"hasPort",value:function(){return this.uri.hasPort()}},{key:"getPath",value:function(){return this.uri.getPath()}},{key:"hasPath",value:function(){return this.uri.hasPath()}},{key:"getQuery",value:function(){return this.uri.getQuery()}},{key:"hasQuery",value:function(){return this.uri.hasQuery()}},{key:"getFragment",value:function(){return this.uri.getFragment()}},{key:"hasFragment",value:function(){return this.uri.hasFragment()}},{key:"getAllParameters",value:function(){return this.uri.getAllParameters()}},{key:"getParameterValues",value:function(e){return this.uri.getParameterValues(e)}},{key:"getParameterMap",value:function(){return this.uri.getParameterMap()}},{key:"getParameterValue",value:function(e){return this.uri.getParameterValue(e)}},{key:"setParameterValues",value:function(e,t){return this.uri.setParameterValues(e,_.isArray(t)?t:[t]),this}},{key:"removeParameter",value:function(e){return this.uri.removeParameter(e),this}},{key:"setFragment",value:function(e){if(_.isObject(e)){var t=[];for(var a in e)t.push(a+"="+e[a]);e=t.join("&")}return this.uri.setRawFragment(e),this}},{key:"toString",value:function(){var e=this.uri.toString();return _.endsWith(e,"?")?e.substr(0,e.length-1):e}},{key:"_nativePathElement",value:function(e){var t=this.uri.getPath().split("/");return 3===t.length&&t[1]===e?t[2]:null}}]),e}();t["default"]=u,e.exports=t["default"]},function(e,t,a){var n=function(){function e(e){var t=(""+e).match(h);return t?new l(u(t[1]),u(t[2]),u(t[3]),u(t[4]),u(t[5]),u(t[6]),u(t[7])):null}function t(e,t,o,s,r,u,c){var d=new l(n(e,p),n(t,p),a(o),s>0?s.toString():null,n(r,_),null,a(c));return u&&("string"==typeof u?d.setRawQuery(u.replace(/[^?&=0-9A-Za-z_\-~.%]/g,i)):d.setAllParameters(u)),d}function a(e){return"string"==typeof e?encodeURIComponent(e):null}function n(e,t){return"string"==typeof e?encodeURI(e).replace(t,i):null}function i(e){var t=e.charCodeAt(0);return"%"+"0123456789ABCDEF".charAt(t>>4&15)+"0123456789ABCDEF".charAt(15&t)}function o(e){return e.replace(/(^|\/)\.(?:\/|$)/g,"$1").replace(/\/{2,}/g,"/")}function s(e){if(null===e)return null;for(var t,a=o(e),n=d;(t=a.replace(n,"$1"))!=a;a=t);return a}function r(e,t){var a=e.clone(),n=t.hasScheme();n?a.setRawScheme(t.getRawScheme()):n=t.hasCredentials(),n?a.setRawCredentials(t.getRawCredentials()):n=t.hasDomain(),n?a.setRawDomain(t.getRawDomain()):n=t.hasPort();var i=t.getRawPath(),o=s(i);if(n)a.setPort(t.getPort()),o=o&&o.replace(f,"");else if(n=!!i){if(47!==o.charCodeAt(0)){var r=s(a.getRawPath()||"").replace(f,""),l=r.lastIndexOf("/")+1;o=s((l?r.substring(0,l):"")+s(i)).replace(f,"")}}else o=o&&o.replace(f,""),o!==i&&a.setRawPath(o);return n?a.setRawPath(o):n=t.hasQuery(),n?a.setRawQuery(t.getRawQuery()):n=t.hasFragment(),n&&a.setRawFragment(t.getRawFragment()),a}function l(e,t,a,n,i,o,s){this.scheme_=e,this.credentials_=t,this.domain_=a,this.port_=n,this.path_=i,this.query_=o,this.fragment_=s,this.paramCache_=null}function u(e){return"string"==typeof e&&e.length>0?e:null}var c=new RegExp("(/|^)(?:[^./][^/]*|\\.{2,}(?:[^./][^/]*)|\\.{3,}[^/]*)/\\.\\.(?:/|$)"),d=new RegExp(c),f=/^(?:\.\.\/)*(?:\.\.$)?/;l.prototype.toString=function(){var e=[];return null!==this.scheme_&&e.push(this.scheme_,":"),null!==this.domain_&&(e.push("//"),null!==this.credentials_&&e.push(this.credentials_,"@"),e.push(this.domain_),null!==this.port_&&e.push(":",this.port_.toString())),null!==this.path_&&e.push(this.path_),null!==this.query_&&e.push("?",this.query_),null!==this.fragment_&&e.push("#",this.fragment_),e.join("")},l.prototype.clone=function(){return new l(this.scheme_,this.credentials_,this.domain_,this.port_,this.path_,this.query_,this.fragment_)},l.prototype.getScheme=function(){return this.scheme_&&decodeURIComponent(this.scheme_).toLowerCase()},l.prototype.getRawScheme=function(){return this.scheme_},l.prototype.setScheme=function(e){return this.scheme_=n(e,p),this},l.prototype.setRawScheme=function(e){return this.scheme_=e?e:null,this},l.prototype.hasScheme=function(){return null!==this.scheme_},l.prototype.getCredentials=function(){return this.credentials_&&decodeURIComponent(this.credentials_)},l.prototype.getRawCredentials=function(){return this.credentials_},l.prototype.setCredentials=function(e){return this.credentials_=n(e,p),this},l.prototype.setRawCredentials=function(e){return this.credentials_=e?e:null,this},l.prototype.hasCredentials=function(){return null!==this.credentials_},l.prototype.getDomain=function(){return this.domain_&&decodeURIComponent(this.domain_)},l.prototype.getRawDomain=function(){return this.domain_},l.prototype.setDomain=function(e){return this.setRawDomain(e&&encodeURIComponent(e))},l.prototype.setRawDomain=function(e){return this.domain_=e?e:null,this.setRawPath(this.path_)},l.prototype.hasDomain=function(){return null!==this.domain_},l.prototype.getPort=function(){return this.port_&&decodeURIComponent(this.port_)},l.prototype.setPort=function(e){if(e){if(e=Number(e),e!==(65535&e))throw new Error("Bad port number "+e);this.port_=""+e}else this.port_=null;return this},l.prototype.hasPort=function(){return null!==this.port_},l.prototype.getPath=function(){return this.path_&&decodeURIComponent(this.path_)},l.prototype.getRawPath=function(){return this.path_},l.prototype.setPath=function(e){return this.setRawPath(n(e,_))},l.prototype.setRawPath=function(e){return e?(e=String(e),this.path_=!this.domain_||/^\//.test(e)?e:"/"+e):this.path_=null,this},l.prototype.hasPath=function(){return null!==this.path_},l.prototype.getQuery=function(){return this.query_&&decodeURIComponent(this.query_).replace(/\+/g," ")},l.prototype.getRawQuery=function(){return this.query_},l.prototype.setQuery=function(e){return this.paramCache_=null,this.query_=a(e),this},l.prototype.setRawQuery=function(e){return this.paramCache_=null,this.query_=e?e:null,this},l.prototype.hasQuery=function(){return null!==this.query_},l.prototype.setAllParameters=function(e){if("object"==typeof e&&!(e instanceof Array)&&(e instanceof Object||"[object Array]"!==Object.prototype.toString.call(e))){var t=[],a=-1;for(var n in e){var i=e[n];"string"==typeof i&&(t[++a]=n,t[++a]=i)}e=t}this.paramCache_=null;for(var o=[],s="",r=0;r<e.length;){var n=e[r++],i=e[r++];o.push(s,encodeURIComponent(n.toString())),s="&",i&&o.push("=",encodeURIComponent(i.toString()))}return this.query_=o.join(""),this},l.prototype.checkParameterCache_=function(){if(!this.paramCache_){var e=this.query_;if(e){for(var t=e.split(/[&\?]/),a=[],n=-1,i=0;i<t.length;++i){var o=t[i].match(/^([^=]*)(?:=(.*))?$/);a[++n]=decodeURIComponent(o[1]).replace(/\+/g," "),a[++n]=decodeURIComponent(o[2]||"").replace(/\+/g," ")}this.paramCache_=a}else this.paramCache_=[]}},l.prototype.setParameterValues=function(e,t){"string"==typeof t&&(t=[t]),this.checkParameterCache_();for(var a=0,n=this.paramCache_,i=[],o=0;o<n.length;o+=2)e===n[o]?a<t.length&&i.push(e,t[a++]):i.push(n[o],n[o+1]);for(;a<t.length;)i.push(e,t[a++]);return this.setAllParameters(i),this},l.prototype.removeParameter=function(e){return this.setParameterValues(e,[])},l.prototype.getAllParameters=function(){return this.checkParameterCache_(),this.paramCache_.slice(0,this.paramCache_.length)},l.prototype.getParameterValues=function(e){this.checkParameterCache_();for(var t=[],a=0;a<this.paramCache_.length;a+=2)e===this.paramCache_[a]&&t.push(this.paramCache_[a+1]);return t},l.prototype.getParameterMap=function(e){this.checkParameterCache_();for(var t={},a=0;a<this.paramCache_.length;a+=2){var n=this.paramCache_[a++],i=this.paramCache_[a++];n in t?t[n].push(i):t[n]=[i]}return t},l.prototype.getParameterValue=function(e){this.checkParameterCache_();for(var t=0;t<this.paramCache_.length;t+=2)if(e===this.paramCache_[t])return this.paramCache_[t+1];return null},l.prototype.getFragment=function(){return this.fragment_&&decodeURIComponent(this.fragment_)},l.prototype.getRawFragment=function(){return this.fragment_},l.prototype.setFragment=function(e){return this.fragment_=e?encodeURIComponent(e):null,this},l.prototype.setRawFragment=function(e){return this.fragment_=e?e:null,this},l.prototype.hasFragment=function(){return null!==this.fragment_};var h=new RegExp("^(?:([^:/?#]+):)?(?://(?:([^/?#]*)@)?([^/?#:@]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),p=/[#\/\?@]/g,_=/[\#\?]/g;return l.parse=e,l.create=t,l.resolve=r,l.collapse_dots=s,l.utils={mimeTypeOf:function(t){var a=e(t);return/\.html$/.test(a.getPath())?"text/html":"application/javascript"},resolve:function(t,a){return t?r(e(t),e(a)).toString():""+a}},l}();"undefined"!=typeof e&&e.exports&&(t=e.exports=n),t.URI=n},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.DALCache=void 0;var o=a(100),s=i(o),r=a(59),l=i(r),u=a(4),c=i(u),d=a(5),f=i(d),h=a(145),p=i(h),m=a(147),g=i(m),v=a(152),y=i(v),b=a(153),w=i(b),R=a(155),k=i(R),E=a(156),C=i(E),S=a(158),T=n(S),x=a(159),A=i(x),I=a(154),N=n(I),M=a(160),O=i(M),D=(0,p["default"])("DAL.Cache.BrowserStorage"),P=t.DALCache=function(){function e(){(0,c["default"])(this,e),this[D]=null,this.Keys=T}return(0,f["default"])(e,[{key:"configure",value:function(e,t){_.isNumber(e)&&_.isNumber(t)&&(this[D]=new C["default"](e,t),A["default"].cacheConfigured())}},{key:"has",value:function(e){var t=this,a=arguments.length<=1||void 0===arguments[1]?{location:C["default"].Locations.LOCAL}:arguments[1];return new l["default"](function(n,i){return t[D]?void n(t[D].has(e,a)):i(g["default"].ofType(g["default"].Types.STORAGE_NOT_CONFIGURED))})}},{key:"get",value:function(e){var t=this,a=arguments.length<=1||void 0===arguments[1]?{location:C["default"].Locations.LOCAL}:arguments[1];return new l["default"](function(n,i){return t[D]?void n(O["default"].rehydrate(e,t[D].get(e,a))):i(g["default"].ofType(g["default"].Types.STORAGE_NOT_CONFIGURED))})}},{key:"set",value:function(e,t){var a=this,n=arguments.length<=2||void 0===arguments[2]?{location:C["default"].Locations.LOCAL}:arguments[2];return new l["default"](function(i,o){return a[D]?void i(a[D].set(e,O["default"].dehydrate(e,t),n)):o(g["default"].ofType(g["default"].Types.STORAGE_NOT_CONFIGURED))})}},{key:"unset",value:function(e){var t=this,a=arguments.length<=1||void 0===arguments[1]?{location:C["default"].Locations.LOCAL}:arguments[1];return new l["default"](function(n,i){return t[D]?void n(t[D].unset(e,a)):i(g["default"].ofType(g["default"].Types.STORAGE_NOT_CONFIGURED))})}},{key:"clear",value:function(){var e=this;return new l["default"](function(t,a){return e[D]?void t(e[D].clear()):a(g["default"].ofType(g["default"].Types.STORAGE_NOT_CONFIGURED))})}},{key:"updateRooms",value:function(e){var t=this;return this.get(T.ROOMS).then(function(a){return a=a||{},e.forEach(function(e){e.is_deleted||e.is_archived?_.isNull(e.id)?a=_.omitBy(a,function(t){return t.jid===e.jid}):delete a[e.id]:a[e.id]=e}),t.set(T.ROOMS,a).then(function(){return a})})}},{key:"updateRoster",value:function(e){var t=this;return this.get(T.ROSTER).then(function(a){return a=a||{},e.forEach(function(e){e.is_deleted?delete a[e.id]:a[e.id]=e}),t.set(T.ROSTER,a).then(function(){return a})})}},{key:"updateEmoticons",value:function(e){var t=this;return this.get(T.EMOTICONS).then(function(a){var n=e.query.item,i=_.get(a,"query.item",null);return i&&"result"!==e.type&&(n=[].concat(i,n),e.query.path_prefix=a.query.path_prefix,e.query.ver=a.query.ver),e.query.item=_.uniqBy(n,"id"),t.set(T.EMOTICONS,e).then(function(){return e})})}},{key:"getRosterAsXMPP",value:function(){return this.get(T.ROSTER).then(function(e){return e?{iq:{query:{item:(0,s["default"])(e).map(function(t){return y["default"].asX2JS(e[t])}),xmlns:N.ROSTER},type:"result",xmlns:N.JABBER}}:null})}},{key:"getRoomsAsXMPP",value:function(){return this.get(T.ROOMS).then(function(e){return e?{iq:{query:{item:(0,s["default"])(e).map(function(t){return w["default"].asX2JS(e[t])}),xmlns:N.DISCO_ITEMS},type:"result",xmlns:N.JABBER}}:null})}},{key:"getEmoticonsAsXMPP",value:function(){return this.get(T.EMOTICONS).then(function(e){return e?{query:{item:e.query.item.map(k["default"].asX2JS),path_prefix:e.query.path_prefix,xmlns:N.HC_EMOTICONS},type:"result",xmlns:N.JABBER}:null})}}]),e}();t["default"]=new P},function(e,t,a){e.exports={"default":a(146),__esModule:!0}},function(e,t,a){a(26),e.exports=a(18).Symbol["for"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ERRORS=void 0;var i=a(52),o=n(i),s=a(148),r=n(s),l=a(136),u=n(l),c=t.ERRORS=(0,u["default"])({HTTP:"HTTP",XMPP:"XMPP",OFFLINE:"OFFLINE",TIMEOUT:"TIMEOUT",STORAGE_JSON_SERIALIZATION:"STORAGE_JSON_SERIALIZATION",STORAGE_INACCESSIBLE:"STORAGE_INACCESSIBLE",STORAGE_DOM_QUOTA_EXCEEDED:"STORAGE_DOM_QUOTA_EXCEEDED",STORAGE_NOT_CONFIGURED:"STORAGE_NOT_CONFIGURED",EXCEPTION:"EXCEPTION",OUT_OF_SYNC:"OUT_OF_SYNC",RATE_LIMITED:"RATE_LIMITED"}),d=function(){var e=arguments.length<=0||void 0===arguments[0]?{message:"",status:520,type:c.EXCEPTION,body:null}:arguments[0],t=new Error(e.message);if((0,r["default"])(this,t),this.status=e.status,this.message=e.message,this.type=e.type,this.body=e.body,this.name=e.name?"DALError<"+e.name+">":"DALError","Invalid OAuth session"===e.message&&(this.message="If this keeps happening, try logging in again.",this.name=""),this.stack=e.stack||t.stack||null,this.stack){var a=new RegExp("^"+e.name+"|^Error");this.stack=this.stack.replace(a,this.name)}};d.prototype=(0,o["default"])(Error.prototype),d.Types=c,d.fromJqXHR=function(e){var t=e.responseText,a=e.status;if(_.isString(t)&&""!==t)try{var n=JSON.parse(t);t=_.get(n,"error.message",t),a=_.get(n,"error.code",a)}catch(i){}return new d({type:c.HTTP,status:a,message:t,body:e})},d.fromXMPP=function(e){var t=e.querySelector("error"),a=parseInt(t.getAttribute("code"),10),n=t.querySelector("text"),i=n?n.textContent:t.childNodes[0].nodeName;return new d({type:c.XMPP,status:a,message:i,body:e})},d.ofType=function(){var e=arguments.length<=0||void 0===arguments[0]?c.EXCEPTION:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a={type:e,body:null},n=t.message?": "+t.message:"";switch(e){case c.OFFLINE:a.status=0,a.message="Your connection was interrupted";break;case c.TIMEOUT:a.status=0,a.message="DAL operation timed out"+n;break;case c.OUT_OF_SYNC:a.status=409,a.message="Resource is out of sync"+n;break;case c.RATE_LIMITED:a.status=429,a.message="Too many requests"+n;break;case c.STORAGE_DOM_QUOTA_EXCEEDED:a.status=507,a.message="DAL failed to write to storage due to quota exceeded error"+n;break;case c.STORAGE_JSON_SERIALIZATION:a.status=422,a.message="DAL JSON serialization error"+n;break;case c.STORAGE_INACCESSIBLE:a.status=423,a.message="DAL could not access browser storage"+n;break;case c.STORAGE_NOT_CONFIGURED:a.status=503,a.message="DAL.Cache has not been configured! Access to storage is not yet available"+n;break;case c.EXCEPTION:default:a.status=520,a.message="An unknown DALError occurred"+n}return new d((0,r["default"])(t,a))},t["default"]=d},function(e,t,a){e.exports={"default":a(149),__esModule:!0}},function(e,t,a){a(150),e.exports=a(18).Object.assign},function(e,t,a){var n=a(16);n(n.S+n.F,"Object",{assign:a(151)})},function(e,t,a){var n=a(8),i=a(13),o=a(38);e.exports=a(21)(function(){var e=Object.assign,t={},a={},n=Symbol(),i="abcdefghijklmnopqrst";return t[n]=7,i.split("").forEach(function(e){a[e]=e}),7!=e({},t)[n]||Object.keys(e({},a)).join("")!=i})?function(e,t){for(var a=i(e),s=arguments,r=s.length,l=1,u=n.getKeys,c=n.getSymbols,d=n.isEnum;r>l;)for(var f,h=o(s[l++]),p=c?u(h).concat(c(h)):u(h),_=p.length,m=0;_>m;)d.call(h,f=p[m++])&&(a[f]=h[f]);return a}:Object.assign},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(52),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(99),d=n(c),f=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?(0,o["default"])(null):arguments[0];(0,r["default"])(this,e),this.id=t.id?t.id:null,this.jid=t.jid?t.jid:null,this.name=t.name?t.name:"",this.mention_name=t.mention_name?t.mention_name:"",this.email=t.email?t.email:"",this.title=t.title?t.title:null,this.photo_url=t.photo_url?t.photo_url:"",this.version=t.version?t.version:"",this.is_guest=t.is_guest?t.is_guest:!1,this.is_deleted=t.is_deleted?t.is_deleted:!1}return(0,u["default"])(e,null,[{key:"fromXMPP",value:function(t){var a=t.hasAttribute("id")?parseInt(t.getAttribute("id"),10):d["default"].jid.user_id(t.getAttribute("jid"));return new e({id:a,jid:t.getAttribute("jid"),name:t.getAttribute("name"),mention_name:t.getAttribute("mention_name"),email:t.getAttribute("email"),photo_url:t.getAttribute("photo_url"),version:t.getAttribute("version"),is_deleted:"remove"===t.getAttribute("subscription"),is_guest:!1,title:null})}},{key:"fromREST",value:function(t){return new e({id:t.id,jid:t.xmpp_jid,name:t.name,mention_name:t.mention_name,email:t.email,title:t.title,photo_url:t.photo_url,version:t.version,is_guest:t.is_guest,is_deleted:t.is_deleted})}},{key:"asX2JS",value:function(e){var t={id:e.id,jid:e.jid,name:e.name,mention_name:e.mention_name,email:e.email,title:e.title,photo_url:e.photo_url,version:e.version};return e.subscription?t.subscription=e.subscription:e.is_deleted?t.subscription="remove":e.is_guest||(t.subscription=""),t}}]),e}();t["default"]=f,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.PrivacyLevels=void 0;var o=a(52),s=i(o),r=a(4),l=i(r),u=a(5),c=i(u),d=a(136),f=i(d),h=a(99),p=i(h),m=a(154),g=n(m),v=t.PrivacyLevels=(0,f["default"])({PRIVATE:"private",PUBLIC:"public"}),y=(0,f["default"])({NAME:"",TOPIC:"",PRIVACY:v.PUBLIC,AVATAR_URL:"",ID:null,JID:"",GUEST_URL:"",OWNER:null,IS_ARCHIVED:!1,IS_DELETED:!1,VERSION:"00000000"}),b=function(e,t){var a=arguments.length<=2||void 0===arguments[2]?null:arguments[2],n=e.querySelector(t);return _.get(n,"textContent",a)},w=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?(0,s["default"])(null):arguments[0];(0,l["default"])(this,e),this.name=t.name||y.NAME,this.topic=t.topic||y.TOPIC,this.privacy=t.privacy||y.PRIVACY,this.version=t.version||y.VERSION,this.avatar_url=t.avatar_url||y.AVATAR_URL,this.id=t.id?parseInt(t.id,10):y.ID,this.jid=t.jid||y.JID,this.guest_url=t.guest_url||y.GUEST_URL,this.owner=t.owner?parseInt(t.owner,10):y.OWNER,this.is_archived=p["default"].coerceBoolean(t.is_archived,y.IS_ARCHIVED),this.is_deleted=p["default"].coerceBoolean(t.is_deleted,y.IS_DELETED)}return(0,c["default"])(e,null,[{key:"fromXMPPDiscoInfo",value:function(t){var a=t.getElementsByTagNameNS(g.HC_MUC_ROOM,"x")[0],n=t.querySelector("identity"),i=b(a,"owner");return new e({id:b(a,"id"),jid:t.getAttribute("from"),owner:i?p["default"].jid.user_id(i):null,name:n.getAttribute("name"),topic:b(a,"topic"),privacy:b(a,"privacy"),version:b(a,"version"),avatar_url:b(a,"avatar_url"),guest_url:b(a,"guest_url"),is_archived:a.querySelectorAll("is_archived").length>0,is_deleted:!1})}},{key:"fromXMPPDiscoItem",value:function(t){var a=t.getElementsByTagNameNS(g.HC_MUC_ROOM,"x")[0],n=t.hasAttribute("name")?t.getAttribute("name"):b(a,"name"),i=b(a,"owner");return new e({id:b(a,"id"),jid:t.getAttribute("jid"),owner:i?p["default"].jid.user_id(i):null,name:n,topic:b(a,"topic"),privacy:b(a,"privacy"),version:b(a,"version"),avatar_url:b(a,"avatar_url"),guest_url:b(a,"guest_url"),is_archived:!1,is_deleted:!1})}},{key:"fromXMPPMucRoom",value:function(t){var a=b(t,"owner"),n=t.hasAttribute("name")?t.getAttribute("name"):b(t,"name");return new e({id:b(t,"id"),jid:t.getAttribute("jid"),owner:a?p["default"].jid.user_id(a):null,name:n,topic:b(t,"topic"),privacy:b(t,"privacy"),version:b(t,"version"),avatar_url:b(t,"avatar_url"),guest_url:b(t,"guest_url"),is_archived:t.querySelectorAll("is_archived").length>0,is_deleted:"deleted"===t.getAttribute("status")})}},{key:"fromREST",value:function(t){var a=t.id?parseInt(t.id,10):y.ID,n=t.xmpp_jid,i=t.guest_access_url,o=t.owner||{};return new e(_.merge(t,{id:a,jid:n,guest_url:i},{owner:o.id}))}},{key:"asX2JS",value:function(e){return{id:e.id,jid:e.jid,name:e.name,version:e.version,x:{guest_url:e.guest_url,id:e.id,name:e.name,owner:e.owner,privacy:e.privacy,version:e.version}}}}]),e}();t["default"]=w},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.HC="http://hipchat.com",t.HC_PRESENCE="http://hipchat.com/protocol/presence",t.HC_PROFILE="http://hipchat.com/protocol/profile",t.HC_MUC_ROOM="http://hipchat.com/protocol/muc#room",t.HC_MUC_PERMISSIONS="http://hipchat.com/protocol/muc#permissions",t.HC_HISTORY="http://hipchat.com/protocol/history",t.HC_LINKS="http://hipchat.com/protocol/links",t.HC_FILES="http://hipchat.com/protocol/files",t.HC_AUTHENTICATED_FILE="http://hipchat.com/protocol/file",t.HC_EMOTICONS="http://hipchat.com/protocol/emoticons",t.HC_ROSTER_HASH="http://hipchat.com/protocol/users#hash",t.HC_ROOMS_HASH="http://hipchat.com/protocol/rooms#hash",t.JABBER="jabber:client",t.MUC="http://jabber.org/protocol/muc",t.MUC_OWNER="http://jabber.org/protocol/muc#owner",t.MUC_USER="http://jabber.org/protocol/muc#user",t.DISCO_INFO="http://jabber.org/protocol/disco#info",t.DISCO_ITEMS="http://jabber.org/protocol/disco#items",t.CHAT_STATES="http://jabber.org/protocol/chatstates",t.ENTITY_CAPABILITIES="http://jabber.org/protocol/caps",t.ROSTER="jabber:iq:roster",t.LAST_ACTIVITY="jabber:iq:last"},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.EmoticonTypes=void 0;var i=a(52),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(136),d=n(c),f=t.EmoticonTypes=(0,d["default"])({GLOBAL:"global",GROUP:"group"}),h=(0,d["default"])({ID:null,SHORTCUT:"",PATH:"",W:30,H:30,TYPE:f.GROUP}),p=function(e,t){var a=arguments.length<=2||void 0===arguments[2]?null:arguments[2],n=e.querySelector(t);return _.get(n,"textContent",a)},m=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?(0,o["default"])(null):arguments[0];(0,r["default"])(this,e),this.id=t.id?parseInt(t.id,10):h.ID,this.shortcut=t.shortcut||h.SHORTCUT,this.path=t.path||h.PATH,this.w=t.w?parseInt(t.w,10):h.W,this.h=t.h?parseInt(t.h,10):h.H,this.type=t.type||h.TYPE}return(0,u["default"])(e,null,[{key:"fromXMPP",value:function(t){return new e({id:p(t,"id"),shortcut:p(t,"shortcut"),path:p(t,"path"),w:p(t,"w"),h:p(t,"h"),type:p(t,"type")})}},{key:"asX2JS",value:function(e){return{id:String(e.id),shortcut:e.shortcut,path:e.path,w:String(e.w),h:String(e.h),type:e.type}}}]),e}();t["default"]=m},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e){switch(e.code){case 22:return!0;case 1014:return"NS_ERROR_DOM_QUOTA_REACHED"===e.name;default:return!1}}Object.defineProperty(t,"__esModule",{value:!0});var s,r=a(145),l=i(r),u=a(91),c=i(u),d=a(100),f=i(d),h=a(4),p=i(h),m=a(5),g=i(m),v=a(157),y=i(v),b=a(136),w=i(b),R=a(158),k=n(R),E=a(147),C=i(E),S="hc.",T="hc-",x=(0,w["default"])({LOCAL:"localStorage",SESSION:"sessionStorage"}),A=(0,w["default"])((s={},(0,y["default"])(s,k.ROSTER,"3"),(0,y["default"])(s,k.ROOMS,"4"),(0,y["default"])(s,k.EMOTICONS,"1"),s)),I=[k.PER_ROOM_NOTIFICATION_DIALOG_SHOWN,"hc._"+k.USER_ID,"hc._"+k.GROUP_ID,"hc._"+k.ROOMS,"hc._"+k.ROSTER,"hc._"+k.EMOTICONS],N=[k.NOTIF_BANNER_DISMISSAL_COUNT,k.NOTIF_BANNER_DISMISSED_FOREVER,k.INTEGRATIONS,k.CLIENT_PREFERENCES,k.READSTATE],M=function(){function e(t,a){(0,p["default"])(this,e),this._shouldClearPriorUserData(t,a)?this.clear():(this._clearObsoleteData(),this._migrateLegacyKeys()),this.set(k.SCHEMA,A),this.set(k.USER_ID,t),this.set(k.GROUP_ID,a)}return(0,g["default"])(e,[{key:"has",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{location:x.LOCAL}:arguments[1];return S+e in this._getAPI(t.location)}},{key:"get",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{location:x.LOCAL}:arguments[1],a=this._getAPI(t.location);return this.has(e,t)?this._deserialize(a.getItem(S+e)):null}},{key:"set",value:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?{location:x.LOCAL}:arguments[2],n=this._getAPI(a.location),i=this._serialize(t);try{n.setItem(S+e,i)}catch(s){this.unset(e,a);var r=o(s)?C["default"].ofType(C["default"].Types.STORAGE_DOM_QUOTA_EXCEEDED,s):C["default"].ofType(C["default"].Types.EXCEPTION,s);throw window.Raven&&window.Raven.captureException(r),r}return!0}},{key:"unset",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{location:x.LOCAL}:arguments[1],a=this._getAPI(t.location);return a.removeItem(S+e),!0}},{key:"clear",value:function(){var e=this,t=new RegExp("^"+S+"|^"+T);return _.forOwn(x,function(a){var n=e._getAPI(a);(0,f["default"])(n).filter(function(e){return t.test(e)}).forEach(function(e){return n.removeItem(e)})}),!0}},{key:"_shouldClearPriorUserData",value:function(e,t){if(this.has(k.USER_ID)&&this.has(k.GROUP_ID)){var a=this.get(k.USER_ID),n=this.get(k.GROUP_ID);return!(a===e&&n===t)}return!1}},{key:"_getAPI",value:function(e){try{switch(e){case x.SESSION:return window.sessionStorage;case x.LOCAL:default:return window.localStorage}}catch(t){var a=C["default"].ofType(C["default"].Types.STORAGE_INACCESSIBLE,t);throw window.Raven&&window.Raven.captureException(a),a}}},{key:"_serialize",value:function(e){return(0,c["default"])(e,function(e,t){return t instanceof RegExp?t.toString():t})}},{key:"_deserialize",value:function(e){if(_.includes(["null","undefined",""],e))return null;try{return JSON.parse(e)}catch(t){var a=C["default"].ofType(C["default"].Types.STORAGE_JSON_SERIALIZATION,t);return window.Raven&&window.Raven.captureException(a),null}}},{key:"_clearObsoleteData",value:function(){var e=this,t=this.get(k.SCHEMA),a=this._getAPI();(0,f["default"])(A).forEach(function(a){t&&t[a]===A[a]||e.unset(a)}),I.forEach(function(e){a.removeItem(e)})}},{key:"_migrateLegacyKeys",value:function(){var e=this._getAPI();N.forEach(function(t){var a=T+t,n=S+t;if(a in e){var i=e.getItem(a);e.removeItem(a),e.setItem(n,i)}})}}]),e}();M[(0,l["default"])("HJC.Storage.Schema")]=A,M.Locations=x,t["default"]=M,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=a(6),o=n(i);t["default"]=function(e,t,a){return t in e?(0,o["default"])(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NOTIF_BANNER_DISMISSED_FOREVER="notificationBannerDismissedForever",t.NOTIF_BANNER_DISMISSAL_COUNT="notificationBannerDismissalCount",t.PER_ROOM_NOTIFICATION_DIALOG_SHOWN="perRoomNotificationsDialogShown",t.ROSTER="roster",t.ROOMS="rooms-wo-archived",t.EMOTICONS="emoticons",t.GROUP_ID="group_id",t.USER_ID="user_id",t.SCHEMA="storage-schema",t.INTEGRATIONS="integrations",
t.CLIENT_PREFERENCES="client-preferences",t.ANALYTICS="hc_web-herment-storage-key",t.READSTATE="pending-readstate"},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i);t["default"]={updateAuthTokens:function(e){o["default"].dispatch("auth-token-update",e)},updateFeatureFlags:function(e){o["default"].dispatch("feature-flags-update",e)},updateAppConfiguration:function(e){o["default"].dispatch("configuration-change",e)},serverUnsupportedError:function(e){o["default"].dispatch("server-unsupported",e)},updateSID:function(e){o["default"].dispatch("update-sid",e)},cacheConfigured:function(){o["default"].dispatch("DAL:cache-configured")}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o,s=a(157),r=i(s),l=a(152),u=i(l),c=a(153),d=i(c),f=a(155),h=i(f),p=a(158),m=n(p),g=a(99),v=i(g),y=(o={},(0,r["default"])(o,m.ROSTER,{dehydrate:function(e){return _.isNull(e)?null:_.transform(e,function(e,t,a){return e.g=e.g||v["default"].jid.group_id(t.jid),e.c=e.c||v["default"].jid.domain(t.jid),e.u=e.u||{},e.u[a]=[t.name,t.mention_name,t.email,t.photo_url,t.version],e})},rehydrate:function(e){return _.isNull(e)?null:_.transform(e.u,function(t,a,n){return t[n]=new u["default"]({id:parseInt(n,10),jid:e.g+"_"+n+"@"+e.c,name:a[0],mention_name:a[1],email:a[2],photo_url:a[3],version:a[4],is_guest:!1,is_deleted:!1}),t})}}),(0,r["default"])(o,m.ROOMS,{dehydrate:function(e){return _.isNull(e)?null:_.transform(e,function(e,t,a){return e.g=e.g||v["default"].jid.group_id(t.jid),e.c=e.c||v["default"].jid.domain(t.jid),e.u=e.u||{},e.u[a]=[t.name,v["default"].jid.room_name(t.jid),t.privacy===c.PrivacyLevels.PUBLIC?1:0,t.owner,t.guest_url,t.avatar_url,t.version],e})},rehydrate:function(e){return _.isNull(e)?null:_.transform(e.u,function(t,a,n){return t[n]=new d["default"]({id:parseInt(n,10),name:a[0],jid:e.g+"_"+a[1]+"@"+e.c,privacy:1===a[2]?c.PrivacyLevels.PUBLIC:c.PrivacyLevels.PRIVATE,owner:a[3],guest_url:a[4],avatar_url:a[5],version:a[6],topic:null,is_archived:!1,is_deleted:!1}),t})}}),(0,r["default"])(o,m.EMOTICONS,{dehydrate:function(e){return _.isNull(e)?null:{p:e.query.path_prefix,v:e.query.ver,i:_.map(e.query.item,function(e,t){return[parseInt(e.id,10),e.shortcut,e.path,parseInt(e.w,10),parseInt(e.h,10),e.type===f.EmoticonTypes.GROUP?1:0]})}},rehydrate:function(e){return _.isNull(e)?null:{type:"result",query:{path_prefix:e.p,ver:e.v,item:e.i.map(function(e,t){return new h["default"]({id:e[0],shortcut:e[1],path:e[2],w:e[3],h:e[4],type:1===e[5]?f.EmoticonTypes.GROUP:f.EmoticonTypes.GLOBAL})})}}}}),o);t["default"]={dehydrate:function(e,t){return y[e]?y[e].dehydrate(t):t},rehydrate:function(e,t){return y[e]?y[e].rehydrate(t):t}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(157),s=i(o),r=a(10),l=i(r),u=a(4),c=i(u),d=a(5),f=i(d),h=a(22),p=i(h),m=a(51),g=i(m),v=a(99),y=i(v),b=a(162),w=i(b),R=a(163),k=n(R),E=a(144),C=i(E),S=a(9),T=i(S),x=a(164),A=i(x),I=a(165),N=i(I),M=a(166),O=i(M),D=a(121),P=i(D),j=a(167),L=i(j),F=a(169),U=i(F),H=void 0,B=void 0,z=function(e){function t(){(0,c["default"])(this,t);var e=(0,p["default"])(this,(0,l["default"])(t).call(this));return e._initKeys(),e._throttledSavePrefs=_.throttle(e.savePrefs,P["default"].save_preferences_throttle_interval,{leading:!0,trailing:!0}),e.local={queued:{},cache_configured:!1},e}return(0,g["default"])(t,e),(0,f["default"])(t,[{key:"_initKeys",value:function(){H=_.invert(A["default"]),B=_.invert(O["default"]),B=_.assign(B,H),B=_.omit(B,[A["default"].AUTO_JOIN])}},{key:"getModel",value:function(){return N["default"]}},{key:"flush",value:function(){this.local.cache_configured&&C["default"].set(C["default"].Keys.CLIENT_PREFERENCES,this.getClientPreferences())}},{key:"getServerPreferences",value:function(){var e=arguments.length<=0||void 0===arguments[0]?this.getAll():arguments[0];return _.pickBy(e,function(e,t){return _.has(H,t)})}},{key:"getClientPreferences",value:function(){var e=arguments.length<=0||void 0===arguments[0]?this.getAll():arguments[0];return _.pickBy(e,function(e,t){return _.has(B,t)})}},{key:"getDefaults",value:function(){var e;return e={},(0,s["default"])(e,A["default"].NOTIFY_WHEN_DND,!1),(0,s["default"])(e,A["default"].NOTIFY_FOR_VIDEO_WHEN_DND,!1),(0,s["default"])(e,A["default"].THEME,P["default"].default_theme),(0,s["default"])(e,A["default"].DENSITY,P["default"].default_density),(0,s["default"])(e,A["default"].CHAT_VIEW,P["default"].default_chat_view),(0,s["default"])(e,A["default"].NAME_DISPLAY,P["default"].default_name_display),(0,s["default"])(e,A["default"].ENABLE_IDLE,!0),(0,s["default"])(e,A["default"].IDLE_MINUTES,k.IDLE_DELAY_MINUTES),(0,s["default"])(e,A["default"].NOTIFY_FOR_ROOM,!0),(0,s["default"])(e,A["default"].NOTIFY_FOR_TAG,!0),(0,s["default"])(e,A["default"].NOTIFY_FOR_PRIVATE_ROOM,!0),(0,s["default"])(e,A["default"].NOTIFY_FOR_PRIVATE,!0),(0,s["default"])(e,A["default"].HIDE_PRESENCE_MESSAGES,!0),(0,s["default"])(e,A["default"].SOUNDS_ENABLED,!0),(0,s["default"])(e,A["default"].MESSAGE_SOUNDS,!0),(0,s["default"])(e,A["default"].VIDEO_SOUNDS,!0),(0,s["default"])(e,A["default"].GLOBAL_NOTIFICATION_SETTING,"loud"),(0,s["default"])(e,A["default"].IGNORE_ADD_INTEGRATIONS_GLANCE,""),(0,s["default"])(e,O["default"].ANIMATED_AVATARS,P["default"].default_animated_avatars),(0,s["default"])(e,O["default"].HIDE_GIFS_BY_DEFAULT,!1),(0,s["default"])(e,O["default"].ENABLE_SPELL_CHECK,!0),(0,s["default"])(e,O["default"].ENABLE_AUTOCORRECT,!1),(0,s["default"])(e,O["default"].HIDE_ATTACHED_CARDS_BY_DEFAULT,!1),(0,s["default"])(e,O["default"].REPLACE_TEXT_EMOTICONS,!0),(0,s["default"])(e,O["default"].SHOW_UNREAD_DIVIDER,!0),(0,s["default"])(e,O["default"].SHOW_CHAT_SIDEBAR,!0),(0,s["default"])(e,O["default"].SHOW_GROUPCHAT_SIDEBAR,!0),(0,s["default"])(e,O["default"].SHOW_NAVIGATION_SIDEBAR,!0),(0,s["default"])(e,O["default"].CHAT_ACTIVE_PANEL,"files"),(0,s["default"])(e,O["default"].GROUPCHAT_ACTIVE_PANEL,"roster"),(0,s["default"])(e,O["default"].LEFT_COLUMN_WIDTH,P["default"].column_width_limits.left["default"]),(0,s["default"])(e,O["default"].RIGHT_COLUMN_WIDTH,P["default"].column_width_limits.right["default"]),(0,s["default"])(e,O["default"].KEEP_POPUPS_VISIBLE,!1),(0,s["default"])(e,O["default"].BLINK_TASKBAR,!0),(0,s["default"])(e,O["default"].BOUNCE_ICON,!0),(0,s["default"])(e,O["default"].BOUNCE_ONCE,!0),(0,s["default"])(e,O["default"].ENABLE_LOGGING,!1),(0,s["default"])(e,O["default"].SHOW_QUICK_SWITCHER_HINT,!0),(0,s["default"])(e,O["default"].ACTIVE_CHAT_INTEGRATION,null),(0,s["default"])(e,O["default"].ACTIVE_GROUPCHAT_INTEGRATION,null),e}},{key:"getValidDefaults",value:function(e){var t,a=_.pickBy(e.preferences,function(e){return!_.isNull(e)&&!_.isUndefined(e)&&""!==e}),n=(t={},(0,s["default"])(t,A["default"].NOTIFY_FOR_ROOM,_.get(a,A["default"].NOTIFY_FOR_ROOM,!0)),(0,s["default"])(t,A["default"].NOTIFY_FOR_PRIVATE_ROOM,_.get(a,A["default"].NOTIFY_FOR_PRIVATE_ROOM,!0)),t);if(_.get(e,"feature_flags.web_client_per_room_notifications")){var i=n[A["default"].NOTIFY_FOR_ROOM]||n[A["default"].NOTIFY_FOR_PRIVATE_ROOM]?"loud":"normal";n[A["default"].GLOBAL_NOTIFICATION_SETTING]=_.get(a,A["default"].GLOBAL_NOTIFICATION_SETTING,i)}return _.extend(this.getAll(),a,n)}},{key:"getNotificationTypes",value:function(){var e;return e={},(0,s["default"])(e,A["default"].SHOW_TOASTERS,this.getShowToasters()),(0,s["default"])(e,O["default"].BLINK_TASKBAR,this.shouldBlinkTaskBar()),(0,s["default"])(e,O["default"].BOUNCE_ICON,this.shouldBounceIcon()),(0,s["default"])(e,O["default"].BOUNCE_ONCE,this.shouldBounceOnce()),e}},{key:"registerListeners",value:function(){var e=this;T["default"].registerOnce({"DAL:cache-configured":function(){e.local.cache_configured=!0,C["default"].get(C["default"].Keys.CLIENT_PREFERENCES).then(function(t){e.set(t)})}}),T["default"].register({"updated:active_chat":function(t){e.setChatToFocus(t)},"updated:config":function(t){_.has(t,"preferences")&&(_.has(t,"preferences.properties")&&!_.isObject(t.preferences.properties)&&delete t.preferences.properties,e.setIfNotEqual(_.omitBy(t.preferences,_.isUndefined))),_.has(t,"feature_flags")&&e.set({web_client_integrations_enabled:L["default"].isFeatureEnabled(t),web_client_freeze_gifs:_.get(t,"feature_flags.web_client_freeze_gifs",!1)})},"updated:ignoreAddIntegrationsGlance":function(t){e.set(A["default"].IGNORE_ADD_INTEGRATIONS_GLANCE,t)},"save-preferences":function(t){e.setIfNotEqual(t)},"add-room-integration-discovery-ignore-list":function(t){e.addRoomToIgnoreIntegrationGlanceList(t)},"close-room":function(t){e.removeRoom(t)},"toggle-sound-notifications":function(){e.toggleSounds()},"set-first-login-date":function(){e.setFirstLoginDate()},"unload-app":function(){e.savePrefs()}}),this.on("change",this._onChange)}},{key:"_onChange",value:function(e){var t=this.getServerPreferences(e),a=this.getClientPreferences(e);_.isEmpty(a)||this.flush(),_.isEmpty(t)||(_.assign(this.local.queued,t),this._throttledSavePrefs()),T["default"].dispatch("updated:preferences",this.getAll())}},{key:"savePrefs",value:function(){T["default"].dispatch("sync-preferences",this.local.queued),this.local.queued={}}},{key:"getAutoJoinRooms",value:function(){return this.get(A["default"].AUTO_JOIN)}},{key:"setAutoJoinRooms",value:function(e){this.set((0,s["default"])({},A["default"].AUTO_JOIN,e))}},{key:"getChatToFocus",value:function(){return this.get(O["default"].CHAT_TO_FOCUS)}},{key:"getSoundsEnabled",value:function(){return this.get(A["default"].SOUNDS_ENABLED)}},{key:"getMessageSounds",value:function(){return this.get(A["default"].MESSAGE_SOUNDS)}},{key:"getVideoSounds",value:function(){return this.get(A["default"].VIDEO_SOUNDS)}},{key:"getShowToasters",value:function(){return this.get(A["default"].SHOW_TOASTERS)}},{key:"getBlinkTaskBar",value:function(){return this.get(O["default"].BLINK_TASKBAR)}},{key:"getBounceIcon",value:function(){return this.get(O["default"].BOUNCE_ICON)}},{key:"getBounceOnce",value:function(){return this.get(O["default"].BOUNCE_ONCE)}},{key:"toggleSounds",value:function(){this.set(A["default"].SOUNDS_ENABLED,!this.getSoundsEnabled())}},{key:"getHidePresenceMessages",value:function(){return this.get(A["default"].HIDE_PRESENCE_MESSAGES)}},{key:"shouldUse24HrTime",value:function(){return this.get(A["default"].USE_24_HR_FORMAT)||!1}},{key:"shouldIssueNotification",value:function(){return this.getShowToasters()||this.shouldBlinkTaskBar()||this.shouldBounceIcon()}},{key:"setChatToFocus",value:function(e){y["default"].jid.is_search(e)||(this.data.chatToFocus=e?e.replace(/"/g,""):"",this._onChange((0,s["default"])({},O["default"].CHAT_TO_FOCUS,this.data.chatToFocus)))}},{key:"removeRoom",value:function(e){var t=_.filter(this.getAutoJoinRooms(),function(t){return t.jid!==e.jid});this.set((0,s["default"])({},A["default"].AUTO_JOIN,t))}},{key:"setFirstLoginDate",value:function(){var e=this.get(A["default"].PROPERTIES)||{};e[A["default"].PROPERTIES_FIRST_LOGIN_DATE]=(new Date).getTime(),this.set(A["default"].PROPERTIES,e)}},{key:"getRoomNotificationOverrides",value:function(){var e=this.get(A["default"].ROOM_NOTIFICATION_OVERRIDES);return _.isEmpty(e)?{}:e}},{key:"overrideNotificationForRoom",value:function(e,t){var a=_.cloneDeep(this.getRoomNotificationOverrides());a[e]=t,this.set(A["default"].ROOM_NOTIFICATION_OVERRIDES,a)}},{key:"removeRoomNotificationOverride",value:function(e){var t=_.omit(this.getRoomNotificationOverrides(),e);this.set(A["default"].ROOM_NOTIFICATION_OVERRIDES,t)}},{key:"getGlobalNotificationSetting",value:function(){return this.get(A["default"].GLOBAL_NOTIFICATION_SETTING)}},{key:"setGlobalNotificationSetting",value:function(e){this.set(A["default"].GLOBAL_NOTIFICATION_SETTING,e)}},{key:"getNotifyWhenDND",value:function(){return this.get(A["default"].NOTIFY_WHEN_DND)}},{key:"getNotifyForVideoWhenDND",value:function(){return this.get(A["default"].NOTIFY_FOR_VIDEO_WHEN_DND)}},{key:"shouldHideGifsByDefault",value:function(){return this.get(O["default"].HIDE_GIFS_BY_DEFAULT)}},{key:"shouldHideAttachedCardsByDefault",value:function(){return this.get(O["default"].HIDE_ATTACHED_CARDS_BY_DEFAULT)}},{key:"shouldReplaceTextEmoticons",value:function(){return this.get(O["default"].REPLACE_TEXT_EMOTICONS)}},{key:"shouldShowUnreadMessageDivider",value:function(){return this.get(O["default"].SHOW_UNREAD_DIVIDER)}},{key:"shouldShowChatSidebar",value:function(){return this.get(O["default"].SHOW_CHAT_SIDEBAR)}},{key:"shouldShowGroupChatSidebar",value:function(){return this.get(O["default"].SHOW_GROUPCHAT_SIDEBAR)}},{key:"shouldShowNavigationSidebar",value:function(){return this.get(O["default"].SHOW_NAVIGATION_SIDEBAR)}},{key:"getChatActivePanel",value:function(){var e=this.get(O["default"].CHAT_ACTIVE_PANEL);return this.get("web_client_integrations_enabled")?"integrations":"integrations"===e?"files":e}},{key:"getGroupChatActivePanel",value:function(){var e=this.get(O["default"].GROUPCHAT_ACTIVE_PANEL);return this.get("web_client_integrations_enabled")?"integrations":"integrations"===e?"roster":e}},{key:"getActiveGroupchatIntegration",value:function(){return this.get(O["default"].ACTIVE_GROUPCHAT_INTEGRATION)}},{key:"getActiveChatIntegration",value:function(){return this.get(O["default"].ACTIVE_CHAT_INTEGRATION)}},{key:"getLeftColumnWidth",value:function(){return this.get(O["default"].LEFT_COLUMN_WIDTH)}},{key:"getRightColumnWidth",value:function(){return this.get(O["default"].RIGHT_COLUMN_WIDTH)}},{key:"getChatView",value:function(){return this.get(A["default"].CHAT_VIEW)}},{key:"getNameDisplay",value:function(){return this.get(A["default"].NAME_DISPLAY)}},{key:"getShowQuickSwitcherHint",value:function(){return this.get(O["default"].SHOW_QUICK_SWITCHER_HINT)}},{key:"getNameDisplayOptions",value:function(){return["names","mentions"]}},{key:"getIgnoreAddIntegrationGlanceRooms",value:function(){return this._convertStringToIntArray(this.get(A["default"].IGNORE_ADD_INTEGRATIONS_GLANCE))}},{key:"_convertStringToIntArray",value:function(e){var t=[];return e&&(t=e.split(",").map(Number)),t}},{key:"addRoomToIgnoreIntegrationGlanceList",value:function(e){var t=this._convertStringToIntArray(this.get(A["default"].IGNORE_ADD_INTEGRATIONS_GLANCE));_.includes(t,e)||(t.push(e),this.set(A["default"].IGNORE_ADD_INTEGRATIONS_GLANCE,t.join())),T["default"].dispatch("save-preferences",(0,s["default"])({},A["default"].IGNORE_ADD_INTEGRATIONS_GLANCE,t.join()))}},{key:"getTheme",value:function(){return this.get(A["default"].THEME)}},{key:"isDarkTheme",value:function(){return this.getTheme()===this.DARK_THEME}},{key:"getThemeOptions",value:function(){return[this.LIGHT_THEME,this.DARK_THEME]}},{key:"getChatViewOptions",value:function(){return["classic_neue","classic"]}},{key:"getDensity",value:function(){return this.get(A["default"].DENSITY)}},{key:"getDensityOptions",value:function(){return["normal","tighter"]}},{key:"getAnimatedAvatarsOptions",value:function(){return["animated","static"]}},{key:"shouldAnimateAvatars",value:function(){return!this.data.web_client_freeze_gifs||"animated"===this.get(O["default"].ANIMATED_AVATARS)}},{key:"shouldLog",value:function(){return this.get(O["default"].ENABLE_LOGGING)}},{key:"shouldBlinkTaskBar",value:function(){var e=U["default"].get("client_subtype"),t=y["default"].clientSubType.isWindows(e);return t&&this.getBlinkTaskBar()}},{key:"shouldBounceIcon",value:function(){var e=U["default"].get("client_subtype"),t=y["default"].clientSubType.isMac(e);return t&&this.getBounceIcon()}},{key:"shouldBounceOnce",value:function(){var e=U["default"].get("client_subtype"),t=y["default"].clientSubType.isMac(e);return t&&this.getBounceOnce()}},{key:"LIGHT_THEME",get:function(){return"light"}},{key:"DARK_THEME",get:function(){return"dark"}}]),t}(w["default"]);t["default"]=new z,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(157),o=n(i),s=a(10),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(51),h=n(f),p=a(148),m=n(p),g=a(52),v=n(g),y=a(4),b=n(y),w=a(97),R=n(w),k=function C(){var e=arguments.length<=0||void 0===arguments[0]?(0,v["default"])(null):arguments[0];(0,b["default"])(this,C),(0,m["default"])(this,e)},E=function(e){function t(){(0,b["default"])(this,t);var e=(0,d["default"])(this,(0,r["default"])(t).call(this));return e.data=e._convertToModel(e.data),e}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"getModel",value:function(){return k}},{key:"setIfNotEqual",value:function(e,t){this.set(e,t,!0)}},{key:"set",value:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],n=this._getInputObject(e,t);n&&!_.isEmpty(n)&&this.doSet(this._convertToModel(n),a)}},{key:"_getInputObject",value:function(e,t){return _.isObject(e)?e:_.isString(e)&&!_.isUndefined(t)?(0,o["default"])({},e,t):null}},{key:"_convertToModel",value:function(e){var t=this.getModel();return new t(e)}},{key:"reset",value:function(){this.data=this._convertToModel(this.getDefaults())}}]),t}(R["default"]);t["default"]=E,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.HEARTBEAT_INTERVAL=6e4,t.XMPP_INACTIVITY_INTERVAL=6e4,t.BOSH_INACTIVITY_INTERVAL=6e4,t.XMPP_PONG_WAIT=3e4,t.NETWORK_LATENCY_GRACE_PERIOD=5e3,t.RECONNECT_BACKOFF_FACTOR=3,t.RECONNECT_DELAY_MS=2e3,t.RECONNECT_MAX_DELAY=6e4,t.RECONNECT_SYNC_THRESHOLD=18e4,t.MAX_RECONNECT_TIME=6e5,t.IDLE_DELAY_MINUTES=15,t.OAUTH_TOKEN_REFRESH_DELAY_MS=5e3,t.OAUTH_TOKEN_REFRESH_BACKOFF_FACTOR=3,t.OAUTH_TOKEN_REFRESH_MAX_DELAY=6e4,t.CACHE_TTL=7776e6,t.OAUTH_TTL=36e5,t.SLEEP_DELAY_MS=6e4,t.READSTATE_BACKOFF_FACTOR=3,t.READSTATE_DEFAULT_BACKOFF=5e3,t.READSTATE_MAX_BACKOFF=3e5,t.READSTATE_UPDATE_DEBOUNCE=500,t.READSTATE_NULL_MID="",t.READSTATE_NULL_TS="0.0",t.SYNC_REQUEST_GZIP_SIZE=10240,t.XMPP_LOG_MAX_CHARS=600,t.XMPP_SEND_IQ_TIMEOUT=3e4},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(136),o=n(i),s=(0,o["default"])({NOTIFY_FOR_ROOM:"notifyForRoom",NOTIFY_FOR_PRIVATE_ROOM:"notifyForPrivateRoom",NOTIFY_FOR_TAG:"notifyForTag",NOTIFY_FOR_PRIVATE:"notifyForPrivate",NOTIFY_WHEN_DND:"notifyWhenDND",NOTIFY_FOR_VIDEO_WHEN_DND:"notifyForVideoWhenDND",SOUNDS_ENABLED:"soundsEnabled",MESSAGE_SOUNDS:"messageSounds",VIDEO_SOUNDS:"videoSounds",SHOW_TOASTERS:"showToasters",HIDE_PRESENCE_MESSAGES:"hidePresenceMessages",USE_24_HR_FORMAT:"timeFormat24Hour",PROPERTIES:"properties",PROPERTIES_FIRST_LOGIN_DATE:"firstLoginDate",ROOM_NOTIFICATION_OVERRIDES:"roomNotificationOverrides",GLOBAL_NOTIFICATION_SETTING:"globalNotificationSetting",AUTO_JOIN:"autoJoin",NOTIFICATIONS:"notifications",UPDATE_TIME:"updateTime",THEME:"theme",DENSITY:"density",CHAT_VIEW:"chatView",NAME_DISPLAY:"nameDisplay",ENABLE_IDLE:"enableIdle",IDLE_MINUTES:"idleMinutes",CHECK_MINOR_UPDATES:"checkMinorUpdates",IGNORE_ADD_INTEGRATIONS_GLANCE:"ignoreAddIntegrationsGlance"});t["default"]=s,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return _.isString(e)?e.replace(/"/g,""):e}function o(e,t){var a=i(t);return _.includes(S[e].options,a)?a:S[e]["default"]}function s(e,t){if(_.isString(e)){var a=i(e);if(_.includes(S.notificationLevels.options,a))return a}return t[k["default"].NOTIFY_FOR_ROOM]||t[k["default"].NOTIFY_FOR_PRIVATE_ROOM]?"loud":"normal"}function r(e){var t=[];e.item&&(e=e.item),Array.isArray(e)||(e=[e]);for(var a in e){var n=e[a];_.isPlainObject(n)&&!_.isEmpty(n)&&t.push(_.pick(n,"jid","name"))}return t}function l(e){return _.transform(e,function(e,t,a){_.isString(t)?e[a]=_.compact(t.split(",")):e[a]=t})}function u(e){if(_.isObject(e))return e;if(_.isString(e))try{return JSON.parse(e)}catch(t){return null}}function c(e){return _.transform(e,function(e,t,a,n){switch(a){case k["default"].USE_24_HR_FORMAT:case k["default"].HIDE_PRESENCE_MESSAGES:case k["default"].NOTIFY_FOR_TAG:case k["default"].NOTIFY_FOR_PRIVATE:case k["default"].NOTIFY_WHEN_DND:case k["default"].NOTIFY_FOR_VIDEO_WHEN_DND:case k["default"].SHOW_TOASTERS:case k["default"].SOUNDS_ENABLED:case k["default"].MESSAGE_SOUNDS:case k["default"].VIDEO_SOUNDS:case k["default"].ENABLE_IDLE:case k["default"].CHECK_MINOR_UPDATES:case C["default"].SHOW_UNREAD_DIVIDER:case C["default"].REPLACE_TEXT_EMOTICONS:case C["default"].BOUNCE_ICON:case C["default"].BOUNCE_ONCE:case C["default"].BLINK_TASKBAR:case C["default"].HIDE_GIFS_BY_DEFAULT:case C["default"].SHOW_CHAT_SIDEBAR:case C["default"].SHOW_GROUPCHAT_SIDEBAR:case C["default"].SHOW_NAVIGATION_SIDEBAR:case C["default"].LAUNCH_WITH_OS_STARTUP:case C["default"].ENABLE_SPELL_CHECK:case C["default"].KEEP_POPUPS_VISIBLE:case C["default"].ENABLE_LOGGING:case C["default"].SHOW_QUICK_SWITCHER_HINT:e[a]=y["default"].coerceBoolean(t);break;case k["default"].NOTIFY_FOR_ROOM:case k["default"].NOTIFY_FOR_PRIVATE_ROOM:e[a]=_.isBoolean(t)?t:!0;break;case k["default"].IDLE_MINUTES:case k["default"].UPDATE_TIME:case C["default"].LEFT_COLUMN_WIDTH:case C["default"].RIGHT_COLUMN_WIDTH:e[a]=parseFloat(t);break;case k["default"].CHAT_TO_FOCUS:case C["default"].CHAT_ACTIVE_PANEL:case C["default"].GROUPCHAT_ACTIVE_PANEL:case k["default"].IGNORE_ADD_INTEGRATIONS_GLANCE:e[a]=i(t);break;case k["default"].GLOBAL_NOTIFICATION_SETTING:e[a]=s(t,n);break;case k["default"].THEME:case k["default"].CHAT_VIEW:case k["default"].DENSITY:case k["default"].NAME_DISPLAY:case C["default"].ANIMATED_AVATARS:e[a]=o(a,t);break;case k["default"].AUTO_JOIN:e[a]=r(t);break;case k["default"].NOTIFICATIONS:e[a]=l(t);break;case k["default"].PROPERTIES:e[a]=u(t);break;case k["default"].ROOM_NOTIFICATION_OVERRIDES:e[a]=u(t);break;case"secondsToIdle":case"isIdleTimeEnabled":case"enableEmoticons":case"dndWhenInCall":case"visualNotifications":case"exitWarn":break;default:e[a]=t}})}Object.defineProperty(t,"__esModule",{value:!0});var d=a(148),f=n(d),h=a(52),p=n(h),m=a(4),g=n(m),v=a(99),y=n(v),b=a(121),w=n(b),R=a(164),k=n(R),E=a(166),C=n(E),S={theme:{options:["light","dark"],"default":w["default"].default_theme},density:{options:["normal","tighter"],"default":w["default"].default_density},chatView:{options:["classic","classic_neue"],"default":w["default"].default_chat_view},nameDisplay:{options:["names","mentions"],"default":w["default"].default_name_display},animatedAvatars:{options:["animated","static"],"default":w["default"].default_animated_avatars},notificationLevels:{options:["loud","normal","quiet"],"default":w["default"].default_notification_level}},T=function x(){var e=arguments.length<=0||void 0===arguments[0]?(0,p["default"])(null):arguments[0],t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];(0,g["default"])(this,x),t&&(e=_.pick(e,_.values(k["default"]))),(0,f["default"])(this,c(e))};t["default"]=T,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(136),o=n(i),s=(0,o["default"])({ANIMATED_AVATARS:"animatedAvatars",HIDE_GIFS_BY_DEFAULT:"hideGifsByDefault",HIDE_ATTACHED_CARDS_BY_DEFAULT:"hideAttachedCardsByDefault",CHAT_TO_FOCUS:"chatToFocus",REPLACE_TEXT_EMOTICONS:"replaceTextEmoticons",SHOW_UNREAD_DIVIDER:"showUnreadDivider",SHOW_CHAT_SIDEBAR:"showChatSidebar",SHOW_GROUPCHAT_SIDEBAR:"showGroupChatSidebar",SHOW_NAVIGATION_SIDEBAR:"showNavigationSidebar",CHAT_ACTIVE_PANEL:"chatActivePanel",GROUPCHAT_ACTIVE_PANEL:"groupChatActivePanel",LEFT_COLUMN_WIDTH:"leftColumnWidth",RIGHT_COLUMN_WIDTH:"rightColumnWidth",LAUNCH_WITH_OS_STARTUP:"launchWithOSStartup",ENABLE_SPELL_CHECK:"enableSpellCheck",ENABLE_AUTOCORRECT:"enableAutoCorrect",KEEP_POPUPS_VISIBLE:"keepPopUsVisible",BLINK_TASKBAR:"blinkTaskbar",BOUNCE_ICON:"bounceIcon",BOUNCE_ONCE:"bounceOnce",ENABLE_LOGGING:"enableLogging",SHOW_QUICK_SWITCHER_HINT:"showQuickSwitcherHint",ACTIVE_GROUPCHAT_INTEGRATION:"activeGroupchatIntegration",ACTIVE_CHAT_INTEGRATION:"activeChatIntegration"});t["default"]=s,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(121),o=n(i),s=a(168),r=a(170),l=n(r);t["default"]={CONFIGURE_LINK_SOURCE_ID:5,DIALOG_LINK_SOURCE_ID:6,API_SOURCE_ID:7,to_full_key:function(e,t){return e+":"+t},is_full_key:function(e){return-1!==e.indexOf(":")},split_full_key:function(e){return e.split(":")},isFeatureEnabled:function(e){var t=e&&e.is_guest;return!t&&(_.get(e,"feature_flags.web_client_integrations")||"all"===_.get(e,"perms.hipconnect"))},isInternalIntegrationKey:function(e){return _.includes([o["default"].links_glance.full_key,o["default"].files_glance.full_key,o["default"].people_glance.full_key],e)},getIntegrationsUrl:function(e,t,a,n){var i=(0,s.getClientLocationId)();n||(n=0);var r={base_url:e,room_id:t,user_id:encodeURIComponent(a),from_location_id:i,source_id:n},u=new l["default"](o["default"].integrations_url);return u.replaceVariables(r)},getIntegrationsBaseUrl:function(e){var t={base_url:e},a=new l["default"](o["default"].integrations_base_url);return a.replaceVariables(t)},getIntegrationsConfigUrl:function(e,t,a){var n={base_url:e,room_id:t,addon_key:a},i=new l["default"](o["default"].integrations_config_url);return i.replaceVariables(n)},getIntegrationsUpdateUrl:function(e,t,a){var n={base_url:e,room_id:t,addon_key:a},i=new l["default"](o["default"].integrations_update_url);return i.replaceVariables(n)},extractIntegrationParametersFromMessage:function(e){var t={};return e&&(t={body:e.body,sender:{id:e.sender_id,name:e.sender,mention:e.sender_mention},mid:e.mid,type:e.type,metadata:_.get(e,"metadata",{})},e.card&&(t.card=_.pick(e.card,["title","description","url"])),e.file_data&&(t.media={type:_.get(e.file_data,"file_type","unknown").replace("img","image"),name:_.get(e.file_data,"name",""),size:e.file_data.size,url:e.file_data.url},e.file_data.thumb_url&&(t.media.thumb_url=e.file_data.thumb_url)),e.link_details&&(t.media={type:e.link_details.type,url:e.link_details.url})),t}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){var e=s["default"].get("client_type"),t=s["default"].get("client_subtype");return"qt"===e&&"windows"===t?c:"qt"===e&&"linux"===t?d:"mac"===e?u:"web"===e?l:r}Object.defineProperty(t,"__esModule",{value:!0}),t.ANDROID_CLIENT_LOCATION_ID=t.IOS_CLIENT_LOCATION_ID=t.LINUX_CLIENT_LOCATION_ID=t.WINDOWS_CLIENT_LOCATION_ID=t.MAC_CLIENT_LOCATION_ID=t.WEB_CLIENT_LOCATION_ID=t.INTERNET_LINK_LOCATION_ID=t.UNKNOWN_LOCATION_ID=void 0,t.getClientLocationId=i;var o=a(169),s=n(o),r=t.UNKNOWN_LOCATION_ID=0,l=(t.INTERNET_LINK_LOCATION_ID=1,t.WEB_CLIENT_LOCATION_ID=2),u=t.MAC_CLIENT_LOCATION_ID=3,c=t.WINDOWS_CLIENT_LOCATION_ID=4,d=t.LINUX_CLIENT_LOCATION_ID=5;t.IOS_CLIENT_LOCATION_ID=6,t.ANDROID_CLIENT_LOCATION_ID=7},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(47),h=n(f),p=a(51),m=n(p),g=a(9),v=n(g),y=a(97),b=n(y),w=function(e){function t(){return(0,r["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,m["default"])(t,e),(0,u["default"])(t,[{key:"registerListeners",value:function(){var e=this;v["default"].register("updated:config",function(t){e.set(t)})}},{key:"get",value:function(e){switch(e){case"auth_method":return this._getAuthMethod();case"client_node":return this._getClientNode();case"bind_url":return this._getBindUrl();default:return(0,h["default"])((0,o["default"])(t.prototype),"get",this).call(this,e)}}},{key:"_getBindUrl",value:function(){return _.isString(this.data.bind_url)&&_.isString(this.data.web_server)&&-1===this.data.bind_url.indexOf("https://")&&(this.data.bind_url="https://"+this.data.web_server+this.data.bind_url),this.data.bind_url}},{key:"_getAuthMethod",value:function(){return _.isNull(this.data.auth_method)&&_.isString(this.data.oauth_token)&&(this.data.auth_method="oauth2"),this.data.auth_method}},{key:"_getClientNode",value:function(){if(_.isString(this.data.client_type)&&_.isNull(this.data.client_node)){var e="http://hipchat.com/client/"+this.data.client_type;this.data.client_subtype&&(e+="/"+this.data.client_subtype),this.data.client_node=e}return this.data.client_node}},{key:"getDefaults",value:function(){return{auth_method:null,auth_nonce:null,oauth_token:null,oauth_token_expires_in:null,apiv1_token:null,apiv1_token_expires_in:null,base_url:"",video_base_url:"",bind_url:null,api_host:"api.hipchat.com",conference_server:null,chat_server:null,display_name:"",web_server:null,route:null,invite_url:null,video_chat_uri:null,client_type:null,client_subtype:null,client_version_id:null,client_os_version_id:null,client_node:null,asset_base_uri:null,video_chat_enabled:null,private_rooms_enabled:null,guest_access_enabled:null,html5_routing_enabled:null,ui:null,app_config_overrides:null,feature_flags:{},native_feature_flags:{},log_to_file:!1,jid:null,sid:null,user_id:null,user_name:null,group_id:null,group_name:null,mention:null,is_admin:null,is_guest:null,guest_key:null,email:null,title:null,photo_small:null,photo_large:null,group_avatar_url:null,addlive_app_id:null}}},{key:"isOAuth",value:function(){return"oauth2"===this._getAuthMethod()}},{key:"isNonce",value:function(){return"nonce"===this._getAuthMethod()}},{key:"getNonceToken",value:function(){return this.data.auth_nonce}},{key:"getOAuthToken",value:function(){return this.data.oauth_token}},{key:"getOAuthTokenExpiry",value:function(){return this.data.oauth_token_expires_in}},{key:"getApiV1TokenExpiry",value:function(){return this.data.apiv1_token_expires_in}},{key:"getApiV1Token",value:function(){return this.data.apiv1_token}},{key:"getSID",value:function(){return this.data.sid||"Unknown"}},{key:"isAdmin",value:function(){return this.data.is_admin===!0}},{key:"isGuest",value:function(){return this.data.is_guest===!0}},{key:"shouldLogToFile",value:function(){return this.data.log_to_file===!0}}]),t}(b["default"]);t["default"]=new w,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var a=_.get(e,t,"");return a=_.isObject(a)?(0,c["default"])(a):String(a)}Object.defineProperty(t,"__esModule",{value:!0});var o=a(4),s=n(o),r=a(5),l=n(r),u=a(91),c=n(u),d=new RegExp("{[^}]*}","g"),f=function(){function e(t){(0,s["default"])(this,e),this.template=t}return(0,l["default"])(e,[{key:"getTemplateVariables",value:function(){var e=this.template.match(d);return _.uniq(_.map(e,function(e){return e.slice(1,-1)}))}},{key:"replaceVariables",value:function(e){var t=this.template,a=this.getTemplateVariables();return _.each(a,function(a){t=t.replace("{"+a+"}",encodeURIComponent(i(e,a)))}),t}},{key:"getTemplateValuesFromParameters",value:function(e){var t=this.getTemplateVariables();return _.reduce(t,function(t,a){return t[a]=i(e,a),t},{})}}]),e}();t["default"]=f,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(4),o=n(i),s=a(5),r=n(s),l=a(172),u=n(l),c=a(175),d=n(c),f=function(){function e(t,a,n,i){(0,o["default"])(this,e),i?(this.window=i,this.window.location=t):this.window=window.open(t,a,n),this._initializeXDM(),this._startClosedInterval()}return(0,r["default"])(e,[{key:"focus",value:function(){this.window.focus()}},{key:"close",
value:function(){clearInterval(this._closedInterval),this.window.close(),this._xdmChannel.destroy(),u["default"].destroyVideoSession()}},{key:"_initializeXDM",value:function(){var e=this;this._xdmChannel=(0,d["default"])({window:this.window}),this._xdmChannel.ready(function(){e._xdmChannel.listen("video-conference-joined",function(){u["default"].videoConferenceJoined()}),e._xdmChannel.listen("video-conference-left",function(){u["default"].videoConferenceLeft()}),e._xdmChannel.listen("video-ready-to-close",function(){e.close()})})}},{key:"_startClosedInterval",value:function(){this._closedInterval=setInterval(function(e){e.window?_.get(e,"window.closed")&&(e.close(),clearInterval(e._closedInterval)):clearInterval(e._closedInterval)},1e3,this)}}]),e}();t["default"]=f,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i),s=a(173),r=n(s),l=a(174),u=n(l),c=a(109),d=n(c);t["default"]={startScreenShare:function(e){o["default"].dispatch(u["default"].ENSO+".start-screen-share",{jid:e})},showInviteFlag:function(e){o["default"].dispatch("show-flag",{id:e.id,type:"video",sender:e.sender,photo:e.photo_url,message:e.message,service:u["default"].ENSO})},showPopupsDisabledFlag:function(e){o["default"].dispatch("show-flag",{id:e.flag_id,type:"video_popup_blocked",body:e.message,promise:e.promise})},removeInviteFlag:function(e){o["default"].dispatch("remove-flag",e.index)},sendVideoInviteDeclineMessage:function(e){o["default"].dispatch("send-video-message",{jid:e.jid,type:"decline",reason:e.reason,service:u["default"].ENSO})},handleRemoteDeclinedMessage:function(e){o["default"].dispatch("call-declined",e.message)},sendVideoInviteAcceptMessage:function(e){o["default"].dispatch("send-video-message",{jid:e.jid,type:"accept",service:u["default"].ENSO})},sendVideoInviteMessage:function(e){o["default"].dispatch("send-video-message",{jid:e.jid,url:e.url,type:"call",service:u["default"].ENSO,callback:e.callback})},sendHangupMessage:function(e){var t=d["default"].is_room(e.jid)?"room":"oto";r["default"].dispatch("analytics-event",{name:"hipchat.client.user."+t+".video.hangup",properties:{room:e.room_id,service:u["default"].ENSO}}),o["default"].dispatch("send-video-message",{jid:e.jid,type:"hangup",service:u["default"].ENSO})},generateMissedCallMessage:function(e){o["default"].dispatch("missed-call",e.message)},videoConferenceJoined:function(){o["default"].dispatch(u["default"].ENSO+".video-conference-joined")},videoConferenceLeft:function(){o["default"].dispatch(u["default"].ENSO+".video-conference-left")},destroyVideoSession:function(){o["default"].dispatch(u["default"].ENSO+".video-session-destroyed")},videoCallConnected:function(e){var t=e.jid,a=e.start,n=void 0===a?0:a,i=e.done,o=void 0===i?0:i,s=d["default"].is_room(t)?"room":"oto",l=o-n;0>=l||r["default"].dispatch("analytics-event",{name:"hipchat.client.user."+s+".video.connected",properties:{time:l,service:u["default"].ENSO}})},joinRoomVideoCall:function(e){r["default"].dispatch("analytics-event",{name:"hipchat.client.user.room.video.join",properties:{room:e.room_id,service:u["default"].ENSO}}),o["default"].dispatch(u["default"].ENSO+".join-room-video",e)},joinAddLiveCall:function(e){o["default"].dispatch(u["default"].ADDLIVE+".start-video-call",{service:u["default"].ADDLIVE,type:"call",jid:e.jid,audio_only:e.audio_only})},leaveAddLiveCall:function(e){o["default"].dispatch(u["default"].ADDLIVE+".audio-video-call-hung-up",{sender:{jid:e}})},endAddLiveVideoSession:function(e){o["default"].dispatch(u["default"].ADDLIVE+".video-window-event",{type:"video_session_ended",data:{jid:e,reloading:!1}})}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(47),h=n(f),p=a(51),_=n(p),m=a(58),g=n(m),v=a(90),y=n(v),b=function(e){function t(){return(0,r["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,_["default"])(t,e),(0,u["default"])(t,[{key:"dispatch",value:function(e){for(var a,n=arguments.length,i=Array(n>1?n-1:0),s=1;n>s;s++)i[s-1]=arguments[s];if(y["default"].log&&"analytics-set-message-value"!==e){var r;y["default"].debug.apply(y["default"],["[AnalyticsDispatcher: "+e+"]"].concat(i)),(r=y["default"].type("analytics-dispatcher:"+e)).log.apply(r,i)}(a=(0,h["default"])((0,o["default"])(t.prototype),"dispatch",this)).call.apply(a,[this,e].concat(i))}}]),t}(g["default"]);t["default"]=new b,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(136),o=n(i),s=(0,o["default"])({ENSO:"enso",ADDLIVE:"addlive"});t["default"]=s,e.exports=t["default"]},function(e,t){function a(e){var t,a=e.scope,n=e.window,i=e.windowForEventListening||window,o={},s=[],r={},l=!1,u="__ready__",c=function(e){var t;try{t=JSON.parse(e.data)}catch(n){return}if(t.postis&&t.scope===a){var i=o[t.method];if(i)for(var s=0;s<i.length;s++)i[s].call(null,t.params);else r[t.method]=r[t.method]||[],r[t.method].push(t.params)}};i.addEventListener("message",c,!1);var d={listen:function(e,t){o[e]=o[e]||[],o[e].push(t);var a=r[e];if(a)for(var n=o[e],i=0;i<n.length;i++)for(var s=0;s<a.length;s++)n[i].call(null,a[s]);delete r[e]},send:function(e){var t=e.method;(l||e.method===u)&&n&&"function"==typeof n.postMessage?n.postMessage(JSON.stringify({postis:!0,scope:a,method:t,params:e.params}),"*"):s.push(e)},ready:function(e){l?e():setTimeout(function(){d.ready(e)},50)},destroy:function(e){clearInterval(t),l=!1,i&&"function"==typeof i.removeEventListener&&i.removeEventListener("message",c),e&&e()}},f=+new Date+Math.random()+"";return t=setInterval(function(){d.send({method:u,params:f})},50),d.listen(u,function(e){if(e===f){clearInterval(t),l=!0;for(var a=0;a<s.length;a++)d.send(s[a]);s=[]}else d.send({method:u,params:e})}),d}e.exports=a},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={incoming_call_notification:function(e){return"Incoming call from "+e},missed_call_message:function(e){return"Missed call from "+e},join_video_call_message:"Join me in a video call",confirm_leave:"Leave your current video call?",call_status:"On a call",connecting:"Connecting to video callâ¦",popups_blocked:"Please enable popups and try again",answer:"Answer",ignore:"Ignore",enso_to_addlive:function(e){return"I'm calling you using the new HipChat video experience, but you need to update your HipChat app to see it. You can still join the meeting in your browser: "+e},call_declined:{offline:function(e){return"It looks like "+e+" isn't available to accept video calls at the moment."},on_a_call:function(e){return e+" is currently in another video call"},decline:function(e){return e+" declined to join the video call"},unsupported:function(e){return e+" is using a HipChat client that doesn't support video calls"}}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(4),o=n(i),s=a(5),r=n(s),l=a(103),u=n(l),c=a(99),d=n(c),f=a(178),h=n(f),p=a(161),m=n(p),g=a(9),v=n(g),y=a(121),b=n(y),w=a(173),R=n(w),k=a(179),E=n(k),C=function(){function e(){(0,o["default"])(this,e);var t=b["default"].fetch_thumbnails_timeout,a=this.fetchSignedThumbnailCollection.bind(this);this.thumbnailMap={},this._debouncedFetchSignedThumbnailCollection=_.debounce(a,t,{leading:!1,trailing:!0})}return(0,r["default"])(e,[{key:"shouldOpenFileViewer",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return 0===e.button}},{key:"basename",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return e.split("/").pop()}},{key:"filesuffix",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],t=this.basename(e),a=t.split(".").pop();return t!==a?a:""}},{key:"fileViewerSupports",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this._normalizeFile(e);return"unknown"!==this._guessMimeType(t)}},{key:"transformForFileViewer",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this._normalizeFile(e),a={is_authenticated:t.is_authenticated,src:t.signed_url||t.url,srcDownload:t.url,title:t.name,type:t.is_authenticated?"not/supported":this._guessMimeType(t),downloadable:this._isDownloadable(t),date:t.date,meta:t.meta};return"video/youtube"===a.type&&(a.title=e.title||"Youtube Video"),a}},{key:"_formatDateTime",value:function(e,t){return e=/^-?\d*\.?\d*$/.test(e)?u["default"].unix(e):(0,u["default"])(e),e.format(t)}},{key:"_normalizeFile",value:function(e){var t="MMM D YYYY",a=m["default"].shouldUse24HrTime()?"HH:mm":"h:mm A";return{url:e.image||e.file_url||e.url,name:this.basename(e.name||e.title||e.url),date:e.date||"",is_authenticated:!!e.is_authenticated,meta:{avatarSrc:e.sender_avatar,author:e.user_name||e.sender,authorPrefix:E["default"].default_metabar_author_prefix,date:this._formatDateTime(e.date,t),time:this._formatDateTime(e.date,a),fileSize:d["default"].file.get_size_string(e.size),fileType:this.filesuffix(e.image||e.file_url||e.name||e.url)}}}},{key:"_guessMimeType",value:function(e){var t=(e.url||"").split("?")[0].toLowerCase()||(e.name||"").toLowerCase(),a=e.meta&&e.meta.fileType?e.meta.fileType:"",n=t.match(/\.(png|jpg|jpeg|gif|svg)$/i)||a.match(/(png|jpg|jpeg|gif|svg)$/i),i=t.match(/\.pdf$/i)||a.match(/pdf$/i),o=t.match(/\.mp3$/i)||a.match(/mp3$/i),s=t.match(/\.mp4$/i)||a.match(/mp4$/i),r=t.match(/(youtu(?:be\.com|\.be))/i);return n?"image/"+n[1].replace("jpg","jpeg").replace("svg","svg+xml"):i?"application/pdf":r?"video/youtube":s?"video/mp4":o?"audio/mp3":"unknown"}},{key:"_isDownloadable",value:function(e){return"video/youtube"!==this._guessMimeType(e)}},{key:"downloadFileAtUrl",value:function(e){R["default"].dispatch("analytics-secure-file-download");var t=document.createElement("iframe"),a=function(){t.parentNode.removeChild(t),v["default"].dispatch("file-download-stop")};document.body.appendChild(t),_.delay(a,b["default"].file_download_timeout),t.src=e}},{key:"fetchSignedThumbnailCollection",value:function(){h["default"].fetchSignedThumbnailCollection(this.thumbnailMap),this.thumbnailMap={}}},{key:"fetchSignedThumbnail",value:function(e){var t=e.id,a=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1],n=arguments.length<=2||void 0===arguments[2]?_.noop:arguments[2],i={cb:a,errCb:n};this.thumbnailMap[t]=i,this._debouncedFetchSignedThumbnailCollection()}}]),e}();e.exports=new C},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i),s=a(173),r=n(s);t["default"]={requestAncientHistory:function(e){o["default"].dispatch("requesting-ancient-history",e)},setScrollValue:function(e){o["default"].dispatch("set-scroll-value",e)},preserveScrollValue:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];o["default"].dispatch("preserve-scroll-value",e)},displayMessageAction:function(e){r["default"].dispatch("analytics-events",{name:"hipchat.client.integrations.message.action.open"}),o["default"].dispatch("display-message-action",e)},hideMessageAction:function(e){r["default"].dispatch("analytics-events",{name:"hipchat.client.integrations.message.action.close"}),o["default"].dispatch("hide-message-action",e)},chatStartedScroll:function(e){o["default"].dispatch("chat-is-scrolling",{scrolling:!0,jid:e})},updateScrollPosition:function(e){o["default"].dispatch("update-scroll-position",e)},chatStoppedScroll:function(e){o["default"].dispatch("chat-is-scrolling",{scrolling:!1,jid:e})},toggleImage:function(e){o["default"].dispatch("toggle-image",{jid:e.jid,mid:e.mid})},senderClick:function(e){o["default"].dispatch("sender-clicked",e)},chatPanelMounted:function(e){r["default"].dispatch("analytics-chat-mount",e)},onFailedCancel:function(e){o["default"].dispatch("cancel-failed-message",e)},onFailedRetry:function(e){o["default"].dispatch("retry-failed-message",e)},openChatByMentionName:function(e){o["default"].dispatch("open-chat-by-mention-name",e.mentionName)},dismissActionsDropDown:function(){o["default"].dispatch("dismiss-active-actions-dropdown")},messageMediaLoaded:function(e){o["default"].dispatch("message-media-loaded",e)},messageMediaSizeFound:function(e){o["default"].dispatch("message-media-size-found",e)},toggleAttachedCards:function(e){o["default"].dispatch("toggle-attached-cards",e)},fetchSignedThumbnail:function(e,t,a){o["default"].dispatch("API:fetch-signed-thumbnail",e,t,a)},fetchSignedThumbnailCollection:function(e){o["default"].dispatch("API:fetch-signed-thumbnail-collection",e)},thumbnailIsLoading:function(e){o["default"].dispatch("thumbnail-is-loading",e)},thumbnailLoadedSuccess:function(e){o["default"].dispatch("thumbnail-loaded-success",e)},thumbnailLoadedError:function(e){o["default"].dispatch("thumbnail-loaded-error",e)}},e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={default_metabar_author_prefix:"Shared by"},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(4),o=n(i),s=a(5),r=n(s),l=a(9),u=n(l),c=a(181),d=n(c),f=a(182),h=n(f),p=a(173),m=n(p),g=a(161),v=n(g),y=a(184),b=n(y),w=a(121),R=n(w),k=a(99),E=n(k),C=a(90),S=n(C),T=a(185),x=n(T),A=function(){function e(){(0,o["default"])(this,e),this.isSupported="undefined"!=typeof Notification,this.totalUnreadCount=0,this.totalUnreadHasMention=!1,this.titleNotifications=[],this.audioDuration={},this.canPlay={},this.autoclose_timeout=R["default"].notification_close_timeout,this.maxNotifications=R["default"].notification_limit,this.notificationCount=0,this.group_name="",this.feature_flags={},this.current_user_presence=b["default"].AVAILABLE,this.titleCounter=new h["default"]({group_name:this.group_name,feature_flags:this.feature_flags});try{this.favicon=new d["default"]({bgColor:R["default"].favicon_bg_color,maxCount:R["default"].max_unread_count})}catch(t){S["default"].warn(t)}}return(0,r["default"])(e,[{key:"initialize",value:function(e){function t(e,t,a){var n=document.createElement("source");n.type=t,n.src=a,e.appendChild(n)}var a=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];"undefined"!=typeof Audio&&!function(){var i="oncanplay"in Audio.prototype;a.audio={notification:e+(n.notify_sound_asset||R["default"].notify_sound_asset),incoming_call:e+(n.incoming_sound_asset||R["default"].incoming_sound_asset),outgoing_call:e+(n.outgoing_sound_asset||R["default"].outgoing_sound_asset)},_.forOwn(a.audio,function(e,n){a.audio[n]=new Audio,a.audio[n].addEventListener("loadedmetadata",function(){a.audioDuration[n]=a.audio[n].duration});var o=function(){a.canPlay[n]=!0},s=a.checkIfCanPlay.bind(a,a.audio[n]);i?a.audio[n].oncanplay=o:(s("audio/ogg")||s("audio/mpeg"))&&o(),t(a.audio[n],"audio/ogg",e+".ogg"),t(a.audio[n],"audio/mpeg",e+".mp3")})}()}},{key:"checkIfCanPlay",value:function(e,t){if(!e.canPlayType)return!1;var a=e.canPlayType(t);return"probably"===a||"maybe"===a}},{key:"update",value:function(e){this.group_name=e.group_name||this.group_name,this.feature_flags=e.feature_flags||this.feature_flags,this.current_user_presence=e.current_user_presence||this.current_user_presence,this.titleCounter&&this.titleCounter.update({group_name:this.group_name,feature_flags:this.feature_flags})}},{key:"notify",value:function(e){if(this._increaseCount(),this._shouldNotify(e.type)){var t=e.title;_.get(this.feature_flags,"web_client_subdomain_scoped_session")&&(t=this._formatNewMessageNotificationTitle(e));var a=new Notification(t,this._getOptions(e));this._bindNotification(a,e.jid)}}},{key:"_shouldNotify",value:function(e){return this.isSupported&&(this.current_user_presence!==b["default"].DND||v["default"].getNotifyWhenDND()||v["default"].getNotifyForVideoWhenDND()&&"incoming_call"===e)}},{key:"_formatNewMessageNotificationTitle",value:function(e){var t=x["default"].notification_title_with_group(e.title,e.group_name);return E["default"].strings.ellipsis(t,R["default"].notification_title_max_character_length)}},{key:"_shouldPlaySound",value:function(e){if(!v["default"].getSoundsEnabled())return!1;var t=v["default"].getMessageSounds(),a=v["default"].getVideoSounds(),n=this.current_user_presence===b["default"].DND,i=v["default"].getNotifyWhenDND(),o=v["default"].getNotifyForVideoWhenDND();return"outgoing_call"===e&&a?!0:"notification"!==e||!t||n&&!i?!("incoming_call"!==e||!a||n&&!i&&!o):!0}},{key:"playSound",value:function(e,t){if(this._shouldPlaySound(e)&&this.audio[e]&&this.canPlay[e]){var a=this.audio[e],n=this.audioDuration[e],i=function(){this.currentTime=0,this.play()};if(n&&a.currentTime<n)try{a.pause(),a.currentTime=0}catch(o){S["default"].warn("HC-Client",o)}t?a.addEventListener("ended",i):a.removeEventListener("ended",i),a.play()}}},{key:"stopSounds",value:function(e){function t(e){try{e.pause(),e.currentTime=0}catch(t){S["default"].warn("HC-Client",t)}}e&&this.audio[e]&&this.canPlay[e]?t(this.audio[e]):_.forEach(this.audio,function(e){t(e)})}},{key:"updateTotalUnreadCount",value:function(e,t){e===this.totalUnreadCount&&t===this.totalUnreadHasMention||(this._updateFavicon(e,t),this._updateTitleBadge(e),this.totalUnreadCount=e,this.totalUnreadHasMention=t)}},{key:"setTitleNotification",value:function(e){this.titleNotifications.push(e),this._updateTitleNotification()}},{key:"unsetTitleNotification",value:function(e){_.remove(this.titleNotifications,{id:e}),this._updateTitleNotification()}},{key:"_getOptions",value:function(e){var t={icon:e.icon,body:e.body};return this.notificationCount>=this.maxNotifications&&(t.tag=!0),t}},{key:"_bindNotification",value:function(e,t){var a=this;e.onclick=function(){window.focus(),u["default"].dispatch("set-route",{jid:t}),u["default"].dispatch("focus-video-window",{jid:t}),m["default"].dispatch("analytics-select-room",{jid:t}),this.close()},e.onshow=function(){setTimeout(function(){e.close()},a.autoclose_timeout)},e.onclose=function(){a._decreaseCount(e)}}},{key:"_increaseCount",value:function(){this.notificationCount++}},{key:"_decreaseCount",value:function(e){e.tag?this.notificationCount=0:this.notificationCount--}},{key:"_updateFavicon",value:function(e,t){if(this.favicon)if(e>0){var a={bgColor:R["default"].favicon_bg_color,maxCount:R["default"].max_unread_count};t&&(a.bgColor=R["default"].favicon_bg_color_with_mention),this.favicon.badge(e,a)}else this.favicon.reset()}},{key:"_updateTitleBadge",value:function(e){if(this._browserNeedsBadge()){var t=e>0?e:0,a=this._getCurrentTitleNotification();this.titleCounter.set(t,a)}}},{key:"_updateTitleNotification",value:function(){var e=this._getCurrentTitleNotification(),t=this._browserNeedsBadge()?this.totalUnreadCount:0;this.titleCounter.set(t,e)}},{key:"_getCurrentTitleNotification",value:function(){var e=_.last(this.titleNotifications);return _.get(e,"text",null)}},{key:"_browserNeedsBadge",value:function(){return E["default"].browser.is.ie()||E["default"].browser.is.ie_edge()||E["default"].browser.is.safari()}}]),e}();e.exports=new A},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(4),o=n(i),s=a(5),r=n(s),l=a(99),u=n(l),c=function(){function e(t){var a=this;(0,o["default"])(this,e),this.def={bgColor:"#d00",textColor:"#fff",fontFamily:"sans-serif",fontStyle:"lighter",elementId:!1},this.browser={},this.browser.ff="undefined"!=typeof InstallTrigger,this.browser.opera=!!window.opera||navigator.userAgent.indexOf("Opera")>=0,this.readyCb=function(){},this.ready=!1,this.opt=_.merge(this.def,t),this.opt.textColor=this.hexToRgb(this.opt.textColor);try{this.orig=this.getIcon(),this.canvas=document.createElement("canvas"),this.img=document.createElement("img"),this.orig.hasAttribute("href")?(this.img.onload=function(){a.h=a.img.height>0?a.img.height:32,a.w=a.img.width>0?a.img.width:32,a.canvas.height=a.h,a.canvas.width=a.w,a.context=a.canvas.getContext("2d"),a.setReady()},this.img.setAttribute("src",this.orig.getAttribute("href"))):(this.img.setAttribute("src",""),this.h=32,this.w=32,this.img.height=this.h,this.img.width=this.w,this.canvas.height=this.h,this.canvas.width=this.w,this.context=this.canvas.getContext("2d"),this.setReady())}catch(n){throw"Error initializing favico. Message: "+n.message}}return(0,r["default"])(e,[{key:"setReady",value:function(){this.ready=!0,this.reset(),this.readyCb()}},{key:"reset",value:function(){this.ready&&this.context&&(this.context.clearRect(0,0,this.w,this.h),this.context.drawImage(this.img,0,0,this.w,this.h),this.setIcon(this.canvas))}},{key:"draw",value:function(e){var t=this;if(!u["default"].browser.is.ie()&&!u["default"].browser.is.ie_edge()){this.ready=!1;var a=new Image;a.onload=function(){t.context&&(e.n="number"==typeof e.n?Math.abs(0|e.n):e.n,e.w=t.w,e.h=t.h,e.len=(""+e.n).length,t.context.clearRect(0,0,t.w,t.h),t.context.drawImage(a,0,0),t.context.beginPath(),t.context.font=t.opt.fontStyle+" "+Math.floor(e.n>99?1.2*e.h:.55*e.h)+"px "+t.opt.fontFamily,t.context.textAlign="center",t.context.fillStyle="rgb("+t.opt.textColor.r+","+t.opt.textColor.g+","+t.opt.textColor.b+")","number"==typeof e.n&&e.n>t.opt.maxCount?(t.context.font="bold "+Math.floor(.5*e.h)+"px "+t.opt.fontFamily,t.context.fillText("â¢â¢â¢",Math.floor(e.w/2),Math.floor(.67*e.h))):t.context.fillText(e.n,Math.floor(e.w/2),Math.floor(e.h-.34*e.h)),t.context.closePath(),t.setIcon(t.canvas))};var n='<svg xmlns="http://www.w3.org/2000/svg" width="'+this.w+'" height="'+this.h+'"><g><path fill="'+e.bgColor+'" d="M29.1,28.9c-1.1-0.6-2.2-1.7-2.6-3.2c-0.1-0.3,0-0.5,0.2-0.7c3.2-2.5,5.2-6.1,5.2-10.2c0-7.5-7-13.6-15.8-13.6c-8.7,0-15.7,6.1-15.7,13.6c0,7.5,7,13.6,15.7,13.6c1.1,0,2.2-0.1,3.3-0.3c0.3-0.1,0.5,0,0.7,0.1c2.2,1.3,5.4,2.4,8.2,2.4c0.9,0,1.3-0.6,1.3-1.1C28.6,29.3-209.8,29.1,28.9z"/></g></svg>';a.src="data:image/svg+xml,"+encodeURIComponent(n)}}},{key:"badge",value:function(e,t){var a=this;try{if("number"==typeof e?e>0:""!==e){var n={type:"badge",options:{n:e,bgColor:t.bgColor||this.opt.bgColor}};["textColor"].forEach(function(e){e in t&&(n.options[e]=a.hexToRgb(t[e]))}),["fontStyle","fontFamily"].forEach(function(e){e in t&&(n.options[e]=t[e])}),this.draw(n.options)}else this.reset()}catch(i){throw"Error setting badge. Message: "+i.message}}},{key:"getIcon",value:function(){var e=!1,t="",a=function(){for(var e=document.getElementsByTagName("head")[0].getElementsByTagName("link"),t=e.length,a=t-1;a>=0;a--)if(/(^|\s)icon(\s|$)/i.test(e[a].getAttribute("rel")))return e[a];return!1};if(this.opt.elementId?(e=document.getElementById(this.opt.elementId),e.setAttribute("href",e.getAttribute("src"))):(e=a(),e===!1&&(e=document.createElement("link"),e.setAttribute("rel","icon"),document.getElementsByTagName("head")[0].appendChild(e))),t=this.opt.elementId?e.src:e.href,"data:"!==t.substr(0,5)&&-1===t.indexOf(document.location.hostname))throw new Error("Error setting favicon. Favicon image is on different domain (Icon: "+t+", Domain: "+document.location.hostname+")");return e.setAttribute("type","image/png"),e}},{key:"setIcon",value:function(e){var t=this,a=e.toDataURL("image/png");if(this.opt.elementId)document.getElementById(this.opt.elementId).setAttribute("src",a);else if(this.browser.ff||this.browser.opera){var n=this.orig;this.orig=document.createElement("link"),this.browser.opera&&this.orig.setAttribute("rel","icon"),this.orig.setAttribute("rel","icon"),this.orig.setAttribute("type","image/png"),document.getElementsByTagName("head")[0].appendChild(this.orig),this.orig.setAttribute("href",a),n.parentNode&&n.parentNode.removeChild(n)}else _.defer(function(){t.orig.setAttribute("href",a)});this.ready=!0}},{key:"hexToRgb",value:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,a,n){return t+t+a+a+n+n});var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:!1}}]),e}();e.exports=c},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(4),o=n(i),s=a(5),r=n(s),l=a(183),u=n(l),c=a(121),d=n(c),f=function(){function e(t){(0,o["default"])(this,e),this.group_name=null,this.feature_flags={},this.update(t)}return(0,r["default"])(e,[{key:"update",value:function(e){var t=_.get(e,"group_name",""),a=_.get(e,"feature_flags",{});t===this.group_name&&_.isEqual(a,this.feature_flags)||(this.group_name=t,this.feature_flags=a,this.set())}},{key:"set",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=arguments.length<=1||void 0===arguments[1]?null:arguments[1],a=[];e>d["default"].max_unread_count?a.push("("+d["default"].max_unread_count+"+)"):e&&a.push("("+e+")"),t?a.push(t,"-"):this.feature_flags.web_client_subdomain_scoped_session&&a.push(this.group_name,"-"),a.push(u["default"].app_name),this.setTitle(a.join(" "))}},{key:"setTitle",value:function(e){document.title=e}}]),e}();t["default"]=f,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={app_name:"HipChat",filter_label:"Filter rooms and people",filter:"Filter",all:"All",rooms:"Rooms",people:"People",sign_in:"Sign in",lobby:"Lobby",youre_welcome:"you're welcome here",search_results:"Search results",buttons:{create_room:"Create a room",invite_team:"Invite your team",invite_team_in_lobby:"Invite someone to join!",invite_team_in_qs:"Invite them to join!",invite_team_in_invite_users_dialog:"Invite them to join!"},no_one_found:"No one found",loud:"Loud",normal:"Normal",quiet:"Quiet",room_not_found:"We couldn't find that room. It may have been deleted or you may have the wrong ID.",user_not_found:"We couldn't find that person."},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(136),o=n(i);t["default"]=(0,o["default"])({AVAILABLE:"chat",IDLE:"away",AWAY:"xa",MOBILE:"mobile",DND:"dnd",UNAVAILABLE:"unavailable"}),e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={show_more:"Show more",show_less:"Show less",failed_message:"Couldn't send",failed_message_retry:"Retry",failed_message_cancel:"Cancel",unconfirmed_message_group:"Sending...",room_doesnt_exist:"This room doesn't exist; it may have been archived or deleted.",integration_does_not_exist:"This addon does not exist; it may have been uninstalled from this room.",user_leave:function(e){return e+" left the room"},user_join:function(e){return e+" joined the room"},user_removed:function(e){return e+" was removed from the room"},user_added:function(e){return e+" was added to the room"},user_leave_reason:function(e,t){return e+" left the room ("+t+")"},user_changed_guest_access:function(e,t){return e+" "+t+" guest access"},user_changed_archive_status:function(e,t){return e+" "+t+" the room"},generic_message:function(e){return"Message from "+e},generic_file_message:function(e){return e+" uploaded a file"},generic_file_uploaded_message:function(e,t){return e+" uploaded "+t},topic_message:function(e,t){return e+" changed the topic to: "+t},clear_topic_message:function(e){return e+" cleared the topic."},room_notification_title:function(e,t){return e+" - "+t},oto_notification_title:function(e){return""+e},notification_title_with_group:function(e,t){return e+" ("+t+")"},you_have_been_removed:"You have been removed from the room",archived:"archived",unarchived:"unarchived",not_allowed:"guest access unavailable",turned_on:"turned on",turned_off:"turned off",loading_thumbnail:"Loading thumbnailâ¦",loading_image:"Loading imageâ¦",image_error:"Failed to load the image",thumbnail_error:"Failed to load thumbnail",image_hidden:"Image hidden",edited:"Edited",message_deleted:"Message deleted"},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){e.textContent="REDACTED"}function o(e){var t=e.textContent;e.textContent=t.replace(/([\s\S]+\/)[\S]+(\.[\w]+)$/,"$1REDACTED$2")}function s(e){var t=void 0;(0,l["default"])(e).forEach(function(e){t=e.nodeName,f.indexOf(t)>=0?i(e):h.indexOf(t)>=0&&o(e)})}Object.defineProperty(t,"__esModule",{value:!0});var r=a(118),l=n(r),u=a(154),c=["token","auth_nonce","oauth_token","oauth2_token","access_token","apiv1_token","nonce"],d=["message","text"],f=["body","desc"],h=["name","thumb","thumbnail","thumb_url","file_url"],p="[function call]";t["default"]={sanitize:function(e){if(_.isFunction(e))return this.sanitizeFunc(e);var t=_.cloneDeep(e);return _.isObject(t)?this.iterateObj(t):t},sanitizeXML:function(e){var t=_.get(e,"localName");if(!_.isString(t))return e;switch(t.toLowerCase()){case"auth":return this.cleanStanza(e);case"success":return this.cleanStanza(e);case"message":return this.cleanMessageStanza(e);case"iq":return this.cleanIqStanza(e)}return e},cleanStanza:function(e){var t=this.cloneXMLNode(e);return t?(t=this.cleanNodeContent(t),t=this.cleanNodeAttrs(t)):e},cleanMessageStanza:function(e){var t=this.cloneXMLNode(e),a=void 0;return t?(a=t.getElementsByTagName("*"),a.length&&s(a),t):e},cleanIqStanza:function(e){var t=this.cloneXMLNode(e),a=t.getElementsByTagName("query"),n=void 0;return a.length&&(n=a[0].getAttribute("xmlns"),n!==u.HC_FILES&&n!==u.HC_AUTHENTICATED_FILE||this.cleanFilesStanza(t)),t},cleanFilesStanza:function(e){var t=e.getElementsByTagName("*");t.length&&s(t)},cloneXMLNode:function(e){return e.cloneNode(!0)},cleanNodeContent:function(e){return e.textContent=this.cleanToken(e.textContent),e},cleanNodeAttrs:function(e){var t=this,a=arguments.length<=1||void 0===arguments[1]?c:arguments[1];return _.each(a,function(a){var n=e.getAttribute(a);e&&n&&e.setAttribute(a,t.cleanToken(n))}),e},cleanToken:function(e){var t=e.toString();return t.slice(0,8)+"..."},cleanMessage:function(e){return"REDACTED"},iterateObj:function(e){for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];_.isObject(a)&&!_.isFunction(a)?this.iterateObj(a):e[t]=this.sanitizeVal(t,a)}return e},sanitizeVal:function(e,t){return t?_.isFunction(t)?this.sanitizeFunc(t):-1!==c.indexOf(e)?this.cleanToken(t):-1!==d.indexOf(e)?this.cleanMessage(t):t:t},sanitizeFunc:function(e){return p}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(24),o=n(i),s=a(90),r=n(s),l=(0,o["default"])("X"),u=(0,o["default"])("Y"),c=(0,o["default"])("realX"),d=(0,o["default"])("realY");t["default"]={track:function(){var e=_.debounce(this._save.bind(this),20,{leading:!0,trailing:!0});document.addEventListener("mouseover",e),document.addEventListener("mousemove",e)},_save:function(e){var t=e.pageX,a=e.pageY;this[c]=t,this[d]=a,r["default"].type("mouse-position").withFilter().info("Real mouse position has changed:",t,a)},useLatest:function(){this[l]=this[c],this[u]=this[d]},hasChanged:function(e){var t=e.pageX,a=e.pageY;return this[l]!==t||this[u]!==a?(this[l]=t,this[u]=a,r["default"].type("mouse-position").withFilter().info("Mouse position has changed:",t,a),!0):!1},get x(){return this[l]},get y(){return this[u]},get realX(){return this[c]},get realY(){return this[d]}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(157),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(189),d=n(c),f=a(205),h=n(f),p=a(173),m=n(p),g=a(9),v=n(g),y=a(121),b=n(y),w=a(169),R=n(w),k=a(99),E=n(k),C=a(206),S=n(C),T=a(90),x=n(T);a(254);var A=function(){function e(t,a){var n=arguments.length<=2||void 0===arguments[2]?window["herment-gas-client"]:arguments[2],i=arguments.length<=3||void 0===arguments[3]?window["app-metrics"]:arguments[3],o=arguments.length<=4||void 0===arguments[4]?window.performance:arguments[4];
(0,r["default"])(this,e),this.setupVariables(t,a,o),this.bindCustomAnalyticEvents(),this.startHerment(t,a,n),this.setupMetrics(i),this.handlePreloaderAnalytics(),this.handleAnalyticsLaunched(),this.registerListeners()}return(0,u["default"])(e,[{key:"registerListeners",value:function(){var e=this;v["default"].registerOnce({"app-state-ready":function(){e.handleAppStateReady()},"DAL:cache-configured":function(){S["default"].Cache.get(S["default"].Cache.Keys.CLIENT_PREFERENCES).then(function(t){e.shouldSendLaunchToChat=e.shouldSendLaunchToChatComplete=E["default"].jid.is_chat(_.get(t,"chatToFocus"))})}}),m["default"].registerOnce({"analytics-client-ready":function(){e.handleAnalyticsClientReady()},"analytics-rooms-loaded":function(){e.handleAnalyticsRoomLoaded()},"analytics-roster-loaded":function(){e.handleAnalyticsRosterLoaded()},"analytics-emoticons-loaded":function(){e.handleAnalyticsEmoticonLoaded()}}),m["default"].register({"analytics-hc-client-start":function(){e.handleClientStart()},"analytics-hc-client-initial-connection":function(){e.handleInitialConnection()},"analytics-hc-client-reconnection-start":function(){e.handleReconnectionStart()},"analytics-hc-client-reconnection-success":function(){e.handleReconnectionSuccess()},"analytics-initial-presence-response-received":function(){e.handlePresenceResponse()},"analytics-start-iq-response-received":function(){e.handleStartupIqResponse()},"analytics-initial-auth-start":function(){e.handleAuthStart()},"analytics-initial-auth-done":function(){e.handleAuthDone()},"analytics-on-dom-ready":function(){e.handleDomReady()},"analytics-hc-init":function(){e.handleAppInit()},"analytics-chat-mount":function(t){e.handleChatMountEvent(t)},"analytics-open-room":function(t){e.handleOpenedRoom(t)},"analytics-request-history":function(t){e.handleHistoryRequest(t)},"analytics-history-loaded":function(t){e.handleHistoryResponse(t)},"analytics-roster-mount":function(t){e.handleRosterMount(t)},"analytics-files-mount":function(t){e.handleFilesMount(t)},"analytics-select-room":function(t){e.handleLobbyOpen(t)},"analytics-lobby-mount":function(t){e.handleLobbyMount(t)},"analytics-new-active-chat":function(t){E["default"].jid.is_chat(t.jid)&&(e.spawnCompositeEvent(h["default"].CHAT_SENDABLE,t),e.spawnCompositeEvent(h["default"].CHAT_IS_COMPLETE,t))},"performance-timing:analytics-launch-to-chat":function(t){e.handleLaunchToChat(t)},"performance-timing:analytics-launch-to-chat-complete":function(t){e.handleLaunchToChatComplete(t)}})}},{key:"registerAppStateReadyAnalytics",value:function(){var e=this;m["default"].registerOnce({"performance-timing:analytics-launch-to-active-chat-list":function(t){e.handleLaunchToActiveChatList(t)}})}},{key:"setupVariables",value:function(e,t,a){this.eventQueue=[],this.userAgent=E["default"].browser.userAgent(),this.performance=a,this.slug=this.getSlug(t),this.baseEvent=this.getBaseEvent(e.group_id,e.user_id,this.slug,e.is_admin,t.client_version_id),this.isGuest=this.getIsGuest(),this.appLaunchTime=window.hc_client_launch_time,this.browserMetricsBaseEvent=this.getBrowserMetricsBaseEvent(e.is_admin,this.slug),this.requiredClientUpToDateFetchTimes=this.getRequiredClientFetchTimesObject(this.isGuest),this.compositeEventQueue={},this.shouldSendLaunchToChat=this.shouldSendLaunchToChatComplete=!0,this.deleteWindowLaunchTime()}},{key:"bindCustomAnalyticEvents",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?d["default"].events:arguments[0];_.forOwn(t,function(t,a){_.isString(t)&&!function(){var e=t;t=function(){return{name:e}}}(),m["default"].register(a,function(){for(var a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];return e.sendEvents(t.apply(e,n))})})}},{key:"sendEvents",value:function(e){var t=this;if(e){var a=E["default"].toArray(e);_.each(a,function(e){t.addToEventQueue(t.makeEvent(e))})}}},{key:"startHerment",value:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?window["herment-gas-client"]:arguments[2],n=this.getHermentOptions(e.group_id,e.user_id,t.client_version_id);a(n).start(),x["default"].type("analytics").withFilter().alwaysExpanded().log("Herment started with options: ",n)}},{key:"setupMetrics",value:function(){var e=arguments.length<=0||void 0===arguments[0]?window["app-metrics"]:arguments[0];this.metrics=e({publish:this.customPublish.bind(this),unfold:!0})}},{key:"customPublish",value:function(e,t){var a=this.makeEvent({name:e,properties:t});this.addToEventQueue(a)}},{key:"customBrowserMetricsEvent",value:function(e){if("probes"in e&&e.probes<=0)return void x["default"].type("analytics").withFilter().alwaysExpanded().log("Probes property is invalid. Event was skipped: ",e);var t=_.assign(e,{sid:R["default"].getSID()}),a=_.assign(_.clone(this.browserMetricsBaseEvent),{properties:t}),n=this.makeEvent(a);this.addToEventQueue(n)}},{key:"handleRequiredClientUpToDateFetchTime",value:function(e){var t=this.getTimeSinceAppLaunch();if(this.requiredClientUpToDateFetchTimes[e]=t,_.every(this.requiredClientUpToDateFetchTimes)){var a={name:h["default"].CLIENT_CURRENT,properties:{time_since_launch:t,is_guest:this.isGuest}},n=this.makeEvent(a);this.addToEventQueue(n),this.handleInitialDataFetched()}}},{key:"handlePreloaderAnalytics",value:function(){var e=this;window.preloaderEvents&&window.preloaderEvents.onComplete(function(t){_.each(t,function(t){e.addToEventQueue(e.makeEvent(t))})})}},{key:"handleAnalyticsLaunched",value:function(){var e=this.makeEvent({name:h["default"].CLIENT_LAUNCH});this.addToEventQueue(e)}},{key:"handleAnalyticsRoomLoaded",value:function(){this.handleRequiredClientUpToDateFetchTime("rooms"),this.metrics.stop({key:h["default"].INITIAL_ROOMS,id:"app",size:0,props:{method:"bosh"}})}},{key:"handleAnalyticsRosterLoaded",value:function(){this.handleRequiredClientUpToDateFetchTime("roster"),this.metrics.stop({key:h["default"].INITIAL_ROSTER,id:"app",size:0,props:{method:"bosh"}})}},{key:"handleAnalyticsEmoticonLoaded",value:function(){this.handleRequiredClientUpToDateFetchTime("emoticons"),this.metrics.stop({key:h["default"].INITIAL_EMOTICONS,id:"app",size:0,props:{method:"bosh"}})}},{key:"handleAnalyticsClientReady",value:function(){var e=this.makeEvent({name:h["default"].CLIENT_READY,properties:{time_since_launch:this.getTimeSinceAppLaunch()}});this.addToEventQueue(e)}},{key:"handleInitialDataFetched",value:function(){this.metrics.stop({key:h["default"].INITIAL_FETCH,id:"app",size:0})}},{key:"handleAppInit",value:function(){var e=arguments.length<=0||void 0===arguments[0]?this.performance:arguments[0];if(e&&e.now){var t=Math.floor(e.now());this.metrics.store({key:h["default"].CLIENT_READY_FOR_USER,probes:t,size:0,props:{readyForUser:t}})}}},{key:"handleClientStart",value:function(){this.metrics.start({key:h["default"].CONNECTION_ESTABLISHED,id:"app",size:0}),this.metrics.start({key:h["default"].INITIAL_FETCH,id:"app",size:0})}},{key:"handleInitialConnection",value:function(){this.metrics.stop({key:h["default"].CONNECTION_ESTABLISHED,id:"app",size:0}),this.metrics.start({key:h["default"].INITIAL_PRESENCE,id:"app",size:0}),this.metrics.start({key:h["default"].INITIAL_IQ,id:"app",size:0}),this.metrics.start({key:h["default"].INITIAL_ROOMS,id:"app",size:0}),this.metrics.start({key:h["default"].INITIAL_ROSTER,id:"app",size:0}),this.metrics.start({key:h["default"].INITIAL_EMOTICONS,id:"app",size:0})}},{key:"handleOpenedRoom",value:function(e){this.metrics.start({key:h["default"].ROOM_RENDER,id:e.jid}),this.metrics.start({key:h["default"].ROOM_FILES_LOAD,id:e.jid}),this.metrics.start({key:h["default"].ROOM_MEMBERS_LOAD,id:e.jid})}},{key:"handleChatMountEvent",value:function(e){this.metrics.stop({key:h["default"].ROOM_RENDER,id:e.id,size:e.size})}},{key:"handleHistoryRequest",value:function(e){this.metrics.start({key:h["default"].ROOM_HISTORY_LOAD,id:e.jid})}},{key:"handleHistoryResponse",value:function(e){this.metrics.stop({key:h["default"].ROOM_HISTORY_LOAD,id:e.jid,size:e.size})}},{key:"handleRosterMount",value:function(e){this.metrics.stop({key:h["default"].ROOM_MEMBERS_LOAD,id:e.id,size:e.size})}},{key:"handleFilesMount",value:function(e){this.metrics.stop({key:h["default"].ROOM_FILES_LOAD,id:e.id,size:e.size})}},{key:"handleLobbyOpen",value:function(e){E["default"].jid.is_lobby(e.jid)&&this.metrics.start({key:h["default"].LOBBY_RENDER,id:e.jid,size:0})}},{key:"handleLobbyMount",value:function(e){this.metrics.stop({key:h["default"].LOBBY_RENDER,id:e.id,size:0})}},{key:"handleReconnectionStart",value:function(){this.metrics.start({key:h["default"].RECONNECTION,id:"app",size:0})}},{key:"handleReconnectionSuccess",value:function(){this.metrics.stop({key:h["default"].RECONNECTION,id:"app",size:0})}},{key:"handlePresenceResponse",value:function(){this.metrics.stop({key:h["default"].INITIAL_PRESENCE,id:"app",size:0,props:{method:"bosh"}})}},{key:"handleStartupIqResponse",value:function(){this.metrics.stop({key:h["default"].INITIAL_IQ,id:"app",size:0,props:{method:"bosh"}})}},{key:"handleAuthStart",value:function(){this.metrics.start({key:h["default"].AUTH,id:"app",size:0})}},{key:"handleAuthDone",value:function(){this.metrics.stop({key:h["default"].AUTH,id:"app",size:0,props:{method:"bosh"}})}},{key:"handleDomReady",value:function(){var e=E["default"].timings.getPerfTiming();this.metrics.store({key:h["default"].DOM_READY,id:"app",size:0,props:e})}},{key:"handleLaunchToActiveChatList",value:function(e){var t=this.getTimeSinceAppLaunch();this.customBrowserMetricsEvent({key:h["default"].LAUNCH_TO_ACTIVE_CHAT_LIST,size:_.get(e,"size"),probes:t,method:"bosh"})}},{key:"handleAppStateReady",value:function(){this.isGuest||this.registerAppStateReadyAnalytics()}},{key:"handleLaunchToChat",value:function(e){if(this.shouldSendLaunchToChat){var t=this.getTimeSinceAppLaunch();this.shouldSendLaunchToChat=!1,this.customBrowserMetricsEvent({key:h["default"].LAUNCH_TO_CHAT,size:_.get(e,"size"),probes:t,method:"bosh"})}}},{key:"handleLaunchToChatComplete",value:function(e){if(this.shouldSendLaunchToChatComplete){this.shouldSendLaunchToChatComplete=!1;var t=this.getTimeSinceAppLaunch(),a=E["default"].jid.is_room(e.jid),n=a?0:1,i=""+(a?"r":"p")+e.id;this.customBrowserMetricsEvent({key:h["default"].LAUNCH_TO_CHAT_COMPLETE,size:n,chat:i,probes:t,method:"bosh"})}}},{key:"makeEvent",value:function(e){return this.processRoomType(e),e.serverTime=E["default"].now(),_.merge({},this.baseEvent,e)}},{key:"addToEventQueue",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_.get(e,"properties")||(e=this.makeEvent(e)),this.eventQueue.push(e),x["default"].type("analytics").withFilter().alwaysExpanded().log("Event was added to queue:",e.name,e.properties,e)}},{key:"getTimeSinceAppLaunch",value:function(){return E["default"].now()-this.appLaunchTime}},{key:"getIsGuest",value:function(){return window.HC&&window.HC.is_guest?window.HC.is_guest:!1}},{key:"getSlug",value:function(e){return e.client_subtype?e.client_type+"_"+e.client_subtype:e.client_type}},{key:"getBaseEvent",value:function(e,t,a,n,i){return{server:"gid-"+e,product:h["default"].PRODUCT,subproduct:"hc_"+a,version:i,user:"uid-"+t,properties:{client:a,isAdmin:n,environment:"production",type:a,ver:i,os_ver:this.userAgent.os.name+" "+(this.userAgent.os.version||""),browser:this.userAgent.browser.name+" "+this.userAgent.browser.version}}}},{key:"getHermentOptions",value:function(e,t,a){return{queue:this.eventQueue,storage_key:S["default"].Cache.Keys.ANALYTICS,server:"gid-"+e,product:h["default"].PRODUCT,subproduct:"hc_"+this.slug,version:a,user:"uid-"+t,unfold:!0,publish_interval:b["default"].analytics_publish_interval,save_interval:b["default"].analytics_save_interval}}},{key:"getBrowserMetricsBaseEvent",value:function(e,t){return{name:h["default"].BROWSER_METRICS,properties:{client:t,isAdmin:e,environment:"production"}}}},{key:"getRequiredClientFetchTimesObject",value:function(e){return e?{emoticons:null}:{roster:null,rooms:null,emoticons:null}}},{key:"processRoomType",value:function(e){e&&e.properties&&e.properties.type&&!_.isString(e.properties.type)&&delete e.properties.type}},{key:"deleteWindowLaunchTime",value:function(){delete window.hc_client_launch_time}},{key:"__unstageCompositeEvent",value:function(e){var t=_.get(this.compositeEventQueue,e);t&&(_.each(t,function(e){e.dispatcher.unregister(e.name,e.func)}),delete this.compositeEventQueue[e])}},{key:"__stageCompositeEvent",value:function(e,t){_.each(t,function(e){e.dispatcher.register(e.name,e.func)}),this.compositeEventQueue[e]=t}},{key:"spawnCompositeEvent",value:function(e,t){var a,n=this,i=(a={},(0,o["default"])(a,h["default"].CHAT_SENDABLE,function(){var e=(new Date).getTime(),a=function(a){t.jid===a.jid&&(n.customBrowserMetricsEvent({key:h["default"].CHAT_SENDABLE,size:E["default"].jid.is_room(a.jid)?0:1,probes:E["default"].now()-e,method:"bosh"}),n.__unstageCompositeEvent(h["default"].CHAT_SENDABLE))};return[{dispatcher:m["default"],name:"analytics-active-chat-changed",func:a}]}),(0,o["default"])(a,h["default"].CHAT_IS_COMPLETE,function(){var e=(new Date).getTime(),a=function(a){if(t.jid===a.jid){var i=E["default"].jid.is_room(a.jid),o=i?0:1,s=""+(i?"r":"p")+a.id;n.customBrowserMetricsEvent({key:h["default"].CHAT_IS_COMPLETE,size:o,chat:s,probes:E["default"].now()-e,method:"bosh"}),n.__unstageCompositeEvent(h["default"].CHAT_IS_COMPLETE)}};return[{dispatcher:m["default"],name:"analytics-history-loaded",func:a}]}),a),s=i[e];s&&(this.__unstageCompositeEvent(e),this.__stageCompositeEvent(e,s()))}},{key:"__reset",value:function(){this.eventQueue=[],this.compositeEventQueue={},this.isGuest=!1,this.appLaunchTime=null,this.slug=null,this.browserMetricsBaseEvent={},this.requiredClientUpToDateFetchTimes=null,this.requiredClientUpToDateFetchTimes={}}}]),e}();t["default"]=A,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){L&&e.push({name:"hipchat.client.message.input.abandoned"})}function o(e){var t=e.isClosed,a=e.jid,n=e.type,o=I["default"].jid.is_lobby(a),s={name:o?"hipchat.client.lobby.viewed":"hipchat.client.chat.viewed"},r={};if(t&&(r.isClosed=!0),!o&&(r.type=n,I["default"].jid.is_room(a))){var l=D["default"].get("allRooms")[a];if(l){var u=D["default"].get("roster"),c=_.get(l,"participants.members",[]).concat(_.get(l,"participants.guests",[]));r.room=l.id,r.room_name=l.name,r["private"]=I["default"].jid.is_private_room(l.privacy)?"yes":"no",r.here_size=_.values(_.pick(u,c)).filter(function(e){return _.get(e,"presence.show")===j["default"].AVAILABLE}).length,r.all_size=c.length}}_.isEmpty(r)||(s.properties=r);var d=[s];return i(d),d}function s(e){var t={isNew:!0,type:e.type,source:e.source},a=I["default"].jid.is_room(e.jid)?"room":"oto",n=t.source||"lobby",i="switcher"===n?"hipchat.client.switcher.open."+a:"hipchat.client.lobby.open."+a;return"lobby"!==n&&"switcher"!==n||(t.filter_text_length=e.query?e.query.length:0),{name:i,properties:t}}function r(e){L=!_.isEmpty(e)}function l(e){return e=e.trim(),F.test(e)||U.test(e)}function u(e){return e=e.trim(),H.test(e)}function c(e){var t=[];if(L){var a=S["default"].getEmoticonsInfo(e.text);a.forEach(function(a){t.push({name:"hipchat.client.emoticon.used",properties:{room:"groupchat"===e.chat_type?e.active_chat_id:null,emoticonUsed:a.shortcut,emoticonType:a.type}})}),l(e.text)?t.push({name:"hipchat.client.message.group.mentioned"}):u(e.text)&&t.push({name:"hipchat.client.message.user.mentioned"}),B.test(e.text)&&t.push({name:"hipchat.client.message.url.sent"});var n=z.exec(e.text);n&&t.push({name:"hipchat.client.slash.command.used",properties:{command:n[1]}}),M["default"].slash_replacement_regex.test(e.text)&&t.push({name:"hipchat.client.slash.command.used",properties:{command:"replacement"}}),L=!1}return t}function d(e){return[{name:"hipchat.client.room.created"},{name:"hipchat.client.room."+e.privacy+".created"}]}function f(e){var t;switch(e.show){case"xa":t="away";break;case"dnd":t="donotdisturb";break;case"chat":t="available"}return t?{name:"hipchat.client.top.navigation.profile.status.clicked."+t}:void 0}function h(e){return{name:"hipchat.client.top.navigation.profile.status.statusmessage",properties:{custom:""!==e.status}}}function p(e){return e}function m(e){var t;if(e&&e.scope){switch(e.scope){case"all":t="search";break;default:t=e.scope}return{name:"hipchat.client.lobby.filter."+t}}}function g(e){var t="unknown-addon";return e&&e.addon_key&&(t=e.addon_key),{addonKey:t}}function v(e){return{name:"hipchat.client.connect.dialog.close",properties:g(e)}}function y(e){return{name:"hipchat.client.connect.dialog.link.click",properties:g(e)}}function b(e){return{name:e.name,properties:e.data}}function w(e){return{name:"hipchat.client.settings.general.hidegifs",properties:e}}function R(e){return{name:e.name,properties:e.props}}function k(e){return{name:"hipchat.client.keyboard.shortcut.used",properties:e}}function E(){return{name:"hipchat.client.secure.file.download"}}Object.defineProperty(t,"__esModule",{value:!0});var C=a(110),S=n(C),T=a(106),x=n(T),A=a(99),I=n(A),N=a(121),M=n(N),O=a(190),D=n(O),P=a(184),j=n(P),L=!1,F=/(?=[^\\w>]|^)@all(?=[^\\w<]|$)/gi,U=/(?=[^\\w>]|^)@here(?=[^\\w<]|$)/gi,H=/(?=[^\\w]|^)@[a-z0-9\-]+(?=[^\\w]|$)/gi,B=new RegExp(x["default"].url,"gi"),z=/\/(join|part|topic|available|away|dnd|code|quote|pre|monospace|clear|me)\s/;t["default"]={events:{"analytics-select-room":o,"analytics-open-room":s,"analytics-set-message-value":r,"analytics-send-message":c,"analytics-create-room":d,"analytics-event":p,"analytics-update-presence":f,"analytics-update-status-message":h,"analytics-filter-lobby":m,"analytics-connect-dialog-click":y,"analytics-connect-dialog-close":v,"analytics-connect-event":b,"analytics-hide-gifs":w,"analytics-room-notification-setting":R,"analytics-keyboard-shortcut-used":k,"analytics-secure-file-download":E},__reset:function(){L=!1}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(117),o=n(i),s=a(127),r=n(s),l=a(191),u=n(l),c=a(114),d=n(c),f=a(10),h=n(f),p=a(4),m=n(p),g=a(5),v=n(g),y=a(22),b=n(y),w=a(51),R=n(w),k=a(99),E=n(k),C=a(97),S=n(C),T=a(192),x=n(T),A=a(199),I=n(A),N=a(202),M=n(N),O=a(9),D=n(O),P=a(173),j=n(P),L=a(161),F=n(L),U=a(164),H=n(U),B=a(185),z=n(B),q=a(203),V=n(q),G=a(184),W=n(G),Y=a(121),K=n(Y),X=a(195),J=n(X),Q=a(180),Z=n(Q),ee=a(90),te=n(ee),ae=a(169),ne=n(ae),ie=a(204),oe=n(ie),se=function(e){function t(){(0,m["default"])(this,t);var e=(0,b["default"])(this,(0,h["default"])(t).call(this));return e.local={initialized:!1,user_state:"active",active_type:"",profile_jids:[],sent_msg_ids:[],participants:[],closedChats:[],deletedRooms:[],history_fetch_id:0,chat_states:["active","inactive","composing","gone"],emoticons_initialized:!1,windowFocused:!0,clearUnreadCounts:!1,shouldReconcileAutoJoin:!1,lastSavedAutoJoin:[],presence_updates_timers:{}},e.presenceProcessor=new M["default"]({is_guest:_.get(window.HC,"is_guest",!1)}),e.iqProcessor=new I["default"]({is_guest:_.get(window.HC,"is_guest",!1)}),e.server_data_callbacks={message:e.handleIncomingMessages,iq:e.handleIQ,presence:e.handlePresence,success:e.handleConnectionSuccess},e.messageProcessor=new x["default"](e),e.debouncedSetActiveRooms=_.debounce(e.setActiveRooms,K["default"].set_active_rooms_timeout,{leading:!0,trailing:!0}),e.debouncedFetchRoomParticipantsFromAPI=_.debounce(e.fetchRoomParticipantsFromAPI,K["default"].fetch_room_participants_timeout,{leading:!1,trailing:!0}),e.refetchReadStateHandler=e.refetchReadState.bind(e),e.registerCallbacks(),e.addChangeHandlers(),e}return(0,R["default"])(t,e),(0,v["default"])(t,[{key:"getRoomDefaults",value:function(){return{topic:null,admins:[],participants:{members:[],guests:[]},files:[],links:[],is_archived:"0",history_fetch_ids:[],show_join_leave_messages:!1,guest_mention_regex:null,most_recent_message:null,last_read_message:null,avatar_url:"",roster_size:0,participants_fully_initialized:!1,presence:{show:"",status:"",seconds:"",idleTime:""},unreadCount:0,unreadCountTemp:0,unreadMentionCount:0,unreadMentionJustMeCount:0,isUpdatingUnreadCount:!1,hasMention:!1,files_fetched:!1,links_fetched:!1}}},{key:"getRosterDefaults",value:function(){return{presence:{show:"unknown",status:"",seconds:"",idleTime:""},closed_at:E["default"].getMoment()}}},{key:"getDefaults",value:function(){return{config:{},active_chat:"",asset_base_uri:"",client_type:"",client_subtype:"",client_version_id:"",video_chat_uri:"",current_user:{},activeRooms:{},allRooms:{},newMessages:{},roster:{},profiles:{},smileys:{},emoticons:{path_prefix:"",icons:{}},mentionRegexUser:null,mentionRegexMe:null,mentionRegexJustMe:null,group_name:"",group_id:null,conference_server:null,chat_server:null,api_host:"api.hipchat.com",web_server:null,features:{},permissions:{},release_dialog_content:{},ui_available:!1,is_in_welcome_range:!1}}},{key:"registerCallbacks",value:function(){var e=this;D["default"].registerOnce({"hc-init":function(t){e.handleHCInit(t)},"app-state-ready":function(){e.fetchReadState()},"after:app-state-ready":function(){e.set("ui_available",!0)},signout:function(){var t={is_guest:_.get(e.data.current_user,"is_guest",!1),guest_key:_.get(e.data.current_user,"guest_key",!1),type:"",jid:e.data.active_chat,preferences:F["default"].getAll()};D["default"].dispatch("exit-app",t)}}),D["default"].register({"configuration-change":function(t){e.handleConfigChange(t)},"feature-flags-update":function(t){e.updateFeatureFlags(t),$(document).trigger("app-feature-flags",t)},"auth-token-update":function(t){e.updateConfig(t)},"update-sid":function(t){e.updateConfig(t),te["default"].info("SID was updated: ",t.sid),te["default"].type("sid").info("SID was updated: ",t.sid)},"server-data":function(t){e.handleServerData(t)},"app-state-ready":function(){e.handleAppStateReady()},"open-room":function(t){e.handleOpenRoom(t)},"join-room":function(t){e.handleJoinRoom(t)},"close-room":function(t){e.handleCloseRoom(t.jid)},"delete-room":function(t){e.local.deletedRooms.push(t.jid)},"send-message":function(t){e.handleSendMessage(t)},"fetch-attachment-image":function(t){t=_.groupBy(t,"room"),e.set({newMessages:t}),e._handleNewMessageUpdate(t)},"update-presence":function(t){e.updatePresence(t),"away"===t.show&&D["default"].registerOnce("update-presence",e.refetchReadStateHandler)},"DAL:handle-joined-rooms":function(t){e.handleJoinedRooms(t)},"hide-join-messages":function(){_.forOwn(e.data.activeRooms,function(e){e.show_join_leave_messages=!1})},"guest-access-changed":function(t){var a=e.data.allRooms[t.jid];a&&_.assign(a,{guest_url:t.url}),e.handleRoomUpdate(a)},"new-active-chat":function(t){e._updateReadStateForActiveChat(),e._clearUnreadCountForChat(e.data.active_chat),e.local.active_type=/@chat/.test(t.jid)?"chat":"groupchat",e.set("active_chat",t.jid),e.setActiveGuestUserRegex(),e._updateReadStateForActiveChat(),e._clearUnreadCountForChat(t.jid),E["default"].jid.is_room(t.jid)&&_.get(e.data.activeRooms,[t.jid,"roster_size"],!1)&&e.initializeRoomParticipants(t.jid)},"request-ancient-history":function(t,a){e.local.history_fetch_id++,t.id="history:"+e.local.history_fetch_id,e.data.activeRooms[t.jid]&&e.data.activeRooms[t.jid].history_fetch_ids.push(t.id),D["default"].dispatch("fetch-previous",t,a)},"remove-room-participant":function(t){e.removeRoomParticipant(t)},"add-room-visitor":function(t){e.addVisitor(t)},"add-room-participant":function(t){e.addRoomParticipant(t)},"room-presence-received":function(t){e.handleRoomPresence(t)},"user-removed":function(t){e.handleUserRemoved(t)},"handle-cached-room":function(t){e.handleRooms(t)},"DAL:handle-new-room":function(t){e.handleRooms(t)},"DAL:handle-created-room":function(t){e.handleNewRoom(t)},"DAL:handle-fetched-links":function(t){e.handleLinkQueryResponse(t)},"DAL:handle-fetched-files":function(t){e.handleFileQueryResponse(t)},"add-link-from-message":function(t){e.addLinkFromMessageToRoom(t.room,t.link)},"add-file-from-message":function(t){e.addFileFromMessageToRoom(t.room,t.file)},"global-presence-received":function(t){e.handleGlobalPresence(t)},"groupchat-invite-received":function(t){e.handleInviteMessage(t)},"groupchat-invite-accepted":function(t){e.handleRoomInviteAccepted(t.jid)},"private-chat-invite-received":function(t){e.handlePrivateChatInvite(t)},"enso.invite-to-audio-video-call":function(t){e.handlePrivateChatInvite(t.message)},"set-user-state":function(t){e.local.user_state!==t.state?(e.local.user_state=t.state,D["default"].dispatch("send-user-state-message",t)):"composing"===t.state&&D["default"].dispatch("send-user-state-message",t)},"status-message-received":function(t){e.handleChatStateMessage(t)},"mark-chats-as-read":function(){var t=_.values(e.data.activeRooms);e.resetReadStateCounts(t)},"mark-rooms-as-read":function(){var t=_.filter(e.data.activeRooms,function(e){return E["default"].jid.is_room(e.jid)});e.resetReadStateCounts(t)},"mark-people-as-read":function(){var t=_.filter(e.data.activeRooms,function(e){return E["default"].jid.is_private_chat(e.jid)});e.resetReadStateCounts(t)},"archive-room":function(t,a){e.handleArchiveRoom(t,!0,a)},"unarchive-room":function(t,a){e.handleArchiveRoom(t,!1,a)},"room-archived":function(t){e.handleArchivedRoom(t,"1")},"room-unarchived":function(t){e.handleArchivedRoom(t,"0")},"DAL:handle-topic-updated":function(t){e.handleTopicUpdated(t.topic,t.jid)},"enable-dark-feature":function(t){e.handleEnableDarkFeature(t)},"open-chat-by-mention-name":function(t){e.openChatByMentionName(t)},"missed-call":function(t){e.handleMissedCall(t)},"call-declined":function(t){e.handleCallDeclined(t)},"application-focused":function(){e.local.windowFocused=!0,e._updateReadStateForActiveChat(),e._clearUnreadCountForChat(e.data.active_chat)},"application-blurred":function(){e.local.windowFocused=!1},"strophe-disconnecting":function(){D["default"].unregister("update-presence",e.refetchReadStateHandler)},"strophe-reconnecting":function(){e.local.shouldReconcileAutoJoin=!0,e.resetRoomParticipantsListInitializedFlag()},"before:app-state-reconnected":function(){e.resetFilesAndLinksFetching()},"app-state-reconnected":function(){e.refetchReadState()},"fetch-files":function(t){var a=t.room;_.get(e.data.activeRooms,a)&&(e.data.activeRooms[a].files_fetching=!0,e.set("activeRooms",e.data.activeRooms))},"fetch-links":function(t){var a=t.room;_.get(e.data.activeRooms,a)&&(e.data.activeRooms[a].links_fetching=!0,e.set("activeRooms",e.data.activeRooms))},"preferences-saved":function(t){t.autoJoin&&(e.local.lastSavedAutoJoin=t.autoJoin)},"updated:preferences":function(t){var a=_.get(e.data,"config",{}),n=_.get(a,"preferences",{});a.preferences=_.merge(n,t),e.data.config=a,e._updateTotalUnreadCount()},"set-room-participants-fully-initialized":function(t){var a=_.get(e.data.activeRooms,t);a&&e.setRoomParticipantsFullyInitialized(a)},"API:fetched-recent-history":function(t){e.handleIncomingMessages(t,e)},"DAL:guest-fetched-room-participants":function(t){e.handleGuestRoomParticipants(t.items)},"DAL:fetched-room-participants":function(t){e.handleRoomParticipantsFromAPI(t)},"DAL:readstate-fetched":function(t,a){e.handleReadState(t,a)}})}},{key:"updateConfig",value:function(e){var t=_.merge(this.data.config,e);this.set({config:t})}},{key:"handleAppStateReady",value:function(){for(j["default"].dispatch("analytics-client-ready",{name:"hipchat.client.ready"});this.local.profile_jids.length;){var e=this.local.profile_jids.shift();D["default"].dispatch("request-profile",e)}var t=_.size(this.data.activeRooms),a=1===_.size(this.data.roster);this._isFirstLogin()&&!this.data.current_user.is_guest&&(D["default"].dispatch("set-first-login-date"),this._showWelcomeDialog(),0===t&&a&&this.onBoardNewUser(t)),this.verifyOTOChats()}},{key:"_showWelcomeDialog",value:function(){var e=_.get(this.data.config,"feature_flags.web_client_is_welcome_dialog_enabled",!1);e&&this.data.is_in_welcome_range&&D["default"].dispatch("show-modal-dialog",{dialog_type:"welcome-dialog",dialog_data:{}})}},{key:"_isFirstLogin",value:function(){var e=arguments.length<=0||void 0===arguments[0]?F["default"].getAll():arguments[0],t=_.get(e,"properties.firstLoginDate");return t=parseInt(t,10),_.isNaN(t)}},{key:"_handleWelcomeRange",value:function(e){var t=K["default"].welcome_dialog.max_size_of_group_to_display,a=1===e,n=t>=e;a||!n||this.data.is_in_welcome_range?!a&&n||!this.data.is_in_welcome_range||this.set({is_in_welcome_range:!1}):this.set({is_in_welcome_range:!0})}},{key:"verifyOTOChats",value:function(){var e=this;_.size(this.data.activeRooms)>0&&_.forOwn(this.data.activeRooms,function(t,a){E["default"].jid.is_private_chat(a)&&(e.data.roster[a]||D["default"].dispatch("close-room",{jid:a}))})}},{key:"handleConfigChange",value:function(e){var t=_.mergeWith(this.data.config,e,function(e,t,a){return a===H["default"].AUTO_JOIN?t:void 0});this.set({config:t}),this.handleHCInit(t,!0)}},{key:"resetFilesAndLinksFetching",value:function(){for(var e in this.data.activeRooms)this.data.activeRooms[e]&&(this.data.activeRooms[e].files_fetching=!1,this.data.activeRooms[e].links_fetching=!1);var t=!0,a=!1,n=void 0;try{for(var i,o=(0,d["default"])(this.local.closedChats);!(t=(i=o.next()).done);t=!0){var s=i.value;this.data.allRooms[s]&&(this.data.allRooms[s].files_fetching=!1,this.data.allRooms[s].links_fetching=!1)}}catch(r){a=!0,n=r}finally{try{!t&&o["return"]&&o["return"]()}finally{if(a)throw n}}}},{key:"fetchReadState",value:function(){te["default"].log("[ReadState] Fetching readstate data."),D["default"].dispatch("DAL:fetch-readstate")}},{key:"refetchReadState",value:function(){this.local.clearUnreadCounts&&this._clearPendingReadstateData(),this.fetchReadState()}},{key:"handleReadState",value:function(e,t){var a=this,n=this.data.activeRooms;return e||!Array.isArray(t)?(te["default"].warn("[ReadState] Error fetching readstate. Reason:",e,t),void this._resetPendingReadstateData()):(te["default"].log("[ReadState] Received readstate data for "+t.length+" rooms:",_.map(t,"xmppJid")),_.forEach(t,function(e){var t=e.xmppJid;if(!_.isEmpty(n)&&!n[t])return te["default"].debug("[ReadState] Removing inactive room:",t),void a._removeReadState(t);var i=_.pick(a.getRoomDefaults(),"unreadCount","unreadMentionCount","unreadMentionJustMeCount","unreadCountTemp","hasMention"),o=_.pick(n[t],"unreadCount","unreadMentionCount","unreadMentionJustMeCount","unreadCountTemp","hasMention"),s={isUpdatingUnreadCount:!1,last_read_message:{mid:e.mid,timestamp:Number(e.timestamp)}};if(_.assign(s,i,o),"unreadCount"in e){var r=e.unreadCount.count||0,l=e.unreadCount.mentions||0,u=e.unreadCount.includesMention;s.unreadCount=r+s.unreadCountTemp,s.unreadCountTemp=s.unreadCount,s.unreadCount&&E["default"].jid.is_room(t)&&(s.hasMention=u||s.hasMention,s.hasMention&&(s.unreadMentionCount=l,s.unreadMentionJustMeCount=1)),a.local.clearUnreadCounts=!0}_.assign(n[t],s)}),this._resetPendingReadstateData(),this.handleChatsAbsentFromReadState(t.map(function(e){return e.xmppJid})),this.set("activeRooms",n),void D["default"].dispatch("readstate-received"))}},{key:"_clearPendingReadstateData",value:function(){_.forEach(this.data.activeRooms,function(e){e.unreadCountTemp=0,e.isUpdatingUnreadCount=!0}),this.set("activeRooms",this.data.activeRooms)}},{key:"_resetPendingReadstateData",value:function(){_.forEach(this.data.activeRooms,function(e){e.unreadCountTemp=e.unreadCount,e.isUpdatingUnreadCount=!1}),this.set("activeRooms",this.data.activeRooms)}},{key:"handleChatsAbsentFromReadState",value:function(e){for(var t in this.data.activeRooms){var a=this.data.activeRooms[t];a&&E["default"].jid.is_chat(t)&&-1===e.indexOf(t)&&(te["default"].debug("[ReadState] Adding active room:",t),this.getLastMessageForChat(a))}}},{key:"getLastMessageForChat",value:function(e){var t=e.jid,a=E["default"].jid.is_private_chat(t)?"user":"room",n=E["default"].jid.is_private_chat(t)?E["default"].jid.user_id(t):e.id,i={jid:t,path:{type:a,identifier:n}};n?D["default"].dispatch("API:fetch-last-message",i,this.addChatToReadState.bind(this)):this._updateReadState({
jid:i.jid})}},{key:"getLastClosedChat",value:function(){var e=this;return this.local.closedChats=_.filter(this.local.closedChats,function(t){return E["default"].jid.is_room(t)?t in e.data.allRooms:t in e.data.roster}),this.local.closedChats.shift()}},{key:"addChatToReadState",value:function(e){var t=_.get(e,"items[0]",{}),a=E["default"].getTimestampFromIsoDate(t.date),n=this.data.activeRooms[e.jid];n.most_recent_message={mid:t.id,timestamp:a},n.last_read_message=(0,u["default"])({},n.most_recent_message),this.set("activeRooms",this.data.activeRooms),this._updateReadState({jid:e.jid,mid:t.id,timestamp:a})}},{key:"resetReadStateCounts",value:function(e){var t=this;te["default"].log("[ReadState] Marking chats as read",e.map(function(e){return e.jid})),_.forEach(e,function(e){e.unreadCount&&(t._clearUnreadCountForChat(e.jid),t.getLastMessageForChat(e))})}},{key:"getGroupInstanceRoomInfo",value:function(){var e=this.data.conference_server,t=this.data.group_name,a=this.data.group_id,n=E["default"].jid.build_group_jid(t,a,e);return{jid:n,room:this.data.allRooms[n]}}},{key:"onBoardNewUser",value:function(e){var t=this.getGroupInstanceRoomInfo(),a=t.room;a&&"public"===a.privacy?0===e&&D["default"].dispatch("set-route",{jid:t.jid}):D["default"].dispatch("set-route",{jid:"lobby"})}},{key:"addChangeHandlers",value:function(){var e=this;_.map(this.data,function(t,a){e.on("change:"+a,function(e){D["default"].dispatch("updated:"+a,e)})})}},{key:"handleOpenRoom",value:function(e){var t=E["default"].jid.bare_jid(e.jid||e.from);if(E["default"].jid.is_private_chat(t))return void this.joinPrivateChat(t,E["default"].jid.user_id(t));var a=E["default"].fetch(this.data.allRooms[t],{}),n=_.get(e,"dontSelectRoom",!1);a=_.assign({},this.getRoomDefaults(),a,{presence:_.cloneDeep(this.getRoomDefaults().presence),type:"groupchat",jid:t}),this.data.activeRooms[t]=a,(n||a.jid!==this.data.active_chat)&&this.getLastMessageForChat(a),this.set({activeRooms:this.data.activeRooms,active_chat:n?this.data.active_chat:t}),this._clearUnreadCountForChat(t)}},{key:"handleJoinRoom",value:function(e){var t=this,a=e.room,n=!a.indexOf("@");if(a&&"@"!==a){var i=void 0;n&&!function(){var e=a.substr(1);i=_.filter(t.data.roster,function(t){return t.mention_name&&t.mention_name===e})}(),_.isEmpty(i)&&!function(){var e=a.toLowerCase();i=_.filter(t.data.allRooms,function(t){return t.name&&t.name.toLowerCase()===e}),i.length>1&&(i=_.filter(i,function(e){return e.name&&e.name===a}))}();var o=_.head(i);o?o.jid!==this.data.active_chat&&D["default"].dispatch("set-route",{jid:o.jid}):D["default"].dispatch("show-flag",{type:"warning",close:"auto",body:(n?"User":"Room")+' "'+a+'" not found.'})}}},{key:"initializeRoomParticipants",value:function(e){var t=this.data.activeRooms[e],a=E["default"].jid.is_private_room(t.privacy);t.participants_fully_initialized||(!t.roster_size||t.roster_size<=K["default"].initial_room_participants_limit?this.setRoomParticipantsFullyInitialized(t):this.data.active_chat===e&&this.debouncedFetchRoomParticipantsFromAPI(t,a))}},{key:"handleJoinedRooms",value:function(e){var t=this;E["default"].toArray(e).forEach(function(e){var a=t.data.activeRooms[e.jid];a&&(a.show_join_leave_messages=!0,a.roster_size=e.roster_size||0,a.topic=e.topic,t.initializeRoomParticipants(e.jid))})}},{key:"handleOfflineChatsChanges",value:function(e,t,a,n){var i=_.xor(a,e),o=_.partition(i,function(e){return _.includes(a,e)}),s=(0,r["default"])(o,2),l=s[0],u=s[1],c=_.xor(a,t),d=_.partition(c,function(e){return _.includes(a,e)}),f=(0,r["default"])(d,2),h=f[0],p=f[1],m=_.union(u,p),g=_.union(l,h);te["default"].type("application-store:handle-offline-chats-changes").log({opened:m,closed:g}),ne["default"].isGuest()||this._closeRooms(g),this._openRooms(m,n)}},{key:"_closeRooms",value:function(e){_.each(e,function(e){D["default"].dispatch("close-room",{jid:e,type:E["default"].room.detect_chat_type(e)})})}},{key:"_openRooms",value:function(e,t){_.each(e,function(e){D["default"].dispatch("open-room",{jid:e,dontSelectRoom:!0}),J["default"].restoreRoomOrder(e),e===t&&J["default"].navigateToChat(e),E["default"].jid.is_private_chat(e)&&D["default"].dispatch("request-profile",e)})}},{key:"handleHCInit",value:function(e){var t,a=this,n=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],i=E["default"].toArray(_.uniq(_.cloneDeep(F["default"].getAutoJoinRooms()))),o={},s={},r=_.get(e,["preferences","autoJoin"],!1),l=r&&r.length<2&&this._isFirstLogin(e.preferences),u=l?_.get(e,"preferences.chatToFocus"):F["default"].getChatToFocus(),c=_.map(i,"jid"),d=_.keys(this.data.activeRooms),f=c.concat(d),h=this.data.active_chat;te["default"].type("application-store:handle-hc-init").log("isFirstLogin:",l),te["default"].type("application-store:handle-hc-init").log("chatToFocus:",u),l&&!e.is_guest||(this.local.shouldReconcileAutoJoin?!function(){a.local.shouldReconcileAutoJoin=!1,te["default"].type("application-store:handle-hc-init").log("autoJoin reconciling started.");var e=_.map(a.local.lastSavedAutoJoin,"jid");"nonce"!==a.data.config.auth_method?D["default"].registerOnce("after:configuration-change",function(){a.handleOfflineChatsChanges(c,d,e,h)}):D["default"].registerOnce("strophe-reconnected",function(){a.handleOfflineChatsChanges(c,d,e,h)})}():te["default"].type("application-store:handle-hc-init").log("autoJoin reconciling skipped."),_.forEach(i,function(n){n.type=E["default"].jid.is_room(n.jid)?"groupchat":"chat","chat"===n.type&&(n.participants_fully_initialized=!0,t=E["default"].jid.user_id(n.jid),n.id=t,_.includes(a.local.participants,t)||a.local.participants.push(t),_.includes(a.local.profile_jids,n.jid)||a.local.profile_jids.push(n.jid)),e.is_guest&&(n.participants_fully_initialized=!0);var i=_.get(a.data,"activeRooms['"+n.jid+"']",{}),s=_.get(a.data,"allRooms['"+n.jid+"']",{});n.name||(n.name=i.name||s.name,te["default"].warn("Room name isn't defined in the autoJoin list. Room jid: "+n.jid)),o[n.jid]=_.merge(a.getRoomDefaults(),_.omit(i,["name"]),n)}));var p=_.pick(e,["user_jid","jid","user_id","user_name","mention","title","photo_large","photo_small","email","is_admin","is_guest","guest_key","presence","user_created_utc"]);p.user_jid=p.user_jid||p.jid,p.is_guest=!!p.is_guest,void 0!==F["default"].getAutoJoinRooms()&&(p.is_guest?(this.data.active_chat=e.room_jid,this.local.active_type="groupchat"):l||!u||f.length&&-1===f.indexOf(u)?this.data.active_chat="lobby":(this.data.active_chat=u,this.local.active_type=/@chat/.test(u)?"chat":"groupchat")),E["default"].jid.is_private_chat(this.data.active_chat)&&D["default"].dispatch("request-profile",this.data.active_chat),E["default"].jid.is_chat(this.data.active_chat)&&_.isEmpty(o)&&(o[this.data.active_chat]=_.merge(this.getRoomDefaults(),{jid:this.data.active_chat,type:E["default"].jid.is_room(this.data.active_chat)?"groupchat":"chat"},this.data.allRooms[this.data.active_chat]),F["default"].setAutoJoinRooms([{jid:o[this.data.active_chat].jid,name:o[this.data.active_chat].name}])),this.set("ignoreAddIntegrationsGlance",_.get(e,"preferences.ignoreAddIntegrationsGlance")),n||(s[p.user_jid]=_.assign(this.getRosterDefaults(),{presence:{show:"chat",status:""}}),p.is_guest&&(s[e.user_jid].mention_name=p.mention),o[p.user_jid]&&(o[p.user_jid].presence=p.presence={show:"chat",status:""}));var m=_.reduce(K["default"].core_mentions,function(e,t){return t.isUser||(e=[].concat(e,t.mention_name)),e},[]),g=m?"|"+m.join("|")+"|":"";this.data.mentionRegexMe=new RegExp("(?=[^\\w]|^)@("+E["default"].escapeRegEx(e.mention)+g+'"'+E["default"].escapeRegEx(e.user_name)+'")(?=[^\\w]|$)',"ig"),this.data.mentionRegexJustMe=new RegExp("(?=[^\\w]|^)@("+E["default"].escapeRegEx(e.mention)+'|"'+E["default"].escapeRegEx(e.user_name)+'")(?=[^\\w]|$)',"ig"),this.data.activeRooms=o,_.merge(this.data,{current_user:p,roster:s,smileys:E["default"].emoticons.addSmileys(e.emoticons||[])});var v=e.features||this.data.features;this.setActiveGuestUserRegex();var y={current_user:this.data.current_user,activeRooms:this.data.activeRooms,roster:this.data.roster,smileys:this.data.smileys,chat_server:e.chat_server,conference_server:e.conference_server,api_host:e.api_host,web_server:e.web_server,group_name:e.group_name,group_id:e.group_id,features:v,permissions:e.perms||{}};this.data.active_chat&&(this.data.activeRooms[this.data.active_chat]||(this.data.active_chat="lobby"),y.active_chat=this.data.active_chat),this.set(y),this.local.initialized||(this.local.lastSavedAutoJoin=i),this.local.initialized=!0,this.updatePresenceProcessor()}},{key:"handleStartupIQAutoJoin",value:function(e){var t=this;e.forEach(function(e){if(E["default"].jid.is_room(e.jid)){var a=E["default"].jid.user_id(_.get(e,"x.owner",null)),n=_.merge(t.getRoomDefaults(),t.data.allRooms[e.jid],t.data.activeRooms[e.jid],e.x,{jid:e.jid,type:"groupchat",owner:a});_.includes(n.admins,a)||n.admins.push(a),t.data.allRooms[e.jid]=_.cloneDeep(n),t.data.activeRooms[e.jid]=_.cloneDeep(n)}})}},{key:"handleServerData",value:function(e){var t=this;_.map(this.server_data_callbacks,function(a,n){var i=e[n];i&&a(i,t,e.cached)})}},{key:"unsubscribeFromStanzas",value:function(e){var t=this;E["default"].toArray(e).forEach(function(e){t.server_data_callbacks[e]=function(e){_.noop(e)}})}},{key:"handleIQ",value:function(e,t,a){t.iqProcessor.handleIQ.apply(t.iqProcessor,arguments)}},{key:"handleInviteMessage",value:function(e){var t=E["default"].jid.bare_jid(e.from),a=_.get(e,"x[0].invite",{}),n=a.reason||"",i=a.from||"",o=E["default"].jid.bare_jid(i),s=_.omit(_.get(e,"x[1]"),"xmlns"),r=s.name||"";this.data.allRooms[t]||(this.data.allRooms[t]=_.assign(this.getRoomDefaults(),{jid:t},s));var l=_.get(this.data,'roster["'+o+'"].name',"");E["default"].jid.is_room(i)&&(l=E["default"].jid.resource(i)),D["default"].dispatch("open-room",{jid:t,dontSelectRoom:!0}),D["default"].dispatch("show-modal-dialog",{dialog_type:"room-invite-dialog",dialog_data:{bgDismiss:!1,room_name:r,room_jid:t,from_user:l,should_queue:!0,reason:n}}),j["default"].dispatch("analytics-event",{name:"hipchat.client.invite.room",properties:{isFromDory:"HipChat"===l}})}},{key:"handleRoomInviteAccepted",value:function(e){this.data.allRooms[e]&&(this.handleNewRoom(this.data.allRooms[e]),D["default"].dispatch("set-route",{jid:e}))}},{key:"handlePrivateChatInvite",value:function(e){var t,a;t=e.from===this.data.current_user.user_jid?E["default"].jid.bare_jid(e.to):E["default"].jid.bare_jid(e.from),a=E["default"].jid.user_id(t),this.joinPrivateChat(t,a)}},{key:"handlePresence",value:function(e,t){t.presenceProcessor.handlePresence(e)}},{key:"handleMissedCall",value:function(e){this.handleIncomingMessages(e,this)}},{key:"handleCallDeclined",value:function(e){this.handleIncomingMessages(e,this)}},{key:"handleIncomingMessages",value:function(e,t){t.set({rawMessages:e});var a=t.messageProcessor.processMessages(e);a=_.groupBy(a,"room"),t.set({newMessages:a}),t._handleNewMessageUpdate(a)}},{key:"handleSendMessage",value:function(e){var t=E["default"].jid.is_chat(e.jid)?this.data.activeRooms[e.jid]:null,a=Date.now()/1e3;if(t){_.get(t,"most_recent_message.timestamp",0)>a?e.time=t.most_recent_message.timestamp+1:e.time=a;var n=this.messageProcessor.processSentMessage(e);this.local.user_state="active",this.local.sent_msg_ids.push(e.id.toString()),this.set({newMessages:_.groupBy(n,"room")})}}},{key:"_handleNewMessageUpdate",value:function(e){var t=this,a=E["default"].jid.is_chat(this.data.active_chat)?this.data.activeRooms[this.data.active_chat]:null,n=!1;_.forEach(e,function(e,a){_.forEach(t.data.activeRooms,function(i){i.jid===a&&_.forEach(e,function(e){if(t._updateMostRecentMessage(i,e),e.is_echo)t._updateReadStateForChat(i);else if(t._msgIsTopicChange(e))return;if(n=!0,!t._msgShouldNotUpdateBadge(e)&&i&&!e.is_history_message&&"user_state"!==e.type){if(++i.unreadCount,++i.unreadCountTemp,E["default"].isFormattedMessage(e))return;if(t._shouldUpdateMentionFromCard(t.data.mentionRegexMe,e)||e.body&&-1!==e.body.search(t.data.mentionRegexMe)||E["default"].jid.is_private_chat(i.jid))return i.hasMention=!0,++i.unreadMentionCount,void((t._shouldUpdateMentionFromCard(t.data.mentionRegexJustMe,e)||e.body&&-1!==e.body.search(t.data.mentionRegexJustMe))&&++i.unreadMentionJustMeCount)}})})}),a&&this._msgShouldUpdateReadState(a.most_recent_message)&&(this._updateReadStateForActiveChat(),n=!0),n&&(this.set("activeRooms",this.data.activeRooms),this._updateTotalUnreadCount())}},{key:"_shouldUpdateMentionFromCard",value:function(e,t){return _.has(t,"card.activity.html")&&-1!==t.card.activity.html.indexOf("hc-mention-user")&&e.test(t.card.activity.html)}},{key:"_updateMostRecentMessage",value:function(e,t){var a=e.most_recent_message||{};!t.is_presence_message&&E["default"].validateMID(t.mid)&&(!a.timestamp||t.time>a.timestamp)&&(e.most_recent_message={mid:t.mid,timestamp:t.time})}},{key:"_msgShouldUpdateReadState",value:function(e){var t=this.data.current_user.user_jid,a=this.data.roster[t],n=a?a.presence:null,i=this.local.windowFocused,o=E["default"].jid.is_chat(this.data.active_chat),s=e?t===e.sender:!1,r=n&&n.show!==W["default"].IDLE;return i&&o&&(s||r)}},{key:"_msgIsTopicChange",value:function(e){return!!e.subject}},{key:"_updateReadStateForActiveChat",value:function(){var e=this.data.active_chat;e&&E["default"].jid.is_chat(e)&&this.data.activeRooms[e]&&this._updateReadStateForChat(this.data.activeRooms[e])}},{key:"_updateReadStateForChat",value:function(e){var t=e.most_recent_message,a=e.last_read_message,n={jid:e.jid};if(!(t&&a&&t.timestamp<=a.timestamp))return t||a?void(!t&&a||(e.last_read_message=(0,u["default"])({},t),n.mid=t.mid,n.timestamp=t.timestamp,this._updateReadState(n))):(e.last_read_message={},void this._updateReadState(n))}},{key:"_updateReadState",value:function(e){e&&E["default"].jid.is_chat(e.jid)&&D["default"].dispatch("DAL:update-readstate",e)}},{key:"_removeReadState",value:function(e){E["default"].jid.is_chat(e)&&D["default"].dispatch("DAL:remove-readstate",{jid:e})}},{key:"_clearUnreadCountForChat",value:function(e){var t=this._clearUnreadCount(e);t&&(this.set("activeRooms",this.data.activeRooms),this._updateTotalUnreadCount())}},{key:"_clearUnreadCount",value:function(e){if(!E["default"].jid.is_chat(e))return!1;var t=this.data.activeRooms[e],a=this.data.allRooms[e];if(t){var n=_.pick(this.getRoomDefaults(),"unreadCount","unreadCountTemp","unreadMentionCount","unreadMentionJustMeCount","hasMention"),i=_.pick(t,"unreadCount","unreadCountTemp","unreadMentionCount","unreadMentionJustMeCount","hasMention");if(!_.isEqual(i,n))return this.data.activeRooms[e]=_.assign({},t,n),a&&E["default"].jid.is_room(e)&&(this.data.allRooms[e]=_.assign({},a,n)),!0}return!1}},{key:"_updateTotalUnreadCount",value:function(){var e=F["default"].getAll(),t=e.notifyForRoom,a=e.notifyForPrivateRoom,n=e.notifyForPrivate,i=e.notifyForTag,o=e.roomNotificationOverrides,s=void 0===o?{}:o,r=_.get(this.data.config,"feature_flags.web_client_per_room_notifications",!1),l=F["default"].getGlobalNotificationSetting(),u=!1,c=_.reduce(this.data.activeRooms,function(e,o){var c=E["default"].jid.is_private_chat(o.jid);if(c){if(o.unreadCount&&(u=!0),n)return e+o.unreadCount}else{if(o.hasMention&&(u=!0),r){var d=_.get(s[o.jid],"level",l);switch(d){case"quiet":return e+o.unreadMentionJustMeCount;case"normal":return e+o.unreadMentionCount;case"loud":default:return e+o.unreadCount}}if(E["default"].jid.is_public_room(o.privacy)){if(t)return e+o.unreadCount;if(i)return e+o.unreadMentionCount}else if(E["default"].jid.is_private_room(o.privacy)){if(a)return e+o.unreadCount;if(i)return e+o.unreadMentionCount}}return e},0);J["default"].updateTotalUnreadCount(c,u)}},{key:"_msgShouldNotUpdateBadge",value:function(e){var t=_.isArray(e.x)&&e.x.length?e.x[0]:!1,a="0"===_.get(t,"notify");return a||e.delay||e.room===this.data.active_chat&&this.local.windowFocused||e.sender===this.data.current_user.user_name}},{key:"handleChatStateMessage",value:function(e){var t=E["default"].jid.bare_jid(_.get(e,"message.from")),a=this.data.activeRooms[t],n=E["default"].jid.bare_jid(_.get(e,"message.delay.from_jid",t)),i=E["default"].jid.user_id(t);this.data.current_user.user_jid===n&&E["default"].jid.is_private_chat(t)&&(a||"active"!==e.type?a&&"gone"===e.type&&this.handleCloseRoom(t):this.joinPrivateChat(t,i))}},{key:"handleConnectionSuccess",value:function(e,t){}},{key:"handleEmoticons",value:function(e,t){var a=e.item?E["default"].toArray(e.item):[],n="result"===t?{}:_.cloneDeep(this.data.emoticons.icons);n=E["default"].emoticons.addBulk(a,n),e.path_prefix&&E["default"].emoticons.path_prefix!==e.path_prefix&&(E["default"].emoticons.path_prefix=e.path_prefix);var i=_.keys(this.data.emoticons.icons).sort(),o=_.keys(n).sort(),s=!_.isEqual(i,o);s&&this.set({emoticons:{path_prefix:e.path_prefix,icons:n}}),this.local.emoticons_initialized?s&&this._replaceEmoticonsIfRequired():this.local.emoticons_initialized=!0}},{key:"_replaceEmoticonsIfRequired",value:function(){F["default"].shouldReplaceTextEmoticons()&&this.data.rawMessages&&this.handleIncomingMessages(this.data.rawMessages,this)}},{key:"handleRoster",value:function(e){var t=this,a=null;_.isPlainObject(e)&&(a=e);var n=[],i=!1;E["default"].toArray(e).filter(function(e){return!!e}).forEach(function(e){var a=_.get(e,"id"),o=_.get(e,"jid");if("remove"===_.get(e,"subscription")&&(o||a)){var s=_.get(t.data,"roster['"+o+"']")||_.find(t.data.roster,{id:a});s&&(s.deleted=!0),o=o||s.jid,D["default"].dispatch("room-deleted",{jid:o}),i=!0}else e.display_name=e.name,e.id=e.id?e.id:E["default"].jid.user_id(e.jid),n.push(e)}),this.data.roster=_.omitBy(this.data.roster,function(e){return e.deleted});var o=_.keyBy(n,function(e){return t.data.roster[e.jid]||_.assign(e,e.jid===t.data.current_user.user_jid?{presence:{show:"chat",status:""}}:t.getRosterDefaults()),e.jid}),s=_.size(this.data.roster),r=_.merge(this.data.roster,o),l=_.size(r);this.set("roster",r);var u=_.get(this.data.config,"feature_flags.web_client_user_joined_notification",!1);if(u&&a&&l>s&&l<=K["default"].max_users_in_group_join_notification){var c="user-joined-flag-"+E["default"].now();oe["default"].showFlag({id:c,type:"success",body:this._flagBodyForUserJoinedEvent(a.jid,a.display_name,c),close:"manual"})}this.updateMentionNames(),this.updateRosterNames(),i&&this.verifyOTOChats(),this._handleWelcomeRange(_.toArray(r).length)}},{key:"_setRouteToUser",value:function(e,t){return function(a){a.preventDefault(),D["default"].dispatch("set-route",{jid:e}),oe["default"].removeFlag(t)}}},{key:"_flagBodyForUserJoinedEvent",value:function(e,t,a){var n=this;return function(){return React.createElement("div",null,React.createElement("b",{dangerouslySetInnerHTML:{__html:V["default"].user_joined(t)}}),React.createElement("span",null," "),React.createElement("a",{href:"#",onClick:n._setRouteToUser(e,a)},V["default"].user_joined_link))}}},{key:"updateMentionNames",value:function(){var e=this.data.current_user.is_guest,t=_.map(this.data.roster,function(t){return"subscription"in t&&!e||!/Guest$/.test(t.mention_name)&&e?t.mention_name:void 0});t=_.reject(t,_.isEmpty);var a=t.indexOf(this.data.current_user.mention);-1!==a&&t.splice(a,1);var n=_.filter(K["default"].core_mentions,{isUser:!0}),i=_.map(n,"mention_name"),o=i?i.join("|"):"";this.set({mentionRegexUser:new RegExp("(?=[^\\w]|^)@("+(t.length?t.join("|")+"|"+o:o)+")(?=[^\\w]|$)","gi")})}},{key:"updateGuestMentions",value:function(e){var t,a,n=this,i=this.data.activeRooms[e];i&&_.get(i,"participants.guests")&&(t=_.map(i.participants.guests,function(e){return n.data.roster[e]?n.data.roster[e].mention_name:void 0}),a=new RegExp("(?=[^\\w]|^)@("+(t&&t.length?t.join("|"):"")+")(?=[^\\w]|$)","gi"),i.guest_mention_regex=a,this.set({activeRooms:this.data.activeRooms}),this.setActiveGuestUserRegex())}},{key:"updateRosterNames",value:function(){var e=_.transform(this.data.roster,function(e,t){e[t.mention_name]=t.name}),t={};_.forEach(K["default"].core_mentions,function(e){t[e.mention_name]=e.name}),E["default"].roster_names=_.merge(e,t)}},{key:"handleProfile",value:function(e){var t=E["default"].jid.bare_jid(e.from);this.data.profiles[t]=e.query;var a=_.get(this.data,["roster",t]);a&&(a.name=_.get(e,["query","name"])),this.set("profiles",this.data.profiles)}},{key:"handleFileQueryResponse",value:function(e){var t=this,a=e.jid;if(this.data.activeRooms[a]){var n=this.data.activeRooms[a].files||[],i=_.orderBy(n.concat(e.files),"date","desc"),o=_.uniqBy(i,"url");this.data.activeRooms[a].files=_.map(o,function(e){return e.user_name=e.user_name||E["default"].user.get_user_name(t.data.roster,e.group_id,e.user_id),e.icon_class=e.icon_class||E["default"].file.get_icon_class(e.name),e}),this.data.activeRooms[a].all_files_fetched=e.end,this.data.activeRooms[a].files_fetched=!0,this.data.activeRooms[a].files_fetching=!1,this.set("activeRooms",this.data.activeRooms),D["default"].dispatch("files-fetched",{jid:a})}}},{key:"addFileFromMessageToRoom",value:function(e,t){if(this.data.activeRooms[e]){var a=this.data.activeRooms[e].files||[];a=[t].concat((0,o["default"])(a)),a=_.orderBy(a,"date","desc"),a=_.uniqBy(a,"url"),this.data.activeRooms[e].files=a,this.debouncedSetActiveRooms()}}},{key:"handleLinkQueryResponse",value:function(e){var t=this,a=e.jid;if(this.data.activeRooms[a]){var n=this.data.activeRooms[a].links||[],i=n.concat(e.links),o=_.orderBy(i,"date","desc"),s=_.uniqBy(o,"url");this.data.activeRooms[a].links=_.map(s,function(e){return e.user_name=e.user_name||E["default"].user.get_user_name(t.data.roster,e.group_id,e.user_id),e.display_url=e.display_url||e.url.replace(/.*?:\/\//g,""),e}),this.data.activeRooms[a].all_links_fetched=e.end,this.data.activeRooms[a].links_fetched=!0,this.data.activeRooms[a].links_fetching=!1,this.set("activeRooms",this.data.activeRooms),D["default"].dispatch("links-fetched",{jid:a})}}},{key:"addLinkFromMessageToRoom",value:function(e,t){if(this.data.activeRooms[e]){var a=this.data.activeRooms[e].links||[],n=_.orderBy([].concat(t,a),"date","desc");this.data.activeRooms[e].links=_.uniqBy(n,"url"),this.debouncedSetActiveRooms()}}},{key:"joinPrivateChat",value:function(e,t){this.data.activeRooms[e]={jid:e,id:t,name:_.get(this.data.roster,[e,"name"],"Unknown"),type:"chat",presence:_.get(this.data.roster,[e,"presence"])||{show:"",status:""},files:[],links:[],history_fetch_ids:[],unreadCount:0,unreadMentionCount:0,unreadMentionJustMeCount:0,hasMention:!1},-1===this.local.participants.indexOf(t)&&this.local.participants.push(t),D["default"].dispatch("request-profile",e),this.set("activeRooms",this.data.activeRooms)}},{key:"handleRooms",value:function(e){var t=this;arguments.length<=1||void 0===arguments[1]?!1:arguments[1];e=E["default"].toArray(e);var a=[],n=_.reduce(e,function(e,n){var i={};if(n){if(n.is_deleted)a.push(n.jid);else if(n.id&&!n.jid){var o=_.find(_.values(t.data.activeRooms),{id:n.id}),s=_.find(_.values(t.data.allRooms),{id:n.id}),r=o||s;if(r){var l=r.jid,u=r.name;D["default"].dispatch("close-room",{jid:l}),a.push(l),o&&D["default"].dispatch("show-flag",{type:"info",body:z["default"].you_have_been_removed+' "'+u+'"',close:"auto"}),te["default"].type("application-store:handle-rooms").log("Active room was closed because user was removed from that room. jid: "+l)}}else{var c=t.data.activeRooms[n.jid]||{};i=_.assign({},t.getRoomDefaults(),c,n.x,{jid:n.jid,name:n.name}),t.data.activeRooms[n.jid]&&(t.data.activeRooms[n.jid]=i,E["default"].jid.is_room(n.jid)&&!_.includes(i.admins,i.owner)&&t.addRoomAdmin(n.jid,i.owner)),e.push(i)}return e}},[]),i=_.keyBy(n,"jid"),o=_.omit(this.data.allRooms,a),s=_.omit(this.data.activeRooms,a);this.set({allRooms:_.assign(o,i),activeRooms:s})}},{key:"determineRoomUpdate",value:function(e){if("deleted"===e.status)return void this.handleRoomDelete(e);var t=!this.data.allRooms[e.jid];t&&this.handleNewRoom(e),this.handleRoomUpdate(e)}},{key:"handleNewRoom",value:function(e){var t=this.getRoomDefaults();t.type=E["default"].room.detect_chat_type(e.jid),this.data.allRooms[e.jid]=_.assign(t,e),t.admins||(t.admins=[]),t.admins.push(e.owner),this.set({allRooms:this.data.allRooms})}},{key:"handleRoomUpdate",value:function(e){this.data.allRooms[e.jid]=_.merge(this.data.allRooms[e.jid],e),this.data.activeRooms[e.jid]&&(this.data.activeRooms[e.jid]=_.merge(this.data.activeRooms[e.jid],e)),this.set({allRooms:this.data.allRooms,activeRooms:this.data.activeRooms}),this._updateTotalUnreadCount()}},{key:"handleRoomDelete",value:function(e){var t=this.data.allRooms[e.jid]?this.data.allRooms[e.jid].id:e.id;delete this.data.allRooms[e.jid],this.data.activeRooms[e.jid]&&(e.jid!==this.data.active_chat||_.includes(this.local.deletedRooms,e.jid)||D["default"].dispatch("show-flag",{type:"info",close:"auto",body:'"'+this.data.activeRooms[e.jid].name+'" was deleted by the admin.'}),D["default"].dispatch("close-room",{jid:e.jid,doNotNotifyHC:!0,id:t})),D["default"].dispatch("room-deleted",{jid:e.jid,id:t}),this.set({allRooms:this.data.allRooms,activeRooms:this.data.activeRooms}),this._updateTotalUnreadCount(),_.pull(this.local.deletedRooms,e.jid)}},{key:"handleCloseRoom",value:function(e){D["default"].dispatch("room-closed",{jid:e}),delete this.data.activeRooms[e],delete this.data.newMessages[e],this._resetFiles(e),this._resetLinks(e),E["default"].jid.is_private_chat(e)&&this.data.roster[e]&&(this.data.roster[e].closed_at=E["default"].getMoment()),this.set({activeRooms:this.data.activeRooms,roster:this.data.roster}),this.local.closedChats=[].concat(e,_.pull(this.local.closedChats,e)),this._updateTotalUnreadCount(),this._removeReadState(e)}},{key:"_resetFiles",value:function(e){this.data.allRooms[e]&&(this.data.allRooms[e].files=[],this.data.allRooms[e].all_files_fetched=!1,this.data.allRooms[e].files_fetched=!1,this.data.allRooms[e].files_fetching=!1)}},{key:"_resetLinks",value:function(e){this.data.allRooms[e]&&(this.data.allRooms[e].links=[],this.data.allRooms[e].all_links_fetched=!1,this.data.allRooms[e].links_fetched=!1,this.data.allRooms[e].links_fetching=!1)}},{key:"addVisitor",value:function(e){var t=!!this.data.roster[e.participant],a=!!this.data.activeRooms[e.participant];t&&a||(this.data.roster[e.participant]={mention_name:e.user_mention||_.get(this.data.roster[e.participant],"mention_name"),name:e.user_name,jid:e.participant},this.addRoomParticipant({room:e.room,user_jid:e.participant,user_id:E["default"].jid.user_id(e.participant),role:"visitor",affiliation:""}),this.updateParticipantStatusInRoster(e),this.updateGuestMentions(e.room)),this.data.roster[e.participant].presence={show:e.presence.show||"chat",status:e.presence.status},this.set("roster",this.data.roster)}},{key:"updateParticipantStatusInRoster",value:function(e){var t=this.data.activeRooms[e.room];if(t){var a=_.get(t,"participants.guests",[]);a.some(function(t){return t===e.participant})&&(this.data.roster[e.participant].is_guest=!0)}}},{key:"removeVisitor",value:function(e){this.data.roster[e.participant]&&(delete this.data.roster[e.participant],this.set("roster",this.data.roster),this.updateGuestMentions(e.room))}},{key:"handleRoomPresence",value:function(e){this.data.activeRooms[e.room]&&(this.addRoomParticipant(e),this.updateMessagesIfGuestsConnected(e.room))}},{key:"updateMessagesIfGuestsConnected",value:function(e){e&&(_.isEmpty(_.get(this.data.activeRooms[e],"participants.guests",[]))||(this.messageProcessor.updateMessagesIfGuestsConnected(this.data.newMessages[e]),this.set("newMessages",this.data.newMessages)))}},{key:"handleGlobalPresence",value:function(e){var t,a,n=this;_.forOwn(e,function(e,i){t=n.data.roster[i],a=n.data.activeRooms[i],t&&(i!==n.data.current_user.user_jid||i===n.data.current_user.user_jid&&_.includes(["away","chat","dnd","xa"],e.show))&&_.assign(t.presence,e),a&&_.assign(a.presence,e)}),this.set({activeRooms:this.data.activeRooms,roster:this.data.roster})}},{key:"addRoomParticipantFromAPI",value:function(e,t){E["default"].jid.is_public_room(e.privacy)&&!t.is_present_in_room||(E["default"].room.is_guest(t)?(this.data.roster[t.jid]||(this.data.roster[t.jid]=t,this.set("roster",this.data.roster)),_.includes(e.participants.guests,t.jid)||(e.participants.guests.push(t.jid),this.updateGuestMentions(e.jid))):_.includes(e.participants.members,t.jid)||e.participants.members.push(t.jid),E["default"].room.is_admin(t)&&!_.includes(e.admins,t.id)&&e.admins.push(t.id),_.includes(this.local.participants,t.id)||this.local.participants.push(t.id))}},{key:"addRoomParticipant",value:function(e){var t=this,a=this.data.activeRooms[e.room],n="visitor"===e.role?a.participants.guests:a.participants.members,i=-1===n.indexOf(e.user_jid);i&&(n.push(e.user_jid),"unavailable"===e.type&&E["default"].user.is_admin(a.admins,a.owner,this.data.current_user)?this.roomParticipantNotification(e,"add"):this.roomParticipantNotificationTimer(a,e,"join")),"private"===a.privacy&&D["default"].dispatch("unmark-participant",{room:e.room,user:e.user_jid}),"owner"!==e.affiliation&&"admin"!==e.affiliation||_.includes(a.admins,e.user_id)||this.addRoomAdmin(e.room,e.user_id),this.data.current_user.is_guest&&!this.data.roster[e.user_jid]&&D["default"].dispatch("request-profile",e.user_jid,function(a){a.query&&(t.handleGuestRoomParticipants(_.merge(e,a.query)),t.debouncedSetActiveRooms())}),this.debouncedSetActiveRooms(),-1===this.local.participants.indexOf(e.user_id)&&this.local.participants.push(e.user_id)}},{key:"removeRoomParticipant",value:function(e){var t=this,a=this.data.activeRooms[e.room];a&&(a.participants[e.role]?("guests"===e.role?(this.roomParticipantNotification(e,"leave"),this.removeVisitor(e)):this.roomParticipantNotificationTimer(a,e,"leave"),"private"===a.privacy&&"guests"!==e.role?D["default"].dispatch("mark-participant-unknown",{room:e.room,user:e.participant,role:e.role}):_.remove(a.participants[e.role],function(t){return t===e.participant})):"none"===e.role&&(E["default"].user.is_admin(a.admins,a.owner,this.data.current_user)&&this.roomParticipantNotification(e,"remove"),_.remove(a.participants.members,function(t){return t===e.participant}),_.forEach(a.participants.guests,function(a){a===e.participant&&t.removeVisitor(e)})),this.debouncedSetActiveRooms())}},{key:"handleUserRemoved",value:function(e){this.removeRoomParticipant({room:e.room,participant:e.user_jid,role:e.role});var t=Number(_.get(this.data.current_user,"user_id")||_.get(this.data.current_user,"id"));this.data.allRooms[e.room]&&this.data.activeRooms[e.room].owner!==t&&e.user_jid===this.data.current_user.user_jid&&(this.data.activeRooms[e.room]&&(D["default"].dispatch("show-flag",{type:"info",body:z["default"].you_have_been_removed+' "'+this.data.activeRooms[e.room].name+'"',close:"auto"}),D["default"].dispatch("close-room",{jid:e.room})),D["default"].dispatch("room-deleted",{jid:e.room}),delete this.data.allRooms[e.room],this.set({allRooms:this.data.allRooms}))}},{key:"roomParticipantNotificationTimer",value:function(e,t,a){var n=this;if(e.show_join_leave_messages){var i=t.participant||t.user_jid,o=e.jid+i;"join"===a?this.local.presence_updates_timers[o]?clearTimeout(this.local.presence_updates_timers[o]):this.roomParticipantNotification(t,a):(clearTimeout(this.local.presence_updates_timers[o]),this.local.presence_updates_timers[o]=setTimeout(function(){delete n.local.presence_updates_timers[o],n.roomParticipantNotification(t,a)},K["default"].leave_room_message_confirmation_timeout))}}},{key:"roomParticipantNotification",value:function(e,t){var a=e.participant||e.user_jid||e.jid,n=this.data.roster[a];if(!F["default"].getHidePresenceMessages()&&n){var i=void 0,o=[],s=this.data.activeRooms[e.room];E["default"].user.is_admin(s.admins,s.owner,this.data.current_user)&&e.is_present_in_room&&(t="join"),"leave"===t?i="hc-not-allowed"===e.status?z["default"].user_leave_reason(n.name,z["default"].not_allowed):z["default"].user_leave(n.name):"join"===t?i=z["default"].user_join(n.name):"remove"===t?i=z["default"].user_removed(n.name):"add"===t&&(i=z["default"].user_added(n.name)),o.push({body:i,type:"room-presence",from:e.room,delay:!0,sender:" ",user_jid:a}),this.handleIncomingMessages(o,this);
}}},{key:"addRoomAdmin",value:function(e,t){this.data.activeRooms[e].admins.push(t)}},{key:"updatePresence",value:function(e){Z["default"].update({current_user_presence:e.show}),this.data.roster[this.data.current_user.user_jid].presence=e,this.set({roster:this.data.roster})}},{key:"resetRoomParticipantsListInitializedFlag",value:function(){_.forOwn(this.data.activeRooms,function(e){e.participants_fully_initialized=!1})}},{key:"fetchRoomParticipantsFromAPI",value:function(e,t){J["default"].fetchRoomParticipants(e,t)}},{key:"handleRoomParticipantsFromAPI",value:function(e){var t=this,a=_.find(this.data.activeRooms,function(t){return t.id.toString()===e.roomId.toString()});if(a){var n=E["default"].toArray(e.participants);this.setRoomParticipantsFullyInitialized(a),n.forEach(function(e){e.jid=e.xmpp_jid,e.presence={show:"chat",status:""},t.addRoomParticipantFromAPI(a,e)}),this.updateMessagesIfGuestsConnected(a.jid)}}},{key:"setRoomParticipantsFullyInitialized",value:function(e){e.participants_fully_initialized=!0}},{key:"setActiveRooms",value:function(){this.set("activeRooms",this.data.activeRooms),this._updateTotalUnreadCount()}},{key:"setActiveGuestUserRegex",value:function(){var e;this.data.activeRooms[this.data.active_chat]&&(e=this.data.activeRooms[this.data.active_chat].guest_mention_regex),this.set({guestRegexUser:e})}},{key:"updatePresenceProcessor",value:function(){this.presenceProcessor.update({is_guest:this.data.current_user.is_guest,current_user_jid:this.data.current_user.user_jid})}},{key:"handleArchiveRoom",value:function(e,t,a){var n=this.data.activeRooms[e.jid];D["default"].dispatch("API:update-room",{params:{name:n.name,privacy:n.privacy,is_archived:t,is_guest_accessible:!!n.guest_url,topic:n.topic,owner:{id:n.owner},id:n.id},path:{identifier:n.id,type:"room"},jid:e.jid},a)}},{key:"handleArchivedRoom",value:function(e,t){var a=this.data.allRooms[e.jid]||{},n=this.data.activeRooms[e.jid]||{};a.is_archived=t,n.is_archived=t,this.set({allRooms:this.data.allRooms,activeRooms:this.data.activeRooms})}},{key:"handleTopicUpdated",value:function(e,t){t&&(this.data.allRooms[t]&&(this.data.allRooms[t].topic=e),this.data.activeRooms[t]&&(this.data.activeRooms[t].topic=e),this.set({allRooms:this.data.allRooms,activeRooms:this.data.activeRooms}))}},{key:"openChatByMentionName",value:function(e){var t=_.find(this.data.roster,function(t){return t.mention_name.toLowerCase()===e.toLowerCase()}),a=this.get("current_user");if(t&&!a.is_guest){var n={jid:t.jid,name:t.name};D["default"].dispatch("set-route",n)}}},{key:"handleGuestRoomParticipants",value:function(e){var t=this,a=_.forEach(E["default"].toArray(e),function(e){e.jid=e.user_jid||E["default"].jid.build_group_jid(e.id,t.data.group_id,t.data.chat_server),e.presence={show:"chat",status:""}});this.set("roster",_.merge(this.data.roster,_.keyBy(a,"jid"))),this.updateMentionNames(),this.updateRosterNames()}},{key:"updateFeatureFlags",value:function(e){if(_.isObject(e)&&_.has(e,"feature_flags")){var t=_.merge(this.data.config,e);this.set("config",t)}}},{key:"handleEnableDarkFeature",value:function(e){var t=_.get(this.data.config,"feature_flags",{});t&&e.name&&(t[e.name]=!0,this.updateFeatureFlags({feature_flags:t}))}},{key:"configure",value:function(e){this.messageProcessor.configure(e.asset_base_uri),"nonce"!==e.config.auth_method&&this.iqProcessor.addRequiredStartupStanza(),this.set(e)}}]),t}(S["default"]);t["default"]=new se,e.exports=t["default"]},function(e,t,a){"use strict";var n=a(148)["default"];t["default"]=n||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},t.__esModule=!0},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(59),o=n(i),s=a(193),r=n(s),l=a(157),u=n(l),c=a(4),d=n(c),f=a(5),h=n(f),p=a(99),m=n(p),g=a(108),v=n(g),y=a(90),b=n(y),w=a(103),R=n(w),k=a(180),E=n(k),C=a(161),S=n(C),T=a(194),x=n(T),A=a(9),I=n(A),N=a(195),M=n(N),O=a(121),D=n(O),P=a(185),j=n(P),L=a(176),F=n(L),U=a(167),H=n(U),B=a(198),z=function(){function e(t){(0,d["default"])(this,e),this.store=t,this.update(),this.registerEventCallbacks(),this.ready=!1,this.queued=[],this.imagesQueue=[],this._debouncedFetchQueue=_.debounce(this._fetchQueue.bind(this),500,{leading:!0,trailing:!0})}return(0,h["default"])(e,[{key:"update",value:function(){this.setPredicates(),this.updateNotifier()}},{key:"setPredicates",value:function(){this.outgoing_message_predicate=m["default"].createSafePredicate(D["default"].outgoing_message_filter_predicate,D["default"]),m["default"].formatMessageBody=this.formatMessageBody.bind(this)}},{key:"configure",value:function(e){this.asset_base_uri=e}},{key:"updateNotifier",value:function(){E["default"].update({group_name:this.store.get("group_name"),feature_flags:_.get(this.store.get("config"),"feature_flags",{})})}},{key:"registerEventCallbacks",value:function(){var e=this;I["default"].registerOnce("app-state-ready",function(){e.ready=!0,e.processMessages(e.queued),e.queued=[]}),I["default"].register({"application-blurred":function(){e.appBlurred=!0},"application-focused":function(){e.appBlurred=!1}})}},{key:"getMentionArguments",value:function(){var e=this.convertRegex(this.store.get("mentionRegexMe"),"mentionRegexMe"),t=this.convertRegex(this.store.get("mentionRegexUser"),"mentionRegexUser");return{name_tag_regex:e,mention_regex:t,matches:[],do_escape:!1,do_linkify:!1,do_mentions:!0}}},{key:"convertRegex",value:function(e,t){var a="mentionRegexUser"===t?"ig":"g";return"string"==typeof e?new RegExp(e.substring(1,e.lastIndexOf(")")+1),a):e}},{key:"processMessages",value:function(e){var t=m["default"].toArray(e);if(this.ready||e.results){var a={};return a=e.jid&&e.results?this.formatAPIMessages(e):this.formatXMPPMessages(e)}this.queued=this.queued.concat(t)}},{key:"formatXMPPMessages",value:function(e){var t,a,n=this,i={};return e=this.filterMessages(m["default"].toArray(e)),_.forEach(e,function(e){if(t=m["default"].jid.bare_jid(e.from),!n.checkMessageForAction(e,t)){if(n.setMessageTypeAndFormat(e),"undefined"==typeof e.mid&&(e.mid=_.uniqueId()),"undefined"==typeof e.ts&&(e.ts=m["default"].getMoment()),"undefined"!=typeof e.subject){if(e.delay)return;if(a=n.getMessageSender(e),!a)return;var o=n.handleTopicChange(e,a,t);_.assign(e,o)}var s=n.getMessageSenderId(e),r=n.getMessageSender(e),l=n.store.get("current_user");_.assign(e,{room:t,sender:e.sender||r,sender_id:s,sender_is_current_user:s===l.user_id,date:R["default"].unix(e.ts).toISOString(),sender_mention:e.sender_mention||n.getMessageSenderMention(e),sender_avatar:e.sender_avatar||n.getAvatar(s),display_time:n.formatDate(e.ts),time:parseFloat(e.ts),is_history_message:m["default"].isHistoryMessage(e),status:"confirmed"}),n.setMessageColor(e),e.card=n.processCard(_.get(e,"x.card.raw",!1)),n.setMessageSenderAndAvatar(e,_.get(e,"x.notification_sender",!1)),n.processMessageMetadata(e),e=n.formatMessageBody(e),e.body&&!m["default"].isHistoryMessage(e)&&n.shouldNotify(e)&&(a=e.sender||n.getMessageSender(e),n.updateNotifier(),M["default"].showNotification({jid:t,group_id:n.store.get("group_id"),group_name:n.store.get("group_name"),title:n.getNotificationTitle(e.room,a),body:n.getNotificationBody(e,a),icon:n.asset_base_uri+D["default"].notification_icon,html_body:"html"===e.format?e.xhtml_im_body:e.rendered_body}),E["default"].playSound("notification")),i[e.mid]=e;var u={do_emoticons:S["default"].shouldReplaceTextEmoticons()};if(_.filter(e.x,"metadata").length){var c=_.compact(_.map(e.x,"metadata"))[0];if("info"===c.type)_.assign(e,{sender:m["default"].getSenderFromMeta(c.type),sender_id:s,sender_mention:"",color:"gray"});else{var d=e.mid||"",f={},h=parseFloat(e.ts);_.assign(f,{room:t,mid:d+"-link-1",sender:m["default"].getSenderFromMeta(c.type),sender_id:s,sender_mention:e.sender_mention||n.getMessageSenderMention(e),sender_avatar:n.getAvatar(s),date:R["default"].unix(h).toISOString(),display_time:n.formatDate(h+1),time:h,format:"html",body:c.text?m["default"].escapeAndLinkify(c.text,u):"",type:c.type,link_details:c,color:"gray",is_history_message:m["default"].isHistoryMessage(e)}),f.link_details=_.transform(f.link_details,function(e,t,a){e[m["default"].camelToSnake(a)]=t}),"image"!==c.type||c.mp4?i[f.mid]=_.clone(f):n._processImageMessage(c,f)}}}}),i}},{key:"_processImageMessage",value:function(e,t){this.imagesQueue.push({url:e.image,msg:t}),this._debouncedFetchQueue(function(e,t){I["default"].dispatch("fetch-attachment-image",(0,u["default"])({},e.mid,e))})}},{key:"_fetchQueue",value:function(){var e=arguments.length<=0||void 0===arguments[0]?_.noop:arguments[0],t=arguments.length<=1||void 0===arguments[1]?_.clone(this.imagesQueue).reverse():arguments[1];this.imagesQueue=[],this._recurQueue(t,e)}},{key:"_recurQueue",value:function(e,t){var a=this,n=(0,r["default"])(e),i=n[0],o=n.slice(1),s=this._fetchImage(i.url);s.then(function(e){t(i.msg,e),0!==o.length&&a._recurQueue(o,t)},function(e){b["default"].error(e.message,e),0!==o.length&&a._recurQueue(o,t)})}},{key:"_fetchImage",value:function(e){return new o["default"](function(t,a){var n=new Image,i=void 0;n.onload=function(){clearTimeout(i),(n.naturalWidth>D["default"].message_image_max_size||n.naturalHeight>D["default"].message_image_max_size)&&a(new Error("Image is too large")),t(n)},n.onerror=function(e){clearTimeout(i)},i=setTimeout(function(){n.src="",clearTimeout(i),a(new Error("Fetching timeout"))},D["default"].message_image_loading_timeout),n.src=e})}},{key:"filterMessages",value:function(e){var t=m["default"].createSafePredicate(D["default"].message_filter_predicate,D["default"]);return e=_.filter(e,function(e){return _.has(e,"body")?!_.isEmpty(e.body)||!!e.replace:!0}),_.filter(e,t)}},{key:"formatDate",value:function(e){return m["default"].format_time(e,S["default"].shouldUse24HrTime())}},{key:"formatAPIMessages",value:function(e){var t,a=this,n={};return t=_.transform(e.results,function(t,i){if("topic"!==i.type&&!a.isEnsoVideoHistoryMessage(i)&&!_.isNull(i.message)){var o=i.from.name||i.from;if(n={body:i.message,room:e.jid,mid:i.id,time:m["default"].getMoment(i.date),display_time:a.formatDate(i.date),date:(0,R["default"])(i.date).toISOString(),from:e.jid,sender:o,sender_mention:i.from.mention_name,sender_id:i.from.id,sender_avatar:a.getAvatar(i.from.id),type:"unknown"!==i.type&&i.type?i.type:"message",color:i.color,format:i.message_format,card:a.processCard(_.get(i,"card",!1)),is_history_message:!0,status:"confirmed"},"html"===i.message_format&&(n.xhtml_im_body=i.message),i.authenticated_file?_.assign(n,{type:"file",authenticated_file:i.authenticated_file}):i.file&&_.assign(n,{type:"file",file:i.file}),D["default"].slash_replacement_regex.test(i.message)){var s=i.message.split("/");I["default"].dispatch("replacement-message-received",{jid:e.jid,sender_id:i.from.id,text_to_replace:s[1],replacement_text:s[2],time:m["default"].getMoment(i.date),mid:i.id})}if(a.setMessageTypeAndFormat(n),a.setMessageColor(n),a.setMessageSenderAndAvatar(n,_.get(i,"notification_sender",!1)),a.processMessageMetadata(n),t.push(a.formatMessageBody(n)),i.message_links&&i.message_links.length){var r={},l=0;_.map(i.message_links,function(n){l++,r={room:e.jid,mid:n.id||i.id+"-link-"+l,body:n[n.type].text||i.message,time:m["default"].getMoment(i.date)+l,date:(0,R["default"])(i.date).toISOString(),display_time:a.formatDate(i.date),from:e.jid,sender:m["default"].getSenderFromMeta(n.type),sender_mention:i.from.mention_name,sender_id:i.from.id,format:"html",color:"gray",type:n.type,link_details:n[n.type],is_history_message:!0,status:"confirmed"},r.link_details.url=n.url,r.link_details=_.transform(r.link_details,function(e,t,a){e[m["default"].camelToSnake(a)]=t}),t.push(r)})}}}),t=_.reject(t,function(t){return t.mid.split("-link-")[0]===e.mid||_.has(t,"message")&&_.isNull(t.message)}),t.length?_.keyBy(t,"mid"):void 0}},{key:"processSentMessage",value:function(e){var t={},a=this.store.get("current_user"),n=m["default"].jid.user_id(a.user_jid),i={jid:e.jid,room:e.jid,from:a.user_jid,sender:a.user_name,sender_id:n,sender_avatar:this.getAvatar(n),display_time:this.formatDate(),color:"blue",time:e.time,body:e.text,type:"message",mid:e.id.toString(),status:this.outgoing_message_predicate(e)?"unconfirmed":"confirmed",is_user_sent:!0};if(!this.checkMessageForAction(i,e.jid))return this.setMessageTypeAndFormat(i),i=this.formatMessageBody(i),i.sender_mention=this.getMessageSenderMention(i),t[i.mid]=i,t}},{key:"handleTopicChange",value:function(e,t,a){var n=e.subject.substring(0,D["default"].max_topic_text_length),i=this.store.get("current_user"),o={sender:" ",type:"info",color:t===i.user_name?"blue":"nocolor",body:n.length?j["default"].topic_message(t,n):j["default"].clear_topic_message(t)};return I["default"].dispatch("DAL:handle-topic-updated",{topic:n,jid:a}),o}},{key:"formatMessageBody",value:function(e){var t=/message$/.test(e.type)?"message":e.type,a=e.body,n=!0;if("string"==typeof a){if(n=-1===["html","code","quotation","monospace"].indexOf(e.format),e.x&&(e.x=m["default"].toArray(e.x)),"message"===t&&a.match(D["default"].emote_regex)&&(e.type="info",e.isEmote=!0,a=m["default"].replaceEmoteMessage(a,e.sender)),"file"===e.type){var i=x["default"].fromMessageObject(e);e.file_data=i,a=i.desc}"quotation"===e.format&&(a=m["default"].formatMultilineBlock(a));var o=[],s=this.isQuoteMessage(e)||this.isCodeMessage(e)||this.isMonospaceMessage(e),r=n&&!s,l=n&&!s&&S["default"].shouldReplaceTextEmoticons(),u=n&&!s&&m["default"].jid.is_room(e.room),c=n&&!s,d=n,f=this.convertRegex(this.store.get("mentionRegexMe"),"mentionRegexMe"),h=this.convertRegex(this.store.get("mentionRegexUser"),"mentionRegexUser"),p=this.convertRegex(this.store.get("guestRegexUser"),"guestRegexUser"),_=this.store.get("emoticons");a=m["default"].escapeAndLinkify(a,{escape_whitespace:n,name_tag_regex:f,mention_regex:h,guest_regex:p,matches:o,emoticon_path:_.path_prefix,do_escape:n,do_linkify:r,do_emoticons:l,do_word_breaks:d,do_mentions:u,do_hex_colors:c}),e.rendered_body=a,e.message_type=t,"html"===e.format&&e.xhtml_im_body&&(e.xhtml_im_body=this.substituteMentionTagsForHtml(e.xhtml_im_body))}return e}},{key:"getNotificationBody",value:function(e,t){var a;if("message"===e.type)a=e.body?e.body:j["default"].generic_message(t);else if("file"===e.type)if(e.body)a=e.body;else if(_.get(e,"file_data.name")){var n=m["default"].file.get_file_name(e.file_data.name);a=j["default"].generic_file_uploaded_message(t,n)}else a=j["default"].generic_file_message(t);return a||j["default"].generic_message(t)}},{key:"getNotificationTitle",value:function(e,t){var a=this.store.get("activeRooms")[e]||this.store.get("allRooms")[e],n=_.get(a,"name"),i=m["default"].jid.is_room(e),o=void 0;return o=i?this.getRoomNotificationTitle(n,t):this.getOTONotificationTitle(t)}},{key:"getRoomNotificationTitle",value:function(e,t){return j["default"].room_notification_title(t,e)}},{key:"getOTONotificationTitle",value:function(e){return j["default"].oto_notification_title(e)}},{key:"shouldNotify",value:function(e){var t,a,n,i=S["default"].getAll(),o=this.store.get("current_user"),s=this.store.get("roster"),r=s[o.user_jid];if(!i.notifyWhenDND&&r&&"dnd"===_.get(r,"presence.show"))return!1;if(e.type&&"info"===e.type)return!1;if(D["default"].slash_replacement_regex.test(e.body))return!1;if(this.getMessageSenderId(e)===o.user_id)return!1;if(!this.appBlurred&&this.store.get("active_chat")===e.room)return!1;if(m["default"].jid.is_private_chat(e.room))return i.notifyForPrivate;if(t=i.roomNotificationOverrides||{},a=t[e.room]||{},n=_.get(a,"level",S["default"].getGlobalNotificationSetting()),e.x){var l=_.head(m["default"].toArray(e.x)),u=_.get(l,"notify"),c=_.get(l,"type"),d=-1!==e.body.search(this.store.get("mentionRegexMe"));if("0"===u&&("system"!==c||!d))return!1}return this.shouldNotifyForLevel(n,e)}},{key:"shouldNotifyForLevel",value:function(e,t){var a=m["default"].isFormattedMessage(t),n=-1!==t.body.search(this.store.get("mentionRegexJustMe")),i=-1!==t.body.search(this.store.get("mentionRegexMe"));switch(e){case"quiet":return!a&&n;case"normal":return!a&&i;case"loud":return!0;default:return!1}}},{key:"getMessageSenderObject",value:function(e){var t=void 0,a=void 0,n={},i=this.store.get("roster");return e.delay&&e.delay.from_jid?(t=m["default"].jid.bare_jid(e.delay.from_jid),n=i[t]||{id:m["default"].jid.user_id(t),name:m["default"].jid.resource(e.from)}):m["default"].jid.is_private_chat(e.from)?(t=m["default"].jid.bare_jid(e.from),n=i[t]||{id:m["default"].jid.user_id(t)}):e.from_jid?(t=m["default"].jid.bare_jid(e.from_jid),n=i[t]||{id:m["default"].jid.user_id(t)}):e.from&&(a=m["default"].jid.resource(e.from),n=_.find(i,{name:a})||{name:a}),{name:n.name?n.name:"",mention_name:n.mention_name?n.mention_name:"",id:n.id?parseInt(n.id,10):null}}},{key:"getMessageSender",value:function(e){return"link"===e.type?"Link":this.getMessageSenderObject(e).name}},{key:"getMessageSenderId",value:function(e){return this.getMessageSenderObject(e).id}},{key:"getMessageSenderMention",value:function(e){return this.getMessageSenderObject(e).mention_name}},{key:"updateMessagesIfGuestsConnected",value:function(e){var t=this;_.forEach(e,function(e){e.sender_mention||(e.sender_mention=t.getMessageSenderMention(e)),t.formatMessageBody(e)})}},{key:"checkMessageForAction",value:function(e,t){var a,n=_.intersection(_.keys(e),this.store.local.chat_states),i=this.store.get("activeRooms"),o=this.store.get("current_user");a=e.x?m["default"].toArray(e.x):[{}];var s=_.includes(["http://hipchat.com/protocol/enso","http://hipchat.com/protocol/addlive"],a[0].xmlns)&&!m["default"].isHistoryMessage(e);if(s)return this.handleCallMessage(e,a[0],a[0].xmlns.split("/").pop());if("error"===e.type)return b["default"].warn(e),I["default"].dispatch("error-message-received",e),!0;if(e.html&&e.xhtml_im_body&&!e.authenticated_file){var r=$("<div/>").append(m["default"].getFixedHtml(e.xhtml_im_body)),l=$('a[data-target-options="enso_invite"]',r);if(l.length)return!0}else{if(e.authenticated_file||e.file||a[0].file)return this.isOneToOneChatClosed(e,t,i)&&I["default"].dispatch("private-chat-invite-received",e),this.addFile(t,e),!1;if(e.replace)I["default"].dispatch("replacement-message-received",{jid:t,edited_message:e.body,mid:e.mid,replace:e.replace,is_deleted:e.replace&&""===e.body});else{if(e.x&&e.x.is_archived&&!e.body&&!m["default"].isHistoryMessage(e))return parseInt(e.x.is_archived)?I["default"].dispatch("room-archived",{jid:t}):parseInt(e.x.is_archived)||I["default"].dispatch("room-unarchived",{jid:t}),!1;if(this.isCodeMessage(e)||this.isQuoteMessage(e)||this.isMonospaceMessage(e))return this.isOneToOneChatClosed(e,t,i)&&I["default"].dispatch("private-chat-invite-received",e),!1;if(!a[0].file&&"system"!==a[0].type&&i[t]&&e.body&&e.body.length&&v["default"].get_urls_from_string(e.body))return this.addLinks(t,e),!1;if(n.length&&(!e.body||0===e.body.length))return n=_.head(n),I["default"].dispatch("status-message-received",{type:n,message:e}),!0;if(D["default"].slash_replacement_regex.test(e.body)){var u=e.body.split("/");return I["default"].dispatch("replacement-message-received",{jid:t,sender_id:this.getMessageSenderId(e),text_to_replace:u[1],replacement_text:u[2],time:e.time||parseFloat(e.ts),mid:e.mid}),!1}if(a[0].invite){var c=_.get(a[0],"invite.from",!1);if(c&&m["default"].jid.bare_jid(c)===o.user_jid){var d=m["default"].jid.bare_jid(e.from);I["default"].dispatch("open-room",{jid:d,dontSelectRoom:!0})}else{var f=function(t,a){a?I["default"].dispatch("handle-cached-room",{jid:a.jid,name:a.name,x:a}):b["default"].error(["fetch-room"],t.message),I["default"].dispatch("groupchat-invite-received",e)};I["default"].dispatch("fetch-room",e.from,f)}return!0}if(this.isOneToOneChatClosed(e,t,i)&&e.body&&e.body.length>0)return I["default"].dispatch("private-chat-invite-received",e),!1;if("undefined"!=typeof a[0].guest_url&&!m["default"].isHistoryMessage(e))return I["default"].dispatch("guest-access-changed",{jid:t,url:a[0].guest_url}),!1}}}},{key:"handleCallMessage",value:function(e,t,a){var n={call:"invite-to-audio-video-call",accept:"audio-video-call-accepted",decline:"audio-video-call-declined",hangup:"audio-video-call-hung-up"},i={jid:e.from,id:this.getMessageSenderId(e),name:this.getMessageSender(e)},o=this.store.get("current_user"),s=_.intersection(_.keys(t),_.keys(n)),r=_.head(s),l=n[r];return"error"===e.type&&a===F["default"].ENSO?(_.assign(e,{body:_.get(e,"error.text","").toString(),from:"HipChat",sender:m["default"].getSenderFromMeta(),type:"system",color:"gray"}),!e.body):((l&&e.from!==o.user_jid||"audio-video-hangup"===l)&&I["default"].dispatch(a+"."+l,{message:e,sender:i}),!0)}},{key:"setMessageColor",value:function(e){var t=this.store.get("current_user");e.color||e.x&&e.x.color?e.color=e.color||e.x.color:e.sender_id===t.user_id||e.delay&&e.delay.from_jid===t.user_jid||t.is_guest&&e.sender_mention===t.mention?e.color="blue":"notification"===e.type?e.color="gray":e.color="nocolor"}},{key:"isQuoteMessage",value:function(e){if("quotation"===_.get(e,"format"))return!0;var t=!1,a=_.get(e,"x.message_format"),n=D["default"].quote_regex.test(e.body);return(_.isUndefined(a)||"text"===a)&&(t=!0),t&&n}},{key:"isCodeMessage",value:function(e){if("code"===_.get(e,"format"))return!0;var t=!1,a=_.get(e,"x.message_format"),n=D["default"].code_regex.test(e.body);return(_.isUndefined(a)||"text"===a)&&(t=!0),t&&n}},{key:"isMonospaceMessage",value:function(e){if("monospace"===_.get(e,"format"))return!0;var t=!1,a=_.get(e,"x.message_format"),n=D["default"].pre_regex.test(e.body);return(_.isUndefined(a)||"text"===a)&&(t=!0),t&&n}},{key:"formatQuoteMessage",value:function(e){_.assign(e,{original_body:e.body,body:e.body.replace(D["default"].quote_regex,""),format:"quotation"})}},{key:"formatCodeMessage",value:function(e){_.assign(e,{original_body:e.body,body:e.body.replace(D["default"].code_regex,""),format:"code"})}},{key:"formatMonospaceMessage",value:function(e){_.assign(e,{original_body:e.body,body:e.body.replace(D["default"].pre_regex,""),format:"monospace"})}},{key:"setMessageTypeAndFormat",value:function(e){var t=e.x?_.compact(_.map(m["default"].toArray(e.x),"type"))[0]:e.type,a=e.x?_.compact(_.map(m["default"].toArray(e.x),"message_format"))[0]:e.format;if(e.subject||"topic"===t)e.type="info";else if(this.handleInfoMessage(e))_.assign(e,{type:"info",sender:" ",color:"nocolor"});else if("system"===t||"notification"===t){if(e.type="notification",this.isQuoteMessage(e))return this.formatQuoteMessage(e);if(this.isCodeMessage(e))return this.formatCodeMessage(e);if(this.isMonospaceMessage(e))return this.formatMonospaceMessage(e)}else if("room-presence"===t)e.type="info",e.is_presence_message=!0;else if("missed-call"===t)e.type="info",e.is_missed_call_message=!0;else if(e.authenticated_file||e.file){var n=e.authenticated_file||e.file;e.type="file",e.body=n.desc||e.body||"",a="text"}else if(e.x&&"undefined"!=typeof e.x.file)e.type="file",e.body=_.get(e,"x.file.desc")||e.body||"";else if("user_state"===t)e.format="html";else if(e.xhtml_im_body)e.format="html",e.type="notification";else if(!_.isUndefined(e.body)){if(e.type="message",e.body=e.body.toString(),this.isQuoteMessage(e))return this.formatQuoteMessage(e);if(this.isCodeMessage(e))return this.formatCodeMessage(e);if(this.isMonospaceMessage(e))return this.formatMonospaceMessage(e)}e.format=a||"text","html"===e.format&&(e.xhtml_im_body?e.xhtml_im_body=m["default"].getFixedHtml(e.xhtml_im_body):e.body=m["default"].getFixedHtml(e.body))}},{key:"setMessageSenderAndAvatar",value:function(e,t){if(t){var a=this.getNotificationAvatar(t);a&&(e.sender_avatar=a),e.notification_sender=t}}},{key:"processMessageMetadata",value:function(e){var t=_.get(e.card,"metadata",{});if(e.notification_sender&&"addon"===e.notification_sender.type&&(t.sender_addon_key=e.notification_sender.id),e.metadata=t,e.metadata.sender_addon_key){var a=H["default"].extractIntegrationParametersFromMessage(e),n={addon_key:e.notification_sender.id};I["default"].dispatch("integration-iframe-event",B.MESSAGE_RECEIVED,n,a)}}},{key:"handleInfoMessage",value:function(e){if(e.x&&!e.body){if(e.x.is_archived)return e.body=j["default"].user_changed_archive_status(this.getMessageSender(e),parseInt(e.x.is_archived)?j["default"].archived:j["default"].unarchived),!0;if("undefined"!=typeof e.x.guest_url)return e.body=j["default"].user_changed_guest_access(this.getMessageSender(e),e.x.guest_url?j["default"].turned_on:j["default"].turned_off),!0}return!1}},{key:"addLinks",value:function(e,t){var a=this;!t.ts||this.isCodeMessage(t)||this.isMonospaceMessage(t)||!function(){var n=a.getMessageSender(t),i=v["default"].get_urls_from_string(t.body);i.forEach(function(a){if(a=v["default"].wrapped_url_fix(t.body,a),v["default"].url_should_be_replaced(t.body,a)){var i=v["default"].create_link_object(e,t.ts,a,n);I["default"].dispatch("add-link-from-message",{room:e,link:i})}})}()}},{key:"addFile",value:function(e,t){if(t.ts){var a=this.getMessageSender(t),n=x["default"].fromMessageObject(t),i=m["default"].file.create_file_object(e,n,t.ts,a);i&&I["default"].dispatch("add-file-from-message",{room:e,file:i})}}},{key:"getAvatar",value:function(e){if(!e)return!1;var t=this.store.get("roster"),a=_.find(t,function(t){return String(t.id)===String(e)});return a?a.photo_url:""}},{key:"processCard",value:function(e){if(!_.isString(e))return!1;try{var t=JSON.parse(e);return _.has(t,"activity.html")&&(t.activity.html=this.substituteMentionTagsForHtml(t.activity.html)),t}catch(a){return b["default"].error("Error trying to render a card",a),!1}}},{key:"getNotificationAvatar",value:function(e){if(!e)return!1;var t=e.type;return"user"===t?this.getAvatar(m["default"].jid.user_id(e.id)):!1}},{key:"getMentionTags",value:function(e){return $("<div>"+e+"</div>").find("hc-mention")}},{key:"substituteMentionTagsForHtml",value:function(e){var t=this;return this.getMentionTags(e).each(function(){var a=$(this).text(),n=$("<hc-mention>").append($(this).clone()).html(),i=m["default"].escapeAndLinkify(a,t.getMentionArguments());e=e.replace(n,i)}),e}},{key:"isOneToOneChatClosed",value:function(e,t,a){var n=this.store.get("roster");return!a[t]&&!e.is_user_sent&&m["default"].jid.is_private_chat(t)&&n[t]&&parseFloat(e.ts)>=n[t].closed_at}},{key:"isEnsoVideoHistoryMessage",value:function(e){var t=_.get(e,"message","");return"html"===e.message_format&&-1!==t.indexOf("<a")&&-1!==t.indexOf("data-target-options")&&-1!==t.indexOf("enso_invite")&&-1!==t.indexOf(F["default"].join_video_call_message)&&-1!==t.indexOf("</a>")}}]),e}();e.exports=z},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=a(118),o=n(i);t["default"]=function(e){return Array.isArray(e)?e:(0,o["default"])(e)}},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],a=v["default"].get("api_host"),n=t?"?thumbnail=true":"";return"https://"+a+"/v2/file/"+e+n}Object.defineProperty(t,"__esModule",{value:!0});var s=a(52),r=i(s),l=a(4),u=i(l),c=a(5),d=i(c);t.getAuthenticatedFileUrl=o;var f=a(99),h=i(f),p=a(154),m=n(p),g=a(169),v=i(g),y=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?(0,r["default"])(null):arguments[0];(0,u["default"])(this,e),this.id=t.id||null,this.name=t.name||"",this.desc=t.desc||"",this.size=parseInt(t.size,10)||0,this.date=t.date?new Date(t.date):"",this.url=t.is_authenticated?o(t.id,!1):t.url||null,this.thumb_url=t.is_authenticated?o(t.id,!0):t.thumb_url||null,this.group_id=parseInt(t.group_id,10)||null,this.user_id=parseInt(t.user_id,10)||null,this.auth_scheme=t.auth_scheme||"",this.is_authenticated=t.is_authenticated||!1,this.file_name=this.name.split("/").pop(),this.file_type=h["default"].file.get_file_type(this.name,!0),this.file_ext=h["default"].file.get_extension(this.name),this.file_size=h["default"].file.get_size_string(this.size),this.preview_thumbnail="img"===this.file_type?new Image:null}return(0,d["default"])(e,null,[{key:"fromXMPP",value:function(t){function a(e){var a=arguments.length<=1||void 0===arguments[1]?null:arguments[1],n=t.querySelector(e);return _.get(n,"textContent",a)}var n,i;return t.getAttribute("xmlns")===m.HC_AUTHENTICATED_FILE||"authenticated_file"===t.nodeName?(n=a("url"),i=!0):(n=a("file_url"),i=!1),new e({id:a("id"),name:a("name",""),desc:a("desc",""),size:a("size",0),date:new Date(a("date","")),url:n,thumb_url:a("thumb_url",""),group_id:a("group_id"),user_id:a("user_id"),auth_scheme:a("auth_scheme"),is_authenticated:i})}},{key:"fromREST",value:function(t){var a=t.authenticated_file,n=!0;return a||(a=t.file,n=!1),new e({id:a.id,name:a.name,desc:t.message,size:a.size,date:t.date,url:a.url,thumb_url:a.thumb_url,is_authenticated:n})}},{key:"fromMessageObject",value:function(t){var a,n,i,o=t.authenticated_file;return o?(a=o.url,i=!0):(t.x?(o=Array.isArray(t.x)?t.x[0].file:t.x.file,a=o.file_url):(o=t.file,a=o.url),i=!1),n=void 0===o.desc||t.replace?t.body||t.message:o.desc||"",new e({id:o.id,name:o.name,desc:n,size:o.size,date:o.date||t.date,url:a,thumb_url:o.thumb_url,group_id:o.group_id,user_id:o.user_id,auth_scheme:o.auth_scheme,is_authenticated:i})}}]),e}();t["default"]=y},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(148),o=n(i),s=a(9),r=n(s),l=a(196),u=n(l),c=a(173),d=n(c),f=a(161),h=n(f),p=a(93),_=n(p);e.exports={openChatByMentionName:function(e){var t="string"==typeof e?e:e.dataset.mentionName;r["default"].dispatch("open-chat-by-mention-name",t),u["default"].chatRoomMentionClicked()},openChatByJID:function(e){r["default"].dispatch("set-route",{jid:e.jid}),e.source="jid",d["default"].dispatch("analytics-open-room",e)},navigateToChat:function(e){e&&r["default"].dispatch("set-route",{jid:e})},restoreRoomOrder:function(e){r["default"].dispatch("restore-room-order",{jid:e})},addFileForUploadWithUrl:function(e,t){e&&r["default"].dispatch("add-file-for-upload-with-url",{fileUrl:e,source:t})},addFileForUploadWithBase64:function(e,t,a){e&&r["default"].dispatch("add-file-for-upload-with-base64",{base64:e,fileName:t,source:a})},requestAddLiveCredentials:function(e,t){r["default"].dispatch("request-addlive-credentials",{jid:e},t)},logoClicked:function(){d["default"].dispatch("analytics-event",{name:"hipchat.client.top.navigation.logo.clicked"})},enableDarkFeature:function(e,t){r["default"].dispatch("enable-dark-feature",{name:e});var a={name:"hipchat.client.darkfeature.enabled",feature:e,user_jid:t};d["default"].dispatch("analytics-event",a)},clearWebCookies:function(e){r["default"].dispatch("clear-web-cookies",e)},revokeOauth2Token:function(e){r["default"].dispatch("revoke-oauth2-token",e)},fetchRoomParticipants:function(e,t){r["default"].dispatch("fetch-room-participants",e,t)},signout:function(){d["default"].dispatch("analytics-event",{name:"hipchat.client.top.navigation.profile.signout.clicked"}),r["default"].dispatch("signout")},logInToAnotherTeam:function(){u["default"].logInToAnotherTeamClicked(),_["default"].onLogInToAnotherTeam()},showNotification:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(h["default"].shouldIssueNotification()){var t=(0,o["default"])({},h["default"].getNotificationTypes(),e.notification_types);e.notification_types=t;for(var a=arguments.length,n=Array(a>1?a-1:0),i=1;a>i;i++)n[i-1]=arguments[i];_["default"].onNotification.apply(_["default"],[e].concat(n))}},updateTotalUnreadCount:function(){_["default"].onTotalUnreadCountUpdate.apply(this,arguments)},openExternalWindow:function(){_["default"].openExternalWindow.apply(_["default"],arguments)},dismissReadOnlyModal:function(){r["default"].dispatch("dismiss-read-only-modal")}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}
Object.defineProperty(t,"__esModule",{value:!0});var i=a(173),o=n(i),s=a(197),r=n(s),l=a(99),u=n(l);t["default"]={successfulAuthEvent:function(e,t){o["default"].dispatch("analytics-initial-auth-done",{jid:e,token:t})},inviteTeamClickedEvent:function(e){o["default"].dispatch("analytics-event",{name:"hipchat.client."+e+".invite.team.clicked"})},inviteUserToRoomClickedEvent:function(e){o["default"].dispatch("analytics-event",{name:"hipchat.client."+e+".invite.user.to.room.clicked"})},createRoomClickedEvent:function(e){o["default"].dispatch("analytics-event",{name:"hipchat.client."+e+".create.room.clicked"})},connectDialogLinkClickedEvent:function(e){o["default"].dispatch("analytics-connect-dialog-click",{addon_key:e})},connectDialogClosedEvent:function(e){o["default"].dispatch("analytics-connect-dialog-close",{addon_key:e})},newChatButtonClicked:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.top.new.chat.button.clicked"})},failedMessageRetried:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.queued.retry"})},failedMessageCanceled:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.queued.cancel"})},lobbyRoomNavItemClicked:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.left.navigation.lobby.clicked"})},lobbyNoResults:function(e){e&&e.length&&o["default"].dispatch("analytics-event",{name:"hipchat.client.lobby.noresults",properties:{queryLength:e.length}})},lobbyFocusedWithKeyboardShortcut:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.keyboard.navigation.lobby.selected"})},quickSwitcherNoResults:function(e){e&&e.length&&o["default"].dispatch("analytics-event",{name:"hipchat.client.switcher.noresults",properties:{queryLength:e.length}})},quickSwitcherViewed:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.switcher.viewed"})},logInToAnotherTeamClicked:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.multiorg.account.another_team.clicked"})},fileUploadRequested:function(e,t,a){o["default"].dispatch("analytics-event",{name:"hipchat.client.file.uploaded."+t,properties:{fileType:e,source:a}})},roomNotificationIconClicked:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.room.notifications.icon.clicked"})},hideGifsClicked:function(e,t){o["default"].dispatch("analytics-hide-gifs",{oldVal:e,newVal:t})},privateRoomNotificationClicked:function(e,t){o["default"].dispatch("analytics-room-notification-setting",{name:"hipchat.client.settings.notifications.privateroom",props:{oldVal:e,newVal:t}})},openRoomNotificationClicked:function(e,t){o["default"].dispatch("analytics-room-notification-setting",{name:"hipchat.client.settings.notifications.openroom",props:{oldVal:e,newVal:t}})},lightThemeSelected:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.settings.appearance.theme.light"})},darkThemeSelected:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.settings.appearance.theme.dark"})},tighterTextDensitySelected:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.settings.appearance.textdensity.tighter"})},normalTextDensitySelected:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.settings.appearance.textdensity.normal"})},classicChatViewSelected:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.settings.appearance.chatview.classic"})},classicNeueChatViewSelected:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.settings.appearance.chatview.classicneue"})},fullNamesNameDisplaySelected:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.settings.appearance.namedisplay.fullnames"})},mentionNamesNameDisplaySelected:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.settings.appearance.namedisplay.mentionname"})},animatedAvatarsSelected:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.settings.appearance.avatars.animated"})},staticAvatarsSelected:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.settings.appearance.avatars.static"})},generalSettingsPanelSelected:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.settings.general.clicked"})},notificationsSettingsPanelSelected:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.settings.notifications.clicked"})},appearanceSettingsPanelSelected:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.settings.appearance.clicked"})},roomNotificationDropdownClicked:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.room.notifications.dropdown.clicked"})},roomNotificationLevelChanged:function(e,t){o["default"].dispatch("analytics-event",{name:"hipchat.client.room.notifications.level.changed",properties:{oldValue:e,newValue:t}})},globalNotificationLevelChanged:function(e,t){o["default"].dispatch("analytics-event",{name:"hipchat.client.global.notifications.level.changed",properties:{oldValue:e,newValue:t}})},handleLaunchToActiveChatList:function(e){o["default"].dispatch("performance-timing:analytics-launch-to-active-chat-list",{size:_.get(e,"size")})},handleLaunchToChat:function(e){o["default"].dispatch("performance-timing:analytics-launch-to-chat",{size:_.get(e,"size")})},handleLaunchToChatComplete:function(e){o["default"].dispatch("performance-timing:analytics-launch-to-chat-complete",{jid:_.get(e,"jid"),id:_.get(e,"id")})},roomIntegrationsDropdownClicked:function(e){o["default"].dispatch("analytics-event",{name:"hipchat.client.room.integrations.dropdown.clicked",properties:{hasWarningIcon:e}})},roomIntegrationsLinkClicked:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.room.integrations.link.clicked"})},roomIntegrationsGlanceClicked:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.room.integrations.glance.clicked"})},roomIntegrationsGlanceDismissed:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.room.integrations.glance.dismissed"})},tryToReconnectFromHeader:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.reconnection.header.try.again.button.clicked"})},connectionUIStateOffline:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.connection.ui.offline"})},connectionUIStateConnecting:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.connection.ui.connecting"})},connectionUIStateConnectDelay:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.connection.ui.connectdelay"})},connectionUIStateCannotConnect:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.connection.ui.cannotconnect"})},editProfileClicked:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.top.navigation.profile.editProfile.clicked"})},searchInputClicked:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.search.clicked"})},searchInputSubmitted:function(e){var t=void 0;u["default"].jid.is_chat(e)?t=u["default"].room.detect_chat_type(e):u["default"].jid.is_lobby(e)||"all"===e?t="all":e&&("muc"===e?t="allroom":"1-1"===e?t="allpeople":0===e.indexOf("rid")?t="groupchat":0===e.indexOf("uid")&&(t="chat")),o["default"].dispatch("analytics-event",{name:"hipchat.client.search.submit",properties:{type:t}})},chatRoomMentionClicked:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.chat.room.mention.clicked"})},inviteToRoomRightSidebarClicked:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.lobby.invite.room.righticon.clicked"})},roomMenuInviteClicked:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.lobby.room.menu.invite.clicked"})},inviteUsersToRoomSent:function(e,t){var a=void 0;e===r["default"].ROOM_MENU&&(a="hipchat.client.lobby.room.menu.invite.sent"),e===r["default"].RIGHT_SIDEBAR&&(a="hipchat.client.lobby.invite.room.righticon.sent"),a&&o["default"].dispatch("analytics-event",{name:a,properties:{numInvites:t}})},inviteTeamSent:function(e,t){var a=void 0;e===r["default"].LOBBY?a="hipchat.client.lobby.invite.sent":r["default"].TOP!==e&&r["default"].LEFT!==e||(a="hipchat.client."+e+".navigation.invite.team.sent"),a&&o["default"].dispatch("analytics-event",{name:a,properties:{numInvites:t}})},slashCommandUsed:function(e){var t=e.room,a=e.slashUsed;o["default"].dispatch("analytics-event",{name:"hipchat.client.slash.used",properties:{slashUsed:a,room:t}})},slashCommandUsedInAutocomplete:function(e){var t=e.room,a=e.slashUsed;o["default"].dispatch("analytics-event",{name:"hipchat.client.slash.used.autocompleted",properties:{slashUsed:a,room:t}})},userInviteURLCopied:function(){o["default"].dispatch("analytics-event",{name:"hipchat.client.user.inviteURL.copied"})}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(136),o=n(i),s=(0,o["default"])({ROOM_MENU:"room-menu",RIGHT_SIDEBAR:"right-sidebar",LOBBY:"lobby",INVITE_USERS_DIALOG:"invite_users_dialog",QUICK_SWITCHER:"quick_switcher",LEFT:"left",TOP:"top"});t["default"]=s,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DIALOG_CLICK="dialog-button-click",t.DIALOG_FILTER_CHANGED="dialog-filter-changed",t.RECEIVE_PARAMETERS="receive-parameters",t.GLANCE_UPDATE="glance-update",t.MESSAGE_RECEIVED="message-received"},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(59),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(9),d=n(c),f=a(173),h=n(f),p=a(99),m=n(p),g=a(200),v=n(g),y=a(159),b=n(y),w=a(201),R=n(w),k=a(90),E=n(k),C=function(){function e(t){(0,r["default"])(this,e);var a=_.get(t,"is_guest",!1);this.deferredReady=function(){return new o["default"](function(e){d["default"].dispatch("app-state-ready"),e()})},this.__reset(),this.storedRequiredStanzas=[],this.requiredStanzas=[],this.setRequiredStanzas(a)}return(0,u["default"])(e,[{key:"setRequiredStanzas",value:function(e){var t;t=e?["http://hipchat.com/protocol/emoticons"]:["jabber:iq:roster","http://jabber.org/protocol/disco#items","http://hipchat.com/protocol/emoticons"],this.requiredStanzas=this.requiredStanzas.concat(t)}},{key:"addRequiredStartupStanza",value:function(){this.requiredStanzas.unshift("http://hipchat.com/protocol/startup")}},{key:"handleIQ",value:function(e,t){var a=this;_.forEach(m["default"].toArray(e),function(e){e.query&&a.handleOrStoreStanza(e,t)})}},{key:"handleStanza",value:function(e,t){switch(e.query.xmlns){case"jabber:iq:roster":E["default"].debug("Roster Received",{verbose:e}),_.has(e,"query.item")&&("set"!==e.type||this.__isReady())?t.handleRoster(e.query.item):E["default"].debug("Roster Update Skipped",{verbose:e});break;case"http://jabber.org/protocol/disco#info":var a={jid:e.from,name:_.get(e,"query.identity.name"),x:_.get(e,"query.x")};t.handleRooms(a);break;case"http://jabber.org/protocol/disco#items":E["default"].debug("Rooms List Received",{verbose:e}),_.has(e,"query.item")&&t.handleRooms(e.query.item);break;case"http://hipchat.com/protocol/profile":t.handleProfile(e);break;case"http://hipchat.com/protocol/emoticons":E["default"].debug("Emoticons Received",{verbose:e}),_.has(e,"query")&&t.handleEmoticons(e.query,e.type);break;case"http://hipchat.com/protocol/muc#room":_.has(e,"query.item")&&("set"!==e.type||this.__isReady())&&t.determineRoomUpdate(e.query.item);break;case"http://hipchat.com/protocol/integrations":this.__handleIntegrations(e);break;case"http://hipchat.com/protocol/integrations#ui":this.__handleIntegrationsUiPush(e);break;case"http://hipchat.com/protocol/startup":t.handleStartupIQAutoJoin([].concat(_.get(e,"query.preferences.autoJoin.item",[]))),b["default"].updateAppConfiguration(new R["default"](e.query)),h["default"].dispatch("analytics-start-iq-response-received");break;default:return!0}}},{key:"handleOrStoreStanza",value:function(e,t){return this.allRequiredStanzasProcessed?void this.handleStanza(e,t):void(!this.allRequiredStanzasProcessed&&_.includes(this.requiredStanzas,e.query.xmlns)&&"set"!==_.get(e,["type"])?e.error?(0,v["default"])(e):(this.storedRequiredStanzas.push(e),this.receivedRequiredStanzas[e.query.xmlns]=!0,this.allRequiredStanzasProcessed=this.allRequiredStanzasArrived(),this.allRequiredStanzasProcessed&&(this.flushRequiredStanzas(t),this.flushNonRequiredStanzas(t),this.deferredReady()["catch"](function(e){E["default"].type("iq-processor").withCallStack().error(e),E["default"].error(e),h["default"].dispatch("analytics-event",{name:"hipchat.client.load.error",properties:{errorMessage:e.message,errorName:e.name,errorDescription:e.description,errorStack:e.stack}})}))):this.queueStanza(e))}},{key:"flushRequiredStanzas",value:function(e){var t=this,a=function(a){var n=_.find(t.storedRequiredStanzas,function(e){return _.get(e,["query","xmlns"])===a});t.handleStanza(n,e),_.pull(t.storedRequiredStanzas,n)};_.every(this.requiredStanzas,function(e){return"http://hipchat.com/protocol/startup"===e?(d["default"].registerOnce("after:updated:config",function(){_.each(t.requiredStanzas,function(e){a(e)})}),a(e),_.pull(t.requiredStanzas,e),!1):(a(e),!0)})}},{key:"flushNonRequiredStanzas",value:function(e){var t=this;_.each(this.otherStanzas,function(a){t.handleStanza(a,e)}),this.otherStanzas=[]}},{key:"queueStanza",value:function(e){this.otherStanzas.push(e)}},{key:"allRequiredStanzasArrived",value:function(){var e=this;return _.every(this.requiredStanzas,function(t){return e.receivedRequiredStanzas[t]})}},{key:"__reset",value:function(){this.allRequiredStanzasProcessed=!1,this.receivedRequiredStanzas={},this.otherStanzas=[],this.storedRequiredStanzas=[],this.requiredStanzas=[]}},{key:"__isReady",value:function(){return this.allRequiredStanzasProcessed}},{key:"__handleIntegrations",value:function(e){if("set"===e.type){var t=e.query.__text;"string"==typeof t&&(t=JSON.parse(t)),d["default"].dispatch("integration-update",t)}}},{key:"__handleIntegrationsUiPush",value:function(e){if("set"===e.type){var t=e.query.__text;"string"==typeof t&&(t=JSON.parse(t));var a=t.glance;d["default"].dispatch("glance-metadata-pushed",m["default"].toArray(a))}}}]),e}();e.exports=C},function(e,t,a){"use strict";var n=a(9),i=["500","403"];e.exports=function(e){e.error&&e.error.code&&_.includes(i,e.error.code)&&n.dispatch("general-error",e)}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var a=/((_\d+)?(\.\w{3,4}))$/;return t&&_.isString(t)?t.replace(a,"_125$3"):_.isString(e)?e.replace(a,"_125$3"):e}function o(e){return _.transform(e,function(e,t,a,n){switch(a){case"access_token":e.oauth_token=t;break;case"expires_in":e.oauth_token_expires_in=1e3*(t+5);break;case"token":var o=parseInt(t.expiration,10),s=parseInt(t.ttl,10),r=1e3*(o-s),l=(new Date).getTime();l>r&&(l=r,v["default"].warn("Local date might be wrong. Server date:",new Date(r))),e.apiv1_token=t.token||t.__text,e.apiv1_token="false"===e.apiv1_token?null:e.apiv1_token,e.apiv1_token_expires_in=1e3*o-l+5e3;break;case"user_id":case"group_id":case"addlive_app_id":case"room_id":e[a]=parseInt(t,10);break;case"group_invite_url":e.invite_url=t;break;case"is_admin":case"is_guest":case"video_chat_enabled":case"private_rooms_enabled":case"guest_access_enabled":case"html5_routing_enabled":case"log_to_file":e[a]=h["default"].coerceBoolean(t);break;case"prefs":case"preferences":e.preferences=new m["default"](t,!0);break;case"features":e.features=_.transform(t,function(e,t,a){e[a]=h["default"].coerceBoolean(t)});break;case"feature_flags":e.feature_flags=h["default"].features.reconcileFeatureFlags(n.native_feature_flags||{},t);break;case"native_feature_flags":e.native_feature_flags=_.isObject(t)?t:{};break;case"display_name":e.display_name=_.isString(t)?t:"";break;case"mention_name":e.mention=t;break;case"name":e.user_name=t;break;case"video_chat_uri":e.video_chat_uri=t;break;case"video_base_url":e.video_base_url=t;break;case"group_avatar_url":case"group_absolute_avatar_url":e.group_avatar_url=i(n.group_avatar_url,n.group_absolute_avatar_url);break;case"xmlns":case"anonymous":case"el":case"minimal":case"mobile":case"vertical_tabs":case"welcome_msg":case"onRefreshOAuthAccessToken":case"source_json":case"plan":case"state":case"token_type":break;default:e[a]=t}})}Object.defineProperty(t,"__esModule",{value:!0});var s=a(148),r=n(s),l=a(52),u=n(l),c=a(4),d=n(c),f=a(99),h=n(f),p=a(165),m=n(p),g=a(90),v=n(g),y=function b(){var e=arguments.length<=0||void 0===arguments[0]?(0,u["default"])(null):arguments[0];(0,d["default"])(this,b),(0,r["default"])(this,o(e))};t["default"]=y,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(4),o=n(i),s=a(5),r=n(s),l=a(9),u=n(l),c=a(99),d=n(c),f=function(){function e(t){(0,o["default"])(this,e),this.processorData=t,this.queued=[],this.ready=!1,this.subscribeToEvents()}return(0,r["default"])(e,[{key:"subscribeToEvents",value:function(){var e=this;u["default"].registerOnce("app-state-ready",function(){e.ready=!0,e.handlePresence(e.queued),e.queued=[]})}},{key:"update",value:function(e){this.processorData=null,this.processorData=e}},{key:"handlePresence",value:function(e){var t=d["default"].toArray(e);if(this.ready)if(this.processorData.is_guest)this.handlePresencesForGuest(t);else{var a=_.groupBy(t,function(e){return d["default"].jid.is_room(d["default"].jid.bare_jid(e.from))?"room":"global"});this.handleRoomPresences(a.room),this.handleGlobalPresences(a.global)}else this.queued=this.queued.concat(t)}},{key:"handlePresencesForGuest",value:function(e){var t=this;_.forEach(e,function(e){e.x=d["default"].toArray(e.x),t._handleUser(e),t.roomToGlobalPresence(e)}),this.handleGlobalPresences(e)}},{key:"_handleUser",value:function(e){var t=_.get(e.x[0],"item");if(t){var a=d["default"].jid.bare_jid(e.from);"unavailable"===e.type?this._handleUnavailableUser(e,t):"participant"===t.role?this.addRoomParticipant(a,d["default"].jid.bare_jid(t.jid),d["default"].jid.resource(e.from),e):"visitor"===t.role&&this.addRoomVisitor(a,d["default"].jid.bare_jid(t.jid),d["default"].jid.resource(e.from),t.mention_name,e)}}},{key:"_handleUnavailableUser",value:function(e,t){var a=d["default"].jid.bare_jid(e.from);this._isAddresseeCurrentUser(e,t)&&this._hasNotAffiliation(e,t)?this.revokeGuestAccess():this.removeRoomParticipant(a,d["default"].jid.bare_jid(t.jid),t.role,e.status)}},{key:"_isAddresseeCurrentUser",value:function(e,t){var a=d["default"].jid.bare_jid(e.to);return a===t.jid}},{key:"_hasNotAffiliation",value:function(e,t){var a=_.get(e.x[0],"status");return a&&307===Number(a.code)&&"none"===t.affiliation}},{key:"roomToGlobalPresence",value:function(e){e.x=d["default"].toArray(e.x),e.from=_.get(e,"x[0].item.jid",e.from)}},{key:"handleRoomPresences",value:function(e){var t,a=this;_.map(e,function(e){if(t=d["default"].jid.bare_jid(e.from),e.x){if(e.x=d["default"].toArray(e.x),e.x[0].item){var n=e.x[0].item;"unavailable"!==e.type||!_.isString(e.status)||"member"!==n.affiliation&&"owner"!==n.affiliation?e.x[0].status&&307===Number(e.x[0].status.code)&&"none"===n.affiliation?n.actor&&d["default"].jid.bare_jid(n.actor.jid)===n.jid?u["default"].dispatch("close-room",{jid:t}):u["default"].dispatch("user-removed",{room:t,user_jid:d["default"].jid.bare_jid(n.jid),role:n.role}):"visitor"===n.role?a.addRoomVisitor(t,d["default"].jid.bare_jid(n.jid),d["default"].jid.resource(e.from),n.mention_name,e):n&&n.jid&&u["default"].dispatch("room-presence-received",{room:t,user_jid:d["default"].jid.bare_jid(n.jid),user_id:d["default"].jid.user_id(n.jid),role:n.role,affiliation:n.affiliation,type:e.type||""}):a.removeRoomParticipant(t,d["default"].jid.bare_jid(n.jid),n.role,e.status)}}else"error"===e.type&&e.error&&(u["default"].dispatch("show-flag",{type:"error",title:e.error.text.__text,close:"auto"}),u["default"].dispatch("close-room",{jid:t,type:"room",doNotNotifyHC:!0}))})}},{key:"handleGlobalPresences",value:function(e){var t=this,a={};_.forEach(e,function(e){var n=d["default"].jid.bare_jid(e.from),i=e.query?e.query.seconds:!1,o=e.delay?e.delay.stamp:!1,s=t.getState(e);(t.processorData.current_user_jid!==n||"mobile"!==s&&"unavailable"!==s)&&(a[n]={show:s,status:e.status||"",seconds:i||"",idleTime:t.getIdleTime(i,o)})}),_.size(a)>0&&u["default"].dispatch("global-presence-received",a)}},{key:"getState",value:function(e){return e.type&&"unavailable"===e.type&&e.mobile?"mobile":e.type&&"unavailable"===e.type&&!e.mobile?"unavailable":e.show?e.show:"chat"}},{key:"getIdleTime",value:function(e,t){var a="";if(t&&e){var n=d["default"].getMoment(),i=n-(d["default"].getMoment(t)-e);a=d["default"].user.format_idle_time(i)}return a}},{key:"revokeGuestAccess",value:function(){u["default"].dispatch("guest-access-revoked")}},{key:"addRoomParticipant",value:function(e,t,a,n){u["default"].dispatch("add-room-participant",{room:e,user_jid:t,user_name:a,presence:{show:this.getState(n),status:n.status||""}})}},{key:"removeRoomParticipant",value:function(e,t,a,n){u["default"].dispatch("remove-room-participant",{room:e,participant:t,role:"visitor"===a?"guests":"members",status:n||""})}},{key:"addRoomVisitor",value:function(e,t,a,n,i){u["default"].dispatch("add-room-visitor",{room:e,participant:t,user_name:a,user_mention:n,presence:{show:this.getState(i),status:i.status||""}})}}]),e}();e.exports=f},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(183),o=n(i);t["default"]={create_room:"Create room",delete_room:"Delete room",disable_guest:"Disable guest access",join:"Join room",ok:"Ok",OK:"OK",save:"Save","delete":"Delete",close:"Close",cancel:"Cancel",apply:"Apply",rename:"Rename",try_again:"Try again",archive:"Archive",archive_room:"Archive room",unarchive:"Unarchive",unarchive_room:"Unarchive room",confirm_archive:"This will prevent any people from chatting in the room.",confirm_disable_guest:"The room URL will be disabled and current guests will be kicked from the room",confirm_delete:function(e){return"Are you sure you want to delete "+e+"?"},room_deleted:function(e){return e+" deleted."},room_archived:"Room archived.",room_unarchived:"Room unarchived.",archive_room_name:function(e){return"Archive "+e},unarchive_room_name:function(e){return"Unarchive "+e},really_archive:function(e){return"Are you sure you want to archive the "+e+" room?"},really_unarchive:function(e){return"Are you sure you want to unarchive the "+e+" room?"},really_disable_guest:"Are you sure you want to disable guest access?",invite_users:function(e){return"Invite people to "+e},choose_removed_members:"Remove people",join_room:function(e){return"Join "+e},rename_room:function(e){return"Rename "+e},invited_to_join:function(e,t){return e+" invited you to join "+t},disable_guest_fail:"Couldn't disable guest access.",enable_guest_fail:"Couldn't enable guest access.",archive_fail:"Couldn't archive room.",unarchive_fail:"Couldn't unarchive room.",delete_room_fail:"Couldn't delete room.",set_privacy:"Set privacy",notify_for_room:"A message is sent to an open room I'm in",notify_for_private_room:"A message is sent to a private room I'm in",notify_for_tag:"I'm mentioned in a room",notify_for_private:"I receive a private message",play_sound_part_1:"Play sound for",play_sound_part_2:"notifications",basic_play_sound:"Play sound for new messages",message_notifications:"message",video_notifications:"video",message_and_video_notifications:"message and video",show_toasters:"Show a popup",hide_presence_messages:"Show joined/left room messages",use_24_hour_format:"Display time in 24-hour format",hide_gifs_by_default:"Hide gifs by default",hide_attached_cards_by_default:"Hide inline previews by default",replace_text_emoticons:"Turn text emoticons into images",show_unread_divider:"Show divider for unread messages",create_a_new_room:"Create a new room",change_privacy:"Change privacy",theme:"Theme",density:"Text density",chat_view:"Chat view",name_display:"Name display",animated_avatars:"Animated avatars",names:"Name",mentions:"@mention name",light:"Light",dark:"Dark",normal:"Normal",tighter:"Tighter",classic:"Classic",classic_neue:"With avatars",animated:"Show animation","static":"Show as static images",call_from:"Call from",answer:"Answer",decline:"Decline",start_up_with_windows:"Start up with Windows",enable_spell_check:"Enable spell check",enable_autocorrect:"Correct spelling automatically",idle:"Idle",minutes:"minutes",maximum_idle_minutes:"maximum of 99",minimum_idle_minutes:"minimum of 1",keep_popups_visible:"Keeping popups visible until "+o["default"].app_name+" is focused",blink_taskbar:"Blinking the taskbar",bounce_icon:"Bounce the dock icon",bounce_icon_once:"once",bounce_icon_forever:"until I look",proxy_settings_description:function(e){return"Modify the server that "+o["default"].app_name+" connects to by using the "+e+" Proxy Settings"},proxy_settings:function(e){return e+" Proxy Settings"},title_settings:function(e){return e+" Settings"},room_notifications:"Room notifications",beta:"Beta",appearance:"Appearance",general:"General",notifications:"Notifications",connection:"Connection",notify_when_header:"Notify me when",notify_rooms_header:"Rooms",notify_for_oto_per_room_enabled:"Notify me for 1-to-1 messages",notify_for_oto:"I receive a 1-to-1 message",dnd_header:"Do not Disturb",do_not_notify_when_dnd:"Stop all notifications",do_not_notify_when_dnd_basic:"Enable notifications while status is set to Do Not Disturb",notify_when_dnd:"Send all notifications",notify_for_video_when_dnd:"Send a notification for video calls only",enable_logging:"Log additional chat data",edit_message:"Edit message",delete_message:"Are you sure? When it's gone, it's gone.",not_editable:function(e){return"It's too late to "+e+" this"},not_editable_body:function(e){return"We'd all like to re-write history, but it's been more than "+e+" hours since this message was sent."},user_joined:function(e){return e+" has joined."},user_joined_link:"Go say hi!",suggestions:"SUGGESTIONS",message:"MESSAGE",welcome_to_hipchat:"Welcome to HipChat!",choose_people_to_chat:"Choose a few people to chat with",join_some_rooms:"Join some rooms",introduce_yourself:"Introduce yourself",skip_dialog_button:"Skip",start_button:"Start",next_button:"Next",skip_this_step_button:"Skip this step",finish_and_send_button:"Finish and send message",we_ll_help_you:"We'll help you get started chatting with your team. ",this_won_t_take_long:"(This won't take long and is totally worth it.) ",lets_put_together_a_list_of_people:"Let's put together a list of a few people you might be chatting with a lot. Choose the people you'd like to meet. ",weve_got_a_few_sugg_on_rooms:"We've got a few suggestions on rooms (group chats) to start you off with. You'll discover more, of course, but this is a good place to begin. ",you_are_all_set:"You're all set. Write a message (or use ours) introducing yourself to the team. We'll post it in each room you chose. ",welcome_messages:function s(){var s=["@here Hey everybody! I'm new here. I'm sure we'll talk more real soon. Just wanted to introduce myself. ","@here Hi there, I just joined and thought I'd introduce myself. ","@here Hi everyone, I'm new here. I just wanted to say hi. Have an (awesome) day! "],e=_.random(0,s.length-1);return s[e]},got_that_person_down:"Got that 1 person down. ",got_those_people_down:function(e){return"Got those "+e+" people down. "},that_is_a_good_roome_choice:"That's a good room choice. ",those_are_some_good_roome_choices:"Those are some good room choices. ",use_here_in_tour_message:"Use @here in your message to mention everyone currently in the room. ",welcome_message_err:function(e){return"Message max length is "+e+" symbols. "}},e.exports=t["default"]},function(e,t,a){"use strict";var n=a(9),i={showFlag:function(e){n.dispatch("show-flag",e)},removeFlag:function(e){n.dispatch("remove-flag",e)},dismissAlertFlag:function(){n.dispatch("dismiss-alert-flag")}};e.exports=i},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(136),o=n(i),s=(0,o["default"])({AUTH:"hipchat.client.app.perf.auth.server",BROWSER_METRICS:"browser.metrics.app",CLIENT_CURRENT:"hipchat.client.current",CLIENT_LAUNCH:"hipchat.client.launch",CLIENT_READY:"hipchat.client.ready",CLIENT_READY_FOR_USER:"hipchat.client.app.perf.load.ready",CONNECTION_ESTABLISHED:"hc_web.hcjsclient.initial.connection.established",DOM_READY:"hipchat.client.app.perf.nav.timing.dom",INITIAL_EMOTICONS:"hipchat.client.app.perf.emoticons.initial.server",INITIAL_FETCH:"hc_web.hcjsclient.initial.data.fetch",INITIAL_IQ:"hipchat.client.app.perf.iq.initial.server",INITIAL_PRESENCE:"hipchat.client.app.perf.presence.initial.server",INITIAL_ROOMS:"hipchat.client.app.perf.rooms.initial.server",INITIAL_ROSTER:"hipchat.client.app.perf.roster.initial.server",CHAT_SENDABLE:"hipchat.client.app.perf.user.chat-sendable",CHAT_IS_COMPLETE:"hipchat.client.app.perf.user.chat-is-complete",LAUNCH_TO_ACTIVE_CHAT_LIST:"hipchat.client.app.perf.user.launch-to-active-chat-list",LAUNCH_TO_CHAT:"hipchat.client.app.perf.user.launch-to-chat",LAUNCH_TO_CHAT_COMPLETE:"hipchat.client.app.perf.user.launch-to-chat-complete",LOBBY_RENDER:"hipchat.client.app.perf.lobby.panel.render",PRODUCT:"HipChat",RECONNECTION:"hc_web.hcjsclient.reconnection",ROOM_FILES_LOAD:"hipchat.client.app.perf.room.files.load.server",ROOM_HISTORY_LOAD:"hipchat.client.app.perf.room.history.load.server",ROOM_MEMBERS_LOAD:"hipchat.client.app.perf.room.members.load.server",ROOM_RENDER:"hipchat.client.app.perf.room.render"});t["default"]=s,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(59),o=n(i),s=a(99),r=n(s),l=a(207),u=n(l),c=a(246),d=n(c),f=a(220),h=n(f),p=a(208),m=n(p),g=a(144),v=n(g),y=a(176),b=n(y),w=a(184),R=n(w),k=a(152),E=n(k),C=a(147),S=n(C),T=a(153),x=n(T),A=a(155),I=n(A),N=a(249),M=n(N),O=a(251),D=n(O),P=a(252),j=n(P),L=a(253),F=n(L),U={attemptConnect:function(){m["default"].connect()},attemptReconnect:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];m["default"].reconnect(e)},terminateChatSession:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];m["default"].disconnect(e)},sendInitialPresence:function(){var e=arguments.length<=0||void 0===arguments[0]?R["default"].AVAILABLE:arguments[0];return m["default"].Connection.Presence.sendInitialPresence(e)},setPresence:function(){var e=arguments.length<=0||void 0===arguments[0]?R["default"].AVAILABLE:arguments[0],t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return m["default"].Connection.Presence.setPresence(e,t)},joinRoom:function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],a=arguments.length<=2||void 0===arguments[2]?!0:arguments[2];return m["default"].Connection.Rooms.join(e,t,null,a)},joinChat:function(e){var t=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1];u["default"].joinChat(e,t)},joinRooms:function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],a=e.reduce(function(e,a){return r["default"].jid.is_room(a.jid)?e.push(m["default"].Connection.Rooms.join(a.jid,t)):u["default"].joinChat(a.jid),e},[]);return o["default"].all(a)},leaveRoom:function(e,t){return"groupchat"===t?m["default"].Connection.Rooms.leave(e):(u["default"].sendStateMessage(e,t,"gone"),o["default"].resolve())},fetchParticipants:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];return h["default"].fetchRoomParticipants(e,t)},fetchProfile:function(e){var t=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1];u["default"].fetchUserProfile(e,t)},fetchHistory:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?50:arguments[2],n=arguments[3],i=arguments.length<=4||void 0===arguments[4]?_.noop:arguments[4];
u["default"].fetchHistory(e,t,a,n,i)},fetchRecentHistory:function(e){var t=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1];"user"===e.path.type?d["default"].user.recent_history(e,t):d["default"].room.recent_history(e,t)},fetchFiles:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1],a=arguments.length<=2||void 0===arguments[2]?null:arguments[2],n=arguments.length<=3||void 0===arguments[3]?50:arguments[3];return m["default"].Connection.Chat.getFiles(e,t,a,n)},fetchLinks:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1],a=arguments.length<=2||void 0===arguments[2]?null:arguments[2],n=arguments.length<=3||void 0===arguments[3]?50:arguments[3];return m["default"].Connection.Chat.getLinks(e,t,a,n)},fetchPresences:function(e){var t=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1];u["default"].fetchPresence(e,t)},filterPresences:function(e){return m["default"].Connection.Presence.filterPresences(e)},sendMessage:function(e){u["default"].sendMessage(e)},editMessage:function(e,t,a,n){u["default"].editMessage(e,t,a,n)},deleteMessage:function(e){u["default"].deleteMessage(e)},sendStateMessage:function(e,t,a){u["default"].sendStateMessage(e,t,a)},sendVideoMessage:function(e){var t=arguments.length<=1||void 0===arguments[1]?"call":arguments[1],a=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],n=arguments[3],i=arguments[4],o=arguments.length<=5||void 0===arguments[5]?_.noop:arguments[5],s=arguments[6];u["default"].sendVideoMessage({jid:e,type:t,audioOnly:a,url:n,service:i,callback:o,reason:s})},sendEnsoInviteMessage:function(e,t){var a='<a href="'+t+'" data-target-options="enso_invite">'+b["default"].join_video_call_message+"</a>";d["default"].user.send_private_message({path:{identifier:r["default"].jid.user_id(e)},params:{message:a,notify:!1,message_format:"html"}})},sendFileMessage:function(e,t){return r["default"].jid.is_private_chat(e)?d["default"].user.share_file(t):d["default"].room.share_file(t)},requestAddliveCredentials:function(e){var t=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1];u["default"].requestAddliveCredentials(e,t)},clearWebCookies:function(){var e=arguments.length<=0||void 0===arguments[0]?_.noop:arguments[0];u["default"].clearWebCookies(e)},updateAPIV1Token:function(){return m["default"].updateApiV1Token()},revokeOauth2Token:function(){var e=arguments.length<=0||void 0===arguments[0]?_.noop:arguments[0];u["default"].revokeOauth2Token(e)},inviteUsersToRoom:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?_.noop:arguments[2];u["default"].inviteUsersToRoom(e,t,a)},removeUsersFromRoom:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?_.noop:arguments[2];u["default"].removeUsersFromRoom(e,t,a)},savePreferences:function(e){var t=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1];u["default"].savePreferences(e,t)},fetchReadstate:function(){u["default"].readstate.fetch()},updateReadstate:function(e){u["default"].readstate.update(e)},removeReadstate:function(e){u["default"].readstate.remove(e)},retryReadstate:function(){u["default"].readstate.retry()},resetReadstate:function(){u["default"].readstate.reset()},syncIntegrations:function(e){var t=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1];d["default"].integrations.sync(e,t)},getSignedUrl:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?_.noop:arguments[2];d["default"].integrations.getSignedUrl(e,t,a)},requestWithSignedUrl:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?_.noop:arguments[2];d["default"].integrations.requestWithSignedUrl(e,t,a)},fetchAllGlancesForRoom:function(e){var t=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1];d["default"].integrations.fetchAllGlancesForRoom(e,t)},fetchSignedFile:function(e){return h["default"].fetchSignedFile(e)},fetchSignedThumbnailCollection:function(e){return h["default"].fetchSignedThumbnailCollection(e)},checkNetwork:function(){return h["default"].checkNetwork()},isConnected:function(){return m["default"].isConnected()},fetchVideoToken:function(e,t){return h["default"].fetchVideoToken(e,t)},fetchAlertFlag:function(){return h["default"].fetchAlertFlag()},dismissAlertFlag:function(e){return h["default"].dismissAlertFlag(e)},fetchReadOnlyContent:function(){return h["default"].fetchReadOnlyContent()}};U.User=M["default"],U.Cache=v["default"],U.Room=D["default"],U.Emoticon=j["default"],U.Connection=F["default"],U.Models={Room:x["default"],User:E["default"],Emoticon:I["default"],DALError:S["default"]},t["default"]=U,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(91),s=i(o),r=a(4),l=i(r),u=a(5),c=i(u),d=a(99),f=i(d),h=a(163),p=n(h),m=a(90),g=i(m),v=a(208),y=i(v),b=a(243),w=i(b),R=a(169),k=i(R),E=a(213),C=i(E),S=a(9),T=i(S),x=a(176),A=i(x),I=function(){return{}},N=function(e){return null===e||void 0===e},M=function(){function e(){var t=this;(0,l["default"])(this,e),this.cached_profiles={},this.savePrefsAttempts=0,this.savePrefsRetryDelay=p.RECONNECT_DELAY_MS,this.readstate=new w["default"]({fetchCallback:function(e,t){T["default"].dispatch("DAL:readstate-fetched",e,t)},patchCallBack:function(e,t){T["default"].dispatch("DAL:readstate-patched",e,t)}}),T["default"].registerOnce({"DAL:cache-configured":function(){t.readstate.loadStorage()}}),this.parsedCallback=function(e,t,a){return"function"==typeof t&&(a=t,t=!1),a(e),!t},this.sendIQ=function(e,a){return y["default"].sendIQ(e.tree(),function(e){return t.parsedCallback(C["default"].xml2json(e),a)},function(e){return t.parsedCallback(C["default"].xml2json(e),a)})},this.subscribe=function(e,a,n,i){var o,s,r,l;switch(N(a)&&(a=!1),N(n)&&(n=null),e){case"roomChange":e="iq",l="set",r="http://hipchat.com/protocol/muc#room";break;case"presenceError":e="presence",l="error",r="http://jabber.org/protocol/muc#room";break;case"joinRoom":e="presence",l=null,r=null;break;case"videoMessage":e="message",l=null,r=null;default:l=null,r=null}return n&&(s=n.id,o=n.from),y["default"].addHandler(function(e){var n=C["default"].xml2json(e);return t.parsedCallback(n,a,i)},r,e,l,s,o)},this.toXMPPDate=function(e){return"string"==typeof e?e:new Date(e.setMilliseconds(0)).toISOString().replace(/\.000/,"")},this.getJidType=function(e){var t;return t=new RegExp(k["default"].get("conference_server")),t.test(e)?"groupchat":"chat"}}return(0,c["default"])(e,[{key:"on",value:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?I:arguments[2];return"function"==typeof t&&(a=t,t=null),this.subscribe(e,!1,t,a)}},{key:"once",value:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?I:arguments[2];return"function"==typeof t&&(a=t,t=null),this.subscribe(e,!0,t,a)}},{key:"off",value:function(e){return y["default"].deleteHandler(e)}},{key:"fetchPresence",value:function(e){var t,a=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1];return N(e)&&(e=[]),Array.isArray(e)||(e=[e]),t=$iq({type:"get"}).c("query",{xmlns:"http://hipchat.com/protocol/presence"}),e.forEach(function(e){return t.c("uid",e).up()}),this.sendIQ(t,a)}},{key:"inviteUsersToRoom",value:function(e,t,a,n){var i,o;return N(t)&&(t=[]),N(a)&&(a=""),N(n)&&(n=null),Array.isArray(t)||(t=[t]),i={to:e,id:1e7*Math.random()|0},null!==n&&(i.id=n),o=$msg(i).c("x",{xmlns:"http://jabber.org/protocol/muc#user"}),t.forEach(function(e){return o.c("invite",{to:e}),o.c("reason"),o.t(a),o.up(),o.up()}),y["default"].send(o.tree())}},{key:"removeUsersFromRoom",value:function(e,t){var a,n=arguments.length<=2||void 0===arguments[2]?_.noop:arguments[2];return N(t)&&(t=[]),Array.isArray(t)||(t=[t]),g["default"].info("Removing users from room - room_jid: "+e+", user_jids: "+t),a=$iq({type:"set",to:e}).c("query",{xmlns:"http://hipchat.com"}),t.forEach(function(e){return a.c("item",{jid:e,affiliation:"none"}),a.up()}),this.sendIQ(a,n)}},{key:"fetchHistory",value:function(e,t,a,n,i){var o,s;return N(a)&&(a=50),k["default"].isGuest()?!1:(g["default"].info("Getting history - jid: "+e),o={xmlns:"http://hipchat.com/protocol/history",maxstanzas:a,type:this.getJidType(e)},N(t)||(o.before=this.toXMPPDate(t)),s=$iq({type:"get",to:e,id:n}).c("query",o),this.sendIQ(s,i))}},{key:"fetchUserProfile",value:function(e){var t,a=this,n=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1];return e?this.cached_profiles[e]&&n?void n(this.cached_profiles[e]):(g["default"].info("Fetching profile - jid: "+e),t=$iq({type:"get",to:e}).c("query",{xmlns:"http://hipchat.com/protocol/profile"}),this.sendIQ(t,function(t){return t.error||(a.cached_profiles[e]=t),n?n(t):void 0})):void 0}},{key:"joinChat",value:function(e){arguments.length<=1||void 0===arguments[1]?I:arguments[1];return this.sendStateMessage(e,"chat","active")}},{key:"sendMessage",value:function(e){var t,a;return t={to:e.jid,type:this.getJidType(e.jid),id:1e7*Math.random()|0},null!==e.id&&(t.id=e.id),a=$msg(t).c("body").t(e.text).up(),"chat"===t.type&&(t.from=k["default"].get("jid"),a.c("active",{xmlns:"http://jabber.org/protocol/chatstates"}).up().c("x",{xmlns:"http://hipchat.com"}).c("echo").up().up()),e.xhtml&&a.c("html").c("body").c("p").h(e.xhtml),y["default"].send(a.tree())}},{key:"editMessage",value:function(e,t,a,n,i){var o,s;return N(i)&&(i=null),o={to:e,type:this.getJidType(e),from:k["default"].get("jid"),id:1e7*Math.random()|0},null!==i&&(o.id=i),s=$msg(o).c("body").t(t).up(),s.c("replace",{xmlns:"urn:xmpp:message-correct:0",id:a,ts:n}).up().c("x",{xmlns:"http://hipchat.com"}).c("echo"),y["default"].send(s.tree())}},{key:"deleteMessage",value:function(e){return this.editMessage(e.from,"",e.mid,e.ts)}},{key:"sendStateMessage",value:function(e,t,a){var n,i;return n={to:e,type:t,id:1e7*Math.random()|0},i=$msg(n).c(a,{xmlns:"http://jabber.org/protocol/chatstates"}).up(),y["default"].send(i.tree())}},{key:"savePreferences",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],a=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1],n=k["default"].get("apiv1_token");if(n&&!k["default"].get("is_guest")&&y["default"].isConnected()&&(_.has(t,"autoJoin")&&(Array.isArray(t.autoJoin)?t.autoJoin=_.reduce(t.autoJoin,function(e,t){return _.isPlainObject(t)&&!_.isEmpty(t)&&e.push(t),e},[]):delete t.autoJoin),!_.isEmpty(t))){var i;return $.ajax({type:"POST",dataType:"json",url:k["default"].get("base_url")+"/api/save_preferences",data:{json:(0,s["default"])(_.omitBy(t,_.isNull)),user_id:k["default"].get("user_id"),group_id:k["default"].get("group_id"),token:n,format:"json"},async:!0,complete:function(t){try{i=JSON.parse(t.responseText),i.error&&"Invalid token"===i.error?y["default"].updateApiV1Token().then(function(){e.savePrefsAttempts++,e.savePrefsAttempts<=5&&(e.savePrefsRetryDelay=f["default"].decorrelatedJitter(p.RECONNECT_MAX_DELAY,p.RECONNECT_DELAY_MS,e.savePrefsRetryDelay,p.RECONNECT_BACKOFF_FACTOR),_.delay(e.savePreferences.bind(e),e.savePrefsRetryDelay))}):(e.savePrefsAttempts=0,a())}catch(n){g["default"].warn("[API V1 response structure:] "+t.responseText),a(t.responseText)}}})}}},{key:"sendUploadMessage",value:function(e){var t,a,n;return y["default"].isConnected()?(a=C["default"].xml2json(e.file_info),t={to:e.jid,type:e.type},n=$msg(t).c("x",{xmlns:"http://hipchat.com/protocol/muc#room"}).c("file",{id:a.response.file_id}).up().up(),"groupchat"!==e.type&&n.c("x",{xmlns:"http://hipchat.com"}).c("echo").up().up(),y["default"].send(n.tree())):!1}},{key:"clearWebCookies",value:function(){var e=arguments.length<=0||void 0===arguments[0]?_.noop:arguments[0],t=f["default"].url.clearWebCookies(k["default"].get("web_server"));t&&f["default"].request.simplePost(t,e)}},{key:"revokeOauth2Token",value:function(){var e=arguments.length<=0||void 0===arguments[0]?_.noop:arguments[0],t=k["default"].getOAuthToken(),a=f["default"].url.revokeOauth2Token(k["default"].get("api_host"),t);$.ajax({type:"DELETE",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+t)},url:a,async:!0,success:function(t){e(t)},error:function(t){e(t)}})}},{key:"requestAddliveCredentials",value:function(e){var t,a,n,i=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1];return n=$iq({to:e,type:"get"}).c("query",{xmlns:"http://hipchat.com/protocol/addlive"}),t=function(e){return e=C["default"].xml2json(e),i(null,e.query)},a=function(e){return e=C["default"].xml2json(e),i(e.error)},y["default"].sendIQ(n,t,a)}},{key:"sendVideoMessage",value:function(){var e=void 0,t=arguments.length<=0?void 0:arguments[0],a=t.type,n=void 0,i=1e7*Math.random()|0;return N(t.type)&&(a="call"),y["default"].isConnected()?(e={to:t.jid,type:this.getJidType(t.jid),from:k["default"].get("user_jid"),id:i},n=$msg(e).c("x",{xmlns:"http://hipchat.com/protocol/"+t.service}).c(a),"enso"===t.service?"call"===a?(n.c("url").t(t.url),n.up().up().up().c("body").t(A["default"].enso_to_addlive(t.url.replace("/join/","/call/")))):"decline"===a&&n.c("reason").t(t.reason):(n.c("audio").up(),t.audio_only||n.c("video")),this.once("videoMessage",{id:i},t.callback),y["default"].send(n.tree())):!1}}]),e}();t["default"]=new M,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(91),s=i(o),r=a(59),l=i(r),u=a(4),c=i(u),d=a(5),f=i(d),h=a(145),p=i(h),m=a(163),g=n(m),v=a(209),y=i(v),b=a(206),w=i(b),R=a(99),k=i(R),E=a(90),C=i(E),S=a(210),T=i(S),x=a(213),A=i(x),I=a(169),N=i(I),M=a(159),O=i(M),D=a(201),P=i(D),j=a(215),L=i(j),F=a(216),U=i(F),H=a(230),B=i(H),z=a(231),q=i(z),V=a(233),G=i(V),W=a(234),Y=i(W),K=a(235),X=i(K),J=a(238),Q=i(J),Z=a(239),ee=i(Z),te=a(240),ae=i(te),ne=a(173),ie=i(ne),oe=a(144),se=i(oe),re=(0,p["default"])("HJC.Connection.Manager.State"),le="[Connection]",ue=function(){function e(){var t=this;(0,c["default"])(this,e),this[re]={isInitialConnect:!0,connected:!1,shouldReconnect:!0,isRefreshOAuthTokenInFlight:!1,isSessionRequestInFlight:!1,reconnectDelay:g.RECONNECT_DELAY_MS,oauthTokenRefreshDelay:g.OAUTH_TOKEN_REFRESH_DELAY_MS,reconnectAttempts:0,disconnectedTimestamp:null},this.refreshOAuthToken=function(){l["default"].resolve()},this.Connection=null,this.reconnectionTimer=new y["default"](function(){(t[re].shouldReconnect||t.isBOSHSessionExpired())&&t.reconnect(!1)},this[re].reconnectDelay),this.oauthRefreshTimer=new y["default"](function(){C["default"].debug(le,"OAuth timer expired. Fetching new OAuth token"),ie["default"].dispatch("analytics-event",{name:"hipchat.client.oauth.token.refresh.requested",properties:{reason:"Token expiry timer lapsed"}}),t._getNewOAuthToken().then(_.noop)["catch"](function(e){C["default"].error(le,"Failed to fetch new OAuth token due to: "+e)})},3599e3,5e3),this.oauthRetryTimer=null,this.apiV1TokenRefreshTimer=new y["default"](function(){t.updateApiV1Token()["catch"](function(){})},N["default"].getApiV1TokenExpiry(),5e3)}return(0,f["default"])(e,[{key:"setOAuthTokenCallback",value:function(e){return _.isFunction(e)&&(this.refreshOAuthToken=e),this}},{key:"connect",value:function(){var e=this;return this._initializeSession().then(function(){return Strophe.addConnectionPlugin("ConnectionHooks",new B["default"]),Strophe.addConnectionPlugin("XMPPTrapPlugin",new X["default"]),Strophe.addConnectionPlugin("Presence",new Y["default"]),Strophe.addConnectionPlugin("Ping",new U["default"]),Strophe.addConnectionPlugin("Rooms",new q["default"]),Strophe.addConnectionPlugin("Chat",new G["default"]),Strophe.addConnectionPlugin("Roster",new Q["default"]),Strophe.addConnectionPlugin("Emoticons",new ee["default"]),Strophe.addConnectionPlugin("Cache",new ae["default"]),e.Connection=new T["default"],e._doConnect()}).then(function(){e._registerEventListeners()})["catch"](function(e){C["default"].error("[ConnectionManager.connect]: ",e)})}},{key:"_doConnect",value:function(){var e=this;return new l["default"](function(t,a){e.Connection.ConnectionHooks.addXmppConnectedHandler(function(){return C["default"].debug(le,"Strophe successfully connected"),e._resetForNewReconnection(),e[re].connected=!0,t(),!1}),e.Connection.ConnectionHooks.addXmppDisconnectedHandler(function(e,t){return C["default"].error(le,"Strophe failed to connect. Status: "+e+", Condition: "+t),a({status:e,condition:t}),!1}),e.Connection.connect(N["default"].get("jid"),null,e._onConnectionChange.bind(e),null,null,N["default"].get("route"))})}},{key:"reconnect",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];return this[re].connected||this[re].isSessionRequestInFlight?l["default"].resolve():(e&&(this._resetForNewReconnection(),this[re].connected=!1,clearTimeout(this.oauthRetryTimer)),this._doReconnect())}},{key:"_doReconnect",value:function(){var e=this;return C["default"].debug(le,"Strophe reconnecting"),this.reconnectionTimer.clear(),this[re].reconnectAttempts++,this[re].reconnectAttempts<6&&this._signalReconnecting(),this._reestablishSession().then(function(){return e.Connection.disconnect("Resetting before reconnect"),e.Connection.reset(),e._doConnect()})["catch"](function(t){C["default"].error(le,"Error reestablishing connection. Server response: "+(0,s["default"])(t)),t&&t.refresh_page&&L["default"].reconnectionError(le+" Error reestablishing connection. Server response: "+(0,s["default"])(t)),e._setReconnectTimer(),e[re].reconnectAttempts<5?(e._signalReconnectDelay(),C["default"].debug(le,"reconnect(). Next attempt in "+e[re].reconnectDelay/1e3+"s")):e._signalConnectionFailed("Error: 5 failure attempts to reestablish connection. Server response (if any): "+(0,s["default"])(t))})}},{key:"disconnect",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];C["default"].debug(le,"disconnect() called."),e||(C["default"].debug(le,"disconnect() called. Should not auto-reconnect."),this[re].shouldReconnect=!1,this.reconnectionTimer.clear()),this[re].connected=!1,this.Connection.disconnect(),this.Connection.flush()}},{key:"send",value:function(){for(var e,t=arguments.length,a=Array(t),n=0;t>n;n++)a[n]=arguments[n];return this.Connection?void(e=this.Connection).send.apply(e,a):void C["default"].error(le,"Attempted to send stanza before establishing an initial XMPP connection:",arguments[0].outerHTML)}},{key:"sendIQ",value:function(){for(var e,t=arguments.length,a=Array(t),n=0;t>n;n++)a[n]=arguments[n];return this.Connection?void(e=this.Connection).sendIQ.apply(e,a):void C["default"].error(le,"Attempted to sendIQ before establishing an initial XMPP connection:",arguments[0].outerHTML)}},{key:"addHandler",value:function(){if(this.Connection){var e;return(e=this.Connection).addHandler.apply(e,arguments)}}},{key:"addTimedHandler",value:function(){if(this.Connection){var e;return(e=this.Connection).addTimedHandler.apply(e,arguments)}}},{key:"deleteHandler",value:function(){if(this.Connection){var e;(e=this.Connection).deleteHandler.apply(e,arguments)}}},{key:"getDisconnectedTimestamp",value:function(){return this[re].disconnectedTimestamp}},{key:"isConnected",value:function(){return this[re].connected}},{key:"isInitialConnect",value:function(){return this[re].isInitialConnect}},{key:"isBOSHSessionExpired",value:function(){return k["default"].now()-this.Connection.last_BOSH_activity>this.Connection.allowedInactivityInterval+g.NETWORK_LATENCY_GRACE_PERIOD}},{key:"updateApiV1Token",value:function(){var e=this;return new l["default"](function(t){var a=$iq({type:"get",to:N["default"].get("chat_server")}).c("query",{xmlns:"http://hipchat.com/protocol/auth"});e.Connection.sendIQ(a,function(a){var n=A["default"].xml2json(a);n.query.token&&(O["default"].updateAuthTokens(new P["default"]({token:A["default"].xml2json(a).query.token})),e.apiV1TokenRefreshTimer.clear().resetTime(N["default"].getApiV1TokenExpiry()).start()),t()})})}},{key:"_initializeSession",value:function(){var e=this;return new l["default"](function(t,a){if(!N["default"].get("base_url")||N["default"].isOAuth())return se["default"].configure(N["default"].get("user_id"),N["default"].get("group_id")),t();var n=$.ajax({url:N["default"].get("base_url")+"/chat/session?nonce_auth=1",type:"GET",headers:{accepts:"application/json"}});n.done(function(e){e.error?a(e.error):(O["default"].updateAppConfiguration(new P["default"](e)),se["default"].configure(N["default"].get("user_id"),N["default"].get("group_id")),t())}).fail(function(t){e._handleErrorResponse(t,a)})})}},{key:"_reestablishSession",value:function(){var e=this;return new l["default"](function(t,a){if(N["default"].isNonce()){e[re].isSessionRequestInFlight=!0;var n=$.ajax({url:N["default"].get("base_url")+"/chat/session",type:"GET",timeout:1e4,data:{is_guest:N["default"].isGuest(),guest_key:N["default"].get("guest_key"),uid:N["default"].get("user_id"),nonce_auth:1}});n.done(function(e){e.error?a(e):(O["default"].updateAppConfiguration(new P["default"](e)),t())}).fail(function(t){e._handleErrorResponse(t,a)}).always(function(){e[re].isSessionRequestInFlight=!1})}else N["default"].isOAuth()&&(e.oauthRefreshTimer.hasExpired()?(ie["default"].dispatch("analytics-event",{name:"hipchat.client.oauth.token.refresh.requested",properties:{reason:"_reestablishSession() called"}}),e._getNewOAuthToken().then(t)["catch"](a)):w["default"].checkNetwork().then(t)["catch"](a))})}},{key:"_handleErrorResponse",value:function(e,t){var a=e.responseText;if(_.isString(a)&&""!==a)try{a=JSON.parse(a)}catch(n){a={error:n}}t(a,e)}},{key:"_getStartupStanza",value:function(){var e=this;return new l["default"](function(t){var a=$iq({type:"get",id:1e7*Math.random()|0}).c("query",{xmlns:"http://hipchat.com/protocol/startup",send_auto_join_user_presences:!1});e.Connection.sendIQ(a,function(e){t()})})}},{key:"_getFeatureFlags",value:function(){return new l["default"](function(e,t){$.ajax({type:"POST",url:k["default"].url.featureFlagsAPI(N["default"].get("base_url")),dataType:"json",data:{user_id:N["default"].get("user_id"),group_id:N["default"].get("group_id")}}).done(function(t){var a=_.pickBy(t.features,function(e,t){return 0===t.indexOf("web_client")||"btf"===t||"entity_versioning"===t}),n=new P["default"]({feature_flags:a,native_feature_flags:N["default"].get("native_feature_flags")});O["default"].updateFeatureFlags(n),e(n)}).fail(function(e,a){C["default"].error("[_getFeatureFlags]",e.statusText),t(e.statusText)})})}},{key:"_setReconnectTimer",value:function(){var e=k["default"].decorrelatedJitter(g.RECONNECT_MAX_DELAY,g.RECONNECT_DELAY_MS,this[re].reconnectDelay,g.RECONNECT_BACKOFF_FACTOR);this[re].reconnectDelay=1e3*Math.round(e/1e3),C["default"].debug(le,"Attempting reconnect in "+this[re].reconnectDelay),this.reconnectionTimer.resetTime(this[re].reconnectDelay).start()}},{key:"_resetForNewReconnection",value:function(){this[re].shouldReconnect=!0,this[re].reconnectDelay=g.RECONNECT_DELAY_MS,this[re].reconnectAttempts=0}},{key:"_onConnectionChange",value:function(e,t){var a=this;switch(e){case Strophe.Status.CONNECTED:this._updateSID(),C["default"].debug(le,"Strophe connected");var n=[];return N["default"].isOAuth()?(n.push(this._getStartupStanza().then(function(){C["default"].debug(le,"Startup stanza received"),O["default"].updateAuthTokens({apiv1_token:N["default"].getApiV1Token()}),a.apiV1TokenRefreshTimer.resetTime(N["default"].getApiV1TokenExpiry()).restart()})["catch"](function(e){C["default"].error(le,"Error getting startup stanza",e)})),this[re].isInitialConnect?this.oauthRefreshTimer.resetTime(N["default"].getOAuthTokenExpiry()).start():this.oauthRefreshTimer.resume()):N["default"].isNonce()&&!N["default"].isGuest()&&this.apiV1TokenRefreshTimer.resetTime(N["default"].getApiV1TokenExpiry()).restart(),this[re].isInitialConnect?L["default"].stropheConnected():L["default"].stropheReconnected(),n.push(this._getFeatureFlags().then(function(){C["default"].debug(le,"Feature flags received")})["catch"](function(e){C["default"].error(le,"Error getting feature flags",e)})),l["default"].all(n).then(function(){a[re].isInitialConnect?(L["default"].appStateConnected(),a[re].isInitialConnect=!1):L["default"].appStateReconnected()})["catch"](function(e){C["default"].error(le,"Unknown connection error",e)});case Strophe.Status.CONNFAIL:case Strophe.Status.AUTHFAIL:C["default"].debug(le,"[Strophe] Offline. Condition: "+t),this[re].connected=!1,"conflict"===t||"not-allowed"===t||"not-authorized"===t?(L["default"].stropheAuthFailed(e,t),this.reconnectionTimer.clear()):"policy-violation"===t?(L["default"].strophePolicyViolation(e,t),this.reconnectionTimer.clear()):this._signalConnectionFailed(t);break;case Strophe.Status.DISCONNECTED:C["default"].debug(le,"[Strophe] Disconnected"),this[re].disconnectedTimestamp=(new Date).getTime(),this[re].connected=!1,this.oauthRefreshTimer.pause(),this.apiV1TokenRefreshTimer.clear(),L["default"].stropheDisconnected(),this[re].shouldReconnect&&(C["default"].debug(le,"[Strophe] Disconnected and attempting Reconnect"),this.reconnect(!1));break;case Strophe.Status.AUTHENTICATING:C["default"].debug(le,"[Strophe] Authenticating"),L["default"].stropheAuthenticating();break;case Strophe.Status.CONNECTING:C["default"].debug(le,"[Strophe] Connecting");break;case Strophe.Status.DISCONNECTING:C["default"].debug(le,"[Strophe] Disconnecting. Condition: "+t),L["default"].stropheDisconnecting({status:e,condition:t})}}},{key:"_getNewOAuthToken",value:function(){var e=this;return this[re].isRefreshOAuthTokenInFlight&&C["default"].error("Oauth: OAuth token refresh already in progress"),new l["default"](function(t,a){e._tryToGetOAuthToken().then(function(a){C["default"].debug(le,"Successfully received new OAuth token. Expires in: "+a.expires_in+" seconds."),e[re].isRefreshOAuthTokenInFlight=!1,e.oauthRefreshTimer.resetTime(N["default"].getOAuthTokenExpiry()).start();try{O["default"].updateAuthTokens(new P["default"](a))}catch(n){C["default"].error(le,"Downstream error captured when dispatching new oauth token to the rest of the app: "+n.message)}t()})["catch"](function(e){C["default"].error(le,"Failed to retrieve OAuth token: "+e.error_description),L["default"].stropheAuthFailed({status:Strophe.Status.AUTHFAIL,condition:e.error_description}),a()})})}},{key:"_tryToGetOAuthToken",value:function(){var e=this;return new l["default"](function(t,a){var n=1,i=g.OAUTH_TOKEN_REFRESH_DELAY_MS,o=void 0,s=function(t){return e[re].isRefreshOAuthTokenInFlight=!1,C["default"].debug(le,"Attempt #"+n+" to refresh oauth token failed with "+t.error_code+", "+t.error_description+". Retrying again in "+i),302===t.error_code||401===t.error_code||400===t.error_code&&"invalid_grant"===t.error?void a(t):(n++,i=k["default"].decorrelatedJitter(g.OAUTH_TOKEN_REFRESH_MAX_DELAY,g.OAUTH_TOKEN_REFRESH_DELAY_MS,i,g.OAUTH_TOKEN_REFRESH_BACKOFF_FACTOR),void(e.oauthRetryTimer=setTimeout(o,i)))};(o=function(){C["default"].debug(le,"Trying to refresh oauth token. Attempt #"+n),e[re].isRefreshOAuthTokenInFlight=!0,e.refreshOAuthToken().then(t)["catch"](s)})()})}},{key:"_registerEventListeners",value:function(){$(window).on("beforeunload",this._unloadListener.bind(this))}},{key:"_unloadListener",value:function(){this[re].connected&&this.disconnect(!1)}},{key:"_updateSID",value:function(){var e=_.clone(this.Connection._proto.sid);O["default"].updateSID(new P["default"]({sid:e}))}},{key:"_signalReconnecting",value:function(){L["default"].stropheReconnecting({reconnectAttempts:this[re].reconnectAttempts})}},{key:"_signalReconnectDelay",value:function(){L["default"].stropheReconnectDelay({reconnectDelay:this[re].reconnectDelay})}},{key:"_signalConnectionFailed",value:function(e){L["default"].stropheConnectionFailed(Strophe.Status.CONNFAIL,e)}},{key:"reset",value:function(){this.Connection=null,this.oauthRefreshTimer.clear(),this.reconnectionTimer.clear(),this.apiV1TokenRefreshTimer.clear(),this[re].connected=!1,this[re].isInitialConnect=!0,this[re].shouldReconnect=!0,this[re].reconnectDelay=g.RECONNECT_DELAY_MS,this[re].reconnectAttempts=0,this[re].isRefreshOAuthTokenInFlight=!1,this[re].isSessionRequestInFlight=!1,$(window).off("beforeunload",this._unloadListener.bind(this))}}]),e}();t["default"]=new ue,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(4),o=n(i),s=a(5),r=n(s),l=a(90),u=n(l),c=function(){function e(t,a,n){var i=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];(0,o["default"])(this,e),this._callback=t,this._delay=a,this._repeat=i,this.id=null,this.resetTime(a,n),this.started=!1,this.cleared=!1}return(0,r["default"])(e,[{key:"start",value:function(){var e=this;return this.id&&(this.clear(),u["default"].info("[Timer]","Timer was already running. Clearing timer and restarting.")),this._startTime=(new Date).getTime(),this.started=!0,this.cleared=!1,this.id=setInterval(function(){e.hasExpired()&&e.resolve()},this._frequency),this}},{key:"resetTime",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?this._frequency||1e3:arguments[1];return this._delay=e,this._frequency=e>t?t:e,this}},{key:"restart",value:function(){return this.clear().start(),this}},{key:"clear",value:function(){return clearInterval(this.id),this.id=null,this.cleared=!0,this.started=!1,this}},{key:"pause",value:function(){this._paused||(clearInterval(this.id),this._paused=!0)}},{key:"resume",value:function(){if(this._paused){this._paused=!1;var e=Math.max(this._delay-(new Date).getTime()+this._startTime,0);this.resetTime(e).start()}}},{key:"resolve",value:function(){this._repeat||this.clear(),this._callback()}},{key:"hasExpired",value:function(){return(new Date).getTime()-this._startTime>=this._delay}}]),e}();t["default"]=c,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(47),h=n(f),p=a(51),m=n(p);a(211);var g=a(169),v=n(g),y=a(159),b=n(y),w=a(201),R=n(w),k=a(99),E=n(k),C=a(196),S=n(C),T=a(212),x=n(T),A=function(){Strophe.Connection.apply(this,arguments)};A.prototype=_.extend(A.prototype,Strophe.Connection.prototype);var I=function(e){function t(){(0,r["default"])(this,t);var e=(0,d["default"])(this,(0,o["default"])(t).call(this,v["default"].get("bind_url")));return e.supportsRestarts=!1,e}return(0,m["default"])(t,e),(0,u["default"])(t,[{key:"connect",value:function(){var e,a=this,n=function(e){var t=e.textContent,n=e.getAttribute("oauth2_token")||v["default"].getOAuthToken();return S["default"].successfulAuthEvent(t,n),b["default"].updateAuthTokens(new R["default"]({access_token:n})),a._sasl_success_cb(e)},i=function(e){a._sasl_success_handler&&(a.deleteHandler(a._sasl_success_handler),a._sasl_success_handler=null),a._sasl_challenge_handler&&(a.deleteHandler(a._sasl_challenge_handler),a._sasl_challenge_handler=null),a._sasl_mechanism&&a._sasl_mechanism.onFailure();var t=e.firstElementChild,n=t&&t.nodeName||null;return a._changeConnectStatus(Strophe.Status.AUTHFAIL,n),!1};this._sasl_success_handler=this._addSysHandler(n,null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(i,null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null);for(var s=arguments.length,r=Array(s),l=0;s>l;l++)r[l]=arguments[l];(e=(0,h["default"])((0,o["default"])(t.prototype),"connect",this)).call.apply(e,[this].concat(r))}},{key:"authenticate",value:function(){return!this.supportsRestarts&&this._needsRestartFeature()?void b["default"].serverUnsupportedError("stream-restart-unsupported"):this.send(this._buildRequestAuthExchangeTree())}},{key:"_sasl_auth1_cb",
value:function(){return this.authenticated=!0,this._changeConnectStatus(Strophe.Status.CONNECTED,null)}},{key:"_connect_cb",value:function(e,a,n){var i=this,s=this._proto._reqToData(e);if(s){var r=function(e){i.supportsRestarts=i.supportsRestarts||e.getElementsByTagNameNS("http://hipchat.com","authrestartlogic").length>0},l=s.getAttribute("inactivity"),u=s.getAttribute("wait");return this.allowedInactivityInterval=1e3*parseInt(l?l:u,10),r(s),this._addSysHandler(r,null,"stream:features",null,null),(0,h["default"])((0,o["default"])(t.prototype),"_connect_cb",this).call(this,e,a,n)}}},{key:"_needsRestartFeature",value:function(){return v["default"].isOAuth()}},{key:"_buildRequestAuthExchangeTree",value:function(){var e=void 0,t=void 0,a=void 0,n=void 0;switch(e=v["default"].get("client_type"),t=e===x["default"].WEB?E["default"].browser.family():v["default"].get("client_subtype"),a=e+"_"+t,v["default"].get("auth_method")){case"nonce":n=$build("auth",{xmlns:Strophe.NS.SASL,mechanism:"X-HIPCHAT-WEB",nonce:v["default"].getNonceToken(),oauth2_token:"true",node:v["default"].get("client_node"),ver:v["default"].get("client_version_id")}),n.t(v["default"].get("jid").split("@")[0]);break;case"oauth2":n=$build("auth",{xmlns:"http://hipchat.com",mechanism:"oauth2",oauth2_token:"false",restart_stream:"true",node:v["default"].get("client_node"),ver:v["default"].get("client_version_id")}),n.t(Base64.encode("\x00"+v["default"].getOAuthToken()+"\x00"+a))}return n.tree()}}]),t}(A);t["default"]=I,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(93),o=n(i),s=Strophe.Request.prototype._newXHR;Strophe.Request.prototype._newXHR=function(){var e=s.bind(this)(),t=e.onreadystatechange;return e._customTimeout=e.ontimeout,e.ontimeout=function(){o["default"].onHostRequestTimeout(),e._customTimeout&&e._customTimeout.apply(e,arguments)},e.send=function(){return function(){try{return XMLHttpRequest.prototype.send.apply(e,arguments)}catch(t){return Strophe.warn(t.message)}}}(this),e.onreadystatechange=function(){return 1!==this.readyState||this.withCredentials||(this.withCredentials=!0),t.apply(this,arguments)},e}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(136),o=n(i);t["default"]=(0,o["default"])({WEB:"web",QT:"qt",MAC:"mac"}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(214),o=n(i);t["default"]=new o["default"]({stripWhitespaces:!1}),e.exports=t["default"]},function(e,t,a){var n,i,o;!function(a,s){i=[],n=s,o="function"==typeof n?n.apply(t,i):n,!(void 0!==o&&(e.exports=o))}(this,function(){return function(e){"use strict";function t(){void 0===e.escapeMode&&(e.escapeMode=!0),e.attributePrefix=e.attributePrefix||"",e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0),e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0),void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0),e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1)}function a(){function e(e){var t=String(e);return 1===t.length&&(t="0"+t),t}"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|^\n+|(\s|\n)+$/g,"")}),"function"!=typeof Date.prototype.toISOString&&(Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"})}function n(e){var t=e.localName;return null==t&&(t=e.baseName),(null==t||""==t)&&(t=e.nodeName),t}function i(e){return e.prefix}function o(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"):e}function s(t,a,n){switch(e.arrayAccessForm){case"property":t[a]instanceof Array?t[a+"_asArray"]=t[a]:t[a+"_asArray"]=[t[a]]}if(!(t[a]instanceof Array)&&e.arrayAccessFormPaths.length>0){for(var i=0;i<e.arrayAccessFormPaths.length;i++){var o=e.arrayAccessFormPaths[i];if("string"==typeof o){if(o==n)break}else if(o instanceof RegExp){if(o.test(n))break}else if("function"==typeof o&&o(t,a,n))break}i!=e.arrayAccessFormPaths.length&&(t[a]=[t[a]])}}function r(e){var t=e.split(/[-T:+Z]/g),a=new Date(t[0],t[1]-1,t[2]),n=t[5].split(".");if(a.setHours(t[3],t[4],n[0]),n.length>1&&a.setMilliseconds(n[1]),t[6]&&t[7]){var i=60*t[6]+Number(t[7]),o=/\d\d-\d\d:\d\d$/.test(e)?"-":"+";i=0+("-"==o?-1*i:i),a.setMinutes(a.getMinutes()-i-a.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(a=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds())));return a}function l(t,a,n){if(e.datetimeAccessFormPaths.length>0){for(var i=n.split(".#")[0],o=0;o<e.datetimeAccessFormPaths.length;o++){var s=e.datetimeAccessFormPaths[o];if("string"==typeof s){if(s==i)break}else if(s instanceof RegExp){if(s.test(i))break}else if("function"==typeof s&&s(obj,a,i))break}return o!=e.datetimeAccessFormPaths.length?r(t):t}return t}function u(t,a){if(t.nodeType==w.DOCUMENT_NODE){for(var o=new Object,r=t.childNodes,c=0;c<r.length;c++){var d=r.item(c);if(d.nodeType==w.ELEMENT_NODE){var f=n(d);o[f]=u(d,f)}}return o}if(t.nodeType==w.ELEMENT_NODE){var o=new Object,h=n(t);o.__cnt=0;var r=t.childNodes,p=Array.prototype.filter.call(r,function(e){return e.nodeType===w.TEXT_NODE}).length;if(p>1&&p===r.length){var _=document.createDocumentFragment(),m=document.createTextNode(t.textContent);_.appendChild(m),r=_.childNodes}Array.prototype.forEach.call(r,function(e){if("html"===n(e)&&"http://jabber.org/protocol/xhtml-im"===e.namespaceURI)for(var t=0;t<e.childNodes.length;t++){var a=e.childNodes.item(t),i=n(a);"body"===i&&"http://www.w3.org/1999/xhtml"===a.namespaceURI&&(o.xhtml_im_body=a.innerHTML)}});for(var c=0;c<r.length;c++){var d=r.item(c),f=n(d);d.nodeType!=w.COMMENT_NODE&&(o.__cnt++,null==o[f]?(o[f]=u(d,a+"."+f),s(o,f,a+"."+f)):(null!=o[f]&&(o[f]instanceof Array||(o[f]=[o[f]],s(o,f,a+"."+f))),o[f][o[f].length]=u(d,a+"."+f)))}for(var g=0;g<t.attributes.length;g++){var v=t.attributes.item(g);o.__cnt++;var y=e.attributePrefix;"http://jabber.org/protocol/httpbind"===t.namespaceURI&&"body"===h&&(y="boshwrapper_"),o[y+v.name]=v.value}var b=i(t);return null!=b&&""!=b&&(o.__cnt++,o.__prefix=b),null!=o["#text"]&&(o.__text=o["#text"],o.__text instanceof Array&&(o.__text=o.__text.join("\n")),e.stripWhitespaces&&(o.__text=o.__text.trim()),delete o["#text"],"property"==e.arrayAccessForm&&delete o["#text_asArray"],o.__text=l(o.__text,f,a+"."+f)),null!=o["#cdata-section"]&&(o.__cdata=o["#cdata-section"],delete o["#cdata-section"],"property"==e.arrayAccessForm&&delete o["#cdata-section_asArray"]),1==o.__cnt&&null!=o.__text?o=o.__text:0==o.__cnt&&"text"==e.emptyNodeForm?o="":o.__cnt>1&&null!=o.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==o.__text||""==o.__text.trim())&&delete o.__text,delete o.__cnt,!e.enableToStringFunc||null==o.__text&&null==o.__cdata||(o.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),o}return t.nodeType==w.TEXT_NODE||t.nodeType==w.CDATA_SECTION_NODE?t.nodeValue:void 0}function c(t,a,n,i){var s="<"+(null!=t&&null!=t.__prefix?t.__prefix+":":"")+a;if(null!=n)for(var r=0;r<n.length;r++){var l=n[r],u=t[l];e.escapeMode&&(u=o(u)),s+=" "+l.substr(e.attributePrefix.length)+"=",s+=e.useDoubleQuotes?'"'+u+'"':"'"+u+"'"}return s+=i?"/>":">"}function d(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function f(e,t){return-1!==e.indexOf(t,e.length-t.length)}function h(t,a){return!!("property"==e.arrayAccessForm&&f(a.toString(),"_asArray")||0==a.toString().indexOf(e.attributePrefix)||0==a.toString().indexOf("__")||t[a]instanceof Function)}function p(e){var t=0;if(e instanceof Object)for(var a in e)h(e,a)||t++;return t}function _(t){var a=[];if(t instanceof Object)for(var n in t)-1==n.toString().indexOf("__")&&0==n.toString().indexOf(e.attributePrefix)&&a.push(n);return a}function m(t){var a="";return null!=t.__cdata&&(a+="<![CDATA["+t.__cdata+"]]>"),null!=t.__text&&(a+=e.escapeMode?o(t.__text):t.__text),a}function g(t){var a="";return t instanceof Object?a+=m(t):null!=t&&(a+=e.escapeMode?o(t):t),a}function v(e,t,a){var n="";if(0==e.length)n+=c(e,t,a,!0);else for(var i=0;i<e.length;i++)n+=c(e[i],t,_(e[i]),!1),n+=y(e[i]),n+=d(e[i],t);return n}function y(e){var t="",a=p(e);if(a>0)for(var n in e)if(!h(e,n)){var i=e[n],o=_(i);if(null==i||void 0==i)t+=c(i,n,o,!0);else if(i instanceof Object)if(i instanceof Array)t+=v(i,n,o);else if(i instanceof Date)t+=c(i,n,o,!1),t+=i.toISOString(),t+=d(i,n);else{var s=p(i);s>0||null!=i.__text||null!=i.__cdata?(t+=c(i,n,o,!1),t+=y(i),t+=d(i,n)):t+=c(i,n,o,!0)}else t+=c(i,n,o,!1),t+=g(i),t+=d(i,n)}return t+=g(e)}var b="1.1.8";e=e||{},t(),a();var w={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(e){var t=window.ActiveXObject||"ActiveXObject"in window;if(void 0===e)return null;var a;if(window.DOMParser){var n=new window.DOMParser,i=null;if(!t)try{i=n.parseFromString("INVALID","text/xml").childNodes[0].namespaceURI}catch(o){i=null}try{a=n.parseFromString(e,"text/xml"),null!=i&&a.getElementsByTagNameNS(i,"parsererror").length>0&&(a=null)}catch(o){a=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),a=new ActiveXObject("Microsoft.XMLDOM"),a.async="false",a.loadXML(e);return a},this.asArray=function(e){return void 0===e||null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?r(e):e},this.xml2json=function(e){return u(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null!=t?this.xml2json(t):null},this.json2xml_str=function(e){return y(e)},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return b}}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i);t["default"]={stropheConnected:function(){o["default"].dispatch("strophe-connected")},stropheReconnected:function(){o["default"].dispatch("strophe-reconnected")},stropheReconnecting:function(e){o["default"].dispatch("strophe-reconnecting",e)},stropheReconnectDelay:function(e){o["default"].dispatch("strophe-reconnect-delay",e)},stropheAuthenticating:function(){o["default"].dispatch("strophe-authenticating")},stropheDisconnected:function(){o["default"].dispatch("strophe-disconnected")},stropheDisconnecting:function(){o["default"].dispatch("strophe-disconnecting")},stropheAuthFailed:function(e,t){o["default"].dispatch("strophe-auth-failed",e,t)},stropheConnectionFailed:function(e,t){o["default"].dispatch("strophe-connection-failed",e,t)},strophePolicyViolation:function(e,t){o["default"].dispatch("strophe-policy-violation",e,t)},reconnect:function(){o["default"].dispatch("attempt-reconnect")},reconnectionError:function(e){o["default"].dispatch("reconnection-error",e)},disconnect:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];o["default"].dispatch("attempt-disconnect",e)},handleReconnectLinkClick:function(){o["default"].dispatch("attempt-reconnect-without-reset")},appStateConnected:function(){o["default"].dispatch("app-state-connected")},appStateReconnected:function(){o["default"].dispatch("app-state-reconnected")}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(10),s=i(o),r=a(4),l=i(r),u=a(5),c=i(u),d=a(22),f=i(d),h=a(47),p=i(h),_=a(51),m=i(_),g=a(217),v=i(g),y=a(209),b=i(y),w=a(90),R=i(w),k=a(163),E=n(k),C=a(169),S=i(C),T=E.XMPP_INACTIVITY_INTERVAL+E.XMPP_PONG_WAIT+E.NETWORK_LATENCY_GRACE_PERIOD,x=E.XMPP_INACTIVITY_INTERVAL+E.NETWORK_LATENCY_GRACE_PERIOD,A=function(e){function t(){return(0,l["default"])(this,t),(0,f["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,m["default"])(t,e),(0,c["default"])(t,[{key:"init",value:function(){for(var e,a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];(e=(0,p["default"])((0,s["default"])(t.prototype),"init",this)).call.apply(e,[this].concat(n)),Strophe.addNamespace("PING","urn:xmpp:ping"),this.pingTimer=new b["default"](this.ping.bind(this),x)}},{key:"onConnected",value:function(){var e=this;this.Connection.ConnectionHooks.addXmlInputHandler(function(t){return t.hasChildNodes()&&e.pingTimer.restart(),!0})}},{key:"onDisconnected",value:function(){this.pingTimer.clear()}},{key:"ping",value:function(){var e="get",t=S["default"].get("chat_server"),a=$iq({type:e,to:t}).c("ping",{xmlns:Strophe.NS.PING}).tree();this.Connection.sendIQ(a,null,this._onPingError.bind(this),T),R["default"].debug("[PING]","Sending ping to keep XMPP session alive")}},{key:"_onPingError",value:function(e){e||(R["default"].debug("[PING]","Ping request timed out. Disconnecting Strophe"),this.Connection.disconnect())}}]),t}(v["default"]);t["default"]=A,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(59),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(218),d=n(c),f=a(147),h=n(f),p=a(163),m=function(){function e(){(0,r["default"])(this,e),this.Connection=null}return(0,u["default"])(e,[{key:"init",value:function(e){this.Connection=e,this.connected=!1}},{key:"statusChanged",value:function(e,t){switch(e){case Strophe.Status.CONNECTED:this.connected=!0,this.onConnected();break;case Strophe.Status.AUTHENTICATING:this.onAuthenticating();break;case Strophe.Status.CONNECTING:this.onConnecting();break;case Strophe.Status.DISCONNECTING:this.onDisconnecting();break;case Strophe.Status.AUTHFAIL:this.onAuthFailure();break;case Strophe.Status.CONNFAIL:this.onConnectionFailure();break;case Strophe.Status.DISCONNECTED:this.connected=!1,this.onDisconnected(t)}}},{key:"onConnected",value:function(){}},{key:"onAuthenticating",value:function(){}},{key:"onConnecting",value:function(){}},{key:"onDisconnecting",value:function(){}},{key:"onDisconnected",value:function(e){}},{key:"onAuthFailure",value:function(){}},{key:"onConnectionFailure",value:function(){}},{key:"isConnected",value:function(){return this.connected}},{key:"sendIQWithOfflineGuard",value:function(e){var t=this,a=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1],n=arguments.length<=2||void 0===arguments[2]?_.noop:arguments[2];return new o["default"](function(i,o){if(!d["default"].isOnline()||!t.isConnected())return o(h["default"].ofType(h["default"].Types.OFFLINE));var s=function(e){a(e),i()},r=function(e){return n(e),o(e?h["default"].fromXMPP(e):h["default"].ofType(h["default"].Types.TIMEOUT))};t.Connection.sendIQ(e.tree(),s,r,p.XMPP_SEND_IQ_TIMEOUT)})}},{key:"checkIfOnline",value:function(){var e=this;return new o["default"](function(t,a){d["default"].isOnline()&&e.isConnected()?t():a(h["default"].ofType(h["default"].Types.OFFLINE))})}}]),e}();t["default"]=m,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(59),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(90),d=n(c),f=a(169),h=n(f),p=a(219),_=n(p),m=a(220),g=n(m),v=function(){function e(){(0,r["default"])(this,e),this._state=!1,this._shouldCheckNetwork=!0,this._currentConfirmNetworkUpPromise=null}return(0,u["default"])(e,[{key:"initialize",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=e.doHealthCheck,a=void 0===t?!0:t;this._state=!0,this._shouldCheckNetwork=!!a,"web"===h["default"].get("client_type")&&($(window).on("online",this.onNetworkUp.bind(this)),$(window).on("offline",this.onNetworkDown.bind(this)))}},{key:"onNetworkUp",value:function(){this._currentConfirmNetworkUpPromise=null,this._state!==!0&&(d["default"].debug("[NetworkStatusHelper]","network up event received, signaling UI"),this._state=!0,_["default"].networkUp())}},{key:"onNetworkDown",value:function(){var e=this;if(this._currentConfirmNetworkUpPromise=null,this._state===!1)return o["default"].resolve();if(d["default"].debug("[NetworkStatusHelper]","network down event received, performing health check to confirm"),!this._shouldCheckNetwork)return d["default"].debug("[NetworkStatusHelper]","health check disabled, signaling offline to UI"),this._state=!1,void _["default"].networkDown();var t=this._confirmNetworkUp().then(function(){d["default"].error("[NetworkStatusHelper]","network down event received, health check indicates we are still online, leaving UI as is")})["catch"](function(){d["default"].debug("[NetworkStatusHelper]","network down event received, health check confirmed"),e._currentConfirmNetworkUpPromise===t?(d["default"].debug("[NetworkStatusHelper]","health check still current, signaling offline to UI"),e._state=!1,_["default"].networkDown()):d["default"].debug("[NetworkStatusHelper]","health check was cancelled, no UI changes")});return this._currentConfirmNetworkUpPromise=t,t}},{key:"_confirmNetworkUp",value:function(){return g["default"].checkNetwork()}},{key:"isOnline",value:function(){return this._state}}]),e}();t["default"]=new v,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i),s=a(218),r=n(s);t["default"]={onNetworkDown:function(){r["default"].onNetworkDown()},onNetworkUp:function(){r["default"].onNetworkUp()},networkDown:function(){o["default"].dispatch("network-down")},networkUp:function(){o["default"].dispatch("network-up")}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(91),o=n(i),s=a(59),r=n(s),l=a(169),u=n(l),c=a(153),d=n(c),f=a(152),h=n(f),p=a(147),m=n(p),g=a(121),v=n(g),y=a(99),b=n(y),w=a(163),R=a(221),k=a(90),E=n(k);t["default"]={createRoom:function(e,t,a){return new r["default"](function(n,i){var s=new XMLHttpRequest,r="https://"+u["default"].get("api_host")+"/v2/room",l=function(){var e=JSON.parse(s.responseText);e=e.entity?e.entity:e,n(e)},c=function(){return i(m["default"].fromJqXHR(s))};s.onreadystatechange=function(){if(4===s.readyState){var e=s.status,t=e>=200&&300>e||304===e;t?l():c()}},s.open("POST",r,!0),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Authorization","Bearer "+u["default"].get("oauth_token")),s.send((0,o["default"])({name:e,topic:t,privacy:a}))})},deleteRoom:function(e){return new r["default"](function(t,a){$.ajax({url:"https://"+u["default"].get("api_host")+"/v2/room/"+e,type:"DELETE",dataType:"json",headers:{"Content-Type":"application/json",Authorization:"Bearer "+u["default"].get("oauth_token")},success:function(){return t()},error:function(e){return a(m["default"].fromJqXHR(e))}})})},fetchRoom:function(e){return new r["default"](function(t,a){$.ajax({url:"https://"+u["default"].get("api_host")+"/v2/room/"+e,type:"GET",dataType:"json",headers:{"Content-Type":"application/json",Authorization:"Bearer "+u["default"].get("oauth_token")},success:function(e){return t(d["default"].fromREST(e))},error:function(e){return a(m["default"].fromJqXHR(e))}})})},uploadRoomAvatar:function(e,t){return new r["default"](function(a,n){$.ajax({url:"https://"+u["default"].get("api_host")+"/v2/room/"+e+"/avatar",type:"PUT",dataType:"json",headers:{"Content-Type":"application/json",Authorization:"Bearer "+u["default"].get("oauth_token")},data:(0,o["default"])({avatar:t}),success:function(t){return a({room_id:e})},error:function(e){return n(m["default"].fromJqXHR(e))}})})},revokeOAuthToken:function(){},syncRoster:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return new r["default"](function(t,a){var n=["xmpp_jid","name","mention_name","email","title","photo_url","version","is_guest"].join(","),i=_.transform(e,function(e,t,a){return e[a]=t.version,e}),s={url:"https://"+u["default"].get("api_host")+"/v2/sync/users?auth_token="+u["default"].getOAuthToken()+"&expand=changedUsers&fields="+n,type:"POST",dataType:"json",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},data:(0,o["default"])({requireFullList:!0,knownUsers:i}),success:function(e){t(e.changedUsers.map(function(e){return h["default"].fromREST(e)}))},error:function(e){return a(m["default"].fromJqXHR(e))}};s.data.length>=w.SYNC_REQUEST_GZIP_SIZE&&(s.headers["Content-Encoding"]="gzip",s.data=(0,R.gzip)(s.data),s.processData=!1),$.ajax(s)})},syncRooms:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return new r["default"](function(t,a){var n=["xmpp_jid","name","privacy","is_guest_accessible","guest_access_url","avatar_url","is_archived","topic","version","owner"].join(","),i=_.transform(e,function(e,t,a){return t.name&&(e[a]=t.version),e}),s={url:"https://"+u["default"].get("api_host")+"/v2/sync/rooms?auth_token="+u["default"].getOAuthToken()+"&expand=changedRooms&fields="+n,type:"POST",dataType:"json",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},data:(0,o["default"])({requireFullList:!0,knownRooms:i}),success:function(e){t(e.changedRooms.map(function(e){return d["default"].fromREST(e)}))},error:function(e){return a(m["default"].fromJqXHR(e))}};s.data.length>=w.SYNC_REQUEST_GZIP_SIZE&&(s.headers["Content-Encoding"]="gzip",s.data=(0,R.gzip)(s.data),s.processData=!1),$.ajax(s)})},updateRoomDetails:function(){},fetchRoomParticipants:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];return new r["default"](function(a,n){$.ajax({url:"https://"+u["default"].get("api_host")+"/v2/room/"+e+"/participant",type:"GET",dataType:"json",headers:{"Content-Type":"application/json",Authorization:"Bearer "+u["default"].get("oauth_token")},data:{"include-offline":t,expand:"items","max-results":v["default"].room_participant_page_limit,fields:"is_guest,is_group_admin,xmpp_jid,group,name,mention_name,is_present_in_room"},success:function(t){return a({roomId:e,participants:t.items})},error:function(e){return n(m["default"].fromJqXHR(e))}})})},fetchRecentHistory:function(){},sendFileMessage:function(){},sendPrivateMessage:function(){},syncIntegrations:function(){},getSignedUrl:function(){},requestWithSignedUrl:function(){},fetchSignedFile:function(e){return new r["default"](function(t,a){$.ajax({url:e,type:"GET",dataType:"json",headers:{"Content-Type":"application/json",Authorization:"Bearer "+u["default"].get("oauth_token")},success:function(e){return t(e)},error:function n(e){var n=m["default"].fromJqXHR(e);E["default"].error("[Secure files] Error while getting signed url",n),a(m["default"].fromJqXHR(e))}})})},fetchSignedThumbnailCollection:function(e){var t="https://"+u["default"].get("api_host")+"/v2/file/mget/thumbnails",a=_.keys(e);return new r["default"](function(n,i){$.ajax({url:t,method:"POST",dataType:"json",headers:{"Content-Type":"application/json",Authorization:"Bearer "+u["default"].get("oauth_token")},data:(0,o["default"])({ids:a}),success:function(t){var a=t.files;_.forIn(a,function(t,a){t?e[a].cb(t):(E["default"].error("[Secure files] Error while getting signed thumbnail for file with id "+a),e[a].errCb({status:400}))}),n(a)},error:function s(t){var s=m["default"].fromJqXHR(t);E["default"].error("[Secure files] Error while getting signed thumbnails",s),_.forIn(e,function(e){e.errCb(s)}),i(s)}})})},fetchVideoToken:function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0],t=arguments.length<=1||void 0===arguments[1]?null:arguments[1],a="https://"+u["default"].get("api_host")+"/v2/video"+(e?"/callee/"+e:"")+"/token";return t&&(a+="?room="+t),new r["default"](function(e,t){$.ajax({url:a,method:"GET",type:"json",headers:{"Content-Type":"application/json",Authorization:"Bearer "+u["default"].get("oauth_token")},success:function(a,n,i){try{var o=JSON.parse(a);e(o)}catch(s){t(m["default"].fromJqXHR(i))}},error:function(e){return t(m["default"].fromJqXHR(e))}})})},checkNetwork:function(){var e=_.get(u["default"].get("feature_flags"),"btf",!1)?b["default"].url.featureFlagsAPI(u["default"].get("base_url")):b["default"].url.networkCheckAPI(u["default"].get("api_host"));return new r["default"](function(t,a){$.ajax({url:e,type:"HEAD",timeout:1e4,success:function(){return t()},error:function(e){return a(m["default"].fromJqXHR(e))}})})},fetchAlertFlag:function(){var e="https://"+u["default"].get("api_host")+"/v2/flag";return new r["default"](function(t,a){$.ajax({url:e,method:"GET",type:"json",headers:{"Content-Type":"application/json",Authorization:"Bearer "+u["default"].get("oauth_token")},success:function(e){return t(e)},error:function(e){return a(m["default"].fromJqXHR(e))}})})},dismissAlertFlag:function(e){var t=e.id,a="https://"+u["default"].get("api_host")+"/v2/flag/dismiss";return new r["default"](function(e,n){$.ajax({url:a,method:"POST",type:"json",headers:{"Content-Type":"application/json",Authorization:"Bearer "+u["default"].get("oauth_token")},data:(0,o["default"])({id:t}),success:function(){return e()},error:function(e){return n(m["default"].fromJqXHR(e))}})})},fetchReadOnlyContent:function(){return new r["default"](function(e,t){$.ajax({url:"/login_interstitial",type:"GET",timeout:1e4,success:function(t){return e(t)},error:function(e){return t(m["default"].fromJqXHR(e))}})})}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e,t){var a=new b(t);if(a.push(e,!0),a.err)throw a.msg;return a.result}function i(e,t){return t=t||{},t.raw=!0,n(e,t)}function o(e,t){return t=t||{},t.gzip=!0,n(e,t)}var s=a(222),r=a(223),l=a(228),u=a(227),c=a(229),d=Object.prototype.toString,f=0,h=4,p=0,_=1,m=2,g=-1,v=0,y=8,b=function(e){this.options=r.assign({level:g,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:v,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var a=s.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(a!==p)throw new Error(u[a]);t.header&&s.deflateSetHeader(this.strm,t.header)};b.prototype.push=function(e,t){var a,n,i=this.strm,o=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:t===!0?h:f,"string"==typeof e?i.input=l.string2buf(e):"[object ArrayBuffer]"===d.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new r.Buf8(o),i.next_out=0,i.avail_out=o),a=s.deflate(i,n),a!==_&&a!==p)return this.onEnd(a),this.ended=!0,!1;0!==i.avail_out&&(0!==i.avail_in||n!==h&&n!==m)||("string"===this.options.to?this.onData(l.buf2binstring(r.shrinkBuf(i.output,i.next_out))):this.onData(r.shrinkBuf(i.output,i.next_out)))}while((i.avail_in>0||0===i.avail_out)&&a!==_);return n===h?(a=s.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===p):n===m?(this.onEnd(p),i.avail_out=0,!0):!0},b.prototype.onData=function(e){this.chunks.push(e)},b.prototype.onEnd=function(e){e===p&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=b,t.deflate=n,t.deflateRaw=i,t.gzip=o},function(e,t,a){"use strict";function n(e,t){return e.msg=M[t],t}function i(e){return(e<<1)-(e>4?9:0)}function o(e){for(var t=e.length;--t>=0;)e[t]=0}function s(e){var t=e.state,a=t.pending;a>e.avail_out&&(a=e.avail_out),0!==a&&(x.arraySet(e.output,t.pending_buf,t.pending_out,a,e.next_out),e.next_out+=a,t.pending_out+=a,e.total_out+=a,e.avail_out-=a,t.pending-=a,0===t.pending&&(t.pending_out=0))}function r(e,t){A._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,s(e.strm)}function l(e,t){e.pending_buf[e.pending++]=t}function u(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function c(e,t,a,n){var i=e.avail_in;return i>n&&(i=n),0===i?0:(e.avail_in-=i,x.arraySet(t,e.input,e.next_in,i,a),1===e.state.wrap?e.adler=I(e.adler,t,i,a):2===e.state.wrap&&(e.adler=N(e.adler,t,i,a)),e.next_in+=i,e.total_in+=i,i)}function d(e,t){var a,n,i=e.max_chain_length,o=e.strstart,s=e.prev_length,r=e.nice_match,l=e.strstart>e.w_size-ue?e.strstart-(e.w_size-ue):0,u=e.window,c=e.w_mask,d=e.prev,f=e.strstart+le,h=u[o+s-1],p=u[o+s];e.prev_length>=e.good_match&&(i>>=2),r>e.lookahead&&(r=e.lookahead);do if(a=t,u[a+s]===p&&u[a+s-1]===h&&u[a]===u[o]&&u[++a]===u[o+1]){o+=2,a++;do;while(u[++o]===u[++a]&&u[++o]===u[++a]&&u[++o]===u[++a]&&u[++o]===u[++a]&&u[++o]===u[++a]&&u[++o]===u[++a]&&u[++o]===u[++a]&&u[++o]===u[++a]&&f>o);if(n=le-(f-o),o=f-le,n>s){if(e.match_start=t,s=n,n>=r)break;h=u[o+s-1],p=u[o+s]}}while((t=d[t&c])>l&&0!==--i);return s<=e.lookahead?s:e.lookahead}function f(e){var t,a,n,i,o,s=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=s+(s-ue)){x.arraySet(e.window,e.window,s,s,0),e.match_start-=s,e.strstart-=s,e.block_start-=s,a=e.hash_size,t=a;do n=e.head[--t],e.head[t]=n>=s?n-s:0;while(--a);a=s,t=a;do n=e.prev[--t],e.prev[t]=n>=s?n-s:0;while(--a);i+=s}if(0===e.strm.avail_in)break;if(a=c(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=a,e.lookahead+e.insert>=re)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+re-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<re)););}while(e.lookahead<ue&&0!==e.strm.avail_in)}function h(e,t){var a=65535;for(a>e.pending_buf_size-5&&(a=e.pending_buf_size-5);;){if(e.lookahead<=1){if(f(e),0===e.lookahead&&t===O)return ve;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+a;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,r(e,!1),0===e.strm.avail_out))return ve;if(e.strstart-e.block_start>=e.w_size-ue&&(r(e,!1),0===e.strm.avail_out))return ve}return e.insert=0,t===j?(r(e,!0),0===e.strm.avail_out?be:we):e.strstart>e.block_start&&(r(e,!1),0===e.strm.avail_out)?ve:ve}function p(e,t){for(var a,n;;){if(e.lookahead<ue){if(f(e),e.lookahead<ue&&t===O)return ve;if(0===e.lookahead)break}if(a=0,e.lookahead>=re&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+re-1])&e.hash_mask,a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==a&&e.strstart-a<=e.w_size-ue&&(e.match_length=d(e,a)),e.match_length>=re)if(n=A._tr_tally(e,e.strstart-e.match_start,e.match_length-re),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=re){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+re-1])&e.hash_mask,a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(r(e,!1),0===e.strm.avail_out))return ve}return e.insert=e.strstart<re-1?e.strstart:re-1,t===j?(r(e,!0),0===e.strm.avail_out?be:we):e.last_lit&&(r(e,!1),0===e.strm.avail_out)?ve:ye}function _(e,t){for(var a,n,i;;){if(e.lookahead<ue){if(f(e),e.lookahead<ue&&t===O)return ve;if(0===e.lookahead)break;
}if(a=0,e.lookahead>=re&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+re-1])&e.hash_mask,a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=re-1,0!==a&&e.prev_length<e.max_lazy_match&&e.strstart-a<=e.w_size-ue&&(e.match_length=d(e,a),e.match_length<=5&&(e.strategy===V||e.match_length===re&&e.strstart-e.match_start>4096)&&(e.match_length=re-1)),e.prev_length>=re&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-re,n=A._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-re),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+re-1])&e.hash_mask,a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!==--e.prev_length);if(e.match_available=0,e.match_length=re-1,e.strstart++,n&&(r(e,!1),0===e.strm.avail_out))return ve}else if(e.match_available){if(n=A._tr_tally(e,0,e.window[e.strstart-1]),n&&r(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return ve}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=A._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<re-1?e.strstart:re-1,t===j?(r(e,!0),0===e.strm.avail_out?be:we):e.last_lit&&(r(e,!1),0===e.strm.avail_out)?ve:ye}function m(e,t){for(var a,n,i,o,s=e.window;;){if(e.lookahead<=le){if(f(e),e.lookahead<=le&&t===O)return ve;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=re&&e.strstart>0&&(i=e.strstart-1,n=s[i],n===s[++i]&&n===s[++i]&&n===s[++i])){o=e.strstart+le;do;while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&o>i);e.match_length=le-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=re?(a=A._tr_tally(e,1,e.match_length-re),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(a=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),a&&(r(e,!1),0===e.strm.avail_out))return ve}return e.insert=0,t===j?(r(e,!0),0===e.strm.avail_out?be:we):e.last_lit&&(r(e,!1),0===e.strm.avail_out)?ve:ye}function g(e,t){for(var a;;){if(0===e.lookahead&&(f(e),0===e.lookahead)){if(t===O)return ve;break}if(e.match_length=0,a=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,a&&(r(e,!1),0===e.strm.avail_out))return ve}return e.insert=0,t===j?(r(e,!0),0===e.strm.avail_out?be:we):e.last_lit&&(r(e,!1),0===e.strm.avail_out)?ve:ye}function v(e){e.window_size=2*e.w_size,o(e.head),e.max_lazy_match=T[e.level].max_lazy,e.good_match=T[e.level].good_length,e.nice_match=T[e.level].nice_length,e.max_chain_length=T[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=re-1,e.match_available=0,e.ins_h=0}function y(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=X,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new x.Buf16(2*oe),this.dyn_dtree=new x.Buf16(2*(2*ne+1)),this.bl_tree=new x.Buf16(2*(2*ie+1)),o(this.dyn_ltree),o(this.dyn_dtree),o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new x.Buf16(se+1),this.heap=new x.Buf16(2*ae+1),o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new x.Buf16(2*ae+1),o(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function b(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=K,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?de:me,e.adler=2===t.wrap?0:1,t.last_flush=O,A._tr_init(t),F):n(e,H)}function w(e){var t=b(e);return t===F&&v(e.state),t}function R(e,t){return e&&e.state?2!==e.state.wrap?H:(e.state.gzhead=t,F):H}function k(e,t,a,i,o,s){if(!e)return H;var r=1;if(t===q&&(t=6),0>i?(r=0,i=-i):i>15&&(r=2,i-=16),1>o||o>J||a!==X||8>i||i>15||0>t||t>9||0>s||s>$)return n(e,H);8===i&&(i=9);var l=new y;return e.state=l,l.strm=e,l.wrap=r,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+re-1)/re),l.window=new x.Buf8(2*l.w_size),l.head=new x.Buf16(l.hash_size),l.prev=new x.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new x.Buf8(l.pending_buf_size),l.d_buf=l.lit_bufsize>>1,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=s,l.method=a,w(e)}function E(e,t){return k(e,t,X,Q,Z,Y)}function C(e,t){var a,r,c,d;if(!e||!e.state||t>L||0>t)return e?n(e,H):H;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||r.status===ge&&t!==j)return n(e,0===e.avail_out?z:H);if(r.strm=e,a=r.last_flush,r.last_flush=t,r.status===de)if(2===r.wrap)e.adler=0,l(r,31),l(r,139),l(r,8),r.gzhead?(l(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),l(r,255&r.gzhead.time),l(r,r.gzhead.time>>8&255),l(r,r.gzhead.time>>16&255),l(r,r.gzhead.time>>24&255),l(r,9===r.level?2:r.strategy>=G||r.level<2?4:0),l(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(l(r,255&r.gzhead.extra.length),l(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=N(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=fe):(l(r,0),l(r,0),l(r,0),l(r,0),l(r,0),l(r,9===r.level?2:r.strategy>=G||r.level<2?4:0),l(r,Re),r.status=me);else{var f=X+(r.w_bits-8<<4)<<8,h=-1;h=r.strategy>=G||r.level<2?0:r.level<6?1:6===r.level?2:3,f|=h<<6,0!==r.strstart&&(f|=ce),f+=31-f%31,r.status=me,u(r,f),0!==r.strstart&&(u(r,e.adler>>>16),u(r,65535&e.adler)),e.adler=1}if(r.status===fe)if(r.gzhead.extra){for(c=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>c&&(e.adler=N(e.adler,r.pending_buf,r.pending-c,c)),s(e),c=r.pending,r.pending!==r.pending_buf_size));)l(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>c&&(e.adler=N(e.adler,r.pending_buf,r.pending-c,c)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=he)}else r.status=he;if(r.status===he)if(r.gzhead.name){c=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>c&&(e.adler=N(e.adler,r.pending_buf,r.pending-c,c)),s(e),c=r.pending,r.pending===r.pending_buf_size)){d=1;break}d=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,l(r,d)}while(0!==d);r.gzhead.hcrc&&r.pending>c&&(e.adler=N(e.adler,r.pending_buf,r.pending-c,c)),0===d&&(r.gzindex=0,r.status=pe)}else r.status=pe;if(r.status===pe)if(r.gzhead.comment){c=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>c&&(e.adler=N(e.adler,r.pending_buf,r.pending-c,c)),s(e),c=r.pending,r.pending===r.pending_buf_size)){d=1;break}d=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,l(r,d)}while(0!==d);r.gzhead.hcrc&&r.pending>c&&(e.adler=N(e.adler,r.pending_buf,r.pending-c,c)),0===d&&(r.status=_e)}else r.status=_e;if(r.status===_e&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&s(e),r.pending+2<=r.pending_buf_size&&(l(r,255&e.adler),l(r,e.adler>>8&255),e.adler=0,r.status=me)):r.status=me),0!==r.pending){if(s(e),0===e.avail_out)return r.last_flush=-1,F}else if(0===e.avail_in&&i(t)<=i(a)&&t!==j)return n(e,z);if(r.status===ge&&0!==e.avail_in)return n(e,z);if(0!==e.avail_in||0!==r.lookahead||t!==O&&r.status!==ge){var p=r.strategy===G?g(r,t):r.strategy===W?m(r,t):T[r.level].func(r,t);if(p!==be&&p!==we||(r.status=ge),p===ve||p===be)return 0===e.avail_out&&(r.last_flush=-1),F;if(p===ye&&(t===D?A._tr_align(r):t!==L&&(A._tr_stored_block(r,0,0,!1),t===P&&(o(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),s(e),0===e.avail_out))return r.last_flush=-1,F}return t!==j?F:r.wrap<=0?U:(2===r.wrap?(l(r,255&e.adler),l(r,e.adler>>8&255),l(r,e.adler>>16&255),l(r,e.adler>>24&255),l(r,255&e.total_in),l(r,e.total_in>>8&255),l(r,e.total_in>>16&255),l(r,e.total_in>>24&255)):(u(r,e.adler>>>16),u(r,65535&e.adler)),s(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?F:U)}function S(e){var t;return e&&e.state?(t=e.state.status,t!==de&&t!==fe&&t!==he&&t!==pe&&t!==_e&&t!==me&&t!==ge?n(e,H):(e.state=null,t===me?n(e,B):F)):H}var T,x=a(223),A=a(224),I=a(225),N=a(226),M=a(227),O=0,D=1,P=3,j=4,L=5,F=0,U=1,H=-2,B=-3,z=-5,q=-1,V=1,G=2,W=3,$=4,Y=0,K=2,X=8,J=9,Q=15,Z=8,ee=29,te=256,ae=te+1+ee,ne=30,ie=19,oe=2*ae+1,se=15,re=3,le=258,ue=le+re+1,ce=32,de=42,fe=69,he=73,pe=91,_e=103,me=113,ge=666,ve=1,ye=2,be=3,we=4,Re=3,ke=function(e,t,a,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=a,this.max_chain=n,this.func=i};T=[new ke(0,0,0,0,h),new ke(4,4,8,4,p),new ke(4,5,16,8,p),new ke(4,6,32,32,p),new ke(4,4,16,16,_),new ke(8,16,32,32,_),new ke(8,16,128,128,_),new ke(8,32,128,256,_),new ke(32,128,258,1024,_),new ke(32,258,258,4096,_)],t.deflateInit=E,t.deflateInit2=k,t.deflateReset=w,t.deflateResetKeep=b,t.deflateSetHeader=R,t.deflate=C,t.deflateEnd=S,t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t){"use strict";var a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var a=t.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(var n in a)a.hasOwnProperty(n)&&(e[n]=a[n])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,a,n,i){if(t.subarray&&e.subarray)return void e.set(t.subarray(a,a+n),i);for(var o=0;n>o;o++)e[i+o]=t[a+o]},flattenChunks:function(e){var t,a,n,i,o,s;for(n=0,t=0,a=e.length;a>t;t++)n+=e[t].length;for(s=new Uint8Array(n),i=0,t=0,a=e.length;a>t;t++)o=e[t],s.set(o,i),i+=o.length;return s}},i={arraySet:function(e,t,a,n,i){for(var o=0;n>o;o++)e[i+o]=t[a+o]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,n)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,i))},t.setTyped(a)},function(e,t,a){"use strict";function n(e){for(var t=e.length;--t>=0;)e[t]=0}function i(e){return 256>e?se[e]:se[256+(e>>>7)]}function o(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function s(e,t,a){e.bi_valid>$-a?(e.bi_buf|=t<<e.bi_valid&65535,o(e,e.bi_buf),e.bi_buf=t>>$-e.bi_valid,e.bi_valid+=a-$):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=a)}function r(e,t,a){s(e,a[2*t],a[2*t+1])}function l(e,t){var a=0;do a|=1&e,e>>>=1,a<<=1;while(--t>0);return a>>>1}function u(e){16===e.bi_valid?(o(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function c(e,t){var a,n,i,o,s,r,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,d=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,h=t.stat_desc.extra_base,p=t.stat_desc.max_length,_=0;for(o=0;W>=o;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,a=e.heap_max+1;G>a;a++)n=e.heap[a],o=l[2*l[2*n+1]+1]+1,o>p&&(o=p,_++),l[2*n+1]=o,n>u||(e.bl_count[o]++,s=0,n>=h&&(s=f[n-h]),r=l[2*n],e.opt_len+=r*(o+s),d&&(e.static_len+=r*(c[2*n+1]+s)));if(0!==_){do{for(o=p-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[p]--,_-=2}while(_>0);for(o=p;0!==o;o--)for(n=e.bl_count[o];0!==n;)i=e.heap[--a],i>u||(l[2*i+1]!==o&&(e.opt_len+=(o-l[2*i+1])*l[2*i],l[2*i+1]=o),n--)}}function d(e,t,a){var n,i,o=new Array(W+1),s=0;for(n=1;W>=n;n++)o[n]=s=s+a[n-1]<<1;for(i=0;t>=i;i++){var r=e[2*i+1];0!==r&&(e[2*i]=l(o[r]++,r))}}function f(){var e,t,a,n,i,o=new Array(W+1);for(a=0,n=0;H-1>n;n++)for(le[n]=a,e=0;e<1<<Z[n];e++)re[a++]=n;for(re[a-1]=n,i=0,n=0;16>n;n++)for(ue[n]=i,e=0;e<1<<ee[n];e++)se[i++]=n;for(i>>=7;q>n;n++)for(ue[n]=i<<7,e=0;e<1<<ee[n]-7;e++)se[256+i++]=n;for(t=0;W>=t;t++)o[t]=0;for(e=0;143>=e;)ie[2*e+1]=8,e++,o[8]++;for(;255>=e;)ie[2*e+1]=9,e++,o[9]++;for(;279>=e;)ie[2*e+1]=7,e++,o[7]++;for(;287>=e;)ie[2*e+1]=8,e++,o[8]++;for(d(ie,z+1,o),e=0;q>e;e++)oe[2*e+1]=5,oe[2*e]=l(e,5);ce=new he(ie,Z,B+1,z,W),de=new he(oe,ee,0,q,W),fe=new he(new Array(0),te,0,V,Y)}function h(e){var t;for(t=0;z>t;t++)e.dyn_ltree[2*t]=0;for(t=0;q>t;t++)e.dyn_dtree[2*t]=0;for(t=0;V>t;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*K]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function p(e){e.bi_valid>8?o(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function _(e,t,a,n){p(e),n&&(o(e,a),o(e,~a)),I.arraySet(e.pending_buf,e.window,t,a,e.pending),e.pending+=a}function m(e,t,a,n){var i=2*t,o=2*a;return e[i]<e[o]||e[i]===e[o]&&n[t]<=n[a]}function g(e,t,a){for(var n=e.heap[a],i=a<<1;i<=e.heap_len&&(i<e.heap_len&&m(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!m(t,n,e.heap[i],e.depth));)e.heap[a]=e.heap[i],a=i,i<<=1;e.heap[a]=n}function v(e,t,a){var n,o,l,u,c=0;if(0!==e.last_lit)do n=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],o=e.pending_buf[e.l_buf+c],c++,0===n?r(e,o,t):(l=re[o],r(e,l+B+1,t),u=Z[l],0!==u&&(o-=le[l],s(e,o,u)),n--,l=i(n),r(e,l,a),u=ee[l],0!==u&&(n-=ue[l],s(e,n,u)));while(c<e.last_lit);r(e,K,t)}function y(e,t){var a,n,i,o=t.dyn_tree,s=t.stat_desc.static_tree,r=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=G,a=0;l>a;a++)0!==o[2*a]?(e.heap[++e.heap_len]=u=a,e.depth[a]=0):o[2*a+1]=0;for(;e.heap_len<2;)i=e.heap[++e.heap_len]=2>u?++u:0,o[2*i]=1,e.depth[i]=0,e.opt_len--,r&&(e.static_len-=s[2*i+1]);for(t.max_code=u,a=e.heap_len>>1;a>=1;a--)g(e,o,a);i=l;do a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],g(e,o,1),n=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=n,o[2*i]=o[2*a]+o[2*n],e.depth[i]=(e.depth[a]>=e.depth[n]?e.depth[a]:e.depth[n])+1,o[2*a+1]=o[2*n+1]=i,e.heap[1]=i++,g(e,o,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],c(e,t),d(o,u,e.bl_count)}function b(e,t,a){var n,i,o=-1,s=t[1],r=0,l=7,u=4;for(0===s&&(l=138,u=3),t[2*(a+1)+1]=65535,n=0;a>=n;n++)i=s,s=t[2*(n+1)+1],++r<l&&i===s||(u>r?e.bl_tree[2*i]+=r:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[2*X]++):10>=r?e.bl_tree[2*J]++:e.bl_tree[2*Q]++,r=0,o=i,0===s?(l=138,u=3):i===s?(l=6,u=3):(l=7,u=4))}function w(e,t,a){var n,i,o=-1,l=t[1],u=0,c=7,d=4;for(0===l&&(c=138,d=3),n=0;a>=n;n++)if(i=l,l=t[2*(n+1)+1],!(++u<c&&i===l)){if(d>u){do r(e,i,e.bl_tree);while(0!==--u)}else 0!==i?(i!==o&&(r(e,i,e.bl_tree),u--),r(e,X,e.bl_tree),s(e,u-3,2)):10>=u?(r(e,J,e.bl_tree),s(e,u-3,3)):(r(e,Q,e.bl_tree),s(e,u-11,7));u=0,o=i,0===l?(c=138,d=3):i===l?(c=6,d=3):(c=7,d=4)}}function R(e){var t;for(b(e,e.dyn_ltree,e.l_desc.max_code),b(e,e.dyn_dtree,e.d_desc.max_code),y(e,e.bl_desc),t=V-1;t>=3&&0===e.bl_tree[2*ae[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function k(e,t,a,n){var i;for(s(e,t-257,5),s(e,a-1,5),s(e,n-4,4),i=0;n>i;i++)s(e,e.bl_tree[2*ae[i]+1],3);w(e,e.dyn_ltree,t-1),w(e,e.dyn_dtree,a-1)}function E(e){var t,a=4093624447;for(t=0;31>=t;t++,a>>>=1)if(1&a&&0!==e.dyn_ltree[2*t])return M;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return O;for(t=32;B>t;t++)if(0!==e.dyn_ltree[2*t])return O;return M}function C(e){_e||(f(),_e=!0),e.l_desc=new pe(e.dyn_ltree,ce),e.d_desc=new pe(e.dyn_dtree,de),e.bl_desc=new pe(e.bl_tree,fe),e.bi_buf=0,e.bi_valid=0,h(e)}function S(e,t,a,n){s(e,(P<<1)+(n?1:0),3),_(e,t,a,!0)}function T(e){s(e,j<<1,3),r(e,K,ie),u(e)}function x(e,t,a,n){var i,o,r=0;e.level>0?(e.strm.data_type===D&&(e.strm.data_type=E(e)),y(e,e.l_desc),y(e,e.d_desc),r=R(e),i=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,i>=o&&(i=o)):i=o=a+5,i>=a+4&&-1!==t?S(e,t,a,n):e.strategy===N||o===i?(s(e,(j<<1)+(n?1:0),3),v(e,ie,oe)):(s(e,(L<<1)+(n?1:0),3),k(e,e.l_desc.max_code+1,e.d_desc.max_code+1,r+1),v(e,e.dyn_ltree,e.dyn_dtree)),h(e),n&&p(e)}function A(e,t,a){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&a,e.last_lit++,0===t?e.dyn_ltree[2*a]++:(e.matches++,t--,e.dyn_ltree[2*(re[a]+B+1)]++,e.dyn_dtree[2*i(t)]++),e.last_lit===e.lit_bufsize-1}var I=a(223),N=4,M=0,O=1,D=2,P=0,j=1,L=2,F=3,U=258,H=29,B=256,z=B+1+H,q=30,V=19,G=2*z+1,W=15,$=16,Y=7,K=256,X=16,J=17,Q=18,Z=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ee=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],te=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ae=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ne=512,ie=new Array(2*(z+2));n(ie);var oe=new Array(2*q);n(oe);var se=new Array(ne);n(se);var re=new Array(U-F+1);n(re);var le=new Array(H);n(le);var ue=new Array(q);n(ue);var ce,de,fe,he=function(e,t,a,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=a,this.elems=n,this.max_length=i,this.has_stree=e&&e.length},pe=function(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t},_e=!1;t._tr_init=C,t._tr_stored_block=S,t._tr_flush_block=x,t._tr_tally=A,t._tr_align=T},function(e,t){"use strict";function a(e,t,a,n){for(var i=65535&e|0,o=e>>>16&65535|0,s=0;0!==a;){s=a>2e3?2e3:a,a-=s;do i=i+t[n++]|0,o=o+i|0;while(--s);i%=65521,o%=65521}return i|o<<16|0}e.exports=a},function(e,t){"use strict";function a(){for(var e,t=[],a=0;256>a;a++){e=a;for(var n=0;8>n;n++)e=1&e?3988292384^e>>>1:e>>>1;t[a]=e}return t}function n(e,t,a,n){var o=i,s=n+a;e=-1^e;for(var r=n;s>r;r++)e=e>>>8^o[255&(e^t[r])];return-1^e}var i=a();e.exports=n},function(e,t){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,a){"use strict";function n(e,t){if(65537>t&&(e.subarray&&s||!e.subarray&&o))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var a="",n=0;t>n;n++)a+=String.fromCharCode(e[n]);return a}var i=a(223),o=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(r){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(r){s=!1}for(var l=new i.Buf8(256),u=0;256>u;u++)l[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;l[254]=l[254]=1,t.string2buf=function(e){var t,a,n,o,s,r=e.length,l=0;for(o=0;r>o;o++)a=e.charCodeAt(o),55296===(64512&a)&&r>o+1&&(n=e.charCodeAt(o+1),56320===(64512&n)&&(a=65536+(a-55296<<10)+(n-56320),o++)),l+=128>a?1:2048>a?2:65536>a?3:4;for(t=new i.Buf8(l),s=0,o=0;l>s;o++)a=e.charCodeAt(o),55296===(64512&a)&&r>o+1&&(n=e.charCodeAt(o+1),56320===(64512&n)&&(a=65536+(a-55296<<10)+(n-56320),o++)),128>a?t[s++]=a:2048>a?(t[s++]=192|a>>>6,t[s++]=128|63&a):65536>a?(t[s++]=224|a>>>12,t[s++]=128|a>>>6&63,t[s++]=128|63&a):(t[s++]=240|a>>>18,t[s++]=128|a>>>12&63,t[s++]=128|a>>>6&63,t[s++]=128|63&a);return t},t.buf2binstring=function(e){return n(e,e.length)},t.binstring2buf=function(e){for(var t=new i.Buf8(e.length),a=0,n=t.length;n>a;a++)t[a]=e.charCodeAt(a);return t},t.buf2string=function(e,t){var a,i,o,s,r=t||e.length,u=new Array(2*r);for(i=0,a=0;r>a;)if(o=e[a++],128>o)u[i++]=o;else if(s=l[o],s>4)u[i++]=65533,a+=s-1;else{for(o&=2===s?31:3===s?15:7;s>1&&r>a;)o=o<<6|63&e[a++],s--;s>1?u[i++]=65533:65536>o?u[i++]=o:(o-=65536,u[i++]=55296|o>>10&1023,u[i++]=56320|1023&o)}return n(u,i)},t.utf8border=function(e,t){var a;for(t=t||e.length,t>e.length&&(t=e.length),a=t-1;a>=0&&128===(192&e[a]);)a--;return 0>a?t:0===a?t:a+l[e[a]]>t?a:t}},function(e,t){"use strict";function a(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}e.exports=a},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(47),h=n(f),p=a(51),m=n(p),g=a(217),v=n(g),y=function(e){function t(){(0,r["default"])(this,t);var e=(0,d["default"])(this,(0,o["default"])(t).call(this));return e.handlers={},e.added={},e.removed={},e.reset(),e}return(0,m["default"])(t,e),(0,u["default"])(t,[{key:"statusChanged",value:function(e,a){switch(e){case Strophe.Status.CONNECTED:this.xmppConnected(e,a);break;case Strophe.Status.CONNFAIL:case Strophe.Status.AUTHFAIL:case Strophe.Status.ERROR:case Strophe.Status.DISCONNECTED:this.xmppDisconnected(e,a)}(0,h["default"])((0,o["default"])(t.prototype),"statusChanged",this).call(this,e,a)}},{key:"init",value:function(){for(var e,a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];(e=(0,h["default"])((0,o["default"])(t.prototype),"init",this)).call.apply(e,[this].concat(n)),this.Connection.xmlInput=this._createHooksHandler("xmlInput"),this.Connection.xmlOutput=this._createHooksHandler("xmlOutput"),this.Connection.rawInput=this._createHooksHandler("rawInput"),this.Connection.rawOutput=this._createHooksHandler("rawOutput"),this.xmppConnected=this._createHooksHandler("xmppConnected"),this.xmppDisconnected=this._createHooksHandler("xmppDisconnected"),this.addXmlInputHandler=this._createAddHandler("xmlInput"),this.addXmlOutputHandler=this._createAddHandler("xmlOutput"),this.addRawInputHandler=this._createAddHandler("rawInput"),this.addRawOutputHandler=this._createAddHandler("rawOutput"),this.deleteXmlInputHandler=this._createDeleteHandler("xmlInput"),this.deleteXmlOutputHandler=this._createDeleteHandler("xmlOutput"),this.deleteRawInputHandler=this._createDeleteHandler("rawInput"),this.deleteRawOutputHandler=this._createDeleteHandler("rawOutput"),this.addXmppConnectedHandler=this._createAddHandler("xmppConnected"),this.deleteXmppConnectedHandler=this._createDeleteHandler("xmppConnected"),this.addXmppDisconnectedHandler=this._createAddHandler("xmppDisconnected"),this.deleteXmppDisconnectedHandler=this._createDeleteHandler("xmppDisconnected")}},{key:"onDisconnected",value:function(){this.reset()}},{key:"reset",value:function(){this.handlers.xmlInput=[],this.handlers.xmlOutput=[],this.handlers.rawInput=[],this.handlers.rawOutput=[],this.handlers.xmppConnected=this.handlers.xmppConnected||[],this.handlers.xmppDisconnected=this.handlers.xmppDisconnected||[],this.added.xmlInput=[],this.added.xmlOutput=[],this.added.rawInput=[],this.added.rawOutput=[],this.added.xmppConnected=this.added.xmppConnected||[],this.added.xmppDisconnected=this.added.xmppDisconnected||[],this.removed.xmlInput=[],this.removed.xmlOutput=[],this.removed.rawInput=[],this.removed.rawOutput=[],this.removed.xmppConnected=this.removed.xmppConnected||[],this.removed.xmppDisconnected=this.removed.xmppDisconnected||[]}},{key:"_createAddHandler",value:function(e){var t=this;return function(a){return _.includes(t.added[e],a)||_.includes(t.handlers[e],a)||t.added[e].push(a),a}}},{key:"_createDeleteHandler",value:function(e){var t=this;return function(a){t.removed[e].push(a)}}},{key:"_createHooksHandler",value:function(e){var t=this;if(this.Connection[e]!==Strophe.Connection.prototype[e])throw new Error("\n        Error installing Strophe Connection Hooks plugin.\n        Strophe.Connection."+e+" has already been overwritten.\n        Please ensure that the ConnectionHooks plugin is installed\n        before any other plugin, and that nothing is overwriting the\n        "+e+" method.\n      ");return function(){for(var a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];for(;t.removed[e].length>0;)_.pull(t.handlers[e],t.removed[e].pop());for(;t.added[e].length>0;)t.handlers[e].push(t.added[e].pop());var o=t.handlers[e];t.handlers[e]=[],o.forEach(function(a){try{a.apply(void 0,n)&&t.handlers[e].push(a)}catch(i){Strophe.warn("Removing Strophe handlers due to uncaught exception: "+i.message)}})}}}]),t}(v["default"]);t["default"]=y,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(118),s=i(o),r=a(59),l=i(r),u=a(10),c=i(u),d=a(4),f=i(d),h=a(5),p=i(h),m=a(22),g=i(m),v=a(47),y=i(v),b=a(51),w=i(b),R=a(169),k=i(R),E=a(121),C=i(E),S=a(217),T=i(S),x=a(147),A=i(x),I=a(153),N=i(I),M=a(232),O=i(M),D=a(154),P=n(D),j=function(e){function t(){return(0,f["default"])(this,t),(0,g["default"])(this,(0,c["default"])(t).apply(this,arguments))}return(0,w["default"])(t,e),(0,p["default"])(t,[{key:"init",value:function(){for(var e,a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];(e=(0,y["default"])((0,c["default"])(t.prototype),"init",this)).call.apply(e,[this].concat(n)),Strophe.addNamespace("HC",P.HC),Strophe.addNamespace("HC_MUC_ROOM",P.HC_MUC_ROOM),Strophe.addNamespace("HC_MUC_PERMISSIONS",P.HC_MUC_PERMISSIONS),Strophe.addNamespace("MUC_USER",P.MUC_USER),Strophe.addNamespace("MUC_OWNER",P.MUC_OWNER)}},{key:"create",value:function(e,t,a){var n=this,i=O["default"].createRoomJid(e);return new l["default"](function(o,s){var r=n.Connection.addHandler(function(t){var a=t.querySelector('item[jid="'+i+'"]');if(a&&a.getAttribute("name")===e){var n=parseInt(a.querySelector("id").textContent,10);return o({id:n}),!1}return!0},Strophe.NS.HC_MUC_ROOM,"iq","set");n.checkIfOnline().then(function(){n.join(i,0,{name:e,topic:t,privacy:a})["catch"](function(e){n.Connection.deleteHandler(r),s(e)})},function(e){n.Connection.deleteHandler(r),s(e)})})}},{key:"join",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],a=this,n=arguments.length<=2||void 0===arguments[2]?null:arguments[2],i=arguments.length<=3||void 0===arguments[3]?!0:arguments[3],o="joinRoom:"+_.uniqueId(),s=e+"/"+k["default"].get("user_name"),r="available",u=$pres({type:r,to:s,id:o}).c("x",{xmlns:Strophe.NS.MUC}).c("history",{maxstanzas:t}).up().up();return n&&u.c("x",{xmlns:Strophe.NS.HC_MUC_ROOM}).c("name").t(n.name).up().c("topic").t(n.topic).up().c("privacy").t(n.privacy).up().up(),!k["default"].get("is_guest",!1)&&i&&u.c("limit",{maxmemberpresences:C["default"].initial_room_participants_limit,xmlns:Strophe.NS.HC}),new l["default"](function(e,t){var n=void 0,i=void 0;n=a.Connection.addHandler(function(t){var n=t.getElementsByTagNameNS(Strophe.NS.MUC_USER,"x")[0];return n.querySelector('status[code="110"]')?(a.Connection.deleteHandler(i),e(a._processJoinRoomPresence(t)),!1):!0},Strophe.NS.MUC_USER,"presence",null,null,s),i=a.Connection.addHandler(function(e){return a.Connection.deleteHandler(n),t(A["default"].fromXMPP(e)),!1},null,"presence","error",o,null),a.Connection.send(u.tree())})}},{key:"leave",value:function(e){var t=this,a=e+"/"+k["default"].get("user_name"),n=$pres({to:a,type:"unavailable"});return new l["default"](function(e,i){t.Connection.addHandler(function(t){var a=t.getElementsByTagNameNS(Strophe.NS.MUC_USER,"x")[0];return"error"===t.getAttribute("type")?(i(A["default"].fromXMPP(t)),!1):a.querySelector('status[code="110"]')?(e(),!1):!0},null,"presence",["unavailable","error"],null,a),t.Connection.send(n.tree())})}},{key:"fetch",value:function(e){var t=this,a=$iq({type:"get",to:e}).c("query",{xmlns:Strophe.NS.DISCO_INFO});return new l["default"](function(e,n){t.Connection.sendIQ(a.tree(),function(t){return e(N["default"].fromXMPPDiscoInfo(t))},function(e){return n(A["default"].fromXMPP(e))})})}},{key:"rename",value:function(e,t){var a=$iq({type:"set",to:e}).c("query",{xmlns:Strophe.NS.HC}).c("rename").t(t);return this.sendIQWithOfflineGuard(a)}},{key:"getAll",value:function(){var e=this,t=$iq({type:"get",to:k["default"].get("conference_server")}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS,ignore_archived:!0});return new l["default"](function(a,n){var i=function(e){var t=e.getElementsByTagNameNS(Strophe.NS.DISCO_ITEMS,"query")[0],n=(0,s["default"])(t.querySelectorAll("item")),i=n.map(function(e){return N["default"].fromXMPPDiscoItem(e)});a(i)},o=function(e){return n(A["default"].fromXMPP(e))};e.Connection.sendIQ(t.tree(),i,o)})}},{key:"setPrivacy",value:function(e,t){var a=$iq({type:"set",to:e}).c("query",{xmlns:Strophe.NS.HC}).c("privacy").t(t);return this.sendIQWithOfflineGuard(a)}},{key:"setTopic",value:function(e){var t=this,a=arguments.length<=1||void 0===arguments[1]?"":arguments[1];a=a.trim().substr(0,C["default"].max_topic_text_length);var n=$msg({to:e,type:"groupchat"}).c("subject").t(a);return new l["default"](function(i,o){var s=void 0,r=void 0,l=void 0;s=t.Connection.addHandler(function(e){var n=e.querySelector("subject"),o=n?n.textContent.trim():"";return o===a?(t.Connection.deleteHandler(r),t.Connection.deleteTimedHandler(l),i(),!1):!0},null,"message","groupchat",null,e,{matchBare:!0}),r=t.Connection.addHandler(function(e){t.Connection.deleteHandler(s),t.Connection.deleteTimedHandler(l),o(A["default"].fromXMPP(e))},null,"message","error",null,e,{matchBare:!0}),l=t.Connection.addTimedHandler(C["default"].default_message_confirmation_timeout,function(){t.Connection.deleteHandler(s),t.Connection.deleteHandler(r),o(A["default"].ofType(A["default"].Types.TIMEOUT))}),t.Connection.send(n.tree())})}},{key:"setGuestAccess",value:function(e,t){var a=$iq({type:"set",to:e}).c("query",{xmlns:Strophe.NS.HC}).c("guest_access").t(t?1:0);return this.sendIQWithOfflineGuard(a)}},{key:"inviteUsers",value:function(e,t){}},{key:"removeUsers",value:function(e,t){}},{key:"delete",value:function(e){var t=$iq({type:"set",to:e}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("destroy");return this.sendIQWithOfflineGuard(t)}},{key:"_processJoinRoomPresence",value:function(e){var t=e.getElementsByTagNameNS(Strophe.NS.HC_MUC_PERMISSIONS,"x")[0],a=e.getElementsByTagNameNS(Strophe.NS.MUC_USER,"x")[0].querySelector("item"),n=a=e.getElementsByTagNameNS(Strophe.NS.HC_MUC_ROOM,"x")[0],i=n?n.querySelector("topic"):null,o=i?i.textContent:"",s=t?_.map(t.querySelectorAll("permission"),function(e){return e.textContent}):[],r=e.querySelector("rostersize")?parseInt(e.querySelector("rostersize").textContent,10):0;return{jid:Strophe.getBareJidFromJid(e.getAttribute("from")),type:"groupchat",role:a?a.getAttribute("role"):null,affiliation:a?a.getAttribute("affiliation"):null,permissions:s,roster_size:r,topic:o}}}]),t}(T["default"]);t["default"]=j,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(169),o=n(i),s="A-Za-zÂªÂµÂºÃ-ÃÃ-Ã¶Ã¸-ËË-ËË -Ë¤Ë¬Ë®Í°-Í´Í¶Í·Íº-Í½ÎÎ-ÎÎÎ-Î¡Î£-ÏµÏ·-ÒÒ-Ô§Ô±-ÕÕÕ¡-Ö×-×ª×°-×²Ø -ÙÙ®Ù¯Ù±-ÛÛÛ¥Û¦Û®Û¯Ûº-Û¼Û¿ÜÜ-Ü¯Ý-Þ¥Þ±ß-ßªß´ßµßºà -à à à ¤à ¨à¡-à¡à¢ à¢¢-à¢¬à¤-à¤¹à¤½à¥à¥-à¥¡à¥±-à¥·à¥¹-à¥¿à¦-à¦à¦à¦à¦-à¦¨à¦ª-à¦°à¦²à¦¶-à¦¹à¦½à§à§à§à§-à§¡à§°à§±à¨-à¨à¨à¨à¨-à¨¨à¨ª-à¨°à¨²à¨³à¨µà¨¶à¨¸à¨¹à©-à©à©à©²-à©´àª-àªàª-àªàª-àª¨àªª-àª°àª²àª³àªµ-àª¹àª½à«à« à«¡à¬-à¬à¬à¬à¬-à¬¨à¬ª-à¬°à¬²à¬³à¬µ-à¬¹à¬½à­à­à­-à­¡à­±à®à®-à®à®-à®à®-à®à®à®à®à®à®à®£à®¤à®¨-à®ªà®®-à®¹à¯à°-à°à°-à°à°-à°¨à°ª-à°³à°µ-à°¹à°½à±à±à± à±¡à²-à²à²-à²à²-à²¨à²ª-à²³à²µ-à²¹à²½à³à³ à³¡à³±à³²à´-à´à´-à´à´-à´ºà´½àµàµ àµ¡àµº-àµ¿à¶-à¶à¶-à¶±à¶³-à¶»à¶½à·-à·à¸-à¸°à¸²à¸³à¹-à¹àºàºàºàºàºàºàºàº-àºàº-àºàº¡-àº£àº¥àº§àºªàº«àº­-àº°àº²àº³àº½à»-à»à»à»-à»à¼à½-à½à½-à½¬à¾-à¾á-áªá¿á-áá-áá¡á¥á¦á®-á°áµ-ááá -áááá-áºá¼-áá-áá-ááá-áá -áá-áá-á°á²-áµá¸-á¾áá-áá-áá-áá-áá-áá-áá -á´á-á¬á¯-á¿á-áá -áªá-áá-áá -á±á-áá -á¬á®-á°á-á³ááá  -á¡·á¢-á¢¨á¢ªá¢°-á£µá¤-á¤á¥-á¥­á¥°-á¥´á¦-á¦«á§-á§á¨-á¨á¨ -á©áª§á¬-á¬³á­-á­á®-á® á®®á®¯á®º-á¯¥á°-á°£á±-á±á±-á±½á³©-á³¬á³®-á³±á³µá³¶á´-á¶¿á¸-á¼á¼-á¼á¼ -á½á½-á½á½-á½á½á½á½á½-á½½á¾-á¾´á¾¶-á¾¼á¾¾á¿-á¿á¿-á¿á¿-á¿á¿-á¿á¿ -á¿¬á¿²-á¿´á¿¶-á¿¼â±â¿â-ââââ-âââ-ââ¤â¦â¨âª-â­â¯-â¹â¼-â¿â-âââââ°-â°®â°°-â±â± -â³¤â³«-â³®â³²â³³â´-â´¥â´§â´­â´°-âµ§âµ¯â¶-â¶â¶ -â¶¦â¶¨-â¶®â¶°-â¶¶â¶¸-â¶¾â·-â·â·-â·â·-â·â·-â·â¸¯ããã±-ãµã»ã¼ã-ãã-ãã¡-ãºã¼-ã¿ã-ã­ã±-ãã -ãºã°-ã¿ã-ä¶µä¸-é¿ê-êê-ê½ê-êê-êêªê«ê-ê®ê¿-êê -ê¥ê-êê¢-êê-êê-êê -êªê¸-ê ê -ê ê -ê ê -ê ¢ê¡-ê¡³ê¢-ê¢³ê£²-ê£·ê£»ê¤-ê¤¥ê¤°-ê¥ê¥ -ê¥¼ê¦-ê¦²ê§ê¨-ê¨¨ê©-ê©ê©-ê©ê© -ê©¶ê©ºêª-êª¯êª±êªµêª¶êª¹-êª½ê«ê«ê«-ê«ê« -ê«ªê«²-ê«´ê¬-ê¬ê¬-ê¬ê¬-ê¬ê¬ -ê¬¦ê¬¨-ê¬®ê¯-ê¯¢ê°-í£í°-íí-í»ï¤-ï©­ï©°-ï«ï¬-ï¬ï¬-ï¬ï¬ï¬-ï¬¨ï¬ª-ï¬¶ï¬¸-ï¬¼ï¬¾ï­ï­ï­ï­ï­-ï®±ï¯-ï´½ïµ-ï¶ï¶-ï·ï·°-ï·»ï¹°-ï¹´ï¹¶-ï»¼ï¼¡-ï¼ºï½-ï½ï½¦-ï¾¾ï¿-ï¿ï¿-ï¿ï¿-ï¿ï¿-ï¿";t["default"]={toSlug:function(e){var t="Ã Ã¡Ã¤Ã¢Ã¨Ã©Ã«ÃªÃ¬Ã­Ã¯Ã®Ã²Ã³Ã¶Ã´Ã¹ÃºÃ¼Ã»Ã±Ã§",a="aaaaeeeeiiiioooouuuunc";e=e.replace(/^\s+|\s+$/g,"").toLowerCase();for(var n=0;n<t.length;n++)e=e.replace(new RegExp(t.charAt(n),"g"),a.charAt(n));return e=e.replace(new RegExp("[^0-9"+s+" -]","g"),"").replace(/\s+/g,"_").replace(/-+/g,"-")},createRoomJid:function(e){var t=o["default"].getAll(),a=t.group_id,n=t.conference_server,i=this.toSlug(e);return a+"_"+i+"@"+n},toXMPPDate:function(e){return _.isDate(e)?new Date(e.setMilliseconds(0)).toISOString().replace(/\.000/,""):e}},e.exports=t["default"]},function(e,t,a){"use strict";
function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(59),s=i(o),r=a(10),l=i(r),u=a(4),c=i(u),d=a(5),f=i(d),h=a(22),p=i(h),m=a(47),g=i(m),v=a(51),y=i(v),b=a(217),w=i(b),R=a(154),k=n(R),E=a(232),C=i(E),S=a(147),T=i(S),x=a(194),A=i(x),I=function(e){function t(){return(0,c["default"])(this,t),(0,p["default"])(this,(0,l["default"])(t).apply(this,arguments))}return(0,y["default"])(t,e),(0,f["default"])(t,[{key:"init",value:function(){for(var e,a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];(e=(0,g["default"])((0,l["default"])(t.prototype),"init",this)).call.apply(e,[this].concat(n)),Strophe.addNamespace("HC_LINKS",k.HC_LINKS),Strophe.addNamespace("HC_FILES",k.HC_FILES)}},{key:"getLinks",value:function(e,t,a){var n=this,i=arguments.length<=3||void 0===arguments[3]?50:arguments[3],o={xmlns:Strophe.NS.HC_LINKS,limit:i};t?o.before=C["default"].toXMPPDate(t):a&&(o.after=C["default"].toXMPPDate(a));var r=$iq({type:"get",to:e}).c("query",o);return new s["default"](function(e,a){var o=function(a){e(n._processLinksResponse(a,t,i))},s=function(e){a(T["default"].fromXMPP(e))};n.Connection.sendIQ(r.tree(),o,s)})}},{key:"getFiles",value:function(e,t,a){var n=this,i=arguments.length<=3||void 0===arguments[3]?50:arguments[3],o={xmlns:Strophe.NS.HC_FILES,limit:i};t?o.before=C["default"].toXMPPDate(t):a&&(o.after=C["default"].toXMPPDate(a));var r=$iq({type:"get",to:e}).c("query",o).c("auth_scheme","bearer");return new s["default"](function(e,a){var o=function(a){e(n._processFilesResponse(a,t,i))},s=function(e){a(T["default"].fromXMPP(e))};n.Connection.sendIQ(r.tree(),o,s)})}},{key:"_processLinksResponse",value:function(e,t,a){var n=e.getElementsByTagNameNS(Strophe.NS.HC_LINKS,"query")[0],i=Strophe.getBareJidFromJid(e.getAttribute("from")),o=n.querySelectorAll("item"),s=o.length<a,r=_.map(o,function(e){return{id:parseInt(e.querySelector("id").textContent,10),group_id:parseInt(e.querySelector("group_id").textContent,10),user_id:parseInt(e.querySelector("user_id").textContent,10),url:e.querySelector("url").textContent,date:new Date(e.querySelector("date").textContent),name:e.querySelector("url").textContent.split("/").pop()}});r=_.orderBy(r,"date","desc");var l=_.get(_.last(r),"date");return r.length&&t&&0>=t-l&&(r=[],s=!0),{jid:i,links:r,end:s}}},{key:"_processFilesResponse",value:function(e,t,a){var n=e.getElementsByTagNameNS(Strophe.NS.HC_FILES,"query")[0],i=Strophe.getBareJidFromJid(e.getAttribute("from")),o=void 0,s=void 0;o=n.querySelectorAll("authenticated_file"),0===o.length&&(o=n.querySelectorAll("item")),s=o.length<a;var r=_.map(o,function(e){return A["default"].fromXMPP(e)}),l=_.get(_.last(r),"date");return r.length&&t&&0>=t-l&&(r=[],s=!0),{jid:i,files:r,end:s}}}]),t}(w["default"]);t["default"]=I,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(59),s=i(o),r=a(10),l=i(r),u=a(4),c=i(u),d=a(5),f=i(d),h=a(22),p=i(h),m=a(47),g=i(m),v=a(51),y=i(v),b=a(217),w=i(b),R=a(154),k=n(R),E=a(147),C=i(E),S=a(169),T=i(S),x=a(161),A=i(x),I=a(184),N=i(I),M=function(e){function t(){var e;(0,c["default"])(this,t);for(var a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];var o=(0,p["default"])(this,(e=(0,l["default"])(t)).call.apply(e,[this].concat(n)));return o.idleTimestamp=null,o}return(0,y["default"])(t,e),(0,f["default"])(t,[{key:"init",value:function(){for(var e,a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];(e=(0,g["default"])((0,l["default"])(t.prototype),"init",this)).call.apply(e,[this].concat(n)),Strophe.addNamespace("HC_PRESENCE",k.HC_PRESENCE),Strophe.addNamespace("ENTITY_CAPABILITIES",k.ENTITY_CAPABILITIES),Strophe.addNamespace("LAST_ACTIVITY",k.LAST_ACTIVITY)}},{key:"sendInitialPresence",value:function(){var e=arguments.length<=0||void 0===arguments[0]?N["default"].AVAILABLE:arguments[0];return this.setPresence(e,null,!0)}},{key:"setPresence",value:function(){var e=arguments.length<=0||void 0===arguments[0]?N["default"].AVAILABLE:arguments[0],t=this,a=arguments.length<=1||void 0===arguments[1]?null:arguments[1],n=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];return new s["default"](function(i,o){var s=void 0,r=void 0;s=t.Connection.addHandler(function(){return t.Connection.deleteHandler(r),i(),!1},null,"presence",null,null,T["default"].get("jid"),{matchBare:!0}),r=t.Connection.addHandler(function(e){return t.Connection.deleteHandler(s),o(C["default"].fromXMPP(e)),!1},null,"presence","error",null,T["default"].get("jid"),{matchBare:!0}),t.Connection.send(t._createPresenceStanza(e,a,n))})}},{key:"filterPresences",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],a=T["default"].get("user_id").toString(),n=$iq({type:"set"}).c("query",{xmlns:Strophe.NS.HC_PRESENCE,action:"presence_filter"});return _.find(t,function(e){return e.toString()===a})||t.push(a),t.forEach(function(e){n.c("uid",e).up()}),new s["default"](function(t,a){e.Connection.sendIQ(n.tree(),function(e){return t()},function(e){return a(C["default"].fromXMPP(e))})})}},{key:"_createPresenceStanza",value:function(){var e=arguments.length<=0||void 0===arguments[0]?N["default"].AVAILABLE:arguments[0],t=arguments.length<=1||void 0===arguments[1]?null:arguments[1],a=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],n=$pres({roster_presences:"false"}).c("show").t(e).up();return t&&n.c("status").t(t).up(),e===N["default"].IDLE?(n.c("query",{xmlns:Strophe.NS.LAST_ACTIVITY,seconds:this._getIdleSeconds()}).up(),this._updateIdleTimestamp()):this._resetIdleTimestamp(),a&&n.c("c",{xmlns:Strophe.NS.ENTITY_CAPABILITIES,node:T["default"].get("client_node"),ver:T["default"].get("client_version_id"),os_ver:T["default"].get("client_os_version_id")}).up(),n.tree()}},{key:"_getIdlePreferenceMS",value:function(){return 60*A["default"].get("idleMinutes")*1e3}},{key:"_getIdleSeconds",value:function(){return this.idleTimestamp?Math.round(((new Date).getTime()-this.idleTimestamp+this._getIdlePreferenceMS())/1e3):this._getIdlePreferenceMS()/1e3}},{key:"_updateIdleTimestamp",value:function(){this.idleTimestamp=this.idleTimestamp?this.idleTimestamp:(new Date).getTime()}},{key:"_resetIdleTimestamp",value:function(){this.idleTimestamp=null}}]),t}(w["default"]);t["default"]=M,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(118),s=i(o),r=a(10),l=i(r),u=a(4),c=i(u),d=a(5),f=i(d),h=a(22),p=i(h),m=a(47),g=i(m),v=a(51),y=i(v),b=a(217),w=i(b),R=a(236),k=i(R),E=a(237),C=i(E),S=a(213),T=i(S),x=a(90),A=i(x),I=a(154),N=n(I),M=function(e){function t(){(0,c["default"])(this,t);var e=(0,p["default"])(this,(0,l["default"])(t).call(this));return e.queue=null,e}return(0,y["default"])(t,e),(0,f["default"])(t,[{key:"init",value:function(){for(var e,a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];(e=(0,g["default"])((0,l["default"])(t.prototype),"init",this)).call.apply(e,[this].concat(n)),this.xmlInputHandler=this.onXmlInput.bind(this),this.xmlOutputHandler=this.onXmlOutput.bind(this),this.rawInputHandler=this.onRawInput.bind(this)}},{key:"onConnected",value:function(){this.Connection.last_BOSH_activity=(new Date).getTime(),this.Connection.ConnectionHooks.addXmlInputHandler(this.xmlInputHandler),this.Connection.ConnectionHooks.addRawInputHandler(this.rawInputHandler),this.Connection.ConnectionHooks.addXmlOutputHandler(this.xmlOutputHandler)}},{key:"onXmlInput",value:function(e){try{A["default"].logXML(e,"RECV");var t=this._removeExcludedNodes(e);this.queue={xml:t,json:T["default"].xml2json(t)};var a=!!_.get(this.queue.json,"iq",!1);a&&(this.queue.json=k["default"].transform(this.queue.json))}catch(n){A["default"].type("xmpp-trap").error("Exception thrown in xmlInput handler: "+n.message+".")}return!0}},{key:"onRawInput",value:function(e){try{this.Connection.last_BOSH_activity=(new Date).getTime(),this.queue.xml&&this.queue.xml.hasChildNodes()&&(this.queue.json.message&&(this.queue.json.message=this._fixXhtmlMessageBody(e,this.queue.json.message)),C["default"].receivedServerData(this.queue.json)),this.queue=null}catch(t){A["default"].type("xmpp-trap").error("Exception thrown in rawInput handler: "+t.message+".")}return!0}},{key:"onXmlOutput",value:function(e){return A["default"].logXML(e,"SEND"),!0}},{key:"_removeExcludedNodes",value:function(e){var t=[],a=e.cloneNode(!0),n=[N.ROSTER,N.DISCO_ITEMS,N.DISCO_INFO,N.HC_LINKS,N.HC_FILES,N.HC_AUTHENTICATED_FILE];return(0,s["default"])(a.querySelectorAll("iq")).forEach(function(e){if(_.includes(["result","error"],e.getAttribute("type"))){var a=e.querySelector("query");a&&_.includes(n,a.getAttribute("xmlns"))&&t.push(e)}}),t.forEach(function(e){a.removeChild(e)}),a}},{key:"_fixXhtmlMessageBody",value:function(e,t){return _.map([].concat(t),function(t){if("http://www.w3.org/1999/xhtml"===_.get(t,"html.body.xmlns")){var a=new RegExp("mid=['\"]"+t.mid+"['\"].+?</message>","i"),n=new RegExp("<body[^>]*xmlns=[\"']http:\\/\\/www\\.w3\\.org\\/1999\\/xhtml[\"'][^>]*>(.*?)</body>","i"),i=a.exec(e)||[];i.length&&(i=n.exec(i[0])||[],i.length>1&&(t.html.body.__text=i[1]))}return t})}}]),t}(w["default"]);t["default"]=M,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(99),o=n(i);t["default"]={transform:function(e){var t=this,a=void 0,n=void 0;return _.isArray(e.iq)||(e.iq=[e.iq]),e.iq=e.iq.map(function(e){return a=_.get(e,"query.xmlns"),(n=t._getTransformer(a))(e)}),e},_getTransformer:function(e){var t=void 0;switch(e){case"http://hipchat.com/protocol/muc#room":t=this._hipchatRoomEntity;break;default:t=_.identity}return t},_hipchatRoomEntity:function(e){return _.has(e,"query.item.owner")&&(e.query.item.owner=o["default"].jid.user_id(e.query.item.owner)),e}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i);t["default"]={receivedServerData:function(e){o["default"].dispatch("server-data",e)}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(118),o=n(i),s=a(59),r=n(s),l=a(10),u=n(l),c=a(4),d=n(c),f=a(5),h=n(f),p=a(22),_=n(p),m=a(47),g=n(m),v=a(51),y=n(v),b=a(217),w=n(b),R=a(152),k=n(R),E=a(147),C=n(E),S=function(e){function t(){return(0,d["default"])(this,t),(0,_["default"])(this,(0,u["default"])(t).apply(this,arguments))}return(0,y["default"])(t,e),(0,h["default"])(t,[{key:"init",value:function(){for(var e,a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];(e=(0,g["default"])((0,u["default"])(t.prototype),"init",this)).call.apply(e,[this].concat(n))}},{key:"getRoster",value:function(){var e=this,t=$iq({type:"get"}).c("query",{xmlns:Strophe.NS.ROSTER});return new r["default"](function(a,n){var i=function(e){var t=e.getElementsByTagNameNS(Strophe.NS.ROSTER,"query")[0],n=(0,o["default"])(t.querySelectorAll("item")),i=n.map(function(e){return k["default"].fromXMPP(e)});a(i)},s=function(e){return n(C["default"].fromXMPP(e))};e.Connection.sendIQ(t.tree(),i,s)})}}]),t}(w["default"]);t["default"]=S,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(118),s=i(o),r=a(59),l=i(r),u=a(10),c=i(u),d=a(4),f=i(d),h=a(5),p=i(h),_=a(22),m=i(_),g=a(47),v=i(g),y=a(51),b=i(y),w=a(217),R=i(w),k=a(155),E=i(k),C=a(147),S=i(C),T=a(154),x=n(T),A=function(e){function t(){return(0,f["default"])(this,t),(0,m["default"])(this,(0,c["default"])(t).apply(this,arguments))}return(0,b["default"])(t,e),(0,p["default"])(t,[{key:"init",value:function(){for(var e,a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];(e=(0,v["default"])((0,c["default"])(t.prototype),"init",this)).call.apply(e,[this].concat(n)),Strophe.addNamespace("HC_EMOTICONS",x.HC_EMOTICONS)}},{key:"getEmoticons",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],a=$iq({type:"get"}).c("query",{xmlns:Strophe.NS.HC_EMOTICONS,ver:t});return new l["default"](function(t,n){var i=function(e){var a=e.getElementsByTagNameNS(Strophe.NS.HC_EMOTICONS,"query")[0],n=a.getAttribute("ver")||"",i=a.querySelector("path_prefix").textContent||"",o=(0,s["default"])(a.querySelectorAll("item")),r=o.map(function(e){return E["default"].fromXMPP(e)});t({ver:n,path_prefix:i,emoticons:r})},o=function(e){n(S["default"].fromXMPP(e))};e.Connection.sendIQ(a.tree(),i,o)})}}]),t}(R["default"]);t["default"]=A,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(59),s=i(o),r=a(100),l=i(r),u=a(118),c=i(u),d=a(10),f=i(d),h=a(4),p=i(h),m=a(5),g=i(m),v=a(22),y=i(v),b=a(47),w=i(b),R=a(51),k=i(R),E=a(217),C=i(E),S=a(152),T=i(S),x=a(153),A=i(x),I=a(155),N=i(I),M=a(144),O=i(M),D=a(154),P=n(D),j=a(163),L=a(241),F=function(e){function t(){var e;(0,p["default"])(this,t);for(var a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];var o=(0,y["default"])(this,(e=(0,f["default"])(t)).call.apply(e,[this].concat(n)));return o.disconnectedTimestamp=null,o}return(0,k["default"])(t,e),(0,g["default"])(t,[{key:"init",value:function(){for(var e,a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];(e=(0,w["default"])((0,f["default"])(t.prototype),"init",this)).call.apply(e,[this].concat(n)),Strophe.addNamespace("HC_MUC_ROOM",P.HC_MUC_ROOM),Strophe.addNamespace("HC_ROSTER_HASH",P.HC_ROSTER_HASH),Strophe.addNamespace("HC_ROOMS_HASH",P.HC_ROOMS_HASH),Strophe.addNamespace("HC_EMOTICONS",P.HC_EMOTICONS)}},{key:"onConnected",value:function(){this.Connection.addHandler(this.updateCacheFromRosterPush.bind(this),P.ROSTER,"iq","set"),this.Connection.addHandler(this.updateCacheFromRoomPush.bind(this),P.HC_MUC_ROOM,"iq","set"),this.Connection.addHandler(this.updateCacheFromEmoticonPush.bind(this),P.HC_EMOTICONS,"iq","set")}},{key:"onDisconnected",value:function(){this.disconnectedTimestamp=(new Date).getTime()}},{key:"updateCacheFromRosterPush",value:function(e){return O["default"].has(O["default"].Keys.ROSTER).then(function(t){if(t){var a=e.getElementsByTagNameNS(Strophe.NS.ROSTER,"query")[0],n=a.querySelectorAll("item"),i=(0,c["default"])(n).map(function(e){return T["default"].fromXMPP(e)});return O["default"].updateRoster(i)}})["catch"](_.noop),!0}},{key:"updateCacheFromRoomPush",value:function(e){return O["default"].has(O["default"].Keys.ROOMS).then(function(t){if(t){var a=e.getElementsByTagNameNS(Strophe.NS.HC_MUC_ROOM,"query")[0],n=a.querySelectorAll("item"),i=(0,c["default"])(n).map(function(e){return A["default"].fromXMPPMucRoom(e)});return O["default"].updateRooms(i)}})["catch"](_.noop),!0}},{key:"updateCacheFromEmoticonPush",value:function(e){return O["default"].has(O["default"].Keys.EMOTICONS).then(function(t){if(t){var a=e.getElementsByTagNameNS(Strophe.NS.HC_EMOTICONS,"query")[0],n=a.querySelectorAll("item"),i=(0,c["default"])(n).map(function(e){return N["default"].fromXMPP(e)});return O["default"].updateEmoticons({type:"set",query:{item:i}})}})["catch"](_.noop),!0}},{key:"isReconnectedWithinSyncThreshold",value:function(){var e=!1,t=void 0;return _.isFinite(this.disconnectedTimestamp)&&(t=Date.now()-this.disconnectedTimestamp,e=t<j.RECONNECT_SYNC_THRESHOLD),e}},{key:"isResourceInSync",value:function(e,t){return 0===(0,l["default"])(t).length?s["default"].resolve(!1):this.getResourceHash(e).then(function(e){var a=(0,l["default"])(t).reduce(function(e,a){return t[a].is_deleted||t[a].is_archived||e.push({id:a,version:t[a].version}),e},[]);return(0,L.create)(a)===e})}},{key:"getResourceHash",value:function(e){var t=this,a=e===O["default"].Keys.ROSTER?Strophe.NS.HC_ROSTER_HASH:Strophe.NS.HC_ROOMS_HASH,n="get",i=!0,o=$iq({type:n}).c("query",{xmlns:a,use_full_list:i});return new s["default"](function(e){var n=function(t){var n=t.getElementsByTagNameNS(a,"query")[0];e(n?n.textContent.trim():null)},i=function(){e(null)};t.Connection.sendIQ(o.tree(),n,i)})}}]),t}(C["default"]);t["default"]=F,e.exports=t["default"]},function(e,t,a){"use strict";var n=a(242),i=function(e){var t=e.concat().filter(function(e){return"id"in e&&"version"in e}).sort(function(e,t){var a=Number(e.id),n=Number(t.id);return n>a?-1:a>n?1:0}).map(function(e){return e.id+":"+e.version});return t.join(",")},o=function(e){return Array.isArray(e)?n(i(e)):""};e.exports={create:o,serialize:i}},function(e,t,a){var n;!function(i){"use strict";function o(e,t){var a=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(a>>16);return n<<16|65535&a}function s(e,t){return e<<t|e>>>32-t}function r(e,t,a,n,i,r){return o(s(o(o(t,e),o(n,r)),i),a)}function l(e,t,a,n,i,o,s){return r(t&a|~t&n,e,t,i,o,s)}function u(e,t,a,n,i,o,s){return r(t&n|a&~n,e,t,i,o,s)}function c(e,t,a,n,i,o,s){return r(t^a^n,e,t,i,o,s)}function d(e,t,a,n,i,o,s){return r(a^(t|~n),e,t,i,o,s)}function f(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;var a,n,i,s,r,f=1732584193,h=-271733879,p=-1732584194,_=271733878;for(a=0;a<e.length;a+=16)n=f,i=h,s=p,r=_,f=l(f,h,p,_,e[a],7,-680876936),_=l(_,f,h,p,e[a+1],12,-389564586),p=l(p,_,f,h,e[a+2],17,606105819),h=l(h,p,_,f,e[a+3],22,-1044525330),f=l(f,h,p,_,e[a+4],7,-176418897),_=l(_,f,h,p,e[a+5],12,1200080426),p=l(p,_,f,h,e[a+6],17,-1473231341),h=l(h,p,_,f,e[a+7],22,-45705983),f=l(f,h,p,_,e[a+8],7,1770035416),_=l(_,f,h,p,e[a+9],12,-1958414417),p=l(p,_,f,h,e[a+10],17,-42063),h=l(h,p,_,f,e[a+11],22,-1990404162),f=l(f,h,p,_,e[a+12],7,1804603682),_=l(_,f,h,p,e[a+13],12,-40341101),p=l(p,_,f,h,e[a+14],17,-1502002290),h=l(h,p,_,f,e[a+15],22,1236535329),f=u(f,h,p,_,e[a+1],5,-165796510),_=u(_,f,h,p,e[a+6],9,-1069501632),p=u(p,_,f,h,e[a+11],14,643717713),h=u(h,p,_,f,e[a],20,-373897302),f=u(f,h,p,_,e[a+5],5,-701558691),_=u(_,f,h,p,e[a+10],9,38016083),p=u(p,_,f,h,e[a+15],14,-660478335),h=u(h,p,_,f,e[a+4],20,-405537848),f=u(f,h,p,_,e[a+9],5,568446438),_=u(_,f,h,p,e[a+14],9,-1019803690),p=u(p,_,f,h,e[a+3],14,-187363961),h=u(h,p,_,f,e[a+8],20,1163531501),f=u(f,h,p,_,e[a+13],5,-1444681467),_=u(_,f,h,p,e[a+2],9,-51403784),p=u(p,_,f,h,e[a+7],14,1735328473),h=u(h,p,_,f,e[a+12],20,-1926607734),f=c(f,h,p,_,e[a+5],4,-378558),_=c(_,f,h,p,e[a+8],11,-2022574463),p=c(p,_,f,h,e[a+11],16,1839030562),h=c(h,p,_,f,e[a+14],23,-35309556),f=c(f,h,p,_,e[a+1],4,-1530992060),_=c(_,f,h,p,e[a+4],11,1272893353),p=c(p,_,f,h,e[a+7],16,-155497632),h=c(h,p,_,f,e[a+10],23,-1094730640),f=c(f,h,p,_,e[a+13],4,681279174),_=c(_,f,h,p,e[a],11,-358537222),p=c(p,_,f,h,e[a+3],16,-722521979),h=c(h,p,_,f,e[a+6],23,76029189),f=c(f,h,p,_,e[a+9],4,-640364487),_=c(_,f,h,p,e[a+12],11,-421815835),p=c(p,_,f,h,e[a+15],16,530742520),h=c(h,p,_,f,e[a+2],23,-995338651),f=d(f,h,p,_,e[a],6,-198630844),_=d(_,f,h,p,e[a+7],10,1126891415),p=d(p,_,f,h,e[a+14],15,-1416354905),h=d(h,p,_,f,e[a+5],21,-57434055),f=d(f,h,p,_,e[a+12],6,1700485571),_=d(_,f,h,p,e[a+3],10,-1894986606),p=d(p,_,f,h,e[a+10],15,-1051523),h=d(h,p,_,f,e[a+1],21,-2054922799),f=d(f,h,p,_,e[a+8],6,1873313359),_=d(_,f,h,p,e[a+15],10,-30611744),p=d(p,_,f,h,e[a+6],15,-1560198380),h=d(h,p,_,f,e[a+13],21,1309151649),f=d(f,h,p,_,e[a+4],6,-145523070),_=d(_,f,h,p,e[a+11],10,-1120210379),p=d(p,_,f,h,e[a+2],15,718787259),h=d(h,p,_,f,e[a+9],21,-343485551),f=o(f,n),h=o(h,i),p=o(p,s),_=o(_,r);return[f,h,p,_]}function h(e){var t,a="";for(t=0;t<32*e.length;t+=8)a+=String.fromCharCode(e[t>>5]>>>t%32&255);return a}function p(e){var t,a=[];for(a[(e.length>>2)-1]=void 0,t=0;t<a.length;t+=1)a[t]=0;for(t=0;t<8*e.length;t+=8)a[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return a}function _(e){return h(f(p(e),8*e.length))}function m(e,t){var a,n,i=p(e),o=[],s=[];for(o[15]=s[15]=void 0,i.length>16&&(i=f(i,8*e.length)),a=0;16>a;a+=1)o[a]=909522486^i[a],s[a]=1549556828^i[a];return n=f(o.concat(p(t)),512+8*t.length),h(f(s.concat(n),640))}function g(e){var t,a,n="0123456789abcdef",i="";for(a=0;a<e.length;a+=1)t=e.charCodeAt(a),i+=n.charAt(t>>>4&15)+n.charAt(15&t);return i}function v(e){return unescape(encodeURIComponent(e))}function y(e){return _(v(e))}function b(e){return g(y(e))}function w(e,t){return m(v(e),v(t))}function R(e,t){return g(w(e,t))}function k(e,t,a){return t?a?w(t,e):R(t,e):a?y(e):b(e)}n=function(){return k}.call(t,a,t,e),!(void 0!==n&&(e.exports=n))}(this)},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(157),s=i(o),r=a(4),l=i(r),u=a(5),c=i(u),d=a(244),f=i(d),h=a(245),p=i(h),m=a(169),g=i(m),v=a(99),y=i(v),b=a(90),w=i(b),R=a(218),k=i(R),E=a(163),C=n(E),S=a(144),T=i(S),x=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];(0,l["default"])(this,e),this.request=new f["default"],this.logLevel=null,this.queued=!1,this.waiting=!1,this.disabled=!1,this.fetched=!1,this.timer=null,this.backoff=C.READSTATE_DEFAULT_BACKOFF,this.retryCount=0,this.api_token=null,this.fetchCallback=t.fetchCallback||_.noop,this.patchCallback=t.patchCallback||_.noop,this.state={server:null,client:{},inflight:{}},this.debouncedPatch=_.debounce(this.tryPatch,C.READSTATE_UPDATE_DEBOUNCE).bind(this)}return(0,c["default"])(e,[{key:"log",value:function(){-1!==w["default"].levels.indexOf(this.logLevel)&&w["default"][this.logLevel].apply(w["default"],arguments)}},{key:"loadStorage",value:function(){var e=this;return this.log("[ReadState] loadStorage"),T["default"].get(T["default"].Keys.READSTATE).then(function(t){_.isPlainObject(t)&&!_.isEmpty(t)&&(e.state.client=t,T["default"].unset(T["default"].Keys.READSTATE),e.queued=!0)})}},{key:"fetch",value:function(){this.log("[ReadState] fetch"),this.clearTimer(),this.state.server=null,this.fetched=!1,this.tryFetch()}},{key:"update",value:function(e){return y["default"].jid.is_chat(e.jid)?(this.log("[ReadState] update",e),this.state.client[e.jid]={op:"add",mid:e.mid,timestamp:e.timestamp},T["default"].set(T["default"].Keys.READSTATE,this.state.client),void(this.fetched&&this.debouncedPatch())):!1}},{key:"remove",value:function(e){return y["default"].jid.is_chat(e.jid)?(this.log("[ReadState] remove",e),this.state.client[e.jid]={op:"remove"},T["default"].set(T["default"].Keys.READSTATE,this.state.client),void(this.fetched&&this.debouncedPatch())):!1}},{key:"retry",value:function(){this.log("[ReadState] retry"),this.disabled=!1,this.dequeue()}},{key:"reset",value:function(){this.log("[ReadState] reset"),this.clearTimer(),this.queued=!1,this.state.client={},T["default"].unset(T["default"].Keys.READSTATE)}},{key:"tryFetch",value:function(){return this.log("[ReadState] tryFetch"),k["default"].isOnline()?this.waiting?void this.log("[ReadState] Aborting fetch",{waiting:this.waiting}):(this.waiting=!0,this.disabled=!1,this.api_token=g["default"].get("oauth_token"),void(this.queued?this.request.get(this.handleRefetchResponse.bind(this),!1):this.request.get(this.handleGetResponse.bind(this),!0))):(this.log("[ReadState] Aborting fetch",{isOnline:k["default"].isOnline()}),this.fetchCallback(p["default"].OFFLINE,null),void this.enqueue(this.backoff))}},{key:"tryPatch",value:function(){return this.log("[ReadState] tryPatch"),k["default"].isOnline()?this.waiting?(this.log("[ReadState] Aborting patch",{waiting:this.waiting}),void(this.queued=!0)):this.state.server?this.disabled?void this.log("[ReadState] Aborting patch",{disabled:this.disabled}):void this.patch(this.state.client):(this.log("[ReadState] Aborting patch",{serverState:this.state.server}),this.queued=!0,void this.fetch()):(this.log("[ReadState] Aborting patch",{isOnline:k["default"].isOnline()}),void this.patchCallback(p["default"].OFFLINE,null))}},{key:"patch",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],a=this.buildPatchBody(e);return 0===a.length?(this.log("[ReadState] Aborting patch",{patch_data:a,withCounts:t}),this.queued=!1,void(t&&(this.fetch(),this.waiting=!0))):(this.log("[ReadState] Sending patch data",a),this.waiting=!0,this.queued=!1,this.api_token=g["default"].get("oauth_token"),T["default"].unset(T["default"].Keys.READSTATE),this.state.inflight=_.clone(e),this.state.client={},void this.request.patch(a,this.handlePatchResponse.bind(this),t))}},{key:"buildPatchBody",value:function(e){var t=this,a=[];return _.forOwn(e,function(e,n){var i={op:e.op,path:"/"+n};"add"===e.op&&(i.value={mid:e.mid||C.READSTATE_NULL_MID,timestamp:e.timestamp?e.timestamp.toFixed(6):C.READSTATE_NULL_TS});var o=_.get(t.state.server[n],"timestamp",0);("remove"===e.op||!o||e.timestamp&&o<e.timestamp)&&a.push(i)}),a}},{key:"handleResponse",value:function(e,t){this.disabled=!1,this.waiting=!1,this.handleError(e),this.updateBackoffInterval(t,e),this.handleBackoff()}},{key:"handleError",value:function(e){var t,a=this;if(!e)return this.retryCount=0,!1;this.queued=!0;var n=(t={},(0,s["default"])(t,p["default"].UNAUTHORIZED,function(){a.disabled=!0,a.api_token!==g["default"].get("oauth_token")?a.retry():g["default"].once("change:oauth_token",a.retry.bind(a))}),(0,s["default"])(t,p["default"].BAD_REQUEST,function(){a.disabled=!0,a.reset()}),(0,s["default"])(t,p["default"].DISABLED,function(){a.disabled=!0}),(0,s["default"])(t,p["default"].RATE_LIMITED,function(){a.retryCount++}),(0,s["default"])(t,p["default"].UNAVAILABLE,function(){a.retryCount++}),t);n[e]&&(this.log("[ReadState] handleError: %s",e),n[e]())}},{key:"handleServerData",value:function(e){return e=e&&Array.isArray(e.items)?e.items:[],this.resetServerState(e),this.fetched=!0,e}},{key:"handleGetResponse",value:function(e,t,a){var n=null;this.handleResponse(e,a),e||(n=this.handleServerData(t)),this.fetchCallback(e,n)}},{key:"handleRefetchResponse",value:function(e,t,a){return this.handleResponse(e,a),e?this.fetchCallback(e,null):(this.handleServerData(t),void this.patch(this.state.client,!0))}},{key:"handlePatchResponse",value:function(e,t,a){if(this.handleResponse(e,a),e?this.reapplyInflightData():this.updateServerState(),t){var n=this.handleServerData(t);this.fetchCallback(e,n)}this.patchCallback(e,t)}},{key:"updateBackoffInterval",value:function(e,t){var a=e.backoff?1e3*e.backoff:0;t===p["default"].RATE_LIMITED?a=this.handleRateLimitReset(e.rateLimitReset,e.serverTime,a):t===p["default"].UNAVAILABLE&&(a=this.jitterBackoff(a),a=Math.min(a,C.READSTATE_MAX_BACKOFF)),a&&a!==this.backoff&&(this.log("[ReadState] Changing backoff interval. New value: %s",a),this.backoff=a)}},{key:"handleRateLimitReset",value:function(e,t,a){var n=t?t:Date.now(),i=e+5-n;return i>0?1e3*i:this.jitterBackoff(a)}},{key:"jitterBackoff",value:function(e){var t=C.READSTATE_MAX_BACKOFF,a=C.READSTATE_DEFAULT_BACKOFF,n=C.READSTATE_BACKOFF_FACTOR;return y["default"].decorrelatedJitter(t,e||a,this.backoff,n)}},{key:"handleBackoff",value:function(){this.log("[ReadState] handleBackoff",{backoff:this.backoff,disabled:this.disabled}),this.clearTimer(),this.backoff&&!this.disabled&&this.enqueue(this.backoff)}},{key:"enqueue",value:function(e){this.waiting=!0,this.timer=setTimeout(this.dequeue.bind(this),e)}},{key:"dequeue",value:function(){this.log("[ReadState] dequeue"),this.clearTimer(),this.state.server&&this.fetched?this.queued&&(this.queued=!1,this.tryPatch(!1)):this.fetch()}},{key:"clearTimer",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null,this.waiting=!1)}},{key:"resetServerState",value:function(e){var t=this;this.state.server={},Array.isArray(e)&&e.forEach(function(e){e.xmppJid&&(t.state.server[e.xmppJid]={mid:e.mid,timestamp:Number(e.timestamp)})})}},{key:"reapplyInflightData",value:function(){var e=this;_.forOwn(this.state.inflight,function(t,a){(!e.state.client[a]||t.timestamp>e.state.client[a].timestamp)&&(e.state.client[a]=t)}),this.state.inflight={},T["default"].set(T["default"].Keys.READSTATE,this.state.client)}},{key:"updateServerState",value:function(){var e=this;this.state.server||(this.state.server={}),_.forOwn(this.state.inflight,function(t,a){e.state.server[a]&&"remove"===t.op?delete e.state.server[a]:(!e.state.server[a]||t.timestamp>Number(e.state.server[a].timestamp))&&(e.state.server[a]=t)}),this.state.inflight={}}}]),e}();t["default"]=x,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(91),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(245),d=n(c),f=a(169),h=n(f),p=a(90),_=n(p),m=a(103),g=n(m),v=function(){function e(){(0,r["default"])(this,e)}return(0,u["default"])(e,[{key:"request",value:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?null:arguments[2],n=this,i=arguments.length<=3||void 0===arguments[3]?function(){}:arguments[3],s=arguments.length<=4||void 0===arguments[4]?new XMLHttpRequest:arguments[4];if(e&&t){var r=function(e){var t=e.target,a=n.handleResponse(t),o=a.err,s=a.body,r=a.res;"function"==typeof i&&i(o,s,r)};return s.open(e,t),s.setRequestHeader("Authorization","Bearer "+h["default"].getOAuthToken()),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),"PATCH"===e.toUpperCase()?s.setRequestHeader("Content-Type","application/json-patch+json"):s.setRequestHeader("Content-Type","application/json"),s.addEventListener("load",r),s.addEventListener("error",r),s.addEventListener("abort",r),s.addEventListener("timeout",r),a&&(a=(0,o["default"])(a)),s.send(a),s}}},{key:"getUrl",value:function(e){var t=h["default"].get("api_host"),a=e?"?expand=items.unreadCount":"";return"https://"+t+"/v2/readstate"+a}},{key:"get",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],a=this.getUrl(t);return _["default"].log("[ReadStateRequest] Initiating get request",a),this.request("GET",a,null,e)}},{key:"patch",value:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],n=this.getUrl(a);return this.request("PATCH",n,e,t)}},{key:"handleResponse",value:function(e){var t=d["default"].handleRequestErrors(e.status),a=e.getResponseHeader("Date"),n="ddd, D MMM YYYY H:mm:ss",i={status:e.status,backoff:e.getResponseHeader("X-Backoff"),rateLimitReset:Number(e.getResponseHeader("X-RateLimit-Reset")),serverTime:a?Number(g["default"].utc(a,n).unix()):null},o=void 0;try{o=JSON.parse(e.responseText)}catch(s){o=null}return{err:t,body:o,res:i}}}]),e}();t["default"]=v,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={OFFLINE:"offline",UNAUTHORIZED:"unauthorized",DISABLED:"disabled",RATE_LIMITED:"rateLimited",BAD_REQUEST:"badRequest",UNAVAILABLE:"unavailable",handleRequestErrors:function(e){var t=null;return 401===e?a.UNAUTHORIZED:404===e?a.DISABLED:429===e?a.RATE_LIMITED:e>=400&&500>e?a.BAD_REQUEST:!e||e>=500?a.UNAVAILABLE:t}};t["default"]=a,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(91),o=n(i),s=a(23),r=n(s),l=a(59),u=n(l),c=a(4),d=n(c),f=a(5),h=n(f),p=a(247),m=n(p),g=a(169),v=n(g),y=a(90),b=n(y),w=a(141),R=n(w),k=a(99),E=n(k),C=a(170),S=n(C),T=2048,x=R["default"].connect_api_version,A=function(){
function e(){var t=this;(0,d["default"])(this,e),this.room={recent_history:function(e,a){t.request("GET","room/"+e.path.identifier+"/history/latest",e.params,a)},invite_users:function(e,a){t.request("POST","room/"+e.path.identifier+"/invite/"+e.user_id,e.params,a)},update_room:function(e,a){t.request("PUT","room/"+e.path.identifier,e.params,a,!0)},share_file:function(e){return e.params.token=v["default"].getOAuthToken(),m["default"].uploadFile(t.getUrl("room/"+e.path.identifier+"/share/file"),e.params)}},this.user={recent_history:function(e,a){t.request("GET","user/"+e.path.identifier+"/history/latest",e.params,a)},share_file:function(e){return e.params.token=v["default"].getOAuthToken(),m["default"].uploadFile(t.getUrl("user/"+e.path.identifier+"/share/file"),e.params)},send_private_message:function(e){t.request("POST","user/"+e.path.identifier+"/message",e.params,_.noop,!0)}},this.integrations={sync:function(e,a){function n(e,t){var a={knownIntegrations:{},connectApiVersion:x};return _.each(t||[],function(e){a.knownIntegrations[e]={}}),_.each(e,function(e,n){_.includes(t,n)&&(a.knownIntegrations[n]={},_.each(e,function(e){a.knownIntegrations[n][e.addon_key]=e.version}))}),a}var i=_.map(e.room_ids,function(e){return String(e)}),o=n(e.integrations,i);t.request("POST","addon/sync",o,a,!0)},getSignedUrl:function(e,a,n){t.integrations._signedUrl(e,a,n)},requestWithSignedUrl:function(e,a,n){t.integrations._signedUrl(e,a,function(e,a){var i=e?e.location:null;i?(i=E["default"].addConnectApiVersionToUrl(i),t.requestUrl("GET",i,null,null,n,null,e.timeout)):n(e,a)})},fetchAllGlancesForRoom:function(e,a){var n=new u["default"](function(a,n){t.integrations._allSignedGlances(e,function(e,i){if(!e||e.error||i.status>=300){var o=e&&e.error?e.error:"(status code: "+i.status+")";n(o)}else{var s=_.map(e,function(a,n){var o=new u["default"](function(o,s){if(a.success)!function(){var e=E["default"].addConnectApiVersionToUrl(a.url);t.requestUrl("GET",e,null,null,function(t,a){o({path:e,data:t,result:a})})}();else{b["default"].warn("[HC-Integrations]","Failed to fetch signed url for Glance "+n);var r=null;o({path:r,data:e,result:i})}});return{promise:o,key:n}});a(s)}})});a(n)},_signedUrl:function(e,a,n){var i=e.extension,o=e.attribute||"url",s={},r=e.extension[o];if(r){var l=new S["default"](r);s=l.getTemplateValuesFromParameters(a)}var u=o+"@"+i.type,c="addon/signed-url/"+e.room_id+"/"+i.addon_key+"/"+u+"/"+i.key+"/"+i.addon_timestamp;t.request("GET",c,s,n,null,e.timeout)},_allSignedGlances:function(e,a){t.request("GET","addon/signed-urls/"+e.room_id+"/glances",{},a,null,e.timeout)}}}return(0,h["default"])(e,[{key:"getAPIRoot",value:function(){var e=v["default"].get("api_host");return"https://"+e+"/v2/"}},{key:"url",value:function t(e,a){function n(e){var t="",a=["?","&"];return"string"==typeof e?(t=encodeURI(e),a.forEach(function(e){t=t.replace(new RegExp("\\"+e,"g"),encodeURIComponent(e))}),t):void 0}var t=this.getAPIRoot()+n(e),i=[],o=function(e){for(var t in e)e[t]&&i.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return i.length?"?"+i.join("&"):""};return a?"object"===("undefined"==typeof a?"undefined":(0,r["default"])(a))?(a=_.omitBy(a,function(e){return!e}),t+o(a)):void 0:t}},{key:"getUrl",value:function(e,t,a){return a?this.url(e):this.url(e,t)}},{key:"request",value:function(e,t,a,n,i,o){var s=this.getUrl(t,a,i);s.length>T&&b["default"].warn("Unsafe URL length ("+s.length+"): "+s),this.requestUrl(e,s,v["default"].getOAuthToken(),a,n,i,o)}},{key:"requestUrl",value:function(e,t,a,n,i,s,r){var l=this,u={url:t,type:e};r&&(u.timeout=r),s&&(u.contentType="application/json",u.data=(0,o["default"])(n)),a&&(u.beforeSend=function(e){e.setRequestHeader("Authorization","Bearer "+a)}),$.ajax(u).done(function(e,t,a){l.handleResponse(a,i)}).fail(function(e){l.handleResponse(e,i)})}},{key:"handleResponse",value:function(e,t){var a=e.responseText;if(_.isString(a)&&""!==a)try{a=JSON.parse(a)}catch(n){a={error:n}}t(a,e)}}]),e}();t["default"]=new A,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(91),o=n(i),s=a(59),r=n(s),l=a(248),u=n(l),c=a(90),d=n(c),f=a(89);t["default"]={_readFile:function(e){return new r["default"](function(t,a){var n=new FileReader;n.onloadend=function(){n.error?a(n.error):t(n.result),n.onloadend=null},n.readAsArrayBuffer(e)})},_getRequestBody:function(e,t){for(var a=e.fileContent,n=e.fileType,i=e.fileName,s=e.message,r=new Uint8Array(a),l="application/json"===n?"text/plain":n,c=u["default"].encode(["--"+t,"\r\n","Content-Type: application/json; charset=UTF-8","\r\n",'Content-Disposition: attachment; name="metadata"',"\r\n\r\n",(0,o["default"])({message:s}),"\r\n","--"+t,"\r\n","Content-Type: "+l,"\r\n",'Content-Disposition: attachment; name="file"; filename="'+i+'"',"\r\n\r\n"].join("")),d="\r\n--"+t+"--",f=c.length+r.byteLength+d.length,h=new ArrayBuffer(f),p=new Uint8Array(h,0),_=0,m=0;_<c.length;_++)p[_]=255&c.charCodeAt(_);for(m=0;m<r.byteLength;_++,m++)p[_]=r[m];for(m=0;m<d.length;_++,m++)p[_]=255&d.charCodeAt(m);return new Blob([h])},_getXHREventSource:function(e){return e.upload||e},_registerXHREvents:function(e,t){var a=this._getXHREventSource(e),n=void 0,i=void 0,o=void 0,s=void 0;i=function(e){var a=e.position||e.loaded,n=e.totalSize||e.total,i=a/n;t.emit("progress",i)},o=function(){if(4===e.readyState){if(204===e.status)t.emit("success");else{var a={code:e.status,message:"Unexpected error!"};e.responseXML&&e.responseXML.getElementsByTagName("error").length&&(a=e.responseXML.getElementsByTagName("error")[0].firstChild.nodeValue);try{var i=JSON.parse(e.response);i.error&&(a=i.error)}catch(o){d["default"].error(o)}t.emit("error",a)}n()}},s=function(e){t.emit("error",e),n()},n=function(){a.removeEventListener("progress",i),e.removeEventListener("readystatechange",o),e.removeEventListener("error",s),e.blob=null,t.emit("complete")},a.addEventListener("progress",i),e.addEventListener("readystatechange",o),e.addEventListener("error",s)},_sendRequest:function(e,t,a,n){a.open("POST",t.url,!0),a.setRequestHeader("Content-Type","multipart/related; boundary="+t.boundary+"; charset=UTF-8"),a.setRequestHeader("Authorization","Bearer "+t.token),a.blob=this._getRequestBody(e,t.boundary),this._registerXHREvents(a,n),a.send(a.blob)},uploadFile:function(e,t){var a=this,n=t.token,i=t.file,o=t.fileName,s=t.message,r=new f.EventEmitter,l=new XMLHttpRequest,u="hcb_"+Math.random().toString(36).substring(7);return this._readFile(i).then(function(t){a._sendRequest({fileContent:t,fileName:o,fileType:i.type,message:s},{boundary:u,token:n,url:e},l,r)})["catch"](function(e){r.emit("error",e),r.emit("complete")}),r}},e.exports=t["default"]},function(e,t,a){var n;(function(e,i){!function(o){function s(e){for(var t,a,n=[],i=0,o=e.length;o>i;)t=e.charCodeAt(i++),t>=55296&&56319>=t&&o>i?(a=e.charCodeAt(i++),56320==(64512&a)?n.push(((1023&t)<<10)+(1023&a)+65536):(n.push(t),i--)):n.push(t);return n}function r(e){for(var t,a=e.length,n=-1,i="";++n<a;)t=e[n],t>65535&&(t-=65536,i+=b(t>>>10&1023|55296),t=56320|1023&t),i+=b(t);return i}function l(e){if(e>=55296&&57343>=e)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function u(e,t){return b(e>>t&63|128)}function c(e){if(0==(4294967168&e))return b(e);var t="";return 0==(4294965248&e)?t=b(e>>6&31|192):0==(4294901760&e)?(l(e),t=b(e>>12&15|224),t+=u(e,6)):0==(4292870144&e)&&(t=b(e>>18&7|240),t+=u(e,12),t+=u(e,6)),t+=b(63&e|128)}function d(e){for(var t,a=s(e),n=a.length,i=-1,o="";++i<n;)t=a[i],o+=c(t);return o}function f(){if(y>=v)throw Error("Invalid byte index");var e=255&g[y];if(y++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function h(){var e,t,a,n,i;if(y>v)throw Error("Invalid byte index");if(y==v)return!1;if(e=255&g[y],y++,0==(128&e))return e;if(192==(224&e)){var t=f();if(i=(31&e)<<6|t,i>=128)return i;throw Error("Invalid continuation byte")}if(224==(240&e)){if(t=f(),a=f(),i=(15&e)<<12|t<<6|a,i>=2048)return l(i),i;throw Error("Invalid continuation byte")}if(240==(248&e)&&(t=f(),a=f(),n=f(),i=(15&e)<<18|t<<12|a<<6|n,i>=65536&&1114111>=i))return i;throw Error("Invalid UTF-8 detected")}function p(e){g=s(e),v=g.length,y=0;for(var t,a=[];(t=h())!==!1;)a.push(t);return r(a)}var _="object"==typeof t&&t,m=("object"==typeof e&&e&&e.exports==_&&e,"object"==typeof i&&i);m.global!==m&&m.window!==m||(o=m);var g,v,y,b=String.fromCharCode,w={version:"2.0.0",encode:d,decode:p};n=function(){return w}.call(t,a,t,e),!(void 0!==n&&(e.exports=n))}(this)}).call(t,a(104)(e),function(){return this}())},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(100),s=i(o),r=a(250),l=i(r),u=a(152),c=i(u),d=a(154),f=n(d),h={getRosterAsXMPP:function(){return this.getRoster().then(function(e){return{iq:{query:{item:(0,s["default"])(e).map(function(t){return c["default"].asX2JS(e[t])}),xmlns:f.ROSTER},type:"result",xmlns:f.JABBER}}})},getRoster:function(){return l["default"].getRoster()}};t["default"]=h,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(127),s=i(o),r=a(59),l=i(r),u=a(99),c=i(u),d=a(163),f=n(d),h=a(208),p=i(h),m=a(220),g=i(m),v=a(144),y=i(v),b=a(147),w=i(b),R={getRoster:function(){var e=this,t=function(t){return e._tryToSync(e._syncRosterViaREST.bind(e),t)["catch"](function(t){return e._syncRosterViaXMPP()})};return y["default"].get(y["default"].Keys.ROSTER).then(function(e){return p["default"].Connection.Cache.isReconnectedWithinSyncThreshold()?p["default"].Connection.Cache.isResourceInSync(y["default"].Keys.ROSTER,e).then(function(a){return a?e:t(e)}):t(e)})},getRoomsList:function(){var e=this,t=function(t){return e._tryToSync(e._syncRoomsViaREST.bind(e),t)["catch"](function(t){return e._syncRoomsViaXMPP()})};return y["default"].get(y["default"].Keys.ROOMS).then(function(e){return p["default"].Connection.Cache.isReconnectedWithinSyncThreshold()?p["default"].Connection.Cache.isResourceInSync(y["default"].Keys.ROOMS,e).then(function(a){return a?e:t(e)}):t(e)})},_tryToSync:function(e){for(var t=arguments.length,a=Array(t>1?t-1:0),n=1;t>n;n++)a[n-1]=arguments[n];return new l["default"](function(t,n){var i=1,o=f.RECONNECT_DELAY_MS,s=void 0,r=void 0;r=function(e){return i>=5?void n(w["default"].ofType(w["default"].Types.RATE_LIMITED)):_.includes([403,404],e.status)?void n(e):(i++,o=c["default"].decorrelatedJitter(f.RECONNECT_MAX_DELAY,f.RECONNECT_DELAY_MS,o,f.RECONNECT_BACKOFF_FACTOR),void setTimeout(s,o))},(s=function(){e.apply(void 0,a).then(t)["catch"](r)})()})},_syncRosterViaREST:function(e){var t=e?_.cloneDeep(e):{};return g["default"].syncRoster(e).then(function(e){return e.forEach(function(e){t[e.id]=e}),l["default"].all([y["default"].updateRoster(e),p["default"].Connection.Cache.isResourceInSync(y["default"].Keys.ROSTER,t)])}).then(function(e){var a=(0,s["default"])(e,2),n=a[1];return n?t:l["default"].reject(w["default"].ofType(w["default"].Types.OUT_OF_SYNC))})},_syncRoomsViaREST:function(e){var t=e?_.cloneDeep(e):{};return g["default"].syncRooms(e).then(function(e){return e.forEach(function(e){t[e.id]=e}),l["default"].all([y["default"].updateRooms(e),p["default"].Connection.Cache.isResourceInSync(y["default"].Keys.ROOMS,t)])}).then(function(e){var a=(0,s["default"])(e,2),n=a[1];return n?t:l["default"].reject(w["default"].ofType(w["default"].Types.OUT_OF_SYNC))})},_syncRosterViaXMPP:function(){var e=void 0;return p["default"].Connection.Roster.getRoster().then(function(t){return e=t.reduce(function(e,t){return e[t.id]=t,e},{}),y["default"].set(y["default"].Keys.ROSTER,e)["catch"](_.noop)}).then(function(){return e})},_syncRoomsViaXMPP:function(){var e=void 0;return p["default"].Connection.Rooms.getAll().then(function(t){return e=t.reduce(function(e,t){return e[t.id]=t,e},{}),y["default"].set(y["default"].Keys.ROOMS,e)["catch"](_.noop)}).then(function(){return e})}};t["default"]=R,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(100),s=i(o),r=a(250),l=i(r),u=a(144),c=i(u),d=a(232),f=i(d),h=a(208),p=i(h),m=a(220),g=i(m),v=a(246),y=i(v),b=a(153),w=i(b),R=a(154),k=n(R),E=a(169),C=i(E),S=a(90),T=i(S),x={create:function(e,t,a){var n=this,i=function(){return g["default"].createRoom(e,t,a)["catch"](function(){return p["default"].Connection.Rooms.create(e,t,a)})},o=function(t){return n.getById(t.id)["catch"](function(){return n.getByJid(f["default"].createRoomJid(e))})};return _.get(C["default"].get("feature_flags"),"web_client_coral_room_creation",!1)?i().then(o):p["default"].Connection.Rooms.create(e,t,a).then(function(){return n.getByJid(f["default"].createRoomJid(e))})},"delete":function(e,t){return g["default"].deleteRoom(e)["catch"](function(e){return T["default"].error("[REST:delete-room]",e),p["default"].Connection.Rooms["delete"](t)})},getById:function(e){return g["default"].fetchRoom(e).then(function(e){return c["default"].updateRooms([e]),e})},getByJid:function(e){return p["default"].Connection.Rooms.fetch(e).then(function(e){return c["default"].updateRooms([e]),e})},setPrivacy:function(e,t){return p["default"].Connection.Rooms.setPrivacy(e,t)},rename:function(e,t){return p["default"].Connection.Rooms.rename(e,t)},setTopic:function(e,t){return p["default"].Connection.Rooms.setTopic(e,t)},setGuestAccess:function(e,t){return p["default"].Connection.Rooms.setGuestAccess(e,t)},update:function(e){var t=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1];y["default"].room.update_room(e,t)},uploadAvatar:function(e,t){return g["default"].uploadRoomAvatar(e,t)},getRoomsAsXMPP:function(){return this.getRoomsList().then(function(e){return{iq:{query:{item:(0,s["default"])(e).map(function(t){return w["default"].asX2JS(e[t])}),xmlns:k.DISCO_ITEMS},type:"result",xmlns:k.JABBER}}})},getRoomsList:function(){return l["default"].getRoomsList()}};t["default"]=x,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(100),s=i(o),r=a(144),l=i(r),u=a(155),c=i(u),d=a(208),f=i(d),h=a(154),p=n(h),m={getEmoticonsAsXMPP:function(e){var t=_.get(e,"query.ver","");return this.getEmoticons(t).then(function(e){var t=e.ver,a=e.path_prefix,n=e.emoticons,i={query:{ver:t,path_prefix:a,item:(0,s["default"])(n).map(function(e){return c["default"].asX2JS(n[e])}),xmlns:p.HC_EMOTICONS},type:"result",xmlns:p.JABBER};return l["default"].updateEmoticons(i),i})["catch"](function(){return null})},getEmoticons:function(e){return f["default"].Connection.Emoticons.getEmoticons(e)}};t["default"]=m,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(208),o=n(i),s=a(99),r=n(s),l={getSessionRecoveryTime:function(){return o["default"].Connection.allowedInactivityInterval-(r["default"].now()-o["default"].Connection.last_BOSH_activity)}};t["default"]=l,e.exports=t["default"]},function(e,t){!function(){var e,t;e=function(){var e={},t={};return e.getLocalStorage=function(){return window.localStorage},e.getSessionStorage=function(){return window.sessionStorage},e.getInternalStorage=function(){return t.getItem=function(e){return t[e]},t.setItem=function(e,a){t[e]=a},t.clear=function(){t={}},t},e.getStorage=function(){var t;try{var a=e.getLocalStorage();t="undefined"!=typeof a?a:e.getSessionStorage()}catch(n){}return"undefined"==typeof t&&(t=e.getInternalStorage()),t},e.isCORSRequest=function(e){var t=document.createElement("a");return t.href=e,t.host!==window.location.host},e.useXDomainRequest=function(t){return e.isCORSRequest(t)&&!!window.XDomainRequest&&(-1!==navigator.appVersion.indexOf("MSIE 8.")||-1!==navigator.appVersion.indexOf("MSIE 9."))},e.getCookieValue=function(e){for(var t=e+"=",a=document.cookie.split(";"),n=0;n<a.length;n++){for(var i=a[n];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null},e}(),t=function(e){function t(e){return n&&n.is_started?(n.stop(),n.config=n.parseConfig(e)):(n=new a(e),window["herment-gas-client"]=n),n}function a(t){return this.STORAGE_KEY_PREAMBLE="herment",this.MAXEVENTS=100,this.PUBLISH_INTERVAL=5e3,this.SAVE_INTERVAL=1e3,this.config=this.parseConfig(t),this.storage=e.getStorage(),this.is_started=!1,"undefined"!=typeof window.addEventListener?window.addEventListener("unload",function(){this.moveQueueToStorage()}.bind(this)):window.attachEvent("onunload",function(){this.moveQueueToStorage()}.bind(this)),this}var n=window["herment-gas-client"];return a.prototype={getAtlPath:function(){return e.getCookieValue("__atl_path")},getServerName:function(){var e;return"undefined"!=typeof document.location&&"undefined"!=typeof document.location.hostname&&(e=document.location.hostname),""===e&&(e="-"),e},getProductNameFromServerName:function(e){return"undefined"!=typeof e?e.replace(".com","").replace(".net","").replace(".org","").replace(".au","").replace(".io",""):"-"},getSubdomain:function(e){var t="-",a=e.match(/^([a-z0-9\.]*)[\-\.]{1}([a-z0-9]+)+\.([a-z]{2,6})$/i);if(a){var n=e.split(".");n=2===n[n.length-1].length?n.slice(0,n.length-3):n.slice(0,n.length-2),0!==n.length&&(t=n.join("."))}return t},generateRandomStorageKey:function(){var e=2,t=12,a=(Math.random()+"").slice(e,t),n=(Math.random()+"").slice(e,t);return a.concat(n)},ajaxPost:function(t,a){var n;if(e.useXDomainRequest(t))n=new window.XDomainRequest;else if(window.XMLHttpRequest)n=new XMLHttpRequest;else{if(!window.ActiveXObject)return;n=new window.ActiveXObject("Microsoft.XMLHTTP")}n.open("POST",t,!0),"undefined"!=typeof n.setRequestHeader&&(n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Accept","application/json, text/javascript, */*;")),n.send(a)},parseConfig:function(e){var t,a,n,i,o,s,r,l,u,c,d,f,h,p,_,m,g,v;if("undefined"==typeof e||"undefined"==typeof e.queue){var y=window.AJS=window.AJS||{};y.EventQueue=y.EventQueue||[],t=y.EventQueue}else t=e.queue;return a="undefined"==typeof e||"undefined"==typeof e.analyticsscheme?"https":e.analyticsscheme,n="undefined"==typeof e||"undefined"==typeof e.analyticsserver?"analytics.atlassian.com":e.analyticsserver,i="undefined"==typeof e||"undefined"==typeof e.analyticsurl?"/analytics/events":e.analyticsurl,o="undefined"==typeof e||"undefined"==typeof e.server?this.getServerName():e.server,s="undefined"==typeof e||"undefined"==typeof e.product?this.getProductNameFromServerName(o):e.product,"undefined"==typeof e||"undefined"==typeof e.subproduct?(r=this.getSubdomain(o),"undefined"==typeof r&&(r="-")):r=e.subproduct,l="undefined"==typeof e||"undefined"==typeof e.version?null:e.version,u="undefined"==typeof e||"undefined"==typeof e.session?null:e.session,c="undefined"==typeof e||"undefined"==typeof e.sen?null:e.sen,d="undefined"==typeof e||"undefined"==typeof e.sourceip?null:e.sourceip,f="undefined"==typeof e||"undefined"==typeof e.atlpath?this.getAtlPath():e.atlpath,h="undefined"==typeof e||"undefined"==typeof e.ajax?this.ajaxPost:e.ajax,p="undefined"==typeof e||"undefined"==typeof e.maxevents?this.MAXEVENTS:e.maxevents,_="undefined"==typeof e||"undefined"==typeof e.storage_key?this.STORAGE_KEY_PREAMBLE+this.generateRandomStorageKey()+this.generateRandomStorageKey():e.storage_key,m="undefined"==typeof e||"undefined"==typeof e.user?"default":e.user,g="undefined"==typeof e||"undefined"==typeof e.publish_interval?this.PUBLISH_INTERVAL:e.publish_interval,v="undefined"==typeof e||"undefined"==typeof e.save_interval?this.SAVE_INTERVAL:e.save_interval,{queue:t,gasScheme:a,gasServer:n,gasUrl:i,serverName:o,productName:s,subProductName:r,version:l,session:u,sen:c,sourceIP:d,atlPath:f,post:h,maxevents:p,storageKey:_,user:m,publishInterval:g,saveInterval:v}},pushToServer:function(e,t){var a="undefined"!=typeof t?t:this.config.post,n=this.config.gasScheme+"://"+this.config.gasServer+this.config.gasUrl,i={events:e},o=JSON.stringify(i);a(n,o)},addEventsToArray:function(e,t,a){if("undefined"!=typeof a&&"undefined"!=typeof a.server&&"undefined"!=typeof a.product&&"undefined"!=typeof a.subproduct&&"undefined"!=typeof a.user)for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];if(t.length>=this.config.maxevents)break;if(i.name&&i.properties){var o={name:i.name,properties:i.properties,serverTime:i.time||(new Date).getTime(),server:a.server,user:a.user,product:a.product,subproduct:a.subproduct,version:a.version,session:a.session,sen:a.sen,sourceIP:a.sourceIP,atlPath:a.atlPath};t.push(o)}}},publishFromQueueAndStorage:function(e){try{var t="undefined"!=typeof e?e:this.pushToServer.bind(this),a=[];if(this.config.queue.length<1&&("undefined"==typeof this.storage||this.storage.length<1))return;var n={server:this.config.serverName,user:this.config.user,product:this.config.productName,subproduct:this.config.subProductName,version:this.config.version,session:this.config.session,sen:this.config.sen,sourceIP:this.config.sourceIP,atlPath:this.config.atlPath};this.addEventsToArray(this.config.queue,a,n);var i=this.popEventsFromStorage();this.addEventsToArray(i,a,n),this.config.queue.length=0,a&&a.length&&t(a)}catch(o){}},serialiseEventsToString:function(e){return JSON.stringify(e)},deserialiseEvents:function(e){return JSON.parse(e)},storeEvents:function(e){if("undefined"!=typeof this.storage)try{if(this.storage[this.config.storageKey]){var t=this.deserialiseEvents(this.storage[this.config.storageKey])||[];t.length<this.config.maxevents&&t.push.apply(t,e),e=t}this.storage.setItem(this.config.storageKey,this.serialiseEventsToString(e))}catch(a){}},popEventsFromStorage:function(){if("undefined"==typeof this.storage)return[];try{if(this.storage[this.config.storageKey]){var e=this.deserialiseEvents(this.storage[this.config.storageKey]);return this.storage[this.config.storageKey]=this.serialiseEventsToString([]),e}}catch(t){}return[]},moveQueueToStorage:function(){0!==this.config.queue.length&&"undefined"!=typeof this.storage&&(this.storeEvents(this.config.queue),this.config.queue.length=0)},start:function(){this.is_started=!0;var e=Array.prototype.push;this.config.queue.push=function(t){t.time=(new Date).getTime(),e.call(this.config.queue,t)}.bind(this),this.initialSaveTimeout=setTimeout(this.publishFromQueueAndStorage.bind(this),this.config.saveInterval),this.publishInterval=setInterval(this.publishFromQueueAndStorage.bind(this),this.config.publishInterval),this.saveInterval=setInterval(this.moveQueueToStorage.bind(this),this.config.saveInterval)},stop:function(){this.is_started=!1,this.publishFromQueueAndStorage(),clearTimeout(this.initialSaveTimeout),clearInterval(this.saveInterval),clearInterval(this.publishInterval)},destroy:function(){this.stop(),window["herment-gas-client"]=t}},t}(e),window["herment-gas-client"]=t,window.define&&window.define("herment",[],function(){return t})}()},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(127),o=n(i),s=a(59),r=n(s),l=a(9),u=n(l),c=a(173),d=n(c),f=a(256),h=n(f),p=a(208),m=n(p),g=a(93),v=n(g),y=a(258),b=n(y),w=a(169),R=n(w),k=a(121),E=n(k),C=a(161),S=n(C),T=a(99),x=n(T),A=a(259),I=n(A),N=a(177),M=n(N),O=a(90),D=n(O),P=a(218),j=n(P),L=a(95),F=n(L),U=a(290),H=n(U),B=a(206),z=n(B),q=a(184),V=n(q),G=a(291),W=n(G);t["default"]=function(e){var t=!1,a=x["default"].createSafePredicate(E["default"].outgoing_message_filter_predicate,E["default"]),n=new I["default"],i=function(e){$(window).off("beforeunload"),n.destroy(),v["default"].onSignOut(z["default"],e)},s=function(){if(R["default"].isGuest()){var e=R["default"].get("room_id");z["default"].Room.getById(e).then(function(e){return u["default"].dispatch("DAL:handle-new-room",{jid:e.jid,name:e.name,x:e})}),z["default"].Emoticon.getEmoticonsAsXMPP(function(e){d["default"].dispatch("analytics-emoticons-loaded",{verbose:e})}),z["default"].fetchParticipants(e).then(function(e){return u["default"].dispatch("DAL:guest-fetched-room-participants",e)})["catch"](function(e){return D["default"].type("dal").error("[fetch-room-participants]",e.message)})}else!function(){var e=null;r["default"].all([z["default"].Cache.getRosterAsXMPP(),z["default"].Cache.getRoomsAsXMPP(),z["default"].Cache.getEmoticonsAsXMPP()]).then(function(t){var a=(0,o["default"])(t,3),n=a[0],i=a[1],s=a[2];return n&&u["default"].dispatch("server-data",n),i&&u["default"].dispatch("server-data",i),s&&(e=s),r["default"].all([z["default"].User.getRosterAsXMPP(),z["default"].Room.getRoomsAsXMPP(),z["default"].Emoticon.getEmoticonsAsXMPP(e)])}).then(function(t){var a=(0,o["default"])(t,3),n=a[0],i=a[1],s=a[2];u["default"].dispatch("server-data",n),u["default"].dispatch("server-data",i),u["default"].dispatch("server-data",s||e),d["default"].dispatch("analytics-roster-loaded",{verbose:n}),d["default"].dispatch("analytics-rooms-loaded",{verbose:i}),d["default"].dispatch("analytics-emoticons-loaded",{verbose:s})})["catch"](function(e){D["default"].type("dal").error("[fetch-roster/fetch-rooms/fetch-emoticons]",e.message)})}()};u["default"].register({"hipchat-client-configured":function(){z["default"].attemptConnect()},"strophe-reconnecting":function(){d["default"].dispatch("analytics-hc-client-reconnection-start"),h["default"].stop()},"strophe-authenticating":function(){m["default"].isInitialConnect()&&d["default"].dispatch("analytics-initial-auth-start")},"strophe-disconnected":function(){d["default"].dispatch("analytics-event",{name:"hipchat.client.disconnected"}),h["default"].stop()},"strophe-connection-failed":function(e,t){d["default"].dispatch("analytics-event",{name:"hipchat.client."+(m["default"].isInitialConnect()?"connection":"reconnection")+".failed",properties:{reason:t}}),m["default"].isInitialConnect()||u["default"].dispatch("reconnect-fail"),h["default"].stop();var a="[Connection Failure] "+t;D["default"].error(a),D["default"].type("strophe-connection-failed").error(t),v["default"].onStropheConnectionFailed(a)},"strophe-policy-violation":function(e,t){var a="[Authentication Failure] "+t;D["default"].error(a),D["default"].type("strophe-auth-failed").error(t),v["default"].onStrophePolicyViolation({reason:t,web_server:R["default"].get("web_server")})},"strophe-auth-failed":function(e,t){var a="[Authentication Failure] "+t;D["default"].error(a),D["default"].type("strophe-auth-failed").error(t),v["default"].onStropheAuthFailed(a)},"reconnection-error":function(e){v["default"].onReconnectionError(e)},"strophe-connected":function(){d["default"].dispatch("analytics-hc-client-initial-connection"),d["default"].dispatch("analytics-initial-auth-done");var t=b["default"].getGroupAvatarDefaultColor(R["default"].get("group_id")),a=_.merge(R["default"].getAll(),{feature_flags:e.feature_flags,group_avatar_bg:t||E["default"].default_group_avatar_bg});new W["default"],u["default"].dispatch("hc-init",a),d["default"].dispatch("analytics-hc-init",{}),s(),H["default"].init(),z["default"].sendInitialPresence().then(function(){D["default"].type("dal").log("[update-presence]","Successfully sent initial presence")}),h["default"].start()},"strophe-reconnected":function(){R["default"].isGuest()&&R["default"].get("room_jid")?z["default"].joinRoom(R["default"].get("room_jid")).then(function(e){return u["default"].dispatch("DAL:handle-joined-rooms",e)})["catch"](function(e){return D["default"].error(e.message)}):u["default"].registerOnce("updated:config",function(){z["default"].joinRooms(S["default"].getAutoJoinRooms(),0).then(function(e){return u["default"].dispatch("DAL:handle-joined-rooms",e)})["catch"](function(e){return D["default"].type("dal").error("[join-rooms]",e.message)})}),d["default"].dispatch("analytics-event",{name:"hipchat.client.reconnected"}),d["default"].dispatch("analytics-hc-client-reconnection-success"),s(),H["default"].resubscribe(),h["default"].start(),z["default"].sendInitialPresence(h["default"].isIdle()?V["default"].IDLE:V["default"].AVAILABLE).then(function(){D["default"].type("dal").log("[update-presence]","Successfully sent initial presence"),h["default"].isIdle()||u["default"].dispatch("set-current-user-active")})},"user-on-call":function(){h["default"].stop()},"user-leave-call":function(){h["default"].start()},"close-room":function(e){e.doNotNotifyHC||z["default"].leaveRoom(e.jid,e.type)["catch"](function(e){return D["default"].type("dal").error("[leave-room]",e.message)})},"fetch-files":function(e){var t=e.room,a=e.before,n=e.after;z["default"].fetchFiles(t,a,n,E["default"].fetching_files_limit).then(function(e){u["default"].dispatch("DAL:handle-fetched-files",e)})["catch"](function(e){D["default"].type("dal").error("[fetch-files]",e.message),u["default"].dispatch("DAL:handle-fetched-files",{jid:t,files:[],end:!0})})},"fetch-links":function(e){var t=e.room,a=e.before,n=e.after;z["default"].fetchLinks(t,a,n,E["default"].fetching_links_limit).then(function(e){u["default"].dispatch("DAL:handle-fetched-links",e)})["catch"](function(e){D["default"].type("dal").error("[fetch-links]",e.message),u["default"].dispatch("DAL:handle-fetched-links",{jid:t,links:[],end:!0})})},"create-room":function(e,t){z["default"].Room.create(e.name,e.topic,e.privacy).then(function(e){u["default"].dispatch("DAL:handle-created-room",e),"private"===e.privacy?F["default"].showInviteUsersDialog():F["default"].closeDialog(),t(null,e)})["catch"](function(e){D["default"].type("dal").error("[create-room]",e.message),t(e)})},"delete-room":function(e,t){z["default"].Room["delete"](e.id,e.jid).then(function(){t()})["catch"](function(e){D["default"].type("dal").error("[delete-room]",e.message),t(e)})},"change-room-privacy":function(e,t){z["default"].Room.setPrivacy(e.jid,e.privacy).then(t)["catch"](function(e){D["default"].type("dal").error("[set-room-privacy]",e.message),t(e)})},"change-room-name":function(e,t){z["default"].Room.rename(e.jid,e.name).then(t)["catch"](function(e){D["default"].type("dal").error("[rename-room]",e.message),t(e)})},"update-presence":function(e){v["default"].onChangeUserStatus(e.show),z["default"].setPresence(e.show,e.status).then(function(){D["default"].type("dal").log("[update-presence]","Successfully set presence to "+e.show+", "+e.status)})},"set-guest-access":function(e){var t=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1];z["default"].Room.setGuestAccess(e.jid,e.enable).then(function(){t()})["catch"](function(e){D["default"].type("dal").error("[set-guest-access]",e.message),t(e)})},"guest-access-revoked":function(){i(z["default"],{})},"sync-preferences":function(e){z["default"].savePreferences(e,function(){u["default"].dispatch("preferences-saved",e)})},"request-profile":function(e,t){z["default"].fetchProfile(e,t)},"filter-presences":function(e){z["default"].filterPresences(e).then(function(){D["default"].type("dal").log("[filter-presence]","Updated presence filter to "+e.join(","))})},"fetch-presences":function(e){z["default"].fetchPresences(e)},"attempt-reconnect":function(){z["default"].attemptReconnect()},"attempt-reconnect-without-reset":function(){z["default"].attemptReconnect(!1)},"attempt-disconnect":function(e){z["default"].terminateChatSession(e)},"network-down":function(){},
"network-up":function(){z["default"].attemptReconnect()},"fetch-previous":function(e,t){z["default"].fetchHistory(e.jid,e.oldest||null,E["default"].message_retrieval_chunk_size,e.id,t)},"upload-file":function(e){var t={path:{identifier:e.room_id},params:{file:e.file,fileName:e.fileName,message:e.message}},a=e.jid,n=z["default"].sendFileMessage(a,t);n.on("progress",function(e){u["default"].dispatch("upload-progress-update",{percentage:e,jid:a})}).on("success",function(){u["default"].dispatch("upload-successful",{message:"fileName: "+e.fileName,text:e.message,jid:a})}).on("error",function(e){u["default"].dispatch("upload-failed",{error:e,jid:a})}).on("complete",function(){u["default"].dispatch("upload-complete",{jid:a}),n.removeAllListeners()})},"send-message":function(e){return j["default"].isOnline()?z["default"].isConnected()?void(a(e)&&z["default"].sendMessage(e)):void D["default"].type("dal").warn("[send-message]","client appears to be disconnected, aborting send-message"):void D["default"].type("dal").warn("[send-message]","client appears to be offline, aborting send-message")},"edit-message":function(e){z["default"].editMessage(e.jid,e.message,e.original_mid,e.ts)},"delete-message":function(e){z["default"].deleteMessage(e)},"resend-message":function(e){a(e)&&z["default"].sendMessage(e)},"send-topic":function(e){var t=e.jid,a=e.topic;z["default"].Room.setTopic(t,a).then(function(){u["default"].dispatch("DAL:handle-topic-updated",{jid:t,topic:a})})["catch"](function(e){return D["default"].type("dal").error("[set-topic]",e.message)})},"fetch-room-participants":function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];z["default"].fetchParticipants(e.id,t).then(function(e){return u["default"].dispatch("DAL:fetched-room-participants",e)})["catch"](function(t){D["default"].type("dal").error("[fetch-room-participants]",t.message),D["default"].type("dal").warn("[fetch-room-participants]","fallback to fetch participants via XMPP join without maxmemberpresences"),u["default"].dispatch("set-room-participants-fully-initialized",e.jid),z["default"].joinRoom(e.jid,0,!1).then(function(e){return u["default"].dispatch("DAL:handle-joined-rooms",e)})["catch"](function(e){return D["default"].type("dal").error("[join-room]",e.message)})})},"fetch-room":function(e,t){z["default"].Room.getByJid(e).then(function(e){return t(null,e)})["catch"](function(e){D["default"].type("dal").error("[fetch-room-by-jid]",e.message),t(e)})},"open-room":function(e){x["default"].jid.is_private_chat(e.jid)?z["default"].joinChat(e.jid):(z["default"].Room.getByJid(e.jid)["catch"](function(e){D["default"].type("dal").error("[fetch-room-by-jid]",e.message)}),z["default"].joinRoom(e.jid).then(function(e){return u["default"].dispatch("DAL:handle-joined-rooms",e)})["catch"](function(e){return D["default"].type("dal").error("[join-room]",e.message)}))},"exit-app":function(e){i(z["default"],e)},"app-state-ready":function(){$(document).trigger("app-state-ready");var e=S["default"].getChatToFocus();e&&x["default"].jid.is_room(e)&&u["default"].dispatch("initial-join-presence-sent",{jid:e,with_history:!1}),z["default"].joinRooms(S["default"].getAutoJoinRooms()).then(function(e){return u["default"].dispatch("DAL:handle-joined-rooms",e)})["catch"](function(e){return D["default"].type("dal").error("[join-rooms]",e.message)}),v["default"].onAppStateReady(R["default"].getAll()),console&&(console.emote("Hey there â¦ Trying to reverse engineer something? Why not join our team instead?"),console.emote("Apply at https://www.hipchat.com/jobs and mention this comment."))},"invite-users":function(e){z["default"].inviteUsersToRoom(e.room_jid,e.user_jids,e.reason)},"remove-users":function(e,t){z["default"].removeUsersFromRoom(e.room_jid,e.user_jids,t)},"send-user-state-message":function(e){z["default"].sendStateMessage(e.jid,e.type,e.state)},"send-video-message":function(e){z["default"].sendVideoMessage(e.jid,e.type,e.audio_only,e.url,e.service,e.callback,e.reason)},"request-addlive-credentials":function(e,t){z["default"].requestAddliveCredentials(e.jid,t)},"clear-web-cookies":function(){var e=arguments.length<=0||void 0===arguments[0]?_.noop:arguments[0];z["default"].clearWebCookies(e)},"revoke-oauth2-token":function(){var e=arguments.length<=0||void 0===arguments[0]?_.noop:arguments[0];z["default"].revokeOauth2Token(e),z["default"].terminateChatSession(!1)},"DAL:fetch-readstate":function(){z["default"].fetchReadstate()},"DAL:update-readstate":function(e){z["default"].updateReadstate(e)},"DAL:remove-readstate":function(e){z["default"].removeReadstate(e)},"DAL:retry-readstate":function(){z["default"].retryReadstate()},"DAL:reset-readstate":function(){z["default"].resetReadstate()},"server-data":function(e){!t&&"presence"in e&&(t=!0,d["default"].dispatch("analytics-initial-presence-response-received",{verbose:e}))},"apiv1-token-update-requested":function(){z["default"].updateAPIV1Token()},"auth-token-update":function(e){"apiv1_token"in e&&(D["default"].debug("Updating API v1 auth token: ",D["default"].sanitize(e)),v["default"].onInternalTokenRefreshed(e.apiv1_token))},"before:new-active-chat":function(e){var t=x["default"].jid.is_chat(e.jid);v["default"].onChangeActiveChat(t),d["default"].dispatch("analytics-new-active-chat",e)},"API:fetch-recent-history":function(e){z["default"].fetchRecentHistory(e,function(t){var a=t.error,n=t.items;!a&&n?u["default"].dispatch("API:fetched-recent-history",{jid:e.jid,results:n,mid:e.params["not-before"]}):D["default"].type("dal").error("[fetch-recent-history]",a)})},"API:update-room":function(e,t){z["default"].Room.update(e,t)},"API:sync-integrations":function(e,t){z["default"].syncIntegrations(e,t)},"API:get-signed-url":function(e,t,a){z["default"].getSignedUrl(e,t,a)},"API:request-with-signed-url":function(e,t,a){z["default"].requestWithSignedUrl(e,t,a)},"API:fetch-all-glances-for-room":function(e,t){z["default"].fetchAllGlancesForRoom(e,t)},"API:fetch-signed-file":function(e){var t=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1],a=arguments.length<=2||void 0===arguments[2]?_.noop:arguments[2];z["default"].fetchSignedFile(e.url).then(t)["catch"](a)},"API:upload-room-avatar":function(e){var t=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1];z["default"].Room.uploadAvatar(e.id,e.avatar).then(t)["catch"](t)},"API:fetch-signed-thumbnail":function(e){var t=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1],a=arguments.length<=2||void 0===arguments[2]?_.noop:arguments[2],n=R["default"].get("feature_flags"),i=n.web_client_secure_files_multi_get_for_thumbnails;i?M["default"].fetchSignedThumbnail(e,t,a):z["default"].fetchSignedFile(e.thumb_url).then(t)["catch"](a)},"API:fetch-signed-thumbnail-collection":function(e){z["default"].fetchSignedThumbnailCollection(e)},"API:fetch-last-message":function(e,t){e.params={"max-results":1},z["default"].fetchRecentHistory(e,function(a){t({jid:e.jid,items:a.items})})},"API:fetch-alert-flag":function(){z["default"].fetchAlertFlag().then(function(e){u["default"].dispatch("API:fetch-alert-flag-success",e)})["catch"](function(e){D["default"].type("dal").error("[API:fetch-alert-flag]",e),u["default"].dispatch("API:fetch-alert-flag-failure",e)})},"API:dismiss-alert-flag":function(e){var t=e.id;z["default"].dismissAlertFlag({id:t}).then(function(){u["default"].dispatch("API:dismiss-alert-flag-success")})["catch"](function(e){D["default"].type("dal").error("[API:dismiss-alert-flag]",e),u["default"].dispatch("API:dismiss-alert-flag-failure",e)})},"API:fetch-read-only-content":function(){z["default"].fetchReadOnlyContent().then(function(e){u["default"].dispatch("API:fetch-read-only-content-success",e)})["catch"](function(e){D["default"].type("dal").error("[API:fetch-read-only-content]",e),u["default"].dispatch("API:fetch-read-only-content-failure",e)})}})},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(4),o=n(i),s=a(5),r=n(s),l=a(145),u=n(l),c=a(209),d=n(c),f=a(257),h=n(f),p=a(90),_=n(p),m=a(169),g=n(m),v=a(161),y=n(v),b=a(208),w=n(b),R=(0,u["default"])("HJC.Idle.Manager.State"),k=function(){function e(){(0,o["default"])(this,e),this[R]={isIdle:!1,isRunning:!1,lastUserAction:(new Date).getTime()},this.idleTimer=new d["default"](this._onUserIdle.bind(this),60*y["default"].get("idleMinutes")*1e3),this.activityTimer=new d["default"](this._checkForActivity.bind(this),1e3)}return(0,r["default"])(e,[{key:"start",value:function(){var e=this;if("web"===g["default"].get("client_type")&&!this.isRunning()){var t=60*y["default"].get("idleMinutes")*1e3;$(document).on("mousemove.idle keydown.idle DOMMouseScroll.idle mousewheel.idle mousedown.idle",function(){e[R].lastUserAction=(new Date).getTime()}),this.idleTimer.resetTime(t).start(),this.activityTimer.start(),this[R].isRunning=!0,_["default"].info("[IdleManager] starting idle timers & events")}}},{key:"stop",value:function(){this.idleTimer.clear(),this.activityTimer.clear(),$(document).off("mousemove.idle keydown.idle DOMMouseScroll.idle mousewheel.idle mousedown.idle"),this[R].isRunning=!1,_["default"].info("[IdleManager] stopping idle timers & events")}},{key:"isIdle",value:function(){return this[R].isIdle}},{key:"isRunning",value:function(){return this[R].isRunning}},{key:"_onUserIdle",value:function(){w["default"].isConnected()&&(_["default"].info("[IdleManager] Going idle"),this[R].isIdle=!0,h["default"].goIdle())}},{key:"_userHasTakenActionInTheLastSecond",value:function(){return(new Date).getTime()-this[R].lastUserAction<1e3}},{key:"_checkForActivity",value:function(){if(this._userHasTakenActionInTheLastSecond()){if(!w["default"].isConnected())return;this.idleTimer.restart(),this.isIdle()&&(_["default"].info("[IdleManager] Returning from idle"),this[R].isIdle=!1,h["default"].returnToActive())}this.activityTimer.restart()}},{key:"reset",value:function(){this[R].isIdle=!1,this[R].lastUserAction=(new Date).getTime(),this.stop()}}]),e}();t["default"]=new k,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i),s=a(173),r=n(s),l=a(184),u=n(l);t["default"]={goIdle:function(){o["default"].dispatch("set-current-user-idle"),r["default"].dispatch("analytics-update-presence",{show:u["default"].IDLE})},returnToActive:function(){o["default"].dispatch("set-current-user-active")},changeStatus:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=e.show,a=void 0===t?u["default"].AVAILABLE:t,n=e.status,i=void 0===n?"":n,s=e.type,l=void 0===s?"":s;o["default"].dispatch("set-current-user-status",{show:a,status:i}),"show"===l?r["default"].dispatch("analytics-update-presence",{show:a}):"status"===l?r["default"].dispatch("analytics-update-status-message",{status:i}):"showAndStatus"===l&&(r["default"].dispatch("analytics-update-presence",{show:a}),r["default"].dispatch("analytics-update-status-message",{status:i}))},onCall:function(){o["default"].dispatch("user-on-call")},leaveCall:function(){o["default"].dispatch("user-leave-call")}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(121),o=n(i),s={defaultAvatarColors:o["default"].default_avatar_colors,createAvatarURL:function(e){return"http://"+e},getHash:function(e){for(var t,a=0,n=0,i=e.length;i>n;n++)t=e.charCodeAt(n),a=31*a+t,a&=a;return a},getGroupAvatarDefaultColor:function(e){var t,a=this.defaultAvatarColors;return _.isNumber(e)&&(e=e.toString()),t=Math.abs(this.getHash(e)%a.length),a[t]},getAvatarInitialsFromName:function(e){var t=this,a=e.trim(),n=this._trimNonAlphanumericChars(a).split(/\s+/i).map(function(e){var a=t._trimNonAlphanumericChars(e);return a.charAt(0)}).join("").slice(0,3).toUpperCase();return n},_trimNonAlphanumericChars:function(e){var t=/[=*\/\\+\-_'"`~\(\)\[\]\{\}@]+/i,a=e.replace(t,"").split("").reverse().join("").replace(t,"").split("").reverse().join("");return a},cleanAvatarURL:function(e){return _.isString(e)&&-1===e.indexOf("http://")&&-1===e.indexOf("https://")&&(e=this.createAvatarURL(e)),e}};e.exports=s},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(4),o=n(i),s=a(5),r=n(s),l=a(9),u=n(l),c=a(99),d=n(c),f=a(108),h=n(f),p=a(260),m=n(p),g=a(261),v=n(g),y=a(121),b=n(y),w=a(263),R=n(w),k=a(93),E=n(k),C=a(90),S=n(C),T=a(142),x=n(T),A=a(264),I=n(A),N=a(106),M=n(N),O=a(169),D=n(O),P=function(){function e(){(0,o["default"])(this,e),this._registerListeners(),this._bindDOMEvents(),this._uploading_state={}}return(0,r["default"])(e,[{key:"destroy",value:function(){this._unregisterListeners(),this._unbindDOMEvents()}},{key:"_registerListeners",value:function(){var e=this;u["default"].register({"upload-file":function(t){e._uploading_state[t.jid]=!0},"upload-successful":function(t){e._uploading_state[t.jid]=!1},"upload-failed":function(t){e._handleUploadFailed(t),e._uploading_state[t.jid]=!1},"open-file-picker":function(){e._openFilePicker()},"file-pasted":function(t){e._handleFilePasted(t)},"file-chosen":function(t,a){e._onFileChosen(t,a)},"add-file-for-upload-with-url":function(t){e._handleUploadViaUrl(t)},"add-file-for-upload-with-base64":function(t){e._handleUploadViaBase64(t)},"updated:active_chat":function(t){e.active_chat=t}})}},{key:"_unregisterListeners",value:function(){var e=this;u["default"].unregister({"upload-failed":function(){e._handleUploadFailed()},"open-file-picker":function(){e._openFilePicker()},"file-pasted":function(){e._handleFilePasted()},"file-chosen":function(){e._onFileChosen()},"add-file-for-upload":function(){e._handleFileForUploadWithUrl()},"add-file-for-upload-with-base64":function(){e._handleUploadViaBase64()}})}},{key:"_bindDOMEvents",value:function(){document.addEventListener("dragenter",this._handleDragEnter.bind(this)),document.addEventListener("dragover",this._handleDragEnter.bind(this)),document.addEventListener("drop",this._handleDrop.bind(this))}},{key:"_unbindDOMEvents",value:function(){document.removeEventListener("dragenter",this._handleDragEnter),document.removeEventListener("dragover",this._handleDragEnter),document.removeEventListener("drop",this._handleDrop)}},{key:"_handleUploadViaUrl",value:function(e){e&&e.fileUrl&&this._handleFileForUploadWithUrl(e.fileUrl,e.source)}},{key:"_handleUploadViaBase64",value:function(e){e&&e.base64&&this._handleFileForUploadWithBase64(e.base64,e.fileName,e.source)}},{key:"_handleUploadFailed",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];e.error&&503===e.error.code?this._dispatchError("service_unavailable",e.jid):e.error&&400===e.error.code?this._dispatchError("unable_to_upload_image",e.jid):this._dispatchError("unable_to_upload",e.jid)}},{key:"_handleDragEnter",value:function(e){e.stopPropagation(),e.preventDefault()}},{key:"_handleDrop",value:function(e){if(e.stopPropagation(),e.preventDefault(),!this._uploading_state[this.active_chat]){var t=new RegExp(M["default"].url,"i"),a=e.dataTransfer.getData("text/html"),n=e.dataTransfer.getData("text/plain"),i=null,o=null,s=!!e.dataTransfer.files.length;s||""===n||(t.test(n)?o=n:i=n),o?this._handleDropUrl(o):i?this._handleDropText(i):a?this._handleDropHtml(a):this._handleDropFile(e)}}},{key:"_handleDropHtml",value:function(e){var t="",a=$("<div/>").html(e).find("img")[0],n=$("<div/>").html(e).find("a")[0];a&&$(a).hasClass("remoticon")?this._handleDropText($(a).attr("alt")):a?(t=this._tryRemoveQuery($(a).attr("src")),this._handleUrl(t)):n&&(t=this._tryRemoveQuery($(n).attr("href")),this._handleUrl(t))}},{key:"_handleDropUrl",value:function(e){this._handleUrl(e)}},{key:"_handleDropText",value:function(e){I["default"].focusChatInput(),v["default"].appendMessage({text:e})}},{key:"_handleDropFile",value:function(e){E["default"].focusApp(),this._onFileChosen(e,"dragndrop")}},{key:"_tryRemoveQuery",value:function(e){var t=h["default"].remove_query_string(e);return this._isAllowedUrlFileType(t)&&(e=t),e}},{key:"_handleUrl",value:function(e){I["default"].focusChatInput(),this._isAllowedUrlFileType(e)?this._handleFileForUploadWithUrl(e,"dragndrop"):this._tryUrlByLoadingImage(e)}},{key:"_isAllowedUrlFileType",value:function(e){var t=this.isBase64Image(e);return e=e.toLowerCase(),_.endsWith(e,".jpg")||_.endsWith(e,".jpeg")||_.endsWith(e,".png")||this.isGIF(e)||t}},{key:"isGIF",value:function(e){return _.endsWith(e.toLowerCase(),".gif")}},{key:"isBase64Image",value:function(e){return/^data:image\/[a-z+]{3,8};base64,(.|\n)+/.test(e)}},{key:"_handleFilePasted",value:function(e){if(e.clipboardData&&e.clipboardData.items){var t=e.clipboardData.items[0];t&&"file"===t.kind&&this._onFileChosen(e,"paste")}}},{key:"_handleFileForUploadWithBase64",value:function(e,t,a){var n=d["default"].file.base64_to_blob(e,t);n&&this._handleBlobLoaded(n,t,a)}},{key:"_handleFileForUploadWithUrl",value:function(e,t){this._getBlobFromUrl(e,this._handleBlobLoaded.bind(this),t)}},{key:"_getBlobFromUrl",value:function(e,t,a){var n=arguments.length<=3||void 0===arguments[3]?new XMLHttpRequest:arguments[3],i=arguments.length<=4||void 0===arguments[4]?new FileReader:arguments[4];if(!_.isFunction(t))return void S["default"].type("upload-file-helper").warn("Callback for _getBlobFromUrl function is not defined.");if(!e||!this._validateFileUrl(e))return void S["default"].type("upload-file-helper").warn("File url is not valid: ",e);var o=this.isBase64Image(e)?!1:d["default"].file.get_file_name(e);if(x["default"].getProtocol(e).length>=location.protocol.length-1)this._getDataWithXHRRequest(n,i,t,a,o,e);else if(this.isBase64Image(e)){var s=d["default"].file.base64_to_blob(e);t(s,o,a),S["default"].type("upload-file-helper").info("Blob from base64 image received.")}else this.isGIF(e)?(S["default"].type("upload-file-helper").info("GIF loading via canvas is skipped."),v["default"].appendMessage({text:" "+e})):this._getDataByLoadingImage(t,a,o,e)}},{key:"_getDataWithXHRRequest",value:function(e,t,a,n,i,o){e.open("GET",o),e.responseType="blob",e.onerror=function(){v["default"].appendMessage({text:" "+o}),S["default"].type("upload-file-helper").warn("Image failed to load via xhr: ",o)},e.onload=function(){var s=this,r=e.response;t.readAsArrayBuffer(r),t.onerror=function(){s._dispatchError("unable_to_upload"),S["default"].type("upload-file-helper").warn("Reader failed to read the file: ",o)},t.onload=function(e){var t=new Blob([e.srcElement.result],{type:r.type});a(t,i,n),S["default"].type("upload-file-helper").info("Blob from image received via xhr: ",o)}},e.send()}},{key:"_getDataByLoadingImage",value:function(e,t,a,n){var i=arguments.length<=4||void 0===arguments[4]?!0:arguments[4],o=d["default"].file.get_extension(n)||"png",s="image/"+o,r=new Image;r.setAttribute("crossOrigin","anonymous"),r.onload=function(){var i=document.createElement("canvas");i.width=r.naturalWidth,i.height=r.naturalHeight;var o=i.getContext("2d");o.drawImage(r,0,0);var l=i.toDataURL(s),u=d["default"].file.base64_to_blob(l);e(u,a,t),S["default"].type("upload-file-helper").info("Blob from image received: ",n)},r.onerror=function(){i?(S["default"].type("upload-file-helper").warn("Image failed to load: ",n),v["default"].appendMessage({text:""+n})):S["default"].type("upload-file-helper").warn("Url failed to load: ",n)},r.src=n}},{key:"_tryUrlByLoadingImage",value:function(e){this._getDataByLoadingImage(this._handleBlobLoaded.bind(this),"dragndrop",!1,e,!0)}},{key:"_handleBlobLoaded",value:function(e,t,a){if(e){var n;t||(t=R["default"].upload_default_name+"."+d["default"].file.get_extension_for_mime_type(e.type)),n=d["default"].file.blob_to_file(e,t),this._handleFileForChatInput(n,t,a)}}},{key:"_onFileChosen",value:function(e){var t,a,n=arguments.length<=1||void 0===arguments[1]?"browse":arguments[1];if("change"===e.type)t=e.target.files[0],a=_.get(t,"name");else if("drop"===e.type)t=e.dataTransfer.files[0],a=_.get(t,"name");else if("paste"===e.type){var i=e.clipboardData.items[0];if(i){t=i.getAsFile();var o=d["default"].file.get_extension_for_mime_type(i.type);o&&(a=R["default"].upload_default_name+"."+o)}}t&&a&&n&&this._handleFileForChatInput(t,a,n),I["default"].focusChatInput()}},{key:"_handleFileForChatInput",value:function(e,t,a){e&&(e.file_obj=null,v["default"].expandAttachment({jid:this.active_chat,file_name:t,file:e,file_selection_source:a}),this._processFile(e,t,a))}},{key:"_openTooltip",value:function(e,t,a,n){e.file_obj=n,v["default"].openTooltip({type:"upload_preview",data:{file:n}}),v["default"].expandAttachment({jid:this.active_chat,file_name:t,file:e,file_selection_source:a})}},{key:"_processFile",value:function(e,t,a){var n=this,i=d["default"].file.get_selected_file_type(e),o=i.major,s=i.minor,r=D["default"].get("client_subtype"),l=d["default"].clientSubType.isQT(r),u=d["default"].platform.isWindows(),c=d["default"].browser.is.safari();o=this._determineFileType(o,s),this._validateFile(e)&&this._shouldOpenFilePreview(o)&&!function(){var i={file_type:o};i.src=window.URL.createObjectURL(e),"image"===o?d["default"].image.resizeImage(i.src).then(function(o){i.src_processed=window.URL.createObjectURL(o),n._openTooltip(e,t,a,i)}):"video"===o?u&&l||!("mp4"===s||"quicktime"===s&&c)||n._openTooltip(e,t,a,i):n._openTooltip(e,t,a,i)}()}},{key:"_validateFile",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?b["default"].max_upload_size:arguments[1],a=void 0;return e.size&&e.size/1024/1024>t?(this._dispatchError("file_too_large"),a=!1):(this._readFile(e),a=!0),a}},{key:"_validateFileUrl",value:function(e){var t=void 0;return _.isString(e)&&d["default"].file.get_file_name(e)&&"/"!==e.slice(-1)?t=!0:(this._dispatchError("file_is_folder"),t=!1),t}},{key:"_readFile",value:function(e){var t=this,a=arguments.length<=1||void 0===arguments[1]?new FileReader:arguments[1];a.onload=function(){t._clearErrors()},a.onerror=function(){t._dispatchError("file_is_folder")},a.readAsText(e)}},{key:"_shouldOpenFilePreview",value:function(e){return _.includes(["image","video","audio"],e)}},{key:"_determineFileType",value:function(e,t){return t&&("pdf"===t?e="text":(_.includes(["xml","html","rtf"],t)||_.includes(t,"photoshop"))&&(e="application")),e}},{key:"_openFilePicker",value:function(){var e=document.getElementById("fileInput");e&&e.click(),E["default"].showFileChooser()}},{key:"_clearErrors",value:function(){m["default"].clearFileErrors({jid:this.active_chat})}},{key:"_dispatchError",value:function(e,t){m["default"].dispatchFileError({jid:t||this.active_chat,key:e})}}]),e}();e.exports=P},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(9),o=n(i),s=a(173),r=n(s);e.exports={dispatchFileError:function(e){o["default"].dispatch("file-error",e)},clearFileErrors:function(e){o["default"].dispatch("clear-errors",e)},openFilePicker:function(){r["default"].dispatch("analytics-input-actions-upload-invoke"),o["default"].dispatch("open-file-picker")},filePasted:function(e){o["default"].dispatch("file-pasted",e)},fileChosen:function(e,t){o["default"].dispatch("file-chosen",e,t)},changeFileName:function(e){o["default"].dispatch("change-filename",e)},uploadFile:function(e){o["default"].dispatch("upload-file",e)}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i),s=a(173),r=n(s),l=a(262),u=n(l);t["default"]={sendMessage:function(e){o["default"].dispatch("send-message",e),r["default"].dispatch("analytics-send-message",e)},clearChat:function(e){o["default"].dispatch("clear-messages",e)},closeChat:function(e){o["default"].dispatch("close-room",e)},joinChat:function(e){o["default"].dispatch("join-room",e)},clearChatInput:function(){o["default"].dispatch("clear-chat-input")},setMsgValue:function(e){o["default"].dispatch("set-message-value",e.text)},appendMessage:function(e){o["default"].dispatch("append-message-value",e.text)},setCaretPosition:function(e){o["default"].dispatch("set-chat-caret-position",e)},resetNewForcedCaretPosition:function(){o["default"].dispatch("reset-new-forced-caret-position")},expandAttachment:function(e){o["default"].dispatch("expand-attachment",e)},closeAttachment:function(e){o["default"].dispatch("close-attachment",e)},toggleTooltip:function(e){o["default"].dispatch("toggle-tooltip",e)},openTooltip:function(e){o["default"].dispatch("open-tooltip",e)},closeTooltip:function(e){o["default"].dispatch("close-tooltip",e)},showMessageLengthError:function(){o["default"].dispatch("show-flag",{type:"error",body:u["default"].fail.message_too_long,close:"auto"})},showFileDescriptionLengthError:function(){o["default"].dispatch("show-flag",{type:"error",body:u["default"].fail.file_description_too_long,close:"auto"})},setUserState:function(e){o["default"].dispatch("set-user-state",{jid:e.jid,type:e.type,state:e.state})},dismissActionsDropDown:function(){o["default"].dispatch("dismiss-active-actions-dropdown")},getLastMessageSentByCurrentUser:function(e,t){o["default"].dispatch("get-last-message-sent-by-current-user",{jid:e,cb:t})}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(183),o=n(i);t["default"]={description:{create_room_description:"Name your room after your team, project, or anything really.",create_room_topic:"Tell people what this room is about.",privacy:"Everyone already here will still have access. To add more people, you'll have to invite them.",public_room:"Anyone on your team can join this room and invite others.",private_room:"Only people invited to this room may join.",choose_people_to_remove:"Choose people to remove from this room:",notif_header_prefix:"Customize notifications for: ",notif_settings_info_prefix:"You can also change your ",notif_settings_link:"default settings",notif_settings_info_suffix:" for all rooms.",notif_default:"Change your default in Settings",notif_loud:"For every message",notif_normal:function(e){return"For @all, @here, and @"+e+" mentions only"},notif_quiet:function(e){return"For @"+e+" mentions only"}},label:{room_name:"Room name:",room_topic:"Topic:",these_people:"These people:",message:"Message:",new_room_name:"New room name:",public_room:"Open room",private_room:"Private room",global:"Global",default_text:"Default:",custom:"Custom",loud:o["default"].loud,normal:o["default"].normal,quiet:o["default"].quiet},button:{try_again:"Try again"},success:{users_invited:"People invited.",users_removed:"People removed.",rename_flag:"Room renamed.",privacy_changed:function(e,t){return e+" is now "+t+"."},room_created:function(e){return e+" created."}},fail:{invite_fail:"Couldn't invite people.",remove_users:"Couldn't remove people.",no_users_flag:"Choose someone to remove.",rename_flag:"Couldn't rename the room.",create_room:"Couldn't create the room.",change_privacy_flag:"Couldn't change the room privacy.",sent_message_in_archived_room:"Messages cannot be sent in archived rooms.",message_too_long:"Message too long.",file_description_too_long:"Message too long. It can't be more than 1000 characters.",oto_chats_disabled:"1-1 (private) chats are disabled by the administrator."}},e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={attachment:"Attachment",upload_file:"Upload a file",edit_message:"Edit",delete_message:"Delete",upload_default_name:"upload"},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],t=G["default"].jid.is_chat(e),a=G["default"].jid.is_room(e);if(!t)return!1;var n=A["default"].get("video_enabled"),i=A["default"].get("web_client_enso_video_enabled"),o=A["default"].get("web_client_enso_room_video_enabled");return a?n&&i&&o:n}Object.defineProperty(t,"__esModule",{value:!0});var o=a(23),s=n(o),r=a(59),l=n(r),u=a(4),c=n(u),d=a(5),f=n(d),h=a(9),p=n(h),m=a(265),g=n(m),v=a(161),y=n(v),b=a(95),w=n(b),R=a(266),k=n(R),E=a(257),C=n(E),S=a(190),T=n(S),x=a(267),A=n(x),I=a(270),N=n(I),M=a(169),O=n(M),D=a(271),P=n(D),j=a(121),L=n(j),F=a(261),U=n(F),H=a(285),B=n(H),z=a(287),q=n(z),V=a(99),G=n(V),W=a(90),$=n(W),Y=a(288),K=n(Y),X=a(215),J=n(X),Q=a(195),Z=n(Q),ee=a(289),te=n(ee),ae=a(219),ne=n(ae),ie=a(167),oe=n(ie),se=a(260),re=n(se),le=a(172),ue=n(le),ce=a(174),de=n(ce),fe=a(147),he=n(fe),pe=a(93),_e=n(pe),me=function(){function e(){(0,c["default"])(this,e),this.ConnectionStatus={CONNECTED:1,CONNECTING:2,DISCONNECTED:3,DISCONNECTING:4,NETWORK_DOWN:5,NETWORK_UP:6,SUSPEND:7,ERROR:0},this.FileUploaderErrors={FILE_TOO_LARGE:"file_too_large",FILE_IS_FOLDER:"file_is_folder",UNABLE_TO_UPLOAD:"unable_to_upload"}}return(0,f["default"])(e,[{key:"getInitData",value:function(){if(!T["default"].local.initialized)return!1;var e=T["default"].get("current_user");return _.merge({},{user_jid:e.user_jid,user_id:e.user_id,photo_large:e.photo_large,photo_small:e.photo_small,oauth_token:O["default"].getOAuthToken(),apiv1_token:O["default"].getApiV1Token(),group_id:T["default"].get("group_id"),group_name:T["default"].get("group_name")})}},{key:"getPreferences",value:function(){return y["default"].getAll()}},{key:"getUserByName",value:function(e){if(_.isString(e)){var t=T["default"].get("roster"),a=_.find(t,function(t){return _.has(t,"name")?e.toLowerCase()===t.name.toLowerCase():void 0});return a}}},{key:"getUserByMention",value:function(e){if(_.isString(e)){e="@"===e.charAt(0)?e.slice(1):e;var t=T["default"].get("roster"),a=_.find(t,function(t){return _.has(t,"mention_name")?e.toLowerCase()===t.mention_name.toLowerCase():void 0});return a}}},{key:"requestAddLiveCredentials",value:function(){return new l["default"](function(e,t){Z["default"].requestAddLiveCredentials(O["default"].get("jid"),function(a,n){return a?t({message:_.get(a,"text.__text",""),code:parseInt(a.code,10)}):void e({app_id:parseInt(n.app_id,10),user_id:parseInt(n.user_id,10),scope_id:n.scope_id,salt:n.salt,expires:parseInt(n.expires,10),signature:n.signature})})})}},{key:"joinAddLiveCall",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];ue["default"].joinAddLiveCall({jid:e,audio_only:t})}},{key:"leaveAddLiveCall",value:function(e){ue["default"].endAddLiveVideoSession(e),ue["default"].leaveAddLiveCall(e)}},{key:"onConnectionChanged",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1];switch(e){case this.ConnectionStatus.CONNECTED:p["default"].registerOnce("after:strophe-reconnected",t),J["default"].reconnect();break;case this.ConnectionStatus.CONNECTING:break;case this.ConnectionStatus.DISCONNECTED:J["default"].disconnect(!0);break;case this.ConnectionStatus.DISCONNECTING:break;case this.ConnectionStatus.ERROR:$["default"].error("Connection error");break;case this.ConnectionStatus.NETWORK_DOWN:ne["default"].onNetworkDown();break;case this.ConnectionStatus.NETWORK_UP:ne["default"].onNetworkUp();break;case this.ConnectionStatus.SUSPEND:p["default"].registerOnce("after:strophe-disconnected",t),J["default"].disconnect(!1);break;default:$["default"].error("Connection status invalid")}}},{key:"setPreferences",value:function(e){g["default"].savePreferences(e)}},{key:"setUserStatus",value:function(e){return"object"!==("undefined"==typeof e?"undefined":(0,s["default"])(e))?$["default"].error("API: setUserStatus: object expected"):void(e.show?C["default"].changeStatus(e):e.idle?C["default"].goIdle():C["default"].returnToActive())}},{key:"openLobby",value:function(){K["default"].openLobby()}},{key:"openQuickSwitcher",value:function(){w["default"].showQuickSwitcherDialog()}},{key:"openChat",value:function(e){Z["default"].openChatByJID(e),this.focusChatInput()}},{key:"focusChatInput",value:function(){var e=document.getElementById(L["default"].chat_input_id);e&&e.focus()}},{key:"createRoom",value:function(e){var t=A["default"].getCurrentRoomActions();
t.create_new_room&&w["default"].showCreateRoomDialog(e)}},{key:"deleteRoom",value:function(){var e=A["default"].getCurrentRoomActions(),t=A["default"].get("chat"),a=t.jid,n=t.name;e.delete_room&&w["default"].showDeleteRoomDialog({jid:a,name:n})}},{key:"inviteUsersToRoom",value:function(){var e=A["default"].getCurrentRoomActions();e.invite_users&&w["default"].showInviteUsersDialog()}},{key:"removeUsersFromRoom",value:function(){var e=A["default"].getCurrentRoomActions();e.remove_users&&w["default"].showRemoveUsersDialog()}},{key:"blurApp",value:function(){p["default"].dispatch("application-blurred")}},{key:"focusApp",value:function(){p["default"].dispatch("application-focused")}},{key:"focusSearch",value:function(){p["default"].dispatch("focus-search")}},{key:"getActiveChat",value:function(){var e=T["default"].get("active_chat"),t=T["default"].data.activeRooms[e];return t}},{key:"getCurrentRoomActions",value:function(){return A["default"].getCurrentRoomActions()}},{key:"openIntegrationsWindow",value:function(){var e=A["default"].getCurrentRoomActions();e.integrations&&_e["default"].openExternalWindow(oe["default"].getIntegrationsUrl(O["default"].get("web_server"),A["default"].get("chat").id,O["default"].get("user_id"),oe["default"].API_SOURCE_ID))}},{key:"openRoomNotifications",value:function(){var e=A["default"].getCurrentRoomActions(),t=A["default"].get("chat"),a=t.jid,n=t.name;e.room_notifications&&w["default"].showRoomNotificationsDialog({jid:a,room_name:n})}},{key:"archiveRoom",value:function(){var e=A["default"].getCurrentRoomActions();e.archive_room&&w["default"].showArchiveRoomDialog({archive:!0})}},{key:"unarchiveRoom",value:function(){var e=A["default"].getCurrentRoomActions();e.unarchive_room&&w["default"].showArchiveRoomDialog({archive:!1})}},{key:"changeRoomTopic",value:function(){var e=A["default"].getCurrentRoomActions();e.change_topic&&q["default"].editTopic()}},{key:"changeRoomPrivacy",value:function(){var e=A["default"].getCurrentRoomActions(),t=A["default"].get("chat"),a=t.jid,n=t.name,i=t.privacy;e.change_privacy&&w["default"].showRoomPrivacyDialog({jid:a,name:n,privacy:i})}},{key:"renameRoom",value:function(){var e=A["default"].getCurrentRoomActions(),t=A["default"].get("chat"),a=t.jid,n=t.name;e.rename_room&&w["default"].showRenameRoomDialog({jid:a,name:n})}},{key:"enableGuestAccess",value:function(){var e=A["default"].getCurrentRoomActions(),t=A["default"].get("chat"),a=t.jid;e.enable_guest_access&&q["default"].enableGuestAccess({jid:a})}},{key:"disableGuestAccess",value:function(){var e=A["default"].getCurrentRoomActions();e.disable_guest_access&&w["default"].showDisableGuestAccessDialog()}},{key:"closeActiveChat",value:function(){var e=T["default"].get("active_chat");G["default"].jid.is_chat(e)?K["default"].close(e,G["default"].room.detect_chat_type(e)):G["default"].jid.is_search(e)&&this.closeSearchResults()}},{key:"closeSearchResults",value:function(){K["default"].closeSearchResults()}},{key:"getActiveChats",value:function(){return T["default"].data.activeRooms}},{key:"navigateChatUp",value:function(){p["default"].dispatch("navigate-rooms",{direction:"up"})}},{key:"navigateChatDown",value:function(){p["default"].dispatch("navigate-rooms",{direction:"down"})}},{key:"navigateToTopChat",value:function(){p["default"].dispatch("navigate-rooms",{direction:"top"})}},{key:"navigateToBottomChat",value:function(){p["default"].dispatch("navigate-rooms",{direction:"bottom"})}},{key:"navigateToChatAtIndex",value:function(e){p["default"].dispatch("navigate-rooms",{direction:"index",index:e})}},{key:"showPreferencesDialog",value:function(){w["default"].showSettingDialog()}},{key:"toggleSoundNotifications",value:function(){p["default"].dispatch("toggle-sound-notifications")}},{key:"markChatsAsRead",value:function(){p["default"].dispatch("mark-chats-as-read")}},{key:"markRoomsAsRead",value:function(){p["default"].dispatch("mark-rooms-as-read")}},{key:"markPeopleAsRead",value:function(){p["default"].dispatch("mark-people-as-read")}},{key:"sendMessage",value:function(e){e.id=e.id||N["default"].get("message_id"),e.text=G["default"].strings.stripHiddenCharacters(e.text),e.source="api",U["default"].sendMessage(e)}},{key:"appendMessage",value:function(e){var t=e.text;U["default"].appendMessage({text:t})}},{key:"showInviteTeammatesDialog",value:function(){w["default"].showInviteTeammatesDialog()}},{key:"reopenLastChat",value:function(){var e=T["default"].getLastClosedChat();e&&(Z["default"].navigateToChat(e),Z["default"].restoreRoomOrder(e))}},{key:"recallOlderInputHistory",value:function(e){p["default"].dispatch("recall-older-message",e)}},{key:"recallNewerInputHistory",value:function(e){p["default"].dispatch("recall-newer-message",e)}},{key:"showDesktop4Dialog",value:function(e){var t=_.isObject(_.get(e,"content"))?e.content:T["default"].get("release_dialog_content")||{},a=_.has(e,"bgDismiss")?e.bgDismiss:!0,n={bgDismiss:a,content:t};w["default"].showDesktop4Dialog(n)}},{key:"addFileForUploadWithUrl",value:function(e,t){e&&Z["default"].addFileForUploadWithUrl(e,t)}},{key:"addFileForUploadWithBase64",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1],a=arguments[2];return N["default"].get("uploading")?!1:(_.includes(["paste","dragndrop"],t)&&(a=t,t=null),void(e&&Z["default"].addFileForUploadWithBase64(e,t,a)))}},{key:"showFileUploadError",value:function(e,t){var a=T["default"].get("active_chat");U["default"].expandAttachment({jid:a,file_name:e}),re["default"].dispatchFileError({jid:a,key:t})}},{key:"openFilePicker",value:function(){re["default"].openFilePicker()}},{key:"clearWebCookies",value:function(){var e=arguments.length<=0||void 0===arguments[0]?_.noop:arguments[0];Z["default"].clearWebCookies(e)}},{key:"revokeOauth2Token",value:function(){var e=arguments.length<=0||void 0===arguments[0]?_.noop:arguments[0];Z["default"].revokeOauth2Token(e)}},{key:"sanitizeError",value:function(e){return e?te["default"].sanitize(e):void 0}},{key:"toggleLeftSidebar",value:function(){var e=!y["default"].shouldShowNavigationSidebar();k["default"].setLeftSidebarVisibility(e)}},{key:"toggleRightSidebar",value:function(){var e=T["default"].get("active_chat"),t=G["default"].room.detect_chat_type(e),a=!1;"chat"===t?(a=!y["default"].shouldShowChatSidebar(),k["default"].setRightChatSidebarVisibility(a)):"groupchat"===t&&(a=!y["default"].shouldShowGroupChatSidebar(),k["default"].setRightGroupChatSidebarVisibility(a))}},{key:"getFileUrls",value:function(e){return new l["default"](function(t,a){var n=function(e){p["default"].dispatch("API:fetch-signed-file",{url:e},function(n){n instanceof he["default"]?a(n):t({url:e,signedUrl:n.temp_url,downloadUrl:n.temp_download_url})})};if(P["default"].isSignedFile(e)){var i=e;P["default"].isFileUrlAuthenticated(i)||(i=P["default"].getPublicUrlFromThumbnail(i)),n(i)}else t({url:e,signedUrl:e,downloadUrl:e})})}},{key:"onVideoConferenceJoined",value:function(){p["default"].dispatch("enso.video-conference-joined")}},{key:"onVideoConferenceLeft",value:function(){p["default"].dispatch("enso.video-conference-left")}},{key:"startVideoCall",value:function(){var e=T["default"].get("active_chat");if(i(e)){var t=T["default"].get("activeRooms")[e],a=A["default"].get("web_client_enso_video_enabled"),n={jid:e,name:t.name,service:a?de["default"].ENSO:de["default"].ADDLIVE};G["default"].jid.is_room(e)?(n.room_id=t.id,B["default"].startEnsoRoomVideo(n)):(n.audio_only=!1,B["default"].startCall(n))}}},{key:"isVideoEnabled",value:function(){var e=T["default"].get("active_chat");return i(e)}},{key:"isFileSharingEnabled",value:function(){var e=T["default"].get("active_chat");return G["default"].jid.is_chat(e)?N["default"].get("can_share_files"):!1}},{key:"onAddLiveCall",value:function(){C["default"].onCall()}},{key:"scrollDownOnZoom",value:function(){p["default"].dispatch("scroll-down-on-zoom")}}]),e}();t["default"]=new me,e.exports=t["default"]},function(e,t,a){"use strict";var n=a(9);e.exports={savePreferences:function(e){n.dispatch("save-preferences",e)},addRoomToIntegrationDiscoveryIgnoreList:function(e){n.dispatch("add-room-integration-discovery-ignore-list",e)}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(157),o=n(i),s=a(9),r=n(s),l=a(166),u=n(l);t["default"]={setLeftSidebarVisibility:function(e){var t=(0,o["default"])({},u["default"].SHOW_NAVIGATION_SIDEBAR,e);r["default"].dispatch("save-preferences",t),r["default"].dispatch("left-column-width-updated")},setRightChatSidebarVisibility:function(e){var t=(0,o["default"])({},u["default"].SHOW_CHAT_SIDEBAR,e);r["default"].dispatch("save-preferences",t)},setRightGroupChatSidebarVisibility:function(e){var t=(0,o["default"])({},u["default"].SHOW_GROUPCHAT_SIDEBAR,e);r["default"].dispatch("save-preferences",t)},saveLeftColumnWidth:function(e){var t=(0,o["default"])({},u["default"].LEFT_COLUMN_WIDTH,e);r["default"].dispatch("save-preferences",t),r["default"].dispatch("left-column-width-updated")},saveRightColumnWidth:function(e){var t=(0,o["default"])({},u["default"].RIGHT_COLUMN_WIDTH,e);r["default"].dispatch("save-preferences",t),r["default"].dispatch("right-column-width-updated")},setRightColumnWidthIsChanging:function(e){r["default"].dispatch("set-right-sidebar-visible-width-is-changing",e)}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(191),o=n(i),s=a(10),r=n(s),l=a(4),u=n(l),c=a(5),d=n(c),f=a(22),h=n(f),p=a(51),m=n(p),g=a(9),v=n(g),y=a(121),b=n(y),w=a(204),R=n(w),k=a(161),E=n(k),C=a(268),S=n(C),T=a(269),x=n(T),A=a(167),I=n(A),N=a(97),M=n(N),O=a(99),D=n(O),P=a(103),j=n(P),L=a(93),F=n(L),U=function(e){function t(){(0,u["default"])(this,t);var e=(0,h["default"])(this,(0,r["default"])(t).call(this));return e.default_profile={email:"",mention_name:"",name:"",photo_large:"",photo_small:"",timezone:!1,title:""},e.local={profiles:{}},e}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"getDefaults",value:function(){return{initialized:!1,active_chat:null,path_prefix:"",type:"",rooms:{},topic_editing:!1,chat:{jid:"",name:"",topic:null,photo_large:"",title:"",status:"",privacy:"",is_archived:"0",email:"",presence:{},time:"",loading_profile:!0},video_enabled:!1,user_is_admin:!1,current_user:{},per_room_notifications_enabled:!1}}},{key:"registerListeners",value:function(){var e=this;v["default"].registerOnce({"hc-init":function(t){e.handleConfig(t)}}),v["default"].register({"app-state-ready":function(){e.set("initialized",!0)},"updated:emoticons":function(t){var a=t.path_prefix;e.set({path_prefix:a})},"updated:config":function(t){e.handleConfig(t)},"updated:current_user":function(t){e.local.profiles[t.user_jid]=_.assign({name:t.user_name,mention_name:t.mention},t),e.set({current_user:t})},"updated:activeRooms":function(t){e.handleRoomsUpdate(t),F["default"].onRoomActionsChanged(e.getCurrentRoomActions())},"updated:profiles":function(t){e.handleProfilesUpdate(t)},"updated:roster":function(t){e.handleRosterUpdate(t)},"updated:active_chat":function(t){e.data.active_chat=t,e.updateRoomHeaderState(t)},"after:updated:active_chat":function(){F["default"].onRoomActionsChanged(e.getCurrentRoomActions())},"before:set-route":function(t){t.jid!==e.data.active_chat&&e.resetChat(t.jid)},"edit-topic":function(){e.set("topic_editing",!0)},"dismiss-topic-edit":function(){e.set({topic_editing:!1})},"set-topic":function(t){e.handleSetTopic(t)},"updated:preferences":function(){var t=e.data.active_chat;D["default"].jid.is_private_chat(t)&&e.data.rooms[t]&&(e._updateChatTime(e.data.rooms[t]),e.set("chat",e.data.chat))}})}},{key:"handleRoomsUpdate",value:function(e){var t=this.data.rooms,a=this.data.active_chat,n=_.difference(_.keys(t),_.keys(e));n.length&&(t=_.omit(t,n));var i={rooms:_.merge(t,e)};e[a]&&(i.chat=_.merge(this.data.chat,e[a])),this.set(i),this.updateRoomHeaderState(a)}},{key:"handleProfilesUpdate",value:function(e){var t=this;_.map(e,function(e,a){t.local.profiles[a]=e,t.data.rooms[a]&&(t.data.rooms[a]=_.merge(t.data.rooms[a],e))}),this.updateRoomHeaderState(this.data.active_chat)}},{key:"updateProfile",value:function(e,t){var a=this,n=_.keys(this.default_profile);_.forEach(n,function(n){t[n]&&(a.local.profiles[e][n]=t[n])})}},{key:"handleRosterUpdate",value:function(e){var t=_.cloneDeep(this.data.rooms),a=this.local.profiles,n=this.updateProfile.bind(this);_.forEach(t,function(t,i){if(t&&e[i]){var s=e[i].presence;t.presence=(0,o["default"])({},s),t.name=e[i].name,a[i]&&n(i,t)}}),this.handleRoomsUpdate(t)}},{key:"resetChat",value:function(e){var t=_.assign({},this.data.chat,this.data.rooms[e]);t.loading_profile=!0,this.set("chat",t)}},{key:"updateRoomHeaderState",value:function(e){var t=this;if(clearTimeout(this.timeout),e&&!D["default"].jid.is_lobby(e)&&this.data.rooms[e]){var a=this.data.rooms[e],n=this.data.chat,i=this.data.rooms[e].type,o=this.data.type,s=this.local.profiles[e],r={chat:"files",groupchat:"roster"};o!==i&&(this.data.active_panel=r[i]),"chat"===i&&a&&(s&&(a.loading_profile=!1),_.merge(a,_.clone(this.default_profile),s),this._updateChatTime(a),this.timeout=setTimeout(function(){t.updateRoomHeaderState(e)},6e4));var l=_.assign({},n,a);this.set({active_chat:e,type:l.type,chat:l,active_panel:this.data.active_panel})}}},{key:"_updateChatTime",value:function(e){var t=E["default"].shouldUse24HrTime()?"ddd HH:mm":"ddd h:mm A";if(e.timezone){var a=parseFloat(e.timezone.utc_offset);this.data.chat.time=(0,j["default"])().utcOffset(a).format(t)}else this.data.chat.time=(0,j["default"])().format(t)}},{key:"getCurrentRoomActions",value:function(){var e=this.data.chat,t=this.data.active_chat,a="lobby"===t,n="search"===t,i="groupchat"===this.data.type&&!a&&!n,o=x["default"].get("user_is_room_admin"),s="public"===e.privacy,r=D["default"].room.is_archived(e);return i?{room_notifications:!!this.data.per_room_notifications_enabled,integrations:x["default"].canManageRoomIntegrations()&&!r,create_new_room:x["default"].canCreateRoom(),invite_users:(s||!s&&o)&&!r,remove_users:!s&&o&&!r,enable_guest_access:x["default"].canToggleGuestAccess()&&!e.guest_url,disable_guest_access:x["default"].canToggleGuestAccess()&&!!e.guest_url,archive_room:o&&!r,unarchive_room:o&&r,change_topic:!r,change_privacy:o&&!r,delete_room:o&&!r,rename_room:o&&!r}:{room_notifications:!1,integrations:!1,create_new_room:x["default"].canCreateRoom(),invite_users:!1,remove_users:!1,enable_guest_access:!1,disable_guest_access:!1,archive_room:!1,unarchive_room:!1,change_topic:!1,change_privacy:!1,delete_room:!1,rename_room:!1}}},{key:"handleSetTopic",value:function(e){e=e.trim(),e.length>b["default"].max_topic_text_length&&(R["default"].showFlag({type:"error",body:this._flagBody(S["default"].topic_length_error(b["default"].max_topic_text_length)),close:"auto"}),e=e.substring(0,b["default"].max_topic_text_length)),this.data.chat.topic=e,v["default"].dispatch("send-topic",{jid:this.data.chat.jid,topic:e}),this.data.topic_editing=!1}},{key:"_flagBody",value:function(e){return function(){return React.createElement("div",null,React.createElement("p",{className:"hc-message-body"},e))}}},{key:"handleConfig",value:function(e){this.set({active_chat:E["default"].get("chatToFocus")||this.data.active_chat,video_enabled:_.get(e,"video_chat_enabled")&&_.get(e,"feature_flags.web_client_video_chat"),per_room_notifications_enabled:_.get(e,"feature_flags.web_client_per_room_notifications"),web_client_integrations_enabled:I["default"].isFeatureEnabled(e),web_client_addlive_video_enabled:_.get(e,"feature_flags.web_client_addlive_video",!0),web_client_enso_video_enabled:_.get(e,"feature_flags.web_client_enso_video",!1),web_client_enso_room_video_enabled:_.get(e,"feature_flags.web_client_enso_room_video",!1)})}}]),t}(M["default"]);e.exports=new U},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={default_topic:"This is the room topic. Double click to change it.",loading:"Loadingâ¦",beta:function(e){return"Still baking! The "+e+" feature is not in the beta, but will be soon."},enso_video:"HipChat Video",room_notifications:"Room Notifications",integrations:"Integrations",create_new_room:"Create New Roomâ¦",invite_users:"Invite People",remove_users:"Remove People",disable_guest:"Disable Guest Access",guest_enabled:"Guest Access Enabled",guest_disabled:"Guest Access Disabled",guest_access_on:"Guest Access On",enable_guest:"Enable Guest Access",archive:"Archive",unarchive:"Unarchive",change_topic:"Change Topic",change_privacy:"Change Privacy","delete":"Delete",rename:"Rename",files:"Files",links:"Links",people:"People",room_actions:"Room actions",show_roster:"Show people",hide_roster:"Hide people",show_files:"Show files",hide_files:"Hide files",show_links:"Show links",hide_links:"Hide links",show_integrations:"Show integrations",hide_integrations:"Hide integrations",show_sidebar:"Show sidebar",hide_sidebar:"Hide sidebar",video_call:"Make a video call",audio_call:"Make an audio call",hipchat_video:"AddLive",topic_length_error:function(e){return"Maximum topic length is "+e+"."}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(47),h=n(f),p=a(51),m=n(p),g=a(9),v=n(g),y=a(169),b=n(y),w=a(97),R=n(w),k=a(99),E=n(k),C=function(e){function t(){(0,r["default"])(this,t);var e=(0,d["default"])(this,(0,o["default"])(t).call(this));return e._hasRoomPermissionCheck=_.memoize(e._hasRoomPermission),e}return(0,m["default"])(t,e),(0,u["default"])(t,[{key:"getDefaults",value:function(){return{permissions:{},room_roles:{},room_permissions:{},current_room:null,user_is_admin:!1,user_is_room_admin:!1,current_user:{},invite_url:!1}}},{key:"registerListeners",value:function(){var e=this;v["default"].registerOnce({"hc-init":function(t){e._init(t)}}),v["default"].register({"updated:config":function(t){e._init(t)},"updated:permissions":function(t){e.set("permissions",t)},"updated:current_user":function(t){e.set("current_user",t),e._updateCurrentRoomRoles()},"updated:activeRooms":function(t){var a=_.mapValues(t,function(e){return{admins:e.admins,owner:e.owner}}),n=_.merge(e.data.room_roles,a);e.set("room_roles",n),e._updateCurrentRoomRoles()},"updated:active_chat":function(t){e._clearPermissionsCache(),e.data.current_room=t,e._updateCurrentRoomRoles()},"DAL:handle-joined-rooms":function(t){e._updateRoomPermissions(t)}})}},{key:"_init",value:function(e){this.set({user_is_admin:e.is_admin,invite_url:e.invite_url})}},{key:"canCreateRoom",value:function(){var e=this.data.permissions;return"all"===e.create_rooms||"admins"===e.create_rooms&&this.data.user_is_admin}},{key:"canInviteUsersToGroup",value:function(){return!b["default"].get("feature_flags").hide_invite_your_team_button&&(this.data.user_is_admin===!0||this.data.invite_url)}},{key:"canViewGuestAccess",value:function(){return this._hasRoomPermissionCheck("room:view_guest_access")}},{key:"canToggleGuestAccess",value:function(){return this._hasRoomPermissionCheck("room:toggle_guest_access")}},{key:"_hasRoomPermission",value:function(e){var t=_.get(this.data.current_user,"jid"),a=this.data.room_permissions[this.data.current_room]||{},n=a[t]||[];return-1!==n.indexOf(e)}},{key:"canManageRoomIntegrations",value:function(){return this.data.user_is_admin===!0||this.data.user_is_room_admin===!0||"all"===this.data.permissions.manage_room_integrations}},{key:"canUpdateRoomIntegrations",value:function(){return this.data.user_is_admin===!0||this.data.user_is_room_admin===!0}},{key:"_updateRoomPermissions",value:function(e){var t=this,a=this.data.current_user.jid;E["default"].toArray(e).forEach(function(e){_.set(t.data.room_permissions,[e.jid,a],e.permissions)}),this._clearPermissionsCache(),this.set("room_permissions",this.data.room_permissions)}},{key:"_updateCurrentRoomRoles",value:function(){var e=_.get(this.data.room_roles,[this.data.current_room,"admins"],[]),t=_.get(this.data.room_roles,[this.data.current_room,"owner"],null),a=E["default"].user.is_admin(e,t,this.data.current_user);this.set({user_is_room_admin:a})}},{key:"_clearPermissionsCache",value:function(){this._hasRoomPermissionCheck.cache.clear()}},{key:"clear",value:function(){(0,h["default"])((0,o["default"])(t.prototype),"clear",this).call(this),this._clearPermissionsCache()}},{key:"reset",value:function(){(0,h["default"])((0,o["default"])(t.prototype),"reset",this).call(this),this._clearPermissionsCache()}}]),t}(R["default"]);e.exports=new C},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(157),o=n(i),s=a(114),r=n(s),l=a(10),u=n(l),c=a(4),d=n(c),f=a(5),h=n(f),p=a(22),m=n(p),g=a(51),v=n(g),y=a(121),b=n(y),w=a(97),R=n(w),k=a(271),E=n(k),C=a(161),S=n(C),T=a(9),x=n(T),A=a(99),I=n(A),N=a(273),M=a(274),O=n(M),D=a(184),P=n(D),j=a(275),L=a(126),F=a(196),U=n(F),H=a(95),B=n(H),z=a(279),q=n(z),V=function(e){function t(){(0,d["default"])(this,t);var e=(0,m["default"])(this,(0,u["default"])(t).call(this));return e.local={unsentText:{},uploadingStatus:{},allRooms:{},guests:[],members:[],users:{},room_privacy:"",caret_position:0,input_history:{},input_history_index:{},unsent_text_before_recall:{},upload_progress:{}},e}return(0,v["default"])(t,e),(0,h["default"])(t,[{key:"getDefaults",value:function(){return{active_autocomplete:null,active_chat:null,active_chat_id:null,attachment_expanded:!1,can_share_files:!0,can_use_oto_chats:!0,chat_type:"",default_mentions:_.map(b["default"].core_mentions,function(e){return{jid:e.jid,name:e.name,mention_name:e.mention_name,presence:{show:P["default"].AVAILABLE}}}),emoticon_list:[],emoticon_text:"",emoticon_selected_item:0,emoticon_results_count:0,emoticon_regex:b["default"].emoticon_regex,file:null,file_error:!1,file_error_message:"",file_name:"",mention_list:[],mention_text:"",mention_selected_item:0,mention_results_count:0,mention_regex:b["default"].mention_regex,message_id:0,new_forced_caret_position:0,path_prefix:"",post_emoticon_text:"",post_mention_text:"",pre_emoticon_text:"",pre_mention_text:"",room_is_archived:!0,should_animate_avatar:!0,slash_command_list:[],slash_command_results_count:0,slash_command_selected_item:0,smileys:{},text:"",uploading:!1,upload_progress:null,user_is_admin:!1,user_is_guest:!1,user_state:"active",video_enabled:!1,keyboard_shortcuts:null,keyboard_shortcuts_initialized:!1,web_server:""}}},{key:"registerListeners",value:function(){var e=this;x["default"].registerOnce({"hc-init":function(t){e.handleConfig(t)}}),x["default"].register({"app-state-ready":function(){e.set("initialized",!0),e.data.keyboard_shortcuts_initialized||(e.set("keyboard_shortcuts_initialized",!0),q["default"].init(e.data.keyboard_shortcuts))},"updated:config":function(t){e.handleConfig(t)},"updated:preferences":function(){e.handlePreferences()},"updated:current_user":function(t){e.data.user_is_admin=!!t.is_admin,e.data.user_is_guest=!!t.is_guest},"updated:web_server":function(t){e.data.web_server=t},"updated:permissions":function(t){e.set({can_share_files:"all"===t.file_sharing,can_use_oto_chats:"all"===t.oto_chat})},"close-room":function(t){e.deleteInputHistory(t.jid),e.deleteUnsentText(t.jid),e.deleteUploadingStatus(t.jid)},"updated:activeRooms":function(t){e.handleActiveRoomsUpdate(t)},"send-message":function(t){e.saveInputHistory(t),e.resetHistoryIndex(t.jid),e.data.message_id++,"api"!==t.source&&e.set({text:"",message_id:e.data.message_id,user_state:"active"})},"initiate-edit-message":function(e){var t=Date.now()-1e3*e.time>b["default"].edit_message_threshold;t?B["default"].showNotEditableDialog({action:"edit"}):e.is_deleted||B["default"].showEditMessageDialog(e)},"initiate-delete-message":function(e){var t=Date.now()-1e3*e.time>b["default"].edit_message_threshold;t?B["default"].showNotEditableDialog({action:"delete"}):e.is_deleted||B["default"].showDeleteMessageDialog(e)},"clear-messages":function(){e.clearText()},"clear-chat-input":function(){e.clearText()},"recall-newer-message":function(t){e.isFocused()&&(e.recallNewerMessage(),t.preventDefault())},"recall-older-message":function(t){e.isFocused()&&(e.recallOlderMessage(),t.preventDefault())},"updated:smileys":function(t){var a=_.keyBy(_.keyBy(t,"file"),"shortcut");e.set({smileys:a})},"updated:emoticons":function(t){e.set({path_prefix:t.path_prefix,emoticons:t.icons})},"before:updated:active_chat":function(){e.setUnsentText(e.data.active_chat),e.setUploadingStatus(e.data.active_chat)},"updated:active_chat":function(t){var a=_.assign({},{active_chat:t,active_chat_id:e._getActiveChatId(t),chat_type:I["default"].room.detect_chat_type(t),room_is_archived:I["default"].room.is_archived(e.local.allRooms[t]),text:e.getUnsentText(t),upload_progress:e.getUploadProgress(t)},e.getUploadingStatus(t));e.set(a),e.data.file&&e.data.attachment_expanded&&e.data.file.file_obj&&!e.data.file_error&&!e.data.uploading?x["default"].dispatch("open-tooltip",{type:"upload_preview",data:{file:e.data.file.file_obj}}):x["default"].dispatch("close-tooltip",{type:"upload_preview"})},"upload-file":function(){e.set({uploading:!0})},"upload-successful":function(t){var a=t.jid,n=t.text;e.updateUploadingStatus(a,{uploading:!1,attachment_expanded:!1,file:null,file_extension:"",file_name:""}),a===e.data.active_chat&&n===e.data.text&&e.clearText(),a!==e.data.active_chat&&n===e.local.unsentText[a]&&delete e.local.unsentText[a]},"upload-failed":function(t){e.updateUploadingStatus(t.jid,{uploading:!1})},"upload-progress-update":function(t){var a=t.jid,n=t.percentage;e.local.upload_progress[a]=n,e.updateUploadProgress(a)},"upload-complete":function(t){var a=t.jid;delete e.local.upload_progress[a],e.updateUploadProgress(a)},"set-message-value":function(t){e.set("text",t),e.resetHistoryIndex(e.data.active_chat)},"append-message-value":function(t){e.set("text",_.get(e.data,"text","")+t)},"expand-attachment":function(t){e.updateUploadingStatus(t.jid,{attachment_expanded:!0,file:t.file,file_name:t.file_name,file_error:!1,file_extension:I["default"].file.get_extension(t.file_name),file_selection_source:t.file_selection_source})},"close-attachment":function(t){e.updateUploadingStatus(t.jid,{attachment_expanded:!1,file:null,file_name:"",file_error:!1,file_extension:""})},"set-chat-caret-position":function(t){e.local.caret_position=t},"reset-new-forced-caret-position":function(){e.set("new_forced_caret_position",0)},"sender-clicked":function(t){var a=e.data.text,n=e.local.caret_position;-1===a.indexOf(t.mention+" ")&&(e.local.caret_position=n+t.mention.length+1,e.resetHistoryIndex(e.data.active_chat),e.set({text:""+a.substr(0,n)+t.mention+" "+a.substr(n),new_forced_caret_position:e.local.caret_position}))},"change-filename":function(t){e.set("file_name",t.file_name)},"smiley-chosen":function(t){e.handleSmileyChosen(t)},"set-user-state":function(t){e.data.user_state!==t.state&&(e.data.user_state=t.state)},"file-error":function(t){e.updateUploadingStatus(t.jid,{file_error:!0,file_error_message:O["default"][t.key]})},"clear-errors":function(t){e.updateUploadingStatus(t.jid,{file_error:!1,file_error_message:""})},"dismiss-emoticon-autocomplete":function(){e.dismissEmoticonAutoComplete()},"process-emoticon-text":function(t){e.processEmoticonText(t.text,t.caret_position)},"emoticon-selected":function(){e.handleEmoticonSelected()},"dismiss-mention-autocomplete":function(){e.dismissMentionAutoComplete()},"process-mention-text":function(t){e.processMentionText(t.text,t.caret_position)},"process-slash-command-text":function(t){var a=t.text,n=t.caret_position;e.processSlashCommandText(a,n)},"navigate-autocomplete":function(t){e.navigateAutoComplete(t.autocomplete,t.direction)},"mention-selected":function(){e.handleMentionSelected()},"menu-item-hovered":function(t){e.updateActiveMenuItem(t)},"slash-command-selected":function(){e.handleSlashCommandSelected()}})}},{key:"updateUploadProgress",value:function(e){e===this.data.active_chat&&this.set("upload_progress",this.getUploadProgress(e))}},{key:"getUploadProgress",value:function(e){var t=this.local.upload_progress[e];return void 0!==t?t:null}},{key:"handleActiveRoomsUpdate",value:function(e){var t,a,n;this.local.allRooms=e,t=this.local.allRooms[this.data.active_chat],t&&(a=I["default"].room.is_archived(t),n=this._getActiveChatId(t.jid),t.type===this.data.chat_type&&a===this.data.room_is_archived&&this.data.active_chat_id===n||this.set({active_chat_id:n,chat_type:t.type,room_is_archived:a}))}},{key:"processEmoticonText",value:function(e,t){var a,n,i=e.substring(0,t),o=e.substring(t),s=i.split(this.data.emoticon_regex).slice(-1)[0];0===s.indexOf("(")&&"("!==s?(this.data.emoticon_text=s.toLowerCase(),a=this.filterEmoticonList(this.data.emoticon_text),n=a.slice(0,40),this.set({emoticon_text:s,emoticon_selected_item:0,pre_emoticon_text:i,post_emoticon_text:o,path_prefix:this.data.path_prefix,emoticon_list:n,emoticon_results_count:n.length,active_autocomplete:"emoticon"})):"emoticon"===this.data.active_autocomplete&&this.dismissEmoticonAutoComplete()}},{key:"filterEmoticonList",value:function(e){var t,a=e.slice(1),n=function(e){return"<strong>"+e+"</strong>"};return t=_.filter(this.getEmoticons(),function(e){return-1!==e.shortcut.indexOf(a)}),t=_.sortBy(t,function(e){return e.shortcut.indexOf(a)}),t=_.forEach(t,function(e){e.match_markup=e.shortcut.split(a).join(n(a))})}},{key:"getEmoticons",value:function(){var e=_.toArray(this.data.emoticons),t=_.filter(_.toArray(this.data.smileys),function(e){return 0===e.shortcut.indexOf("(")});return _.sortBy(e.concat(t),"shortcut")}},{key:"handleEmoticonSelected",value:function(){var e=this.data.emoticon_list[this.data.emoticon_selected_item],t=this.getPreEmoticonOnSelect(e.shortcut),a=this.data.post_emoticon_text,n=this.data.post_emoticon_text.indexOf(" ");0!==n&&(a=this.data.post_emoticon_text.slice(n+1)),this.set({text:t+a,new_forced_caret_position:t.length}),this.dismissEmoticonAutoComplete()}},{key:"handleSlashCommandSelected",value:function(){var e=this.data.slash_command_list[this.data.slash_command_selected_item],t=void 0;if(0===e.name.indexOf(this.data.text))t=e.name;else{var a=!0,n=!1,i=void 0;try{for(var o,s=(0,r["default"])(e.aliases);!(a=(o=s.next()).done);a=!0){var l=o.value;0===l.indexOf(this.data.text)&&(t=l)}}catch(u){n=!0,i=u}finally{try{!a&&s["return"]&&s["return"]()}finally{if(n)throw i}}}U["default"].slashCommandUsedInAutocomplete({room:I["default"].jid.is_room(this.data.active_chat)?this.data.active_chat_id:null,slashUsed:t});var c=t+" ";this.set({text:c,new_forced_caret_position:c.length}),this.dismissSlashCommandAutoComplete()}},{key:"getPreEmoticonOnSelect",value:function(e){return this.data.pre_emoticon_text.slice(0,-this.data.emoticon_text.length)+e+" "}},{key:"dismissEmoticonAutoComplete",value:function(){this.set({emoticon_text:"",emoticon_selected_item:0,emoticon_results_count:0,emoticon_list:[],active_autocomplete:null})}},{key:"clearText",value:function(){this.resetHistoryIndex(this.data.active_chat),this.set({text:""})}},{key:"handleSmileyChosen",value:function(e){var t,a=this.local.caret_position,n=this.data.text;0!==a&&n?a===n.length?(n=n.trim()+(" "+e.shortcut+" "),t=n.length):(n=n.substr(0,a).trim()+(" "+e.shortcut+" ")+n.substr(a).trim(),t=a+e.shortcut.length+1):(n=e.shortcut+" "+n.trim(),t=e.shortcut.length+1),this.set({text:n,new_forced_caret_position:t})}},{key:"setUnsentText",value:function(e){I["default"].jid.is_chat(e)&&(this.local.unsentText[e]=this.data.text)}},{key:"getUnsentText",value:function(e){return this.local.unsentText[e]||""}},{key:"deleteUnsentText",value:function(e){delete this.local.unsentText[e]}},{key:"updateUploadingStatus",value:function(e,t){this.data.active_chat===e?this.set(t):this.setUploadingStatus(e,t)}},{key:"setUploadingStatus",value:function(e,t){I["default"].jid.is_chat(e)&&(t?this.local.uploadingStatus[e]=_.assign({},this.local.uploadingStatus[e],t):this.local.uploadingStatus[e]=_.pick(this.data,["uploading","attachment_expanded","file","file_error","file_error_message","file_extension","file_name","file_selection_source"]));
}},{key:"getUploadingStatus",value:function(e){return this.local.uploadingStatus[e]||{uploading:!1,attachment_expanded:!1,file:null,file_error:"",file_error_message:"",file_extension:"",file_name:"",file_selection_source:null}}},{key:"deleteUploadingStatus",value:function(e){delete this.local.uploadingStatus[e]}},{key:"updateRoomData",value:function(){var e=E["default"].getAll();this.local.guests=e.participants.guests,this.local.members=e.participants.members,this.local.users=e.users,this.local.room_privacy=e.active_chat_privacy}},{key:"processMentionText",value:function(e,t){var a=e.substring(0,t),n=e.substring(t),i=a.split(/\s/).slice(-1)[0];if(0===i.indexOf("@")){this.updateRoomData();var o=this.getMentionList(i).slice(0,25),s=(0,L.sort_users)(o,i.slice(1),"mention_name");this.set({mention_list:s,mention_results_count:s.length,mention_text:i,mention_selected_item:0,pre_mention_text:a,post_mention_text:n,active_autocomplete:"mention"})}else"mention"===this.data.active_autocomplete&&this.dismissMentionAutoComplete()}},{key:"getMentionList",value:function(e){var t,a,n=e.slice(1),i=this.local.allRooms[this.data.active_chat],o=i&&i.participants_fully_initialized,s=this.local.members.concat(this.local.guests).concat(this.data.default_mentions);if(""===n)t=_.map(this.data.default_mentions,"jid"),a=(0,N.chatSearch)(s,n,t);else if("private"===this.local.room_privacy&&o||this.data.user_is_guest)a=(0,N.chatSearch)(s,n);else{var r=this.removeGuests(this.local.users).concat(this.local.guests).concat(this.data.default_mentions);t=_.map(s,"jid"),a=(0,N.chatSearch)(r,n,t)}return a}},{key:"processSlashCommandText",value:function(e,t){var a=this;if(this.data.web_client_slash_command_autocomplete_enabled)if(/^\/(\w*)$/.test(e)&&t>0){var n=_.filter(j.commands,function(t){var n=t.name,i=t.aliases,o=t.members_only,s=t.oto_only,l=t.room_only,u=t.filter;if(s&&!I["default"].jid.is_private_chat(a.data.active_chat)||l&&!I["default"].jid.is_room(a.data.active_chat)||o&&a.data.user_is_guest||u&&!u({video_enabled:a.data.video_enabled}))return!1;if(0===n.indexOf(e))return!0;var c=!0,d=!1,f=void 0;try{for(var h,p=(0,r["default"])(i);!(c=(h=p.next()).done);c=!0){var _=h.value;if(0===_.indexOf(e))return!0}}catch(m){d=!0,f=m}finally{try{!c&&p["return"]&&p["return"]()}finally{if(d)throw f}}}),i=_.sortBy(n,"name"),o=i.map(function(e){var t=e.name,a=e.usage,n=e.description,i=e.aliases;return{name:t,usage:a,description:n,aliases:i}});this.set({active_autocomplete:"slash_command",slash_command_list:o,slash_command_selected_item:0,slash_command_results_count:o.length})}else"slash_command"===this.data.active_autocomplete&&this.dismissSlashCommandAutoComplete()}},{key:"dismissSlashCommandAutoComplete",value:function(){this.set({slash_command_list:[],slash_command_selected_item:0,slash_command_results_count:0,active_autocomplete:null})}},{key:"removeGuests",value:function(e){return _.reject(_.toArray(e),I["default"].user.is_guest)}},{key:"navigateAutoComplete",value:function(e,t){"mention"!==e&&"emoticon"!==e&&"slash_command"!==e||("up"===t?this.navigateAutocompleteUp(e):"down"===t&&this.navigateAutocompleteDown(e))}},{key:"navigateAutocompleteUp",value:function(e){var t,a=this.data[e+"_selected_item"],n=this.data[e+"_results_count"];t=a>0?a-1:n-1,this.set((0,o["default"])({},e+"_selected_item",t))}},{key:"navigateAutocompleteDown",value:function(e){var t,a=this.data[e+"_selected_item"],n=this.data[e+"_results_count"];t=n-1>a?a+1:0,this.set((0,o["default"])({},e+"_selected_item",t))}},{key:"handleMentionSelected",value:function(){var e=this.data.mention_list[this.data.mention_selected_item],t=this.getPreMentionOnSelect(e.mention_name),a=this.data.post_mention_text;this.set({text:t+a,new_forced_caret_position:t.length}),this.dismissMentionAutoComplete()}},{key:"getPreMentionOnSelect",value:function(e){return this.data.pre_mention_text.slice(0,-this.data.mention_text.length)+"@"+e+" "}},{key:"updateActiveMenuItem",value:function(e){this.set(e.type+"_selected_item",e.index)}},{key:"dismissMentionAutoComplete",value:function(){this.set({active_autocomplete:null,mention_list:[],mention_text:"",pre_mention_text:"",post_mention_text:"",mention_selected_item:0,mention_results_count:0})}},{key:"recallOlderMessage",value:function(){var e=this.data.active_chat,t=this.local.input_history_index[e];if(!_.isEmpty(this.local.input_history[e]))return _.isNull(t)||_.isUndefined(t)?(this.local.unsent_text_before_recall[e]=this.data.text,t=0,this.local.input_history_index[e]=t,void this.set("text",this.local.input_history[e][t])):void(t<this.local.input_history[e].length-1&&(t++,this.local.input_history_index[e]=t,this.set("text",this.local.input_history[e][t])))}},{key:"recallNewerMessage",value:function(){var e=this.data.active_chat,t=this.local.input_history_index[e];_.isNull(t)||_.isUndefined(t)||(t?(t=--this.local.input_history_index[e],this.set("text",this.local.input_history[e][t])):(this.resetHistoryIndex(e),this.set("text",this.local.unsent_text_before_recall[e])))}},{key:"saveInputHistory",value:function(e){var t=e.text.trim(),a=e.jid;this.local.input_history[a]||(this.local.input_history[a]=[]),this.local.input_history[a].length===b["default"].input_history_max&&this.local.input_history[a].pop(),this.local.input_history[a].unshift(t)}},{key:"deleteInputHistory",value:function(e){delete this.local.input_history[e],delete this.local.input_history_index[e],delete this.local.unsent_text_before_recall[e]}},{key:"resetHistoryIndex",value:function(e){this.local.input_history_index[e]=null}},{key:"isFocused",value:function(){return _.get(document.activeElement,"id")===b["default"].chat_input_id}},{key:"_getActiveChatId",value:function(e){var t=null;return I["default"].jid.is_lobby(e)||(I["default"].jid.is_private_chat(e)?t=I["default"].jid.user_id(e):this.local.allRooms[e]&&(t=parseInt(this.local.allRooms[e].id))),t}},{key:"handlePreferences",value:function(){this.set({should_animate_avatar:S["default"].shouldAnimateAvatars()})}},{key:"handleConfig",value:function(e){this.set({video_enabled:_.get(e,"video_chat_enabled")&&_.get(e,"feature_flags.web_client_video_chat"),keyboard_shortcuts:_.get(e,"keyboard_shortcuts"),web_client_addlive_video_enabled:_.get(e,"feature_flags.web_client_addlive_video",!0),web_client_enso_video_enabled:_.get(e,"feature_flags.web_client_enso_video",!1),web_client_enso_room_video_enabled:_.get(e,"feature_flags.web_client_enso_room_video",!1),web_client_slash_command_autocomplete_enabled:_.get(e,"feature_flags.web_client_slash_command_autocomplete_enabled"),message_editing_enabled:_.get(e,"feature_flags.web_client_message_editing")})}}]),t}(R["default"]);t["default"]=new V,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(157),o=n(i),s=a(10),r=n(s),l=a(4),u=n(l),c=a(5),d=n(c),f=a(22),h=n(f),p=a(51),m=n(p),g=a(9),v=n(g),y=a(161),b=n(y),w=a(265),R=n(w),k=a(266),E=n(k),C=a(166),S=n(C),T=a(97),x=n(T),A=a(272),I=n(A),N=a(99),M=n(N),O=a(167),D=n(O),P=a(121),j=n(P),L=function(e){function t(){return(0,u["default"])(this,t),(0,h["default"])(this,(0,r["default"])(t).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"getDefaults",value:function(){return{admins:[],current_user:{},users:{},rooms:{},files:[],links:[],loading:!1,participants:{members:[],guests:[]},initialized:!1,size:I["default"].MEDIUM,active_chat:null,active_chat_privacy:null,guest_url:"",chat_type:"",invite_url:!1,user_is_admin:!1,active_integration:null,active_integration_data_template_values:null,can_share_files:!0,panels_scroll_top:{}}}},{key:"registerListeners",value:function(){var e=this;v["default"].registerOnce({"hc-init":function(t){e.handleConfig(t)}}),v["default"].register({"updated:config":function(t){e.handleConfig(t)},"updated:current_user":function(t){e.data.current_user=t},"updated:roster":function(t){e.handleRosterUpdate(t)},"updated:permissions":function(t){e.set({can_share_files:"all"===t.file_sharing})},"app-state-ready":function(){e.data.initialized=!0,e.fetchPanelContent(e.data.active_chat)},"app-state-reconnected":function(){v["default"].dispatch("fetch-recent-files"),v["default"].dispatch("fetch-recent-links")},"fetch-files-history":function(){var t=e.data.active_chat;if(M["default"].jid.is_chat(t)){var a=_.last(e.data.files),n=a?a.date:M["default"].format_time_for_history(new Date);v["default"].dispatch("fetch-files",{room:t,before:n})}},"fetch-links-history":function(){var t=e.data.active_chat;if(M["default"].jid.is_chat(t)){var a=_.last(e.data.links),n=a?a.date:M["default"].format_time_for_history(new Date);v["default"].dispatch("fetch-links",{room:t,before:n})}},"fetch-recent-files":function(){var t=e.data.active_chat;if(M["default"].jid.is_chat(t)){var a=_.first(e.data.files),n=a?a.date:null;v["default"].dispatch("fetch-files",{room:t,after:n})}},"fetch-recent-links":function(){var t=e.data.active_chat;if(M["default"].jid.is_chat(t)){var a=_.first(e.data.links),n=a?a.date:null;v["default"].dispatch("fetch-links",{room:t,after:n})}},"DAL:handle-created-room":function(t){e.handleNewRoom(t)},"mark-participant-unknown":function(t){e.markParticipantForPrivateRoom(t)},"unmark-participant":function(t){e.unmarkParticipantForPrivateRoom(t)},"updated:active_chat":function(t){e.handleSelectRoom(t),e.fetchPanelContent(t)},"updated:activeRooms":function(t){e.handleActiveRoomsUpdate(t)},"select-panel":function(t){e.selectPanel(t)},"fetch-panel-content-for-internal-glances":function(t){t.activeIntegration&&e.fetchPanelContent(e.data.active_chat)},"toggle-right-sidebar":function(){e.toggleSidebar(e.data.chat_type)},"set-right-sidebar-panel-scrolltop":function(t){var a=t.room,n=t.type,i=t.scroll_top;M["default"].jid.is_chat(a)&&(e.data.panels_scroll_top[a]||(e.data.panels_scroll_top[a]={}),e.data.panels_scroll_top[a][n]=i,e.set("panels_scroll_top",e.data.panels_scroll_top))}})}},{key:"updateLoadingSpinner",value:function(){if(M["default"].jid.is_chat(this.data.active_chat)){var e=this.data.rooms[this.data.active_chat];e&&(e.files_fetching&&!e.files_fetched?this.showLoadingSpinnerOnPanel("files"):this.hideLoadingSpinnerOnPanel("files"),e.links_fetching&&!e.links_fetched?this.showLoadingSpinnerOnPanel("links"):this.hideLoadingSpinnerOnPanel("links"))}}},{key:"showLoadingSpinnerOnPanel",value:function(e){this.getActivePanel(this.data.chat_type)===e&&this.set("loading",!0)}},{key:"hideLoadingSpinnerOnPanel",value:function(e){this.getActivePanel(this.data.chat_type)===e&&this.set("loading",!1)}},{key:"handleConfig",value:function(e){this.data.active_chat=this.data.active_chat||b["default"].getChatToFocus(),this.set({user_is_admin:e.is_admin,invite_url:e.invite_url,web_client_integrations_enabled:D["default"].isFeatureEnabled(e)}),this.fetchPanelContent(this.data.active_chat)}},{key:"selectPanel",value:function(e){this.shouldToggleSidebar(e.activePanel)&&this.toggleSidebar(this.data.chat_type),this.setPanel(e.activePanel),this.fetchPanelContent(this.data.active_chat)}},{key:"setPanel",value:function(e){"chat"===this.data.chat_type?R["default"].savePreferences((0,o["default"])({},S["default"].CHAT_ACTIVE_PANEL,e)):"groupchat"===this.data.chat_type&&R["default"].savePreferences((0,o["default"])({},S["default"].GROUPCHAT_ACTIVE_PANEL,e))}},{key:"shouldToggleSidebar",value:function(e){var t=!1;return"chat"===this.data.chat_type?t=e===b["default"].getChatActivePanel()||!b["default"].shouldShowChatSidebar():"groupchat"===this.data.chat_type&&(t=e===b["default"].getGroupChatActivePanel()||!b["default"].shouldShowGroupChatSidebar()),t}},{key:"toggleSidebar",value:function(e){var t;"chat"===e?(t=!b["default"].shouldShowChatSidebar(),E["default"].setRightChatSidebarVisibility(t)):"groupchat"===e&&(t=!b["default"].shouldShowGroupChatSidebar(),E["default"].setRightGroupChatSidebarVisibility(t))}},{key:"sidebarShowing",value:function(e){return"chat"===M["default"].room.detect_chat_type(e)&&b["default"].shouldShowChatSidebar()||"groupchat"===M["default"].room.detect_chat_type(e)&&b["default"].shouldShowGroupChatSidebar()}},{key:"getActivePanel",value:function(e){if(this.data.web_client_integrations_enabled){var t=null;if("chat"===e?t=_.get(b["default"].getActiveChatIntegration(),"key"):"groupchat"===e&&(t=_.get(b["default"].getActiveGroupchatIntegration(),"key")),D["default"].isInternalIntegrationKey(t))return D["default"].split_full_key(t)[1]}else{if("chat"===e)return b["default"].getChatActivePanel();if("groupchat"===e)return b["default"].getGroupChatActivePanel()}}},{key:"fetchPanelContent",value:function(e){if(this.data.initialized&&M["default"].jid.is_chat(e)&&this.sidebarShowing(e)&&!this.data.current_user.is_guest){var t=this.getActivePanel(this.data.chat_type);"files"!==t&&"links"!==t||this._shouldFetchPanelContent(e,t)&&v["default"].dispatch("fetch-"+t,{room:e})}}},{key:"_shouldFetchPanelContent",value:function(e,t){var a=this.data.rooms[e],n=_.get(a,t+"_fetching",!1),i=_.get(a,t+"_fetched",!1);return!(n||i)}},{key:"isSignedFile",value:function(e){return this.isFileUrlAuthenticated(e)||this.getPublicUrlFromThumbnail(e)}},{key:"isFileUrlAuthenticated",value:function(e){var t=_.find(this.data.files,{url:e});return _.get(t,"is_authenticated",!1)}},{key:"getPublicUrlFromThumbnail",value:function(e){var t=null,a=this.data.active_chat;return v["default"].dispatch("get-public-url-from-thumbnail",e,a,function(e){return t=e}),t}},{key:"markParticipantForPrivateRoom",value:function(e){var t=this.data.users[e.user];t&&(t.not_present_in?t.not_present_in.push(e.room):t.not_present_in=[e.room])}},{key:"unmarkParticipantForPrivateRoom",value:function(e){var t=this.data.users[e.user];_.includes(_.get(t,"not_present_in"),e.room)&&(t.not_present_in=_.without(t.not_present_in,e.room))}},{key:"sortRoster",value:function(e){return _.sortBy(e,"name")}},{key:"sortRosterByPresenceAndName",value:function(e){return e.sort(t.comparePeople)}},{key:"sortRosterByName",value:function(e){return e.sort(t.compareName)}},{key:"getSortedRosterByPresenceAndName",value:function(e){var t=this,a=[].concat.apply([],_.map(e,function(e){return t.get("participants")[e]}));return this.sortRosterByPresenceAndName(a)}},{key:"getSortedRoster",value:function(e){var t=this,a=[].concat.apply([],_.map(e,function(e){return t.get("participants")[e]})),n=this.getRoomSize();return n===I["default"].XLARGE?[]:n===I["default"].LARGE?this.sortRosterByName(a):this.sortRosterByPresenceAndName(a)}},{key:"insertAlphaHeadings",value:function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=[],a="";return _.forEach(e,function(e){var n=e.name.substr(0,1).toUpperCase();n!==a&&(a=n.toUpperCase(),t.push({letter:a})),t.push(e)}),t}},{key:"getRoomSize",value:function(){var e=this.getRosterCount(["members","guests"]).total,t=j["default"].roster_panel.breakpoints;return e<t.small?I["default"].SMALL:e<t.medium?I["default"].MEDIUM:e<t.large?I["default"].LARGE:I["default"].XLARGE}},{key:"getRoster",value:function(){var e=this.getRoomSize(),t=[];if(e===I["default"].XLARGE)return t;var a=this.getSortedRoster(["members"]),n=this.getSortedRoster(["guests"]),i=a.length>0,o=n.length>0;return i&&(e===I["default"].LARGE&&(a=this.insertAlphaHeadings(a)),t=t.concat(a)),o&&(t.push({group_title:"guests"}),t=t.concat(n)),t}},{key:"countRoster",value:function(e){var t=0,a=0,n=this.data.rooms[this.data.active_chat];return _.get(n,"roster_size")&&!n.participants_fully_initialized?(t=n.roster_size,a=0):_.each(e,function(e){t++,e.presence&&"chat"===e.presence.show&&a++}),{online:a,total:t}}},{key:"getRosterCount",value:function(e){var t=this,a=[].concat.apply([],_.map(e,function(e){return t.get("participants")[e]}));return this.countRoster(a)}},{key:"handleActiveRoomsUpdate",value:function(e){var t=_.difference(_.keys(this.data.rooms),_.keys(e));t.length?this.data.rooms=_.omit(this.data.rooms,t):this.data.rooms=_.merge(this.data.rooms,e),this.data.active_chat&&M["default"].jid.is_chat(this.data.active_chat)&&(this.data.rooms[this.data.active_chat]=e[this.data.active_chat],this.handleSelectRoom(this.data.active_chat))}},{key:"handleRosterUpdate",value:function(e){var t=this;_.map(this.data.participants,function(e,a){t.data.participants[a].length&&t.sortRoster(t.data.participants[a])}),this.data.users=e,this.handleSelectRoom(this.data.active_chat)}},{key:"handleNewRoom",value:function(e){this.set({active_chat:e.jid,chat_type:M["default"].room.detect_chat_type(e.jid)})}},{key:"handleSelectRoom",value:function(e){var t=this;if(e&&M["default"].jid.is_chat(e)){var a,n,i,o,s=M["default"].room.detect_chat_type(e),r=[],l=[];this.data.participants={members:[],guests:[]},this.data.rooms[e]&&(a=this.data.rooms[e].privacy,o=this.data.rooms[e].guest_url,r=this.data.rooms[e].files,l=this.data.rooms[e].links,n=this.data.rooms[e].admins,i=this.data.rooms[e].owner,s=this.data.rooms[e].type,_.map(this.data.rooms[e].participants,function(a,n){_.each(a,function(a){t.data.users[a]&&("private"===t.data.rooms[e].privacy&&t.data.users[a].not_present_in&&-1!==t.data.users[a].not_present_in.indexOf(e)?t.data.participants[n].push(_.assign({},t.data.users[a],{presence:{show:"unknown",status:"",idleTime:!1}})):t.data.participants[n].push(_.cloneDeep(t.data.users[a])))}),t.data.participants[n]=t.sortRoster(_.compact(t.data.participants[n]))})),this.set({admins:n,owner:i,users:this.data.users,participants:this.data.participants,active_chat:e,active_chat_privacy:a,chat_type:s,size:this.getRoomSize(),files:r,links:l,guest_url:o}),this.updateLoadingSpinner()}}}],[{key:"compareStatus",value:function(e,a){if(e===a)return 0;var n=t.status_sorting_order[e]||7,i=t.status_sorting_order[a]||7;return n>i?1:-1}},{key:"compareName",value:function(e,t){return e===t?0:e.name.toLowerCase()>t.name.toLowerCase()?1:-1}},{key:"comparePeople",value:function(e,a){if(e===a)return 0;if(!e.presence||!a.presence)return a.presence?e.presence?0:-1:1;var n=t.compareStatus(e.presence.show,a.presence.show);return 0!==n?n:t.compareName(e,a)}}]),t}(x["default"]);L.status_sorting_order={chat:1,away:2,xa:2,dnd:3,mobile:4,unavailable:5,unknown:6},t["default"]=new L,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(136),o=n(i);t["default"]=(0,o["default"])({SMALL:"small",MEDIUM:"medium",LARGE:"large",XLARGE:"xlarge"}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=e.replace(/\s/g,"|");return new RegExp(""+t,"gi")}function o(e){return new RegExp("^"+e,"i")}function s(e){return new RegExp("\\s"+e,"i")}function r(e){return new RegExp("^"+e+"|\\s"+e,"i")}function l(e){return 0===e.indexOf("@")&&(e=e.slice(1)),new RegExp("^"+e,"i")}function u(e){return 0===e.indexOf("@")&&(e=e.slice(1)),new RegExp(""+e,"i")}function c(e){return new RegExp(""+e,"i")}function d(e){return _.isString(e.mention_name)?e.mention_name.toLocaleLowerCase():null}function f(e){return(R["default"].jid.is_private_chat(e.jid)||R["default"].jid.is_room(e.jid))&&_.isString(e.name)&&R["default"].jid.is_private_chat(e.jid)===_.isString(e.mention_name)}function h(e,t){return t.split(" ").every(function(t){var a=c(t);return a.test(e)})}function p(e,t){var a=t?_.size(t.match(/\s/g))+1:0,n=a>1,o=r(t),s=c(t),d=i(t),p=l(t),m=u(t);return _.reduce(e,function(e,i){if(!f(i))return e;var r=_.escape(i.name),l=_.escape(i.mention_name);if(!t)return i.mention_name&&(i.mention_match_markup=l),i.name_match_markup=r,e.push(i),e;var u=void 0,c=void 0,g=void 0,v=void 0;if(i.mention_name&&(i.mention_name=i.mention_name),n){var y=i.name.match(d);y&&y.length>=a&&h(i.name,t)&&(u=y)}else 1===t.length?(u=i.name.match(o),i.mention_name&&(c=i.mention_name.match(p))):(u=i.name.match(o)||i.name.match(s),i.mention_name&&(c=i.mention_name.match(m)));return u&&(g=u.map(function(e){var t=i.name.indexOf(e);return i.name.slice(t,t+e.length)})),c&&(v=c.map(function(e){var t=i.mention_name.indexOf(e);return i.mention_name.slice(t,t+e.length)})),i.name_match_markup=u?R["default"].highlight_matches(i.name,g):r,i.mention_match_markup=c?R["default"].highlight_matches(i.mention_name,v):l,(u||c)&&e.push(i),e},[])}function m(e,t,a){var n=_.includes(a,t.jid);return _.includes(a,e.jid)===n?0:n?1:-1}function g(e,t,a){var n=e.name.toLocaleLowerCase(),i=t.name.toLocaleLowerCase(),r=d(e),u=d(t),c=o(a),f=s(a),h=l(a),p=a===n,_=a===i,m=c.test(n),g=c.test(i),v=f.test(n),y=f.test(i),b=0===a.indexOf("@")?a.slice(1):a,w=b===r,R=b===u,k=r?h.test(r):!1,E=u?h.test(u):!1;return p===_?w===R?m===g?v===y?r&&u?k===E?0:E?1:-1:0:y?1:-1:g?1:-1:R?1:-1:_?1:-1}function v(e,t){var a=e.name.toLocaleLowerCase(),n=t.name.toLocaleLowerCase();return a.localeCompare(n)}function y(e,t,a){function n(e,n){if(!a)return v(e,n);var i=t.length?m(e,n,t):0;return 0===i&&(i=g(e,n,a)),0===i&&(i=v(e,n)),i}return e.sort(n)}function b(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=arguments.length<=1||void 0===arguments[1]?"":arguments[1],a=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];if(_.isEmpty(e))return[];t=R["default"].escapeRegEx(t.trim().toLocaleLowerCase()).replace(/\s+/g," ");try{new RegExp(t)}catch(n){return[]}var i=p(e,t);return y(i,a,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.chatSearch=b;var w=a(99),R=n(w)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(121),o=n(i);t["default"]={file_too_large:"This file is too large. Try a file that's "+o["default"].max_upload_size+" MB or smaller.",file_is_folder:"This looks like a folder; zip it up and try again.",unable_to_upload:"Couldn't upload the file",unable_to_upload_image:"This image is too large",service_unavailable:"The service for uploading files is unavailable. Try again later."},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=B["default"].jid.is_private_chat(e.jid),a=!0,n=!1,i=void 0;try{for(var o,s=(0,g["default"])(z);!(a=(o=s.next()).done);a=!0){var r=o.value;if(r.matcher.test(e.text)&&(r.members_only&&!e.is_guest||!r.members_only)&&(r.oto_only&&t||!r.oto_only)&&(r.room_only&&!t||!r.room_only)&&(r.filter&&r.filter(e)||!r.filter))return r}}catch(l){n=!0,i=l}finally{try{!a&&s["return"]&&s["return"]()}finally{if(n)throw i}}}function o(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];e&&e.action&&(e.action(t),U["default"].type("slash-commands").log("Action executed for command: ",e.name))}function s(e){var t=e.jid;y["default"].clearChat({jid:t})}function r(e){var t=e.jid;y["default"].closeChat({jid:t}),y["default"].clearChatInput()}function l(e){var t=e.text,a=t.replace(this.matcher,"").trim();T["default"].changeTopic(a),y["default"].clearChatInput()}function u(e){var t=e.jid,a=e.text,n=a.replace(this.matcher,"").trim();A["default"].changeRoomName({jid:t,name:n},function(e){if(e){var t=e.message||N["default"].fail.rename_flag;O["default"].showFlag({type:"error",body:t,close:"auto"})}else O["default"].showFlag({type:"success",body:N["default"].success.rename_flag,close:"auto"})}),y["default"].clearChatInput()}function c(e){var t=e.text,a=t.replace(this.matcher,"").trim();y["default"].clearChatInput(),y["default"].joinChat({room:a})}function d(){var e=k["default"].getKeyCommands();C["default"].showKeyboardShortcutsDialog(e),y["default"].clearChatInput()}function f(){w["default"].requestPreferencesDialog(),y["default"].clearChatInput()}function h(e){var t=e.jid,a=e.videoService,n=e.room_id,i=e.room_is_archived;B["default"].jid.is_room(t)&&!i?T["default"].startEnsoRoomVideo({jid:t,room_id:n}):T["default"].startCall({jid:t,service:a}),y["default"].clearChatInput()}function p(e){var t,a=e.text,n=a.indexOf(" "),i=a,o={type:"showAndStatus"};switch(_.includes(a," ")&&(t=a.substr(n).trim(),t&&(o.status=t),i=i.substr(0,n)),i.substr(1)){case"available":case"here":case"back":o.show=L["default"].AVAILABLE;break;case"away":o.show=L["default"].AWAY;break;case"dnd":o.show=L["default"].DND}P["default"].changeStatus(o),y["default"].clearChatInput()}Object.defineProperty(t,"__esModule",{value:!0}),t.commands=void 0;var m=a(114),g=n(m);t.matchCommand=i,t.executeCommand=o,t.clearAction=s,t.partAction=r,t.topicAction=l,t.renameAction=u,t.joinAction=c,t.shortcutsAction=d,t.settingsAction=f,t.callAction=h,t.presenceAction=p;var v=a(261),y=n(v),b=a(276),w=n(b),R=a(279),k=n(R),E=a(95),C=n(E),S=a(285),T=n(S),x=a(286),A=n(x),I=a(262),N=n(I),M=a(204),O=n(M),D=a(257),P=n(D),j=a(184),L=n(j),F=a(90),U=n(F),H=a(99),B=n(H),z=t.commands=[{name:"/topic",aliases:[],description:"Change chat topic",usage:"[new topic]",members_only:!0,room_only:!0,matcher:/^\/(topic)\s/,action:l},{name:"/rename",aliases:[],description:"Rename a room",usage:"[new name]",members_only:!0,room_only:!0,matcher:/^\/(rename)\s/,action:u},{name:"/clear",aliases:[],description:"Locally clears history for chat",usage:null,matcher:/^\/clear\s?$/,action:s},{name:"/join",aliases:["/enter"],description:"Join a room or 1-1 chat",usage:"[or /enter] [room name/user mention]",members_only:!0,matcher:/^\/(join|enter)\s/,action:c},{name:"/part",aliases:["/close","/leave"],description:"Leave a room or 1-1 chat",usage:"[or /close, /leave]",members_only:!0,matcher:/^\/(part|leave|close)\s?$/,action:r},{name:"/me",aliases:["/em"],description:"Display action text",usage:"[or /em] your message",members_only:!0,matcher:/^\/(me|em)\s/,should_send_message:!0},{name:"/quote",aliases:[],description:"Display quote message",usage:"your message",matcher:/^\/(quote)\s\w/,should_send_message:!0},{name:"/code",aliases:[],description:"Display code snippet",usage:"some code",matcher:/^\/(code)\s\w/,should_send_message:!0},{name:"/pre",aliases:["/monospace"],description:"Display text in monospaced font",usage:"[or /monospace] some text",matcher:/^\/(pre|monospace)\s\w/,should_send_message:!0},{name:"/here",aliases:["/available","/back"],description:"Set presence to available",usage:"[or /available, /back] [your status]",matcher:/^\/(here|available|back)\s?/,action:p},{name:"/away",aliases:[],description:"Set presence to away",usage:"[your status]",matcher:/^\/(away)\s?/,action:p},{name:"/dnd",aliases:[],description:"Set presence to do not disturb",usage:"[your status]",matcher:/^\/(dnd)\s?/,action:p},{name:"/shortcuts",aliases:["/keys"],description:"Open the keyboard shortcuts dialog",usage:"[or /keys]",members_only:!0,matcher:/^\/(shortcuts|keys)\s?$/,action:d},{name:"/settings",aliases:["/prefs"],description:"Open the settings dialog",usage:"[or /prefs]",members_only:!0,matcher:/^\/(prefs|settings)\s?$/,action:f},{name:"/videocall",aliases:["/call"],description:"Start video call",usage:"[or /call]",members_only:!0,oto_only:!1,matcher:/^\/(videocall|call)\s?$/,action:h,filter:function(e){var t=e.jid,a=e.video_enabled,n=e.room_video_enabled;return B["default"].jid.is_room(t)?n:a}}]},function(e,t,a){"use strict";var n=a(9),i=a(173),o=a(95),s=a(277),r=a(93);e.exports={requestReleaseNotesDialog:function(){o.showReleaseNotesDialog()},requestPreferencesDialog:function(){i.dispatch("analytics-event",{name:"hipchat.client.top.navigation.profile.settings.clicked"}),r.showPreferencesDialog()},hideStatusMessageForm:function(){s.hideInlineDialog()},helpButtonClicked:function(){i.dispatch("analytics-event",{name:"hipchat.client.top.navigation.help.clicked"})},userProfileDropdownClicked:function(){i.dispatch("analytics-event",{name:"hipchat.client.top.navigation.profile.clicked"})},searchHistory:function(e,t){n.dispatch("set-route",{jid:"search"}),n.dispatch("search-history",{jid:e,text:t})},searchHistoryExternally:function(e,t){n.dispatch("search-history-externally",{jid:e,text:t})},setSearchText:function(e){n.dispatch("set-search-text",e)},searchBlurred:function(){n.dispatch("blur-search")},dismissNotificationBanner:function(){i.dispatch("analytics-event",{name:"hipchat.client.banner.notification.dismiss.once"}),n.dispatch("dismiss-notification-banner")},dismissNotificationBannerForever:function(){i.dispatch("analytics-event",{name:"hipchat.client.banner.notification.dismiss.forever"}),n.dispatch("dismiss-notification-banner-forever")},requestNotificationPermission:function(){i.dispatch("analytics-event",{name:"hipchat.client.banner.notification.request.permission"}),n.dispatch("request-notification-permission")},positionDialogs:function(){n.dispatch("position-app-header-dialogs")}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i),s=a(278),r=n(s);t["default"]={hideInlineDialog:function(){o["default"].dispatch("hide-inline-dialog",{dialog_type:r["default"].getCurrentInlineDialog()})},toggleInlineDialog:function(e,t){o["default"].dispatch("toggle-inline-dialog",{dialog_type:e,current_dialog_type:r["default"].getCurrentInlineDialog(),dialog_data:t})},showUserStatusMessage:function(e){o["default"].dispatch("show-inline-dialog",{dialog_type:"user-status-message-inline-dialog",dialog_data:e})},showConnectionStatusMessage:function(e){o["default"].dispatch("show-inline-dialog",{dialog_type:"connection-status-message-inline-dialog",dialog_data:e})},showGuestAccessInformation:function(e){o["default"].dispatch("show-inline-dialog",{dialog_type:"guest-access-information-inline-dialog",dialog_data:e})},showAddIntegrationsHelperDialog:function(e){o["default"].dispatch("show-inline-dialog",{dialog_type:"add-integrations-help-dialog",dialog_data:e})}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(51),h=n(f),p=a(97),_=n(p),m=a(9),g=n(m),v=a(121),y=n(v),b=function(e){function t(){return(0,r["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"getDefaults",value:function(){return{activeDialog:!1,bannerShown:!1,dialogData:!1,web_server:y["default"].default_web_server,current_user_id:""}}},{key:"registerListeners",value:function(){var e=this;g["default"].register({"show-inline-dialog":function(t){e._showInlineDialog(t)},"hide-inline-dialog":function(){e._hideInlineDialog()},"toggle-inline-dialog":function(t){e._toggleInlineDialog(t)},"updated:web_server":function(t){e.set("web_server",t)},"notification-banner-status":function(t){e.set("bannerShown",t.shown)},"updated:current_user":function(t){e.set("current_user_id",t.user_id)}})}},{key:"_toggleInlineDialog",value:function(e){e.dialog_type!==this.getCurrentInlineDialog()?this._showInlineDialog(e):this._hideInlineDialog()}},{key:"_showInlineDialog",value:function(e){this.set({activeDialog:e.dialog_type,dialogData:e.dialog_data})}},{key:"_hideInlineDialog",value:function(){this.getCurrentInlineDialog()!==!1&&this.set({activeDialog:!1,dialogData:!1})}},{key:"getCurrentInlineDialog",value:function(){return this.get("activeDialog")}}]),t}(_["default"]);t["default"]=new b,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(280),o=n(i),s=a(173),r=n(s),l=a(281),u=n(l),c=a(95),d=n(c),f=a(282),h=n(f),p=a(283),m=n(p),g=a(99),v=n(g),y=a(284),b=n(y),w={init:function(e){this.commands=[],this.processCommands(e||this.getDefaults())},processCommands:function(e){var t=this;e.forEach(function(e){e.keys&&e.action&&t.bindHandler(e),e.display!==!1&&t.addDisplayItem(e)})},bindHandler:function(e){var t=this,a="function"==typeof e.action?e.action:this.getHandler(e.action);o["default"].bind(e.keys,function(n){return t.dispatchAnalyticsEvent(e),a.apply(t,[e,n])})},dispatchAnalyticsEvent:function(e){"function"==typeof e.action&&(e.action="[Function]"),r["default"].dispatch("analytics-keyboard-shortcut-used",e);
},addDisplayItem:function(e){var t=e.title?e.title:this.getTitle(e.action),a=this.formatDisplay(e.display||e.keys);this.commands.push({title:t,keys:a})},getTitle:function(e){var t=void 0;switch(e){case m["default"].NEW_CHAT:t=h["default"].new_chat;break;case m["default"].INVITE_TO_ROOM:t=h["default"].room_invite_users;break;case m["default"].CLOSE_ROOM:t=h["default"].close_room;break;case m["default"].CREATE_ROOM:t=h["default"].create_room;break;case m["default"].NAVIGATE_ROOMS_UP:t=h["default"].navigate_rooms_up;break;case m["default"].NAVIGATE_ROOMS_DOWN:t=h["default"].navigate_rooms_down;break;case m["default"].SEARCH_HISTORY:t=h["default"].search_history;break;case m["default"].TOGGLE_SOUND_NOTIFICATIONS:t=h["default"].toggle_sound_notifications;break;case m["default"].MARK_ROOMS_AS_READ:t=h["default"].mark_rooms_as_read;break;case m["default"].MARK_CHATS_AS_READ:t=h["default"].mark_chats_as_read;break;case m["default"].RECALL_OLDER_INPUT_HISTORY:t=h["default"].recall_older_input_history;break;case m["default"].RECALL_NEWER_INPUT_HISTORY:t=h["default"].recall_newer_input_history;break;case m["default"].VIEW_SHORTCUTS:t=h["default"].view_shortcuts;break;default:t=""}return t},getHandler:function(e){var t=void 0;switch(e){case m["default"].NEW_CHAT:t=this.openQuickSwitcher.bind(this);break;case m["default"].INVITE_TO_ROOM:t=this.inviteUsersToRoom.bind(this);break;case m["default"].CLOSE_ROOM:t=this.closeRoom.bind(this);break;case m["default"].CREATE_ROOM:t=this.createRoom.bind(this);break;case m["default"].NAVIGATE_ROOMS_UP:t=this.navigateRoomsUp.bind(this);break;case m["default"].NAVIGATE_ROOMS_DOWN:t=this.navigateRoomsDown.bind(this);break;case m["default"].SEARCH_HISTORY:t=this.searchHistory.bind(this);break;case m["default"].TOGGLE_SOUND_NOTIFICATIONS:t=this.toggleSoundNotifications.bind(this);break;case m["default"].MARK_ROOMS_AS_READ:t=this.markRoomsAsRead.bind(this);break;case m["default"].MARK_CHATS_AS_READ:t=this.markChatsAsRead.bind(this);break;case m["default"].VIEW_SHORTCUTS:t=this.showKeyboardShortcutsDialog.bind(this);break;case m["default"].REOPEN_LAST_CHAT:t=this.reopenLastChat.bind(this);break;case m["default"].RECALL_OLDER_INPUT_HISTORY:t=this.recallOlderInputHistory.bind(this);break;case m["default"].RECALL_NEWER_INPUT_HISTORY:t=this.recallNewerInputHistory.bind(this);break;default:t=null}return t},formatDisplay:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];e=v["default"].toArray(e)[0];var t=_.forEach(e.split("+"),function(e,t,a){e=e.toLowerCase();var n="command"===e?"modifier":"normal",i="";switch(e){case"ctrl":i=h["default"].control;break;case"alt":i=h["default"].alt;break;case"shift":i=h["default"].shift;break;case"option":i=h["default"].option;break;case"command":i=h["default"].command;break;case"esc":i=h["default"].esc;break;case"tab":i=h["default"].tab;break;case"up":i=h["default"].up_arrow;break;case"down":i=h["default"].down_arrow;break;case"left":i=h["default"].left_arrow;break;case"right":i=h["default"].right_arrow;break;default:i=e}a[t]={type:n,name:i}});return t},getDefaults:function(){var e=v["default"].platform.isMac()?this.getDefaultsMac():this.getDefaultsWindows();return e},getDefaultsMac:function(){return[{keys:"command+j",action:m["default"].NEW_CHAT},{keys:"command+i",action:m["default"].INVITE_TO_ROOM},{keys:"command+option+w",action:m["default"].CLOSE_ROOM},{keys:"command+option+up",action:m["default"].NAVIGATE_ROOMS_UP},{keys:"command+option+down",action:m["default"].NAVIGATE_ROOMS_DOWN},{keys:"command+option+f",action:m["default"].SEARCH_HISTORY},{keys:"command+shift+s",action:m["default"].TOGGLE_SOUND_NOTIFICATIONS},{keys:"command+option+m",action:m["default"].MARK_ROOMS_AS_READ},{keys:"command+option+shift+m",action:m["default"].MARK_CHATS_AS_READ},{keys:"option+up",action:m["default"].RECALL_OLDER_INPUT_HISTORY},{keys:"option+down",action:m["default"].RECALL_NEWER_INPUT_HISTORY},{keys:"command+/",action:m["default"].VIEW_SHORTCUTS}]},getDefaultsWindows:function(){return[{keys:"ctrl+j",action:m["default"].NEW_CHAT},{keys:"ctrl+i",action:m["default"].INVITE_TO_ROOM},{keys:"ctrl+alt+w",action:m["default"].CLOSE_ROOM},{keys:"ctrl+alt+up",action:m["default"].NAVIGATE_ROOMS_UP},{keys:"ctrl+alt+down",action:m["default"].NAVIGATE_ROOMS_DOWN},{keys:"ctrl+alt+f",action:m["default"].SEARCH_HISTORY},{keys:"ctrl+shift+s",action:m["default"].TOGGLE_SOUND_NOTIFICATIONS},{keys:"ctrl+alt+m",action:m["default"].MARK_ROOMS_AS_READ},{keys:"ctrl+alt+shift+m",action:m["default"].MARK_CHATS_AS_READ},{keys:"ctrl+up",action:m["default"].RECALL_OLDER_INPUT_HISTORY},{keys:"ctrl+down",action:m["default"].RECALL_NEWER_INPUT_HISTORY},{keys:"ctrl+/",action:m["default"].VIEW_SHORTCUTS}]},getKeyCommands:function(){return this.commands},getCommandByTitle:function(e){var t=_.find(this.commands,{title:e});return t?t.keys.map(function(e){return e.name}):void 0},openQuickSwitcher:function(){return b["default"].getCurrentModalDialog()?!1:(d["default"].showQuickSwitcherDialog(!0),!1)},inviteUsersToRoom:function(){return u["default"].inviteUsersToRoom(),!1},createRoom:function(){return u["default"].createRoom(),!1},searchHistory:function(){return u["default"].searchHistory(),!1},closeRoom:function(){return u["default"].closeRoom(),!1},navigateRoomsUp:function(){return u["default"].navigateRoomsUp(),!1},navigateRoomsDown:function(){return u["default"].navigateRoomsDown(),!1},openSettings:function(){return u["default"].openSettings(),!1},toggleSoundNotifications:function(){return u["default"].toggleSoundNotifications(),!1},markRoomsAsRead:function(){return u["default"].markRoomsAsRead(),!1},markChatsAsRead:function(){return u["default"].markChatsAsRead(),!1},showKeyboardShortcutsDialog:function(){return d["default"].showKeyboardShortcutsDialog(this.commands),!1},reopenLastChat:function(){return u["default"].reopenLastChat(),!1},recallOlderInputHistory:function(e,t){return u["default"].recallOlderInputHistory(t),!1},recallNewerInputHistory:function(e,t){return u["default"].recallNewerInputHistory(t),!1}};t["default"]=w,e.exports=t["default"]},function(e,t,a){var n;!function(i,o,s){function r(e,t,a){return e.addEventListener?void e.addEventListener(t,a,!1):void e.attachEvent("on"+t,a)}function l(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return w[e.which]?w[e.which]:R[e.which]?R[e.which]:String.fromCharCode(e.which).toLowerCase()}function u(e,t){return e.sort().join(",")===t.sort().join(",")}function c(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function d(e){return e.preventDefault?void e.preventDefault():void(e.returnValue=!1)}function f(e){return e.stopPropagation?void e.stopPropagation():void(e.cancelBubble=!0)}function h(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function p(){if(!b){b={};for(var e in w)e>95&&112>e||w.hasOwnProperty(e)&&(b[w[e]]=e)}return b}function _(e,t,a){return a||(a=p()[e]?"keydown":"keypress"),"keypress"==a&&t.length&&(a="keydown"),a}function m(e){return"+"===e?["+"]:(e=e.replace(/\+{2}/g,"+plus"),e.split("+"))}function g(e,t){var a,n,i,o=[];for(a=m(e),i=0;i<a.length;++i)n=a[i],E[n]&&(n=E[n]),t&&"keypress"!=t&&k[n]&&(n=k[n],o.push("shift")),h(n)&&o.push(n);return t=_(n,o,t),{key:n,modifiers:o,action:t}}function v(e,t){return null===e||e===o?!1:e===t?!0:v(e.parentNode,t)}function y(e){function t(e){e=e||{};var t,a=!1;for(t in b)e[t]?a=!0:b[t]=0;a||(k=!1)}function a(e,t,a,n,i,o){var s,r,l=[],c=a.type;if(!m._callbacks[e])return[];for("keyup"==c&&h(e)&&(t=[e]),s=0;s<m._callbacks[e].length;++s)if(r=m._callbacks[e][s],(n||!r.seq||b[r.seq]==r.level)&&c==r.action&&("keypress"==c&&!a.metaKey&&!a.ctrlKey||u(t,r.modifiers))){var d=!n&&r.combo==i,f=n&&r.seq==n&&r.level==o;(d||f)&&m._callbacks[e].splice(s,1),l.push(r)}return l}function n(e,t,a,n){m.stopCallback(t,t.target||t.srcElement,a,n)||e(t,a)===!1&&(d(t),f(t))}function i(e){"number"!=typeof e.which&&(e.which=e.keyCode);var t=l(e);if(t)return"keyup"==e.type&&w===t?void(w=!1):void m.handleKey(t,c(e),e)}function s(){clearTimeout(v),v=setTimeout(t,1e3)}function p(e,a,i,o){function r(t){return function(){k=t,++b[e],s()}}function u(a){n(i,a,e),"keyup"!==o&&(w=l(a)),setTimeout(t,10)}b[e]=0;for(var c=0;c<a.length;++c){var d=c+1===a.length,f=d?u:r(o||g(a[c+1]).action);_(a[c],f,o,e,c)}}function _(e,t,n,i,o){m._directMap[e+":"+n]=t,e=e.replace(/\s+/g," ");var s,r=e.split(" ");return r.length>1?void p(e,r,t,n):(s=g(e,n),m._callbacks[s.key]=m._callbacks[s.key]||[],a(s.key,s.modifiers,{type:s.action},i,e,o),void m._callbacks[s.key][i?"unshift":"push"]({callback:t,modifiers:s.modifiers,action:s.action,seq:i,level:o,combo:e}))}var m=this;if(e=e||o,!(m instanceof y))return new y(e);m.target=e,m._callbacks={},m._directMap={};var v,b={},w=!1,R=!1,k=!1;m._handleKey=function(e,i,o){var s,r=a(e,i,o),l={},u=0,c=!1;for(s=0;s<r.length;++s)r[s].seq&&(u=Math.max(u,r[s].level));for(s=0;s<r.length;++s)if(r[s].seq){if(r[s].level!=u)continue;c=!0,l[r[s].seq]=1,n(r[s].callback,o,r[s].combo,r[s].seq)}else c||n(r[s].callback,o,r[s].combo);var d="keypress"==o.type&&R;o.type!=k||h(e)||d||t(l),R=c&&"keydown"==o.type},m._bindMultiple=function(e,t,a){for(var n=0;n<e.length;++n)_(e[n],t,a)},r(e,"keypress",i),r(e,"keydown",i),r(e,"keyup",i)}for(var b,w={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},R={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},k={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},E={option:"alt",command:"meta","return":"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},C=1;20>C;++C)w[111+C]="f"+C;for(C=0;9>=C;++C)w[C+96]=C;y.prototype.bind=function(e,t,a){var n=this;return e=e instanceof Array?e:[e],n._bindMultiple.call(n,e,t,a),n},y.prototype.unbind=function(e,t){var a=this;return a.bind.call(a,e,function(){},t)},y.prototype.trigger=function(e,t){var a=this;return a._directMap[e+":"+t]&&a._directMap[e+":"+t]({},e),a},y.prototype.reset=function(){var e=this;return e._callbacks={},e._directMap={},e},y.prototype.stopCallback=function(e,t){var a=this;return(" "+t.className+" ").indexOf(" mousetrap ")>-1?!1:v(t,a.target)?!1:"INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable},y.prototype.handleKey=function(){var e=this;return e._handleKey.apply(e,arguments)},y.init=function(){var e=y(o);for(var t in e)"_"!==t.charAt(0)&&(y[t]=function(t){return function(){return e[t].apply(e,arguments)}}(t))},y.init(),i.Mousetrap=y,"undefined"!=typeof e&&e.exports&&(e.exports=y),n=function(){return y}.call(t,a,t,e),!(n!==s&&(e.exports=n))}(window,document)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(196),o=n(i),s=a(264),r=n(s);t["default"]={openLobby:function(){r["default"].openLobby(),o["default"].lobbyFocusedWithKeyboardShortcut()},createRoom:function(){r["default"].createRoom(),o["default"].createRoomClickedEvent("keyboard.shortcut")},inviteUsersToRoom:function(){r["default"].inviteUsersToRoom()},searchHistory:function(){r["default"].focusSearch()},closeRoom:function(){r["default"].closeActiveChat()},navigateRoomsUp:function(){r["default"].navigateChatUp()},navigateRoomsDown:function(){r["default"].navigateChatDown()},openSettings:function(){r["default"].openSettings()},markChatsAsRead:function(){r["default"].markChatsAsRead()},markRoomsAsRead:function(){r["default"].markRoomsAsRead()},toggleSoundNotifications:function(){r["default"].toggleSoundNotifications()},reopenLastChat:function(){r["default"].reopenLastChat()},recallOlderInputHistory:function(e){r["default"].recallOlderInputHistory(e)},recallNewerInputHistory:function(e){r["default"].recallNewerInputHistory(e)}},e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={separator:"+",control:"Ctrl",alt:"Alt",option:"Option",shift:"Shift",space:"Space",esc:"Esc",tab:"Tab",command:"â",up_arrow:"â",down_arrow:"â",left_arrow:"â",right_arrow:"â",new_chat:"New chat",room_invite_users:"Invite to room",search_history:"Search chat history",close_room:"Close room",create_room:"Create room",navigate_rooms_up:"Navigate rooms up",navigate_rooms_down:"Navigate rooms down",toggle_sound_notifications:"Toggle sound notifications",mark_chats_as_read:"Mark all chats as read",mark_rooms_as_read:"Mark all rooms as read",recall_older_input_history:"Navigate up through sent messages",recall_newer_input_history:"Navigate down through sent messages",view_shortcuts:"View shortcuts"},e.exports=t["default"]},function(e,t){"use strict";e.exports={NEW_CHAT:"newChat",INVITE_TO_ROOM:"inviteUsersToRoom",CLOSE_ROOM:"closeRoom",CREATE_ROOM:"createRoom",NAVIGATE_ROOMS_UP:"navigateRoomsUp",NAVIGATE_ROOMS_DOWN:"navigateRoomsDown",SEARCH_HISTORY:"searchHistory",TOGGLE_SOUND_NOTIFICATIONS:"toggleSoundNotifications",MARK_CHATS_AS_READ:"markChatsAsRead",MARK_ROOMS_AS_READ:"markRoomsAsRead",VIEW_SHORTCUTS:"viewShortcuts",REOPEN_LAST_CHAT:"reopenLastChat",RECALL_OLDER_INPUT_HISTORY:"recallOlderInputHistory",RECALL_NEWER_INPUT_HISTORY:"recallNewerInputHistory"}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(51),h=n(f),p=a(97),m=n(p),g=a(9),v=n(g),y=a(121),b=n(y),w=function(e){function t(){(0,r["default"])(this,t);var e=(0,d["default"])(this,(0,o["default"])(t).call(this));return e.delayDuration=b["default"].modal_transition_allowance,e.delayTimeout=null,e.activationDelay=100,e.local={fileViewerOpened:!1},e}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"getDefaults",value:function(){return{activeDialog:!1,dialogData:!1,dialogVisible:!1,btnLoading:!1,bgDismiss:!0,web_server:b["default"].default_web_server,dialogs_queue:[]}}},{key:"registerListeners",value:function(){var e=this;v["default"].register({"show-modal-dialog":function(t){var a={activeDialog:t.dialog_type,dialogVisible:!1,dialogData:t.dialog_data,btnLoading:!1};!e.isQueueableDialog(a)&&e.isDialogActive(a)||(e.deactivateTimeout&&(clearTimeout(e.deactivateTimeout),e.deactivateTimeout=null,e.data.dialogData=null,e.data.activeDialog=null),e.isQueueableDialog(a)&&e.shouldDialogQueue()?e.data.dialogs_queue.push(a):e.showDialog(a))},"hide-modal-dialog":function(){if(e.activateTimeout&&(clearTimeout(e.activateTimeout),e.activateTimeout=null),e.set({dialogVisible:!1,btnLoading:!1}),e.deactivateDialog(),e.data.dialogs_queue.length){var t=e.data.dialogs_queue.shift();e.showDialog(t)}},"modal-dialog-btn-loading":function(t){e.set("btnLoading",!!t.loading)},"updated:web_server":function(t){e.set("web_server",t)},"open-in-file-viewer":function(){e.local.fileViewerOpened=!0},"file-viewer-closed":function(){if(e.local.fileViewerOpened=!1,e.data.dialogs_queue.length){var t=e.data.dialogs_queue.shift();e.showDialog(t)}}})}},{key:"showDialog",value:function(e){this.set({activeDialog:e.activeDialog,dialogVisible:e.dialogVisible,dialogData:e.dialogData,btnLoading:e.btnLoading}),this.activateDialog()}},{key:"activateDialog",value:function(){var e=this,t=function(){e.set("dialogVisible",!0),e.activateTimeout=null};this.activationDelay?this.activateTimeout=setTimeout(t,this.activationDelay):t()}},{key:"deactivateDialog",value:function(){var e=this,t=function(){e.set({activeDialog:null,dialogData:!1})};this.delayDuration?this.deactivateTimeout=setTimeout(function(){e.get("dialogVisible")||(t(),e.delayTimeout=null)},this.delayDuration):t()}},{key:"getCurrentModalDialog",value:function(){return this.get("activeDialog")}},{key:"isDialogActive",value:function(e){return this.get("activeDialog")===e.activeDialog}},{key:"isQueueableDialog",value:function(e){return!!_.get(e,"dialogData.should_queue")}},{key:"shouldDialogQueue",value:function(){return this.data.dialogVisible||this.local.fileViewerOpened}}]),t}(m["default"]);t["default"]=new w,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){f["default"].dispatch("analytics-event",{name:"hipchat.client.user.oto.video.call",properties:{service:p["default"].ADDLIVE}}),c["default"].dispatch("addlive.start-video-call",{jid:e.jid,audio_only:e.audio_only,type:"call",name:e.name||""})}function o(e){f["default"].dispatch("analytics-event",{name:"hipchat.client.user.oto.video.call",properties:{service:p["default"].ENSO}}),c["default"].dispatch("enso.start-video-call",{jid:e.jid,audio_only:e.audio_only,type:"call",name:e.name||""})}function s(e){f["default"].dispatch("analytics-event",{name:"hipchat.client.user.room.video.call",properties:{room:e.room_id}}),c["default"].dispatch("enso.start-room-video",{jid:e.jid,room_id:e.room_id,audio_only:!1,type:"call",name:e.name||""})}Object.defineProperty(t,"__esModule",{value:!0});var r=a(136),l=n(r);t.startAddliveCall=i,t.startEnsoCall=o,t.startEnsoRoomVideo=s;var u=a(9),c=n(u),d=a(173),f=n(d),h=a(174),p=n(h),m=500,g=(0,l["default"])({leading:!0,trailing:!1});t["default"]={handlePanelSelect:function(e){c["default"].dispatch("select-panel",{activePanel:e.type})},editTopicInChatHeader:function(){c["default"].dispatch("edit-topic")},dismissTopicEdit:function(){c["default"].dispatch("dismiss-topic-edit")},changeTopic:function(e){c["default"].dispatch("set-topic",e)},startAddliveCall:_.debounce(i,m,g),startEnsoCall:_.debounce(o,m,g),startEnsoRoomVideo:_.debounce(s,m,g),startCall:function(e){e.service===p["default"].ENSO?this.startEnsoCall(e):e.service===p["default"].ADDLIVE&&this.startAddliveCall(e)}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i),s=a(173),r=n(s);t["default"]={changeRoomPrivacy:function(e,t){o["default"].dispatch("change-room-privacy",e,t)},changeRoomName:function(e,t){o["default"].dispatch("change-room-name",e,t)},createRoom:function(e,t){o["default"].dispatch("create-room",e,t),r["default"].dispatch("analytics-create-room",e)},inviteUsers:function(e){o["default"].dispatch("invite-users",e)},removeUsers:function(e,t){o["default"].dispatch("remove-users",e,t)},editMessage:function(e){o["default"].dispatch("edit-message",e)},deleteMessage:function(e){o["default"].dispatch("delete-message",e)}},e.exports=t["default"]},function(e,t,a){"use strict";var n=a(9);e.exports={editTopic:function(){n.dispatch("edit-topic")},deleteRoom:function(e,t){n.dispatch("delete-room",{jid:e.jid,id:e.id},t)},closeRoom:function(e){n.dispatch("close-room",{jid:e,doNotNotifyHC:!0})},archiveRoom:function(e,t){n.dispatch("archive-room",{jid:e.jid,id:e.id},t)},unarchiveRoom:function(e,t){n.dispatch("unarchive-room",{jid:e.jid,id:e.id},t)},enableGuestAccess:function(e,t){n.dispatch("set-guest-access",{jid:e.jid,enable:!0},t)},disableGuestAccess:function(e,t){n.dispatch("set-guest-access",{jid:e.jid,enable:!1},t)}}},function(e,t,a){"use strict";var n=a(9),i=a(173),o={select:function(e,t){var a={jid:e,type:t};n.dispatch("set-route",a),i.dispatch("analytics-select-room",a)},close:function(e,t){n.dispatch("close-room",{jid:e,type:t})},closeSearchResults:function(){n.dispatch("close-room",{jid:"search"}),n.dispatch("remove-search-nav-item")},openSearchResults:function(){n.dispatch("set-route",{jid:"search"})},openLobby:function(){var e={jid:"lobby"};n.dispatch("set-route",{jid:"lobby"}),i.dispatch("analytics-select-room",e)},update_room_order:function(e){n.dispatch("update-room-order",e)},dragStart:function(e){n.dispatch("rooms-nav-drag-start",{target:e.target})},dragOver:function(e){n.dispatch("rooms-nav-drag-over",{event:e.event})},dragEnd:function(){n.dispatch("rooms-nav-drag-end")}};e.exports=o},function(e,t){"use strict";e.exports={constants:{fileKey:"file://",splitKey:"/",fallback:"Unknown"},containsKey:function(e,t){return _.isString(e)&&_.isString(t)?-1!==e.indexOf(t):!1},returnLastItem:function(e,t){return!_.isArray(e)||_.isArray(e)&&!e.length?t:e[e.length-1]},sanitizePath:function(e){var t=void 0,a=this.constants.splitKey,n=this.constants.fallback,i=void 0;return e&&this.containsKey(e,a)?(t=e.split(a),i=this.returnLastItem(t,n)):i=n,i},sanitizeStackTrace:function(e,t){for(var a=this.constants.splitKey,n=this.constants.fileKey,i=this.constants.fallback,o=0;o<t.length;o++){var s=t[o]&&t[o].filename?t[o].filename:!1;if(s&&this.containsKey(s,n)){var r=s.split(a);e.stacktrace.frames[o].filename=this.returnLastItem(r,i)}}},sanitize:function(e){return _.isObject(e)&&(e.culprit&&(e.culprit=this.sanitizePath(e.culprit)),_.has(e,"request.url")&&(e.request.url=this.sanitizePath(e.request.url)),_.has(e,"request.headers.Referer")&&(e.request.headers.Referer=this.sanitizePath(e.request.headers.Referer)),_.has(e,"stacktrace.frames")&&this.sanitizeStackTrace(e,e.stacktrace.frames)),e}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.PresenceSubscriptionHelperClass=void 0;var i=a(4),o=n(i),s=a(5),r=n(s),l=a(121),u=n(l),c=a(9),d=n(c),f=a(99),h=n(f),p=function(){function e(t){(0,o["default"])(this,e),this.initialized=!1,this.current_filter_list=[],this.subscribed={},this.pending_presence_fetch=[],this.debouncedFilterPresences=_.debounce(this._filterPresences,t.filter_participant_presences_timeout,{leading:!1,trailing:!0}),this.throttledRequestPresences=_.throttle(this._requestPresences,t.request_participant_presences_timeout,{leading:!1,trailing:!0})}return(0,r["default"])(e,[{key:"init",value:function(){this.initialized=!0,this.resubscribe()}},{key:"subscribeToPresence",value:function(e){var t=h["default"].toArray(e);this._incrementSubscriptionCounts(t),this.throttledRequestPresences(),this.debouncedFilterPresences()}},{key:"unsubscribeFromPresence",value:function(e){var t=h["default"].toArray(e);this._decrementSubscriptionCounts(t),this.debouncedFilterPresences()}},{key:"resubscribe",value:function(){this.pending_presence_fetch=_.keys(this.subscribed),this.throttledRequestPresences(),this.debouncedFilterPresences()}},{key:"_incrementSubscriptionCounts",value:function(e){var t=this;_.forEach(e,function(e){e=e.toString(),t.subscribed[e]?t.subscribed[e]++:(t.subscribed[e]=1,_.includes(t.current_filter_list,e)||_.includes(t.pending_presence_fetch,e)||t.pending_presence_fetch.push(e))})}},{key:"_decrementSubscriptionCounts",value:function(e){var t=this;_.forEach(e,function(e){e=e.toString(),t.subscribed[e]>1?t.subscribed[e]--:(t.subscribed=_.omit(t.subscribed,e),_.pull(t.pending_presence_fetch,e))})}},{key:"_filterPresences",value:function(){var e=_.keys(this.subscribed),t=_.xor(this.current_filter_list,e),a=!_.isEmpty(t);a&&this.initialized&&e.length&&(this.current_filter_list=e,d["default"].dispatch("filter-presences",this.current_filter_list))}},{key:"_requestPresences",value:function(){var e=_.uniq(this.pending_presence_fetch);e.length&&this.initialized&&(d["default"].dispatch("fetch-presences",e),this.pending_presence_fetch=[])}}]),e}();t.PresenceSubscriptionHelperClass=p,t["default"]=new p(u["default"])},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(23),o=n(i),s=a(127),r=n(s),l=a(59),u=n(l),c=a(4),d=n(c),f=a(5),h=n(f),p=a(9),m=n(p),g=a(195),v=n(g),y=a(172),b=n(y),w=a(204),R=n(w),k=a(257),E=n(k),C=a(206),S=n(C),T=a(93),x=n(T),A=a(121),I=n(A),N=a(99),M=n(N),O=a(90),D=n(O),P=a(180),j=n(P),L=a(176),F=n(L),U=a(174),H=n(U),B=a(161),z=n(B),q=a(169),V=n(q),G=a(292),W=n(G),$=a(184),Y=n($),K=function(){function e(){(0,d["default"])(this,e),this.data=this.getDefaults(),this.registerListeners()}return(0,h["default"])(e,[{key:"getDefaults",value:function(){return{video_session:{},incoming_invites:[],roster:{},feature_flags:{},group_id:null,video_chat_uri:null,asset_base_uri:null,is_native:M["default"].clientSubType.isNative(V["default"].get("client_subtype"))}}},{key:"registerListeners",value:function(){var e=this;this.handlerMap={"updated:config":this._handleConfig,"updated:roster":this._handleRoster,"enso.start-video-call":this.initiateVideoCall,"enso.start-screen-share":this.initiateVideoCall,"enso.start-room-video":this.initiateRoomVideoCall,"enso.join-room-video":this.joinRoomVideoCall,"enso.invite-to-audio-video-call":this.handleVideoCallInvite,"enso.answer-audio-video-call":this.answerIncomingVideoCall,"enso.audio-video-call-accepted":this.videoCallAcceptedByRemoteUser,"enso.audio-video-call-declined":this.handleDeclinedMessage,"enso.decline-audio-video-call":this.declineIncomingVideoCall,"enso.audio-video-call-hung-up":this.handleHangupMessage,"enso.focus-video-window":this._focusVideoWindow,"enso.video-conference-joined":this.handleVideoConferenceJoined,"enso.video-conference-left":this.handleVideoConferenceLeft,"enso.video-session-destroyed":this.handleVideoSessionDestroy},_.mapValues(this.handlerMap,function(t,a,n){n[a]=_.bind(t,e)}),m["default"].register(this.handlerMap)}},{key:"cleanupListeners",value:function(){m["default"].unregister(this.handlerMap)}},{key:"_handleConfig",value:function(e){e.group_id&&(this.data.group_id=e.group_id),e.asset_base_uri&&(this.data.asset_base_uri=e.asset_base_uri),e.video_base_url&&(this.data.video_base_url=e.video_base_url),_.has(e,"feature_flags")&&_.isObject(e.feature_flags)&&(this.data.feature_flags=_.assign({},this.data.feature_flags,e.feature_flags))}},{key:"_handleRoster",value:function(e){this.data.roster=e}},{key:"_focusVideoWindow",value:function(){var e=this;return this.hasVideoSession().then(function(t){t&&e.data.video_session.window.focus()})}},{key:"_generateConferenceId",value:function(){var e=this.data.group_id?this.data.group_id.toString():"",t=M["default"].alphaNumeric(14);return _.padStart(e,6,"0")+t}},{key:"_getConferenceIdFromURL",value:function(e){var t=e.split("?")[0];return t.slice(t.lastIndexOf("/")+1,t.length)}},{key:"_addTokenToUrl",value:function(e,t){return t?M["default"].appendQueryParameter(e,"jwt",t):e}},{key:"_addRingToUrl",value:function(e){return this.data.feature_flags.web_client_play_ring_sound_in_client&&(e=M["default"].setHashFragment(e,{"interfaceConfig.DISABLE_RINGING":"true"})),e}},{key:"initiateVideoCall",value:function(e){var t=this,a=Date.now();return this.hasVideoSession().then(function(n){n?t.determineVideoWindowAction(e,t.initiateVideoCall):!function(){var n="call"===e.type,i=n?M["default"].jid.user_id(e.jid):null,o=n?t._generateConferenceId():t._getConferenceIdFromURL(e.url),s=t.prepareCallSession();t.showConnectingFlag(),S["default"].fetchVideoToken(i,o).then(function(i){return e.url=e.url||t.data.video_base_url+"/"+o+"?",n?(clearTimeout(t.data.connecting_timer),t.sendInvitation(e).then(function(){return e.url=t._addRingToUrl(e.url),e.url=t._addTokenToUrl(e.url,i.token),t.createCallSession(e,s).then(function(n){t.data.video_session.start_time=a,n.window||t.data.is_native?t.notifyForOutgoingCall():t.notifyForPopupBlocked(e)})})["catch"](function(e,t){D["default"].debug("[ENSO]",e,t)})):"accept"===e.type?(e.url=t._addTokenToUrl(e.url,i.token),t.createCallSession(e,s).then(function(n){t.data.video_session.start_time=a,n.window||t.data.is_native||t.notifyForPopupBlocked(e)})):void 0})["catch"](function(e){D["default"].debug("[ENSO JWT]",e)})}()})}},{key:"initiateRoomVideoCall",value:function(e){var t=this,a=Date.now(),n=this._generateConferenceId();return e.url=this.data.video_base_url+"/"+n+"?",this.hasVideoSession().then(function(n){return n?void t.determineVideoWindowAction(e,t.initiateRoomVideoCall):t.sendRoomInvitation({jid:e.jid,url:e.url.replace("/join/","/call/")}).then(function(){t._joinRoomVideoCall(e,a)})})}},{key:"joinRoomVideoCall",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{url:""}:arguments[0],a=Date.now(),n=this.data.video_base_url.split(":")[0]||"https";return t.url=t.url.replace(/^https?:\/\//,n+"://").replace("/call/","/join/"),this.hasVideoSession().then(function(n){n?e.determineVideoWindowAction(t,e.joinRoomVideoCall):e._joinRoomVideoCall(t,a)})}},{key:"_joinRoomVideoCall",value:function(e,t){var a=this,n=this._getConferenceIdFromURL(e.url),i=this.prepareCallSession();return this.showConnectingFlag(),S["default"].fetchVideoToken(null,n).then(function(n){e.url=a._addTokenToUrl(e.url,n.token),a.createCallSession(e,i).then(function(n){a.data.video_session.start_time=t,n.window||a.data.is_native||a.notifyForPopupBlocked(e)})["catch"](function(e,t){D["default"].debug("[ENSO]",e,t)})})["catch"](function(e){D["default"].debug("[ENSO JWT]",e)})}},{key:"determineVideoWindowAction",value:function(e){var t=this,a=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1],n=this.data.video_session,i=function(){t.handleVideoSessionDestroy().then(function(){a.call(t,e)})};if(e.jid===n.jid)n.connected||n.connecting?n.window.focus():i();else if(n.connected){if(!confirm(F["default"].confirm_leave))return!0;i()}else i()}},{key:"showConnectingFlag",value:function(){this.data.feature_flags.web_client_video_connecting_flag&&this.data.is_native&&R["default"].showFlag({type:"info",body:F["default"].connecting,close:"auto",delay:1e4})}},{key:"sendInvitation",value:function(e){var t=this;return new u["default"](function(a,n){b["default"].sendVideoInviteMessage({jid:e.jid,url:e.url,callback:_.bind(t.handleResponseToSentInvitation,t,a,n)})})}},{key:"sendRoomInvitation",value:function(e){return new u["default"](function(t,a){b["default"].sendVideoInviteMessage({jid:e.jid,url:e.url}),t()})}},{key:"handleResponseToSentInvitation",value:function(e,t,a){var n=_.get(a,"x"),i=_.transform(n,function(e,t,a){return"xmlns"!==a&&e.push(a,t.reason),e},[]),o=(0,r["default"])(i,2),s=o[0],l=o[1];switch(s){case"decline":case"hangup":t(s,l);break;case"trying":case"ringing":e();break;default:t("Error handling message ",a)}}},{key:"handleVideoCallInvite",value:function(e){var t=this,a=M["default"].jid.bare_jid(e.sender.jid);if(a!==W["default"].get("jid")){var n=function(){var n=t.getCaller(a),i=t.data.video_session,o=void 0;return{v:t.hasVideoSession().then(function(s){if(s){if(i.jid!==a&&i.connected)return b["default"].sendVideoInviteDeclineMessage({jid:a,reason:"on_a_call"}),!0;if(i.jid===a||i.connected){if(i.jid===a&&i.connected)return!0}else o="video-flag-"+M["default"].now()}else o="video-flag-"+M["default"].now();b["default"].showInviteFlag({id:o,sender:e.sender.name,photo_url:n.photo_url,message:e.message}),t.notifyForIncomingCall(n);var r={invite_flag_id:o,caller:n,missed_timer:setTimeout(function(){t.handleMissedCall(n)},I["default"].missed_video_call_timeout)};t.data.incoming_invites.push(r),x["default"].handleVideoCallInvite(t.answerIncomingVideoCall.bind(t,e.message),t.declineIncomingVideoCall.bind(t,e.message),{id:o,name:e.sender.name,avatar:n.photo_url})})}}();if("object"===("undefined"==typeof n?"undefined":(0,o["default"])(n)))return n.v}}},{key:"removeInvite",value:function(e){var t=_.find(this.data.incoming_invites,{caller:{jid:e}});t&&(clearTimeout(t.missed_timer),this.stopAllSounds(),_.pull(this.data.incoming_invites,t),b["default"].removeInviteFlag({index:t.invite_flag_id}),x["default"].dismissVideoCallInvite(t.invite_flag_id))}},{key:"answerIncomingVideoCall",value:function(e){var t=_.get(e,"x.call.url",""),a=M["default"].jid.bare_jid(e.from);this.stopAllSounds(),this.stopIncomingNotification(a),this.removeInvite(a),b["default"].sendVideoInviteAcceptMessage({jid:a}),this.initiateVideoCall({jid:a,type:"accept",url:t,service:H["default"].ENSO})}},{key:"declineIncomingVideoCall",value:function(e){var t=M["default"].jid.bare_jid(e.from);this.stopAllSounds(),this.stopIncomingNotification(t),
this.removeInvite(t),b["default"].sendVideoInviteDeclineMessage({jid:t,reason:"decline"})}},{key:"handleMissedCall",value:function(e){this.stopAllSounds(),this.stopIncomingNotification(e.jid);var t={body:F["default"].missed_call_message(e.name),type:"missed-call",from:e.jid,delay:!1,sender:" "};b["default"].generateMissedCallMessage({message:t})}},{key:"handleDeclinedCall",value:function(e,t){this.stopAllSounds();var a={body:F["default"].call_declined[t](e.name),type:"system",from:e.jid,delay:!1,sender:"HipChat",sender_avatar:[]};b["default"].handleRemoteDeclinedMessage({message:a})}},{key:"prepareCallSession",value:function(){var e=M["default"].video.get_video_window_props();return x["default"].prepareVideoWindow("HipChatVideoConference",e)}},{key:"createCallSession",value:function(e,t){var a=this,n=e.jid,i=(e.room_id,e.url),o=M["default"].video.get_video_window_props();return x["default"].initializeVideoWindow(i,"HipChatVideoConference",o,t).then(function(e){return a.data.video_session={jid:n,connecting:!0,connected:!1,window:e},e})}},{key:"handleDeclinedMessage",value:function(e){var t=M["default"].jid.bare_jid(e.message.from),a=_.get(e.message,"x.decline.reason","");if(this.stopAllSounds(),clearTimeout(this.data.connecting_timer),this.data.video_session.connecting=!1,t!==W["default"].get("jid")&&a&&(this.handleDeclinedCall(e.sender,a),E["default"].leaveCall()),"on_a_call"===a)try{var n=_.get(this.data,"video_session.window");n.close.call(n)}catch(i){D["default"].debug("[ENSO]","handleDeclinedMessage() attempted to close a video window and failed")}}},{key:"handleHangupMessage",value:function(e){var t=this;return this.hasVideoSession().then(function(a){a&&t.data.video_session.jid!==M["default"].jid.bare_jid(e.sender.jid)||(t.stopAllSounds(),t.removeInvite(M["default"].jid.bare_jid(e.message.from)),E["default"].leaveCall())})}},{key:"videoCallAcceptedByRemoteUser",value:function(){clearTimeout(this.data.connecting_timer),this.stopAllSounds()}},{key:"destroyVideoSession",value:function(){var e=this;_.attempt(function(){return e.data.video_session.window.close()}),this.data.video_session={}}},{key:"handleVideoSessionDestroy",value:function(){var e=this;return this.handleVideoConferenceLeft().then(function(){e.destroyVideoSession()})}},{key:"getCaller",value:function(e){return _.find(this.data.roster,{jid:e})}},{key:"notifyForIncomingCall",value:function(e){j["default"].setTitleNotification({id:e.jid,text:F["default"].incoming_call_notification(e.name)});var t=z["default"].getNotifyForVideoWhenDND()||z["default"].getNotifyWhenDND(),a=W["default"].get("show")===Y["default"].DND,n=t&&a||!a;n&&v["default"].showNotification({group_id:V["default"].get("group_id"),group_name:V["default"].get("group_name"),jid:e.jid,title:e.name,body:F["default"].incoming_call_notification(e.name),icon:this.data.asset_base_uri+I["default"].notification_icon,type:"incoming_call"}),j["default"].playSound("incoming_call",!0)}},{key:"notifyForOutgoingCall",value:function(){var e=this;this.data.feature_flags.web_client_play_ring_sound_in_client&&j["default"].playSound("outgoing_call",!0),clearTimeout(this.data.connecting_timer),this.data.connecting_timer=setTimeout(function(){e.handleUnansweredCall()},I["default"].missed_video_call_timeout)}},{key:"handleUnansweredCall",value:function(){this.stopAllSounds(),this.data.video_session.connected=!1,this.data.video_session.connecting=!1}},{key:"notifyForPopupBlocked",value:function(e){var t=this;b["default"].showPopupsDisabledFlag({flag_id:"popups_disabled_flag",message:"Please enable popups and try again",promise:_.bind(function(){return t.createCallSession(e)},this)})}},{key:"hasVideoSession",value:function(){var e=this;return x["default"].hasActiveVideoSession().then(function(t){return t||!!e.data.video_session.jid})}},{key:"stopAllSounds",value:function(){j["default"].stopSounds()}},{key:"stopIncomingNotification",value:function(e){j["default"].unsetTitleNotification(e)}},{key:"handleVideoConferenceJoined",value:function(){var e=this,t=Date.now();return this.hasVideoSession().then(function(a){a&&(e.data.video_session.connected=!0,e.data.video_session.connecting=!1,b["default"].videoCallConnected({jid:e.data.video_session.jid,start:e.data.video_session.start_time,done:t}),E["default"].onCall())})}},{key:"handleVideoConferenceLeft",value:function(){var e=this;return this.stopAllSounds(),this.hasVideoSession().then(function(t){var a=e.data.video_session.connected||e.data.video_session.connecting;if(t&&a){e.data.video_session.connected=!1,e.data.video_session.connecting=!1;var n=e.data.video_session.jid,i=e.data.video_session.room_id;b["default"].sendHangupMessage({jid:n,room_id:i}),E["default"].leaveCall()}})}}]),e}();t["default"]=K,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(191),o=n(i),s=a(10),r=n(s),l=a(4),u=n(l),c=a(5),d=n(c),f=a(22),h=n(f),p=a(47),m=n(p),g=a(51),v=n(g),y=a(162),b=n(y),w=a(293),R=n(w),k=a(9),E=n(k),C=a(184),S=n(C),T=a(121),x=n(T),A=a(176),I=n(A),N={show:S["default"].DND,status:I["default"].call_status},M=function(e){function t(){(0,u["default"])(this,t);var e=(0,h["default"])(this,(0,r["default"])(t).call(this));return e.local={manual_presence:{show:S["default"].AVAILABLE,status:""}},e}return(0,v["default"])(t,e),(0,d["default"])(t,[{key:"getModel",value:function(){return R["default"]}},{key:"getDefaults",value:function(){return{email:"",guest_key:null,is_admin:!1,is_guest:!1,jid:"",mention:"",photo_large:"",photo_small:"",title:"",user_created_utc:null,id:null,user_name:"",show:S["default"].AVAILABLE,status:""}}},{key:"registerListeners",value:function(){var e=this;E["default"].register({"updated:current_user":function(t){e.setIfNotEqual(t)},"updated:roster":function(t){var a=t[e.data.jid];a&&a.presence&&e.setIfNotEqual({show:a.presence.show,status:a.presence.status})},"set-current-user-status":function(t){e._saveManualPresence(t),e._updatePresence(t)},"set-current-user-idle":function(){e._checkIfOnCall()||e._setIdle()},"set-current-user-active":function(){e._checkIfOnCall()||e._setActive()},"user-on-call":function(){e._setOnCall()},"user-leave-call":function(){e._setLeaveCall()},"application-focused":function(){e.data.show===S["default"].IDLE&&e._setActive()}})}},{key:"_setIdle",value:function(){this._updatePresence({show:S["default"].IDLE})}},{key:"_setActive",value:function(){this._updatePresence(this.local.manual_presence)}},{key:"_checkIfOnCall",value:function(){return this.data.status===N.status&&this.data.show===N.show}},{key:"_setOnCall",value:function(){this._updatePresence(N)}},{key:"_setLeaveCall",value:function(){this._updatePresence(this.local.manual_presence)}},{key:"_saveManualPresence",value:function(e){e.show!==S["default"].IDLE&&(this.local.manual_presence=(0,o["default"])({},e))}},{key:"_resetManualPresence",value:function(){this.local.manual_presence={show:S["default"].AVAILABLE,status:""}}},{key:"_updatePresence",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=e.show,a=void 0===t?this.data.show:t,n=e.status,i=void 0===n?this.data.status:n,o={show:a,status:i},s={show:this.data.show,status:this.data.status};_.isEqual(o,s)||(o.status=o.status.trim(),o.status.length>x["default"].max_presence_text_length&&(o.status=o.status.substring(0,x["default"].max_presence_text_length)),this.set(o),E["default"].dispatch("update-presence",o))}},{key:"reset",value:function(){this._resetManualPresence(),(0,m["default"])((0,r["default"])(t.prototype),"reset",this).call(this)}}]),t}(b["default"]);t["default"]=new M,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return _.transform(e,function(e,t,a){switch(a){case"email":case"guest_key":case"mention":case"photo_large":case"photo_small":case"title":case"show":case"status":case"is_in_welcome_range":e[a]=t;break;case"user_name":case"name":e.user_name=t;break;case"jid":case"user_jid":e.jid=t;break;case"user_created_utc":e[a]=_.isNaN(t)?null:parseInt(t,10);break;case"user_id":case"id":e.id=_.isNaN(t)?null:parseInt(t,10);break;case"is_admin":case"is_guest":e[a]=f["default"].coerceBoolean(t,!1);break;case"presence":e.show=t.show,e.status=t.status}})}Object.defineProperty(t,"__esModule",{value:!0});var o=a(148),s=n(o),r=a(52),l=n(r),u=a(4),c=n(u),d=a(99),f=n(d),h=function p(){var e=arguments.length<=0||void 0===arguments[0]?(0,l["default"])(null):arguments[0];(0,c["default"])(this,p),(0,s["default"])(this,i(e))};t["default"]=h,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(4),o=n(i),s=a(5),r=n(s),l=a(108),u=n(l),c=function(){function e(t){(0,o["default"])(this,e),t&&this.buildForHC(t),this.Actions=a(295),this.AppDispatcher=a(9),this.AnalyticsDispatcher=a(173),this.ApplicationStore=a(190),this.AppConfig=a(121),this.utils=a(99),this.Emoticons=a(110),this.Rehacked=a(299),this.ENV="production",this.api=a(264),this.resolution=Math.ceil(window.devicePixelRatio),this.emoticon_resolution_helper=function(e){e.onerror=null,e.src=u["default"].remove_resolution(e.src)}}return(0,r["default"])(e,[{key:"buildForHC",value:function(e){var t=this;_.forOwn(e,function(e,a){t[a]=e})}}]),e}();e.exports=c},function(e,t,a){"use strict";e.exports={AppActions:a(195),ChatHeaderActions:a(285),ChatInputActions:a(261),ChatWindowActions:a(178),ConnectionActions:a(215),AppHeaderActions:a(276),DialogActions:a(95),FlagActions:a(204),FormActions:a(286),InlineDialogActions:a(277),LobbyActions:a(296),PreferenceActions:a(265),RoomDropdownActions:a(287),RoomNavActions:a(288),RosterActions:a(297),TooltipActions:a(298)}},function(e,t,a){"use strict";var n=a(9),i=a(173),o=a(196),s={applyFilter:function(e){n.dispatch("filter-lobby",e),i.dispatch("analytics-filter-lobby",e)},openChat:function(e){n.dispatch("set-route",{jid:e.jid}),e.source="lobby",i.dispatch("analytics-open-room",e)},resetFilter:function(){n.dispatch("set-lobby-filter-text",{text:""}),n.dispatch("filter-lobby",{query:"",scope:"all"})},showCreateRoomDialog:function(){i.dispatch("analytics-event",{name:"hipchat.client.lobby.create.room.dialog.open"}),o.createRoomClickedEvent("lobby"),n.dispatch("show-modal-dialog",{dialog_type:"create-room-dialog",dialog_data:!1})},lobbyMounted:function(){i.dispatch("analytics-lobby-mount",{id:"lobby"})},setInputText:function(e){n.dispatch("set-lobby-filter-text",{text:e})},resetSelectedItem:function(){n.dispatch("lobby-reset-selected-item")},itemHovered:function(e){n.dispatch("lobby-item-hover",{index:e.index})},selectedNextItem:function(){n.dispatch("lobby-select-next-item")},selectedPrevItem:function(){n.dispatch("lobby-select-prev-item")}};e.exports=s},function(e,t,a){"use strict";var n=a(9),i={fetchPresence:function(){n.dispatch("fetch-presence")}};e.exports=i},function(e,t,a){"use strict";var n=a(9),i=a(173),o={showTooltip:function(e){n.dispatch("show-tooltip",e)},smileyChosen:function(e){n.dispatch("smiley-chosen",e),i.dispatch("analytics-event",{name:"hipchat.client.emoticon.dialog.emoticon.clicked",properties:{emoticonString:e.shortcut}})},moreEmoticonsChosen:function(){i.dispatch("analytics-event",{name:"hipchat.client.emoticon.dialog.more.clicked"})},customEmoticonsChosen:function(){i.dispatch("analytics-event",{name:"hipchat.client.emoticon.dialog.custom.clicked"})}};e.exports=o},function(e,t,a){"use strict";function n(e){var t=e.node||"div";return o(t,e.props,e.lifecycle)}var i=a(300)(a(305)),o=a(306),s=i.before,r=i.after,l=i.on;i.on=function(e,t,a){return _.isPlainObject(a)&&Array.prototype.splice.call(arguments,2,1,n(a)),l.apply(i,arguments)},i.before=function(e,t,a){return _.isPlainObject(a)&&Array.prototype.splice.call(arguments,2,1,n(a)),s.apply(i,arguments)},i.after=function(e,t,a){return _.isPlainObject(a)&&Array.prototype.splice.call(arguments,2,1,n(a)),r.apply(i,arguments)},e.exports=i},function(e,t,a){"use strict";var n=a(301),i=a(304),o=a(303);e.exports=function(e){function t(a,n,s,r){var l=a.length===n+1,u=new i(a[n]),c=[];o.compact(s).forEach(function(e){if(o.isArray(e))t(a,n,e,r);else{var i=u.test(e),s=e.props&&e.props.children;!i&&s&&u.shouldTraverse()?(e.props.children=o.asArray(e.props.children),t(a,n,e.props.children,r)):i&&!l&&s?(e.props.children=o.asArray(e.props.children),t(a,n+1,e.props.children,r)):i&&l&&c.push(e)}}),c.forEach(function(t){var a=s.indexOf(t),n=e.createElement(r.reactClass,{reference:t});-1===r.location?s.splice(a,0,n):1===r.location?s.splice(a+1,0,n):0===r.location&&s.splice(a,1,n)})}var a=new n,s=e.createClass;return e.createClass=function(n){var i=n.render,o=n.displayName;return n.render=function(){var e=i.apply(this,arguments);if(a.isAnythingBeingHacked()&&a.isBeingHacked(o)){var n=a._getEntry(o);n.forEach(function(a){var n=a.selector.expressions;n&&n.forEach(function(n){t(n,0,[e],a)})})}return e},s.apply(e,arguments)},a}},function(e,t,a){"use strict";function n(){this._hackRegistry={}}var i=a(302).Slick.parse,o=a(303),s=function(e,t){if(!e)throw t};n.prototype.isAnythingBeingHacked=function(){return 0!==this._hackRegistry.length},n.prototype.isBeingHacked=function(e){return"undefined"!=typeof this._hackRegistry[e]},n.prototype.before=function(e,t,a,n){this._hack(e,t,a,o.extend({location:-1},n))},n.prototype.after=function(e,t,a,n){this._hack(e,t,a,o.extend({location:1},n))},n.prototype.on=function(e,t,a,n){this._hack(e,t,a,o.extend({location:0},n))},n.prototype._getEntry=function(e){return this._hackRegistry[e]},n.prototype._hack=function(e,t,a,n){s(e,"You must specify a component type to hack"),s(t,"You must specify a selector"),s(a,"You must provide an element to render"),s(-1!==n.location||0!==n.location||1!==n.location,"You must specify a place for the hack to appear");var o=this.isBeingHacked(e),r={selector:i(t),location:n.location,reactClass:a};o?this._hackRegistry[e].push(r):this._hackRegistry[e]=[r]},n.prototype._clear=function(){this._hackRegistry={}},e.exports=n},function(e,t,a){"use strict";(function(){function e(e,o,s,l,c,f,h,p,_,m,g,v,y,b,w,R){if((o||-1===a)&&(t.expressions[++a]=[],n=-1,o))return"";if(s||l||-1===n){s=s||" ";var k=t.expressions[a];i&&k[n]&&(k[n].reverseCombinator=u(s)),k[++n]={combinator:s,tag:"*"}}var E=t.expressions[a][n];if(c)E.tag=c.replace(r,"");else if(f)E.id=f.replace(r,"");else if(h)h=h.replace(r,""),E.classList||(E.classList=[]),E.classes||(E.classes=[]),E.classList.push(h),E.classes.push({value:h,regexp:new RegExp("(^|\\s)"+d(h)+"(\\s|$)")});else if(y)R=R||w,R=R?R.replace(r,""):null,E.pseudos||(E.pseudos=[]),E.pseudos.push({key:y.replace(r,""),value:R,type:1==v.length?"class":"element"});else if(p){p=p.replace(r,""),g=(g||"").replace(r,"");var C,S;switch(_){case"^=":S=new RegExp("^"+d(g));break;case"$=":S=new RegExp(d(g)+"$");break;case"~=":S=new RegExp("(^|\\s)"+d(g)+"(\\s|$)");break;case"|=":S=new RegExp("^"+d(g)+"(-|$)");break;case"=":C=function(e){return g==e};break;case"*=":C=function(e){return e&&e.indexOf(g)>-1};break;case"!=":C=function(e){return g!=e};break;default:C=function(e){return!!e}}""==g&&/^[*$^]=$/.test(_)&&(C=function(){return!1}),C||(C=function(e){return e&&S.test(e)}),E.attributes||(E.attributes=[]),E.attributes.push({key:p,operator:_,value:g,test:C})}return""}var t,a,n,i,o={},s={},r=/\\/g,l=function p(n,r){if(null==n)return null;if(n.Slick===!0)return n;n=(""+n).replace(/^\s+|\s+$/g,""),i=!!r;var l=i?s:o;if(l[n])return l[n];for(t={Slick:!0,expressions:[],raw:n,reverse:function(){return p(this.raw,!0)}},a=-1;n!=(n=n.replace(f,e)););return t.length=t.expressions.length,l[t.raw]=i?c(t):t},u=function(e){return"!"===e?" ":" "===e?"!":/^!/.test(e)?e.replace(/^!/,""):"!"+e},c=function(e){for(var t=e.expressions,a=0;a<t.length;a++){for(var n=t[a],i={parts:[],tag:"*",combinator:u(n[0].combinator)},o=0;o<n.length;o++){var s=n[o];s.reverseCombinator||(s.reverseCombinator=" "),s.combinator=s.reverseCombinator,delete s.reverseCombinator}n.reverse().push(i)}return e},d=function(e){return e.replace(/[-[\]{}()*+?.\\^$|,#\s]/g,function(e){return"\\"+e})},f=new RegExp("^(?:\\s*(,)\\s*|\\s*(<combinator>+)\\s*|(\\s+)|(<unicode>+|\\*)|\\#(<unicode>+)|\\.(<unicode>+)|\\[\\s*(<unicode1>+)(?:\\s*([*^$!~|]?=)(?:\\s*(?:([\"']?)(.*?)\\9)))?\\s*\\](?!\\])|(:+)(<unicode>+)(?:\\((?:(?:([\"'])([^\\13]*)\\13)|((?:\\([^)]+\\)|[^()]*)+))\\))?)".replace(/<combinator>/,"["+d(">+~`!@$%^&={}\\;</")+"]").replace(/<unicode>/g,"(?:[\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])").replace(/<unicode1>/g,"(?:[:\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])")),h=this.Slick||{};h.parse=function(e){return l(e)},h.escapeRegExp=d,this.Slick||(this.Slick=h)}).apply(t)},function(e,t){"use strict";var a=Object.prototype.hasOwnProperty,n=Object.prototype.toString;e.exports={extend:function(e,t){var n;for(n in t)a.call(t,n)&&(e[n]=t[n]);return e},isArray:function(e){return"[object Array]"===n.call(e)},pluck:function(e,t){var a=[];return e.forEach(function(e){a.push(e[t])}),a},every:function(e,t,a){var n=!0;return e.forEach(function(e){n=n&&t.call(a,e)}),n},compact:function(e){var t=[];return e.forEach(function(e){e&&t.push(e)}),t},asArray:function(e){return this.isArray(e)?e:[e]}}},function(e,t,a){"use strict";function n(e){this._selector=e}var i=a(303);n.prototype.test=function(e){var t=!0;if(t&&this._selector.tag&&"*"!==this._selector.tag&&(t=e.type===this._selector.tag||e.type&&e.type.displayName===this._selector.tag),t&&this._selector.classes&&(t=e.props&&e.props.className&&i.every(i.pluck(this._selector.classes,"regexp"),function(t){return t.test(e.props.className)})),t&&this._selector.id&&(t=e.props.id===this._selector.id),t&&this._selector.pseudos)throw"rehacked doesn't understand pseudo classes (yet)";return t&&this._selector.attributes&&(t=i.every(this._selector.attributes,function(t){var a=e.props[t.key];return a&&t.test(a)})),t},n.prototype.shouldTraverse=function(){return">"!==this._selector.combinator},e.exports=n},function(e,t){e.exports=React},function(e,t){"use strict";e.exports=function(e,t,a){var n=["componentWillMount","componentDidMount","componentWillReceiveProps","componentWillUpdate","componentDidUpdate","componentWillUnmount"],i={displayName:"RehackedPlaceholder",render:function(){return React.createElement(e,t)}},o=function(e){var t=n.map(function(e){return function(){var t=a[e];t&&t.apply(this,arguments)}});return _.extend(_.fromPairs(n,t),e)};return React.createClass(o(i))}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(308),o=n(i),s=a(338),r=n(s),l=a(339),u=n(l),c=a(465),d=n(c),f=a(472),h=n(f),p=a(475),_=n(p),m=a(481),g=n(m),v=a(620),y=n(v),b=a(621),w=n(b);a(622),t["default"]=React.createClass({displayName:"MainLayout",mixins:[r["default"]],render:function(){return React.createElement("div",{id:"page"},React.createElement(o["default"],{is_guest:this.props.is_guest}),React.createElement(g["default"],{is_guest:this.props.is_guest}),React.createElement(u["default"],null),React.createElement(d["default"],null),React.createElement(_["default"],null),React.createElement(y["default"],{ref:"fileViewer",items:this.props.files}),React.createElement(h["default"],null),React.createElement(w["default"],null))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(309),o=n(i),s=a(195),r=n(s),l=a(96),u=n(l),c=a(334),d=n(c),f=a(336),h=n(f),p=a(95),m=n(p),g=a(196),v=n(g),y=a(319),b=n(y),w=a(183),R=n(w),k=a(99),E=n(k),C=a(313),S=n(C),T=a(197),x=n(T);t["default"]=React.createClass({displayName:"AppHeader",getInitialState:function(){return this._getState()},_getState:function(){var e=_.assign({},u["default"].getAll(),{read_only_mode:d["default"].get("read_only_mode")});return e},componentDidMount:function(){u["default"].on("change",this._onChange),d["default"].on("change:read_only_mode",this._onChange)},componentWillUnmount:function(){u["default"].off("change",this._onChange),d["default"].off("change:read_only_mode",this._onChange)},_onLogoClick:function(){r["default"].logoClicked()},_onNewChatClick:function(e){v["default"].newChatButtonClicked(),m["default"].showQuickSwitcherDialog(),e.preventDefault()},_getUserStatus:function(){return this.state.ready?React.createElement(o["default"],{search_text:this.state.search_text,focus_search:this.state.focus_search,active_chat:this.state.active_chat,multi_org_supported:this.state.feature_flags.web_client_subdomain_scoped_session,search_enabled:this.state.feature_flags.web_client_embedded_search,should_animate_avatar:this.state.should_animate_avatar,read_only_mode:this.state.read_only_mode,is_guest:this.props.is_guest}):void 0},_getNewChatButton:function(){if(this.state.ready){var e=(0,S["default"])({"aui-button":!0,"aui-button-primary":!0,"is-native":E["default"].clientSubType.isNative(this.state.client_subtype)});return React.createElement("ul",{className:"aui-nav","data-skate-ignore":!0},React.createElement("li",null,React.createElement("a",{onClick:this._onNewChatClick,id:"new_chat_btn",ref:"new_chat_btn",className:e,"aria-label":b["default"].new_chat_btn_title,"data-tipsify-ignore":!0},b["default"].new_chat_btn_title)))}},_getInviteUserButton:function(){return!this.state.feature_flags.hide_invite_your_team_button&&this.state.ready&&(this.state.user_is_admin||this.state.invite_url)?React.createElement("ul",{className:"aui-nav","data-skate-ignore":!0},React.createElement("li",null,React.createElement("a",{onClick:this._onInviteUserClick,className:"aui-button aui-button-link hc-invite-users aui-inline-dialog-trigger","aria-label":b["default"].invite_your_team_btn_title,"data-tipsify-ignore":!0},b["default"].invite_your_team_btn_title))):void 0},_getAppLogo:function(){return React.createElement("a",{id:"app_logo",ref:"app_logo",href:"https://"+this.state.web_server+"/home",onClick:this._onLogoClick,target:"_blank"},React.createElement("span",{className:"aui-header-logo-device"},R["default"].hipchat))},_onInviteUserClick:function(){m["default"].showInviteTeammatesDialog({type:x["default"].TOP}),v["default"].inviteTeamClickedEvent("top.navigation")},_onChange:function(){this.setState(this._getState())},render:function(){var e,t=E["default"].clientSubType.isNative(this.state.client_subtype)?!1:this._getAppLogo(),a=this._getUserStatus(),n=this.props.is_guest?!1:this._getNewChatButton(),i=this.props.is_guest?!1:this._getInviteUserButton(),o=this.state.ready&&this.state.notification_supported&&!this.state.notification_dismissed_forever&&!this.state.notification_permission;o&&(e=React.createElement(h["default"],this.state));var s=(0,S["default"])({"app-header":!0,"banner-dismissed":!this.state.banner_shown,"banner-shown":this.state.banner_shown&&o});return React.createElement("header",{id:"header",className:s,role:"banner"},e,React.createElement("nav",{className:"aui-header aui-dropdown2-trigger-group",role:"navigation","data-aui-responsive":"true"},React.createElement("div",{className:"aui-header-inner"},React.createElement("div",{className:"aui-header-primary"},React.createElement("h1",{id:"logo",className:"aui-header-logo aui-header-logo-hc"},t),n,i),a)))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(310),o=n(i),s=a(318),r=n(s),l=a(321),u=n(l),c=a(330),d=n(c),f=a(292),h=n(f),p=a(169),m=n(p),g=a(276),v=n(g),y=a(331),b=n(y),w=a(311),R=n(w),k=a(99),E=n(k),C=a(332),S=n(C),T=a(333),x=n(T),A=a(314),I=n(A),N=a(326),M=n(N),O=a(327),D=n(O),P=a(328),j=n(P);t["default"]=React.createClass({displayName:"UserStatus",mixins:[I["default"]],getInitialState:function(){return this._getState()},componentDidMount:function(){h["default"].on(["change"],this._onChange),m["default"].on("change:web_server",this._onChange),M["default"].on("change",this._onChange),this._debouncedResize=_.debounce(this._debouncedChange,50,{leading:!1,trailing:!0}),$(window).on("resize",this._debouncedResize)},componentWillUnmount:function(){h["default"].off(["change"],this._onChange),m["default"].off("change:web_server",this._onChange),M["default"].off("change",this._onChange),$(window).off("resize",this._debouncedResize),this._debouncedResize.cancel()},_onHelpButtonClicked:function(){v["default"].helpButtonClicked()},_onUserProfileDropdownClick:function(){v["default"].userProfileDropdownClicked()},_getSearchInput:function(){return React.createElement("li",null,React.createElement(b["default"],{jid:this.props.active_chat,text:this.props.search_text,focus_search:this.props.focus_search,search_enabled:this.props.search_enabled}))},_getHelpMenu:function(e){var t;return e||(t=React.createElement("li",null,React.createElement(S["default"],{type:"link",id:"header-help-menu-link",dropdownID:"header-help-menu",className:"hc-header-help-menu",arrowless:!0},React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-help"})),React.createElement(x["default"],{dropdownID:"header-help-menu",className:"aui-dropdown2-in-header"},React.createElement(d["default"],{read_only_mode:this.props.read_only_mode})))),t},render:function(){var e=this.props.is_guest||this._shouldHideSearchInput()?!1:this._getSearchInput(),t=this._getHelpMenu(this.props.is_guest);return React.createElement("div",{className:"aui-header-secondary"},React.createElement("ul",{className:"aui-nav","data-skate-ignore":!0},React.createElement("li",null,React.createElement(u["default"],null)),e,t,React.createElement("li",{id:"status_dropdown",ref:"status_dropdown",className:"status-dropdown",onClick:this._onUserProfileDropdownClick},React.createElement(S["default"],{type:"link",dropdownID:"current-user-status",className:"hc-header-user-avatar"},React.createElement(o["default"],{avatar_url:this.state.photo_small,size:"small",shouldAnimate:this.props.should_animate_avatar,show_presence:!1}),React.createElement(R["default"],{presence:this.state.show,active:!0,uid:this.state.id})),React.createElement(x["default"],{dropdownID:"current-user-status",className:"aui-dropdown2-in-header"},React.createElement(r["default"],{web_server:this.state.web_server,is_guest:this.props.is_guest,multi_org_supported:this.props.multi_org_supported,presence_show:this.state.show,presence_status:this.state.status,current_user_uid:this.state.id})))))},_shouldHideSearchInput:function(){var e=$(".aui-header").width();return(this.state.connectionStatus!==D["default"].CONNECTED||this.state.networkStatus!==j["default"].ONLINE)&&950>e},_getState:function(){return _.extend({web_server:m["default"].get("web_server"),presenceDialogVisible:!1,currentTime:E["default"].getMoment(),connectionStatus:M["default"].get("connection_status"),networkStatus:M["default"].get("network_status")},h["default"].getAll())},_onChange:function(){this.setState(this._getState())},_debouncedChange:function(){v["default"].positionDialogs(),this._onChange()}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(121),o=n(i),s=a(311),r=n(s),l=a(99),u=n(l),c=a(169),d=n(c),f=a(258),h=n(f),p=a(314),_=n(p);t["default"]=React.createClass({displayName:"PersonAvatar",mixins:[_["default"]],propTypes:{active:React.PropTypes.bool,show_presence:React.PropTypes.bool,size:React.PropTypes.string,avatar_url:React.PropTypes.string,avatar_bg_color:React.PropTypes.string,text:React.PropTypes.string,name:React.PropTypes.string,uid:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.number]),shouldAnimate:React.PropTypes.bool},getDefaultProps:function(){return{active:!0,show_presence:!0,size:"xsmall",avatar_url:"",avatar_bg_color:o["default"].default_group_avatar_bg,text:"",name:"",uid:"",shouldAnimate:!0,onClick:function(){}}},getInitialState:function(){return{src:null,asset_base_uri:d["default"].get("asset_base_uri"),force_default_avatar:!1}},_isMounted:!1,componentDidMount:function(){var e=this;this._isMounted=!0,this.props.avatar_url&&u["default"].image.load(this.props.avatar_url,o["default"].avatar_loading_timeout).then(function(t){e._isMounted&&(e.state.src!==t&&e.setState({src:t}),e._drawCanvas())})["catch"](function(){e._isMounted&&e.setState({force_default_avatar:!0})})},componentDidUpdate:function(){this._drawCanvas()},componentWillUnmount:function(){this._isMounted=!1},_getAvatar:function(){if(!this.props.shouldAnimate&&u["default"].file.is_gif(this.props.avatar_url))return React.createElement("canvas",{className:"aui-avatar-img",ref:"canvas"});var e={backgroundImage:"url("+this.props.avatar_url+")"};return React.createElement("span",{className:"aui-avatar-img",style:e})},_drawCanvas:function(){var e=this.state.src,t=this.refs.canvas;if(e&&t){var a=e.width,n=e.height,i=a,o=0,s=0;n>a?(i=a,s=(n-i)/2):a>n&&(i=n,o=(a-i)/2),t.height=t.width=i,t.getContext("2d").drawImage(e,o,s,i,i,0,0,i,i)}},_getDefaultAvatar:function(){var e={backgroundColor:this.props.avatar_bg_color},t=this.props.text.toUpperCase();return this.props.name&&!t&&(t=h["default"].getAvatarInitialsFromName(this.props.name)),this.state.asset_base_uri&&!t&&(e.backgroundImage="url("+this.state.asset_base_uri+"assets/img/user-avatar-blue-48"+(window.HC.resolution>1?"@2x":"")+".png)"),React.createElement("div",{className:"hc-default-avatar",style:e},t)},_getStatus:function(){return this.props.show_presence?React.createElement(r["default"],{presence:this.props.presence,mobile:this.props.mobile,active:this.props.active,uid:this.props.uid}):!1},render:function(){var e=this.props.avatar_url&&!this.state.force_default_avatar?this._getAvatar():this._getDefaultAvatar(),t=this._getStatus(),a="aui-avatar aui-avatar-project aui-avatar-"+this.props.size;return React.createElement("span",{className:a,onClick:this.props.onClick},React.createElement("span",{className:"aui-avatar-inner"},e),t)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(312),o=n(i),s=a(314),r=n(s),l=a(290),u=n(l);t["default"]=React.createClass({displayName:"PresenceIcon",mixins:[r["default"]],componentWillMount:function(){this.props.uid&&u["default"].subscribeToPresence(this.props.uid)},componentDidUpdate:function(e){e.uid!==this.props.uid&&(u["default"].unsubscribeFromPresence(e.uid),u["default"].subscribeToPresence(this.props.uid))},componentWillUnmount:function(){this.props.uid&&u["default"].unsubscribeFromPresence(this.props.uid)},getDefaultProps:function(){return{classNames:{"hc-status-icon":!0},presence:"chat",mobile:!1,active:!1,uid:""}},_getPresenceIconName:function(e){var t=e;return"chat"===e?t="available":"unknown"===e&&(t="unavailable"),this.props.active&&(t+="-selected"),t},_getStatusName:function(){var e="unknown";return"unknown"===this.props.presence&&this.props.mobile?e="mobile":this.props.presence&&(e=this.props.presence),e},render:function(){var e=this._getStatusName(),t=this._getPresenceIconName(e),a="icon-"+e,n={};n[a]=!0;var i=_.assign({},this.props.classNames,n);return React.createElement(o["default"],{classes:i,iconName:t,uid:this.props.uid})}}),e.exports=t["default"]},function(e,t,a){"use strict";var n=a(313);e.exports=React.createClass({displayName:"Icon",getDefaultProps:function(){return{classes:{},iconName:"chat",active:!1,uid:""}},_getClassNames:function(){return _.assign({},{"aui-icon":!0,"hipchat-icon-small":!0},this.props.classes)},render:function(){var e=this._getClassNames(),t="<svg class='"+n(e)+"' data-uid='"+this.props.uid+"'><use xlink:href='#icon-"+this.props.iconName+"'></use></svg>";return React.createElement("span",{dangerouslySetInnerHTML:{__html:t}})}})},function(e,t,a){var n,i;/*!
	  Copyright (c) 2016 Jed Watson.
	  Licensed under the MIT License (MIT), see
	  http://jedwatson.github.io/classnames
	*/
!function(){"use strict";function a(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var i=typeof n;if("string"===i||"number"===i)e.push(n);else if(Array.isArray(n))e.push(a.apply(null,n));else if("object"===i)for(var s in n)o.call(n,s)&&n[s]&&e.push(s)}}return e.join(" ")}var o={}.hasOwnProperty;"undefined"!=typeof e&&e.exports?e.exports=a:(n=[],i=function(){return a}.apply(t,n),!(void 0!==i&&(e.exports=i)))}()},function(e,t,a){e.exports=a(315)},function(e,t,a){"use strict";var n=a(316),i={shouldComponentUpdate:function(e,t){return n(this,e,t)}};e.exports=i},function(e,t,a){"use strict";function n(e,t,a){return!i(e.props,t)||!i(e.state,a)}var i=a(317);e.exports=n},function(e,t){"use strict";function a(e,t){if(e===t)return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var a=Object.keys(e),i=Object.keys(t);if(a.length!==i.length)return!1;for(var o=n.bind(t),s=0;s<a.length;s++)if(!o(a[s])||e[a[s]]!==t[a[s]])return!1;return!0}var n=Object.prototype.hasOwnProperty;e.exports=a},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(311),o=n(i),s=a(319),r=n(s),l=a(195),u=n(l),c=a(276),d=n(c),f=a(196),h=n(f),p=a(257),_=n(p),m=a(277),g=n(m),v=a(320),y=n(v),b=a(314),w=n(b),R=a(184),k=n(R);t["default"]=React.createClass({displayName:"UserStatusMenu",mixins:[w["default"]],propTypes:{web_server:React.PropTypes.string,is_guest:React.PropTypes.bool,multi_org_supported:React.PropTypes.bool,presence_show:React.PropTypes.string,presence_status:React.PropTypes.string},getDefaultProps:function(){return{active:!0}},_onSignOut:function(){u["default"].signout()},_onSettingsClick:function(){d["default"].requestPreferencesDialog()},_onLogInToAnotherTeam:function(){u["default"].logInToAnotherTeam()},_onPresenceUpdate:function(e){var t=e.currentTarget.getAttribute("data-show");_["default"].changeStatus({status:this.props.presence_status,show:t,type:"show"}),g["default"].showUserStatusMessage({anchor:document.getElementById("status_dropdown"),status:this.props.presence_status,show:t})},_shouldAllowLogIntoAnotherTeam:function(){return!this.props.is_guest&&this.props.multi_org_supported},_getSettings:function(){return React.createElement("li",{className:"settings",role:"listitem"},React.createElement("a",{id:"hc-settings",onClick:this._onSettingsClick},React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-configure"})," ",r["default"].settings))},_getLogIntoAnotherTeam:function(){return React.createElement(y["default"],{className:"hc-actions"},React.createElement("ul",{role:"list"},React.createElement("li",{className:"login-to-another-team",role:"listitem"},React.createElement("a",{id:"hc-login-team",onClick:this._onLogInToAnotherTeam},React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-list-add"})," ",r["default"].log_in_to_another_team))))},_getProfileSection:function(){return React.createElement(y["default"],null,React.createElement("ul",{role:"list"},React.createElement("li",{role:"listitem"},React.createElement("a",{onClick:this._onUserProfileClick,className:"hc-user-name",href:"https://"+this.props.web_server+"/account",target:"_blank"},r["default"].profile))))},_onUserProfileClick:function(){h["default"].editProfileClicked()},render:function(){var e=this.props.is_guest?!1:this._getSettings(),t=this.props.is_guest?null:this._getProfileSection(),a=this._shouldAllowLogIntoAnotherTeam()?this._getLogIntoAnotherTeam():!1;return React.createElement("div",{role:"application"},t,React.createElement(y["default"],{className:"hc-availability"},React.createElement("ul",{role:"list"},React.createElement("li",{className:"chat aui-inline-dialog-trigger",role:"listitem"},React.createElement("a",{id:"hc-avail","data-show":k["default"].AVAILABLE,onClick:this._onPresenceUpdate},React.createElement(o["default"],{presence:k["default"].AVAILABLE,active:this.props.active}),r["default"].available)),React.createElement("li",{className:"xa aui-inline-dialog-trigger",role:"listitem"},React.createElement("a",{id:"hc-xa","data-show":k["default"].AWAY,onClick:this._onPresenceUpdate},React.createElement(o["default"],{presence:k["default"].AWAY,active:this.props.active}),r["default"].away)),React.createElement("li",{className:"dnd aui-inline-dialog-trigger",role:"listitem"},React.createElement("a",{id:"hc-dnd","data-show":k["default"].DND,onClick:this._onPresenceUpdate},React.createElement(o["default"],{presence:k["default"].DND,active:this.props.active}),r["default"].dnd)))),React.createElement(y["default"],{className:"hc-actions"},React.createElement("ul",{role:"list"},e,React.createElement("li",{className:"signout",role:"listitem"},React.createElement("a",{id:"hc-signout",onClick:this._onSignOut},React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-devtools-checkout"})," ",r["default"].log_out)))),a)}}),e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={provide_feedback:"Provide feedback",profile:"Profile",help:"Help & Support",get_started:"Get started",keyboard_shortcuts:"Keyboard shortcuts",whats_new:"What's new",emoticon_list:"Emoticon list",status:"Status",available:"Available",away:"Away",dnd:"Do not disturb",settings:"Settings",log_out:"Log out",log_in_to_another_team:"Log in to another team",new_chat_btn_title:"New chat",invite_your_team_btn_title:"Invite your team"},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(157),o=n(i),s=a(313),r=n(s);t["default"]=React.createClass({displayName:"aui_section",propTypes:{heading:React.PropTypes.string},getDefaultProps:function(){return{heading:""}},_getHeading:function(){return this.props.heading?React.createElement("strong",{"aria-role":"presentation","class":"aui-dropdown2-heading"},this.props.heading):void 0},render:function(){var e,t={role:"presentation",className:(0,r["default"])((e={},(0,o["default"])(e,this.props.className,!!this.props.className),(0,o["default"])(e,"aui-dropdown2-section",!0),e))},a=this._getHeading;return React.createElement("div",t,a,React.createElement("div",{role:"group"},this.props.children))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(322),o=n(i),s=a(324),r=n(s),l=a(325),u=n(l),c=a(326),d=n(c),f=a(277),h=n(f),p=a(329),_=n(p),m=a(323),g=n(m),v=a(327),y=n(v),b=a(328),w=n(b),R=a(196),k=n(R);t["default"]=React.createClass({displayName:"ConnectionStatus",getInitialState:function(){return this._getState()},componentDidMount:function(){d["default"].on("change",this._onChange)},componentWillUnmount:function(){d["default"].off("change",this._onChange)},componentWillUpdate:function(e,t){this.state.status===t.status&&this.state.network_status===t.network_status||h["default"].hideInlineDialog()},shouldComponentUpdate:function(e,t){return this.state.status!==t.status||this.state.network_status!==t.network_status||this.state.status===y["default"].RECONNECT_DELAY||1===this.state.secondsToRetry&&0===t.secondsToRetry},render:function(){if(this.state.network_status===w["default"].OFFLINE)return k["default"].connectionUIStateOffline(),React.createElement(o["default"],{status:this.state.network_status});switch(this.state.status){case y["default"].RECONNECTING:return k["default"].connectionUIStateConnecting(),this._getReconnectingBanner();case y["default"].RECONNECT_DELAY:return k["default"].connectionUIStateConnectDelay(),this._getDelayBanner();case y["default"].DISCONNECTED:return k["default"].connectionUIStateCannotConnect(),React.createElement(r["default"],{status:this.state.status});default:return React.createElement("span",null)}},_getReconnectingBanner:function(){var e=React.createElement("span",null);return e=React.createElement("div",{className:"hc-header-connection reconnecting"},React.createElement("span",{className:"connection-status-icon"},React.createElement(_["default"],{spin:!0,spinner_class:"connection-spinner",size:"small",color:"white",left:"-16px",top:"-8px"})),React.createElement("span",{className:"connection-status"},g["default"].connecting))},_getDelayBanner:function(){var e=React.createElement("span",null);return e=React.createElement(u["default"],{seconds:this.state.secondsToRetry,status:this.state.status})},_getState:function(){var e=d["default"].getAll(),t=e.reconnectingIn,a=Math.round(t/1e3);return e.connection_status===y["default"].UNLOADING&&d["default"].off("change",this._onChange),{status:e.connection_status,network_status:e.network_status,msToRetry:t,secondsToRetry:a}},_onChange:function(){this.setState(this._getState())}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(277),o=n(i),s=a(323),r=n(s);t["default"]=React.createClass({displayName:"ConnectionOfflineStatus",_showInlineDialog:function(){o["default"].showConnectionStatusMessage({anchor:this.refs.banner,status:this.props.status})},_hideInlineDialog:function(){o["default"].hideInlineDialog()},render:function(){return React.createElement("div",{ref:"banner",className:"hc-header-connection disconnected aui-inline-dialog-trigger",onMouseEnter:this._showInlineDialog,onClick:this._hideInlineDialog},React.createElement("span",{className:"connection-status-icon"},React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-warning"})),React.createElement("span",{className:"connection-status"},r["default"].offline))}}),e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={connecting:"Connecting...",connecting_seconds:function(e){return"Connecting in "+e+" second"+(1!==e?"s":"")},check_network:"We're having trouble connecting to HipChat. We'll try again in a few seconds.",retry_cta:"Retry now",unable_to_connect_hipchat:function(e){return"We couldn't connect to HipChat. Check your network connection or check our <a href=\""+e+'" target="_blank">status</a>.'},cant_connect:"Couldn't connect",disconnecting:"Disconnecting",offline:"Offline",offline_status:"It looks like youâre not connected to the internet. Check your network connection."},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(277),o=n(i),s=a(323),r=n(s),l=a(215),u=n(l),c=a(196),d=n(c);t["default"]=React.createClass({displayName:"ConnectionCannotConnectStatus",_handleMouseEnter:function(){o["default"].showConnectionStatusMessage({anchor:this.refs.banner,status:this.props.status})},_handleCantConnectLinkClick:function(){u["default"].reconnect(),o["default"].hideInlineDialog(),d["default"].tryToReconnectFromHeader()},_hideInlineDialog:function(){o["default"].hideInlineDialog()},render:function(){return React.createElement("div",{ref:"banner",className:"hc-header-connection disconnected aui-inline-dialog-trigger",onMouseEnter:this._handleMouseEnter,onClick:this._hideInlineDialog},React.createElement("span",{className:"connection-status-icon"},React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-warning"})),React.createElement("span",{className:"connection-status"},r["default"].cant_connect),React.createElement("a",{className:"reconnect-now",onClick:this._handleCantConnectLinkClick},r["default"].retry_cta))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(277),o=n(i),s=a(323),r=n(s),l=a(215),u=n(l),c=a(196),d=n(c);t["default"]=React.createClass({displayName:"ConnectionCountdownStatus",propTypes:{seconds:React.PropTypes.number,minutes:React.PropTypes.number},getDefaultProps:function(){return{seconds:0,minutes:0}},_handleMouseEnter:function(){o["default"].showConnectionStatusMessage({anchor:this.refs.banner,status:this.props.status})},_handleReconnectClick:function(){u["default"].handleReconnectLinkClick(),o["default"].hideInlineDialog(),d["default"].tryToReconnectFromHeader()},_hideInlineDialog:function(){o["default"].hideInlineDialog()},_getCountdownMessage:function(){return r["default"].connecting_seconds(this.props.seconds)},render:function(){var e=this._getCountdownMessage();return React.createElement("div",{ref:"banner",className:"hc-header-connection countdown aui-inline-dialog-trigger",onMouseEnter:this._handleMouseEnter,onClick:this._hideInlineDialog},e,React.createElement("a",{className:"reconnect-now",onClick:this._handleReconnectClick},r["default"].retry_cta))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(51),h=n(f),p=a(9),m=n(p),g=a(97),v=n(g),y=a(209),b=n(y),w=a(327),R=n(w),k=a(328),E=n(k),C=function(e){function t(){(0,r["default"])(this,t);var e=(0,d["default"])(this,(0,o["default"])(t).call(this));return e._countdownTimer=new b["default"](function(){return e._countdownTimerFn()},1e3,1e3,!0),e._offlineBannerTimer=new b["default"](function(){return e._offlineBannerTimerFn()},5e3),e}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"registerListeners",value:function(){var e=this;m["default"].register({"network-up":function(){e._offlineBannerTimer.clear(),e.set({network_status:E["default"].ONLINE})},"network-down":function(){e._offlineBannerTimer.start()},"strophe-connected":function(){e._setConnectionState(R["default"].CONNECTED)},"strophe-reconnected":function(){e._setConnectionState(R["default"].CONNECTED)},"strophe-reconnecting":function(t){e._setConnectionState(R["default"].RECONNECTING,t)},"strophe-reconnect-delay":function(t){e._setConnectionState(R["default"].RECONNECT_DELAY,t),e._countdownTimer.clear().start()},"strophe-connection-failed":function(){e._setConnectionState(R["default"].DISCONNECTED)},"unload-app":function(){e._setConnectionState(R["default"].UNLOADING)},"exit-app":function(){e._setConnectionState(R["default"].UNLOADING)}})}},{key:"getDefaults",value:function(){return{connection_status:R["default"].CONNECTED,network_status:E["default"].ONLINE,reconnectingIn:0,reconnectionAttempts:0}}},{key:"_setConnectionState",value:function(e,t){this.set({connection_status:e,reconnectionAttempts:_.get(t,"reconnectAttempts")||this.data.reconnectionAttempts,reconnectingIn:_.get(t,"reconnectDelay")||this.data.reconnectingIn})}},{key:"_countdownTimerFn",value:function(){var e=this.data.reconnectingIn,t=e>1e3?e-1e3:0;this.set("reconnectingIn",t),0===t&&this._countdownTimer.clear()}},{key:"_offlineBannerTimerFn",value:function(){this.set({network_status:E["default"].OFFLINE})}}]),t}(v["default"]);t["default"]=new C,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(136),o=n(i);t["default"]=(0,o["default"])({CONNECTED:"connected",DISCONNECTED:"disconnected",RECONNECTING:"reconnecting",RECONNECT_DELAY:"reconnect-delay",UNLOADING:"unloading"}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(136),o=n(i);t["default"]=(0,o["default"])({ONLINE:"online",OFFLINE:"offline"}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(161),o=n(i),s=a(121),r=n(s);t["default"]=React.createClass({displayName:"Spinner",propTypes:{size:React.PropTypes.oneOf(["small","medium","large"]).isRequired,delay:React.PropTypes.number},componentWillUnmount:function(){this._stopSpinner()},componentWillUpdate:function(){this._stopSpinner()},getDefaultProps:function(){return{size:"medium",zIndex:100,ref:"spinner",delay:0}},componentDidMount:function(){this._setSpinner()},componentDidUpdate:function(){this._setSpinner()},_getSpinner:function(){return ReactDOM.findDOMNode(this)},_setSpinner:function(){var e;this.props.spin?(e=this._getOptions(),this._startSpinner(this.props.size,e)):this._stopSpinner()},_getColor:function(){var e=o["default"].getTheme();return r["default"].spinner_colors[e]},_getOptions:function(){var e=_.clone(this.props);return e.color||(e.color=this._getColor()),e},_startSpinner:function(e,t){var a=AJS.$(this._getSpinner());this.props.delay>0?this.timer=setTimeout(function(){a.spin(e,t)},this.props.delay):a.spin(e,t)},_stopSpinner:function(){this.timer&&(this.timer=clearTimeout(this.timer)),AJS.$(this._getSpinner()).spinStop()},render:function(){return React.createElement("div",{className:"hc-spinner "+(this.props.spinner_class?this.props.spinner_class:""),ref:this.props.ref})}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(319),o=n(i),s=a(276),r=n(s),l=a(279),u=n(l),c=a(95),d=n(c),f=a(169),h=n(f),p=a(121),m=n(p),g=a(99),v=n(g);t["default"]=React.createClass({displayName:"HelpMenuContent",getInitialState:function(){return this._getState()},componentDidMount:function(){h["default"].on(["change:web_server","change:feature_flags"],this._onChange)},componentWillUnmount:function(){h["default"].off(["change:web_server","change:feature_flags"],this._onChange)},_onChange:function(){this.setState(this._getState())},_getState:function(){var e=h["default"].get("client_subtype");return{web_server:h["default"].get("web_server"),isWindows:v["default"].clientSubType.isWindows(e),isMac:v["default"].clientSubType.isMac(e),isNative:v["default"].clientSubType.isNative(e),isBTF:_.get(h["default"].get("feature_flags"),"btf",!1)}},_onKeyboardShortcutsClick:function(){var e=u["default"].getKeyCommands();d["default"].showKeyboardShortcutsDialog(e)},_onWhatsNewClick:function(){r["default"].requestReleaseNotesDialog()},_getOnlineHelp:function(){return React.createElement("li",null,React.createElement("a",{className:"hc-online-help",href:m["default"].help_link_url,target:"_blank"},o["default"].help))},_getGetStartedLink:function(){return React.createElement("li",null,React.createElement("a",{className:"hc-get-started",href:m["default"].get_started_url,target:"_blank"},o["default"].get_started))},_getKeyboardShortcutsLink:function(){return React.createElement("li",null,React.createElement("a",{className:"hc-keyboard-shortcuts",onClick:this._onKeyboardShortcutsClick},o["default"].keyboard_shortcuts))},_getEmoticonListLink:function(){var e="https://"+this.state.web_server+"/emoticons";return React.createElement("li",null,React.createElement("a",{className:"hc-emoticon-list-link",href:e,target:"_blank"},o["default"].emoticon_list))},_getWhatsNewLink:function(){return this.state.isNative||this.state.isBTF?null:React.createElement("li",null,React.createElement("a",{id:"whats-new",onClick:this._onWhatsNewClick},o["default"].whats_new))},_getStatusLink:function(){return React.createElement("li",null,React.createElement("a",{className:"hc-status-page-link",href:m["default"].status_page_url,target:"_blank"},o["default"].status))},_getFeedbackLink:function(){return React.createElement("li",null,React.createElement("a",{id:"give-feedback",href:m["default"].feedback_issue_url,target:"_blank"},o["default"].provide_feedback))},render:function(){var e=this._getOnlineHelp(),t=this.props.read_only_mode?!1:this._getGetStartedLink(),a=this._getKeyboardShortcutsLink(),n=this.state.isBTF?!1:this._getStatusLink(),i=this.props.read_only_mode?!1:this._getEmoticonListLink(),o=!this.state.isBTF&&!this.state.isNative&&!this.props.read_only_mode,s=o?this._getWhatsNewLink():!1,r=this.props.read_only_mode?!1:this._getFeedbackLink();return React.createElement("div",{className:"aui-dropdown2-section"},React.createElement("ul",null,e,t,a,i,s,n,r))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(276),o=n(i),s=a(196),r=n(s),l=a(99),u=n(l),c=a(313),d=n(c),f=a(121),h=n(f);t["default"]=React.createClass({displayName:"SearchInput",componentDidMount:function(){this._shouldFocus()},componentDidUpdate:function(){this._shouldFocus()},_shouldFocus:function(){var e=ReactDOM.findDOMNode(this.refs.searchInput);this.props.focus_search&&e&&this._focusAndSelect(e)},_focusAndSelect:function(e){e!==document.activeElement&&(e.focus(),e.select())},render:function(){var e=(0,d["default"])({mousetrap:!0});return React.createElement("div",{className:"aui-quicksearch"},React.createElement("input",{id:"search-query",tabIndex:"-1",type:"text",className:e,placeholder:"Search history",name:"name",autoComplete:"off","data-tipsify-ignore":!0,"aria-label":"Search for something",ref:"searchInput",onKeyDown:this._onKeyDown,onChange:this._onChange,onBlur:this._onBlur,onFocus:this._onFocus,value:this.props.text}))},_onKeyDown:function(e){e.keyCode===u["default"].keyCode.Enter?(this.props.search_enabled?o["default"].searchHistory(this.props.jid,this.props.text):o["default"].searchHistoryExternally(this.props.jid,this.props.text),r["default"].searchInputSubmitted(this.props.jid)):e.keyCode===u["default"].keyCode.Esc&&(o["default"].setSearchText({text:""}),"search"!==this.props.jid&&this._focusOnMessageInput())},_focusOnMessageInput:function(){document.getElementById(""+h["default"].chat_input_id).focus()},_onChange:function(e){o["default"].setSearchText({text:e.target.value})},_onBlur:function(){o["default"].searchBlurred()},_onFocus:function(){r["default"].searchInputClicked()}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(157),o=n(i),s=a(313),r=n(s);t["default"]=React.createClass({displayName:"AUIDropdown2Trigger",propTypes:{type:React.PropTypes.oneOf(["a","link","button"]),dropdownID:React.PropTypes.string.isRequired,arrowless:React.PropTypes.bool,disabled:React.PropTypes.bool,alignmentContainer:React.PropTypes.string,hideLocation:React.PropTypes.string},getDefaultProps:function(){return{type:"button",arrowless:!1,disabled:!1}},render:function(){var e,t={id:this.props.id||_.uniqueId(),href:"#"+this.props.dropdownID,"aria-owns":this.props.dropdownID,title:this.props.title||"","aria-label":this.props["aria-label"]||this.props.title||"","aria-controls":this.props.dropdownID,"aria-disabled":this.props.disabled,"aria-haspopup":!0,className:(0,r["default"])((e={},(0,o["default"])(e,this.props.className,!!this.props.className),(0,o["default"])(e,"aui-dropdown2-trigger",!0),(0,o["default"])(e,"aui-dropdown2-trigger-arrowless",this.props.arrowless),e))};switch(this.props.alignmentContainer&&(t["data-container"]=this.props.alignmentContainer,t["data-aui-alignment-container"]=this.props.alignmentContainer),this.props.hideLocation&&(t["data-dropdown2-hide-location"]=this.props.hideLocation),this.props.type){case"a":case"link":return React.createElement("a",t,this.props.children);case"button":default:return React.createElement("button",t,this.props.children)}}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(157),o=n(i),s=a(313),r=n(s);t["default"]=React.createClass({displayName:"AUIDropdown2",propTypes:{dropdownID:React.PropTypes.string.isRequired,onShow:React.PropTypes.func,onHide:React.PropTypes.func},getDefaultProps:function(){return{onShow:_.noop,onHide:_.noop}},componentDidMount:function(){AJS.$(this._getDropdownElement()).on({"aui-dropdown2-show":this.renderDropdownContents,"aui-dropdown2-hide":this.removeDropdownContents})},componentWillUnmount:function(){this.removeDropdownContents(),AJS.$(this._getDropdownElement()).off()},shouldComponentUpdate:function(){return!1},render:function(){var e,t={id:this.props.dropdownID,"aria-hidden":"true",role:"menu",className:(0,r["default"])((e={},(0,o["default"])(e,this.props.className,!!this.props.className),(0,o["default"])(e,"aui-dropdown2",!0),(0,o["default"])(e,"aui-style-default",!0),e)),dangerouslySetInnerHTML:{__html:this._getStaticDropdownDOM()}};return React.createElement("div",t)},invokeTrigger:function(){AJS.$('[aria-owns="'+this.props.dropdownID+'"]').trigger("aui-button-invoke")},renderDropdownContents:function(){ReactDOM.render(this.props.children,this._getDropdownElement()),AJS.$(window).one("resize",this.invokeTrigger),this.props.onShow()},removeDropdownContents:function(){AJS.$(window).off("resize",this.invokeTrigger),ReactDOM.unmountComponentAtNode(this._getDropdownElement()),AJS.$(this._getDropdownElement()).empty().html(this._getStaticDropdownDOM()),this.props.onHide()},_getDropdownElement:function(){return document.getElementById(this.props.dropdownID)},_getStaticDropdownDOM:function(){return ReactDOMServer.renderToStaticMarkup(this.props.children)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.STORAGE_KEY=void 0;var i=a(191),o=n(i),s=a(10),r=n(s),l=a(4),u=n(l),c=a(5),d=n(c),f=a(22),h=n(f),p=a(51),m=n(p),g=a(97),v=n(g),y=a(9),b=n(y),w=a(121),R=n(w),k=a(335),E=n(k),C=a(204),S=n(C),T=a(99),x=n(T),A=a(90),I=n(A),N=t.STORAGE_KEY="hc.read-only-dismissed",M=function(e){function t(){(0,u["default"])(this,t);var e=(0,h["default"])(this,(0,r["default"])(t).call(this));return e.local={},e}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"getDefaults",value:function(){return{read_only_mode:!1,read_only_input_markdown:"",feature_flag_enabled:!1,alert_flag:{},is_fetching:!1,is_fetched:!1,is_visible:!1,is_dismissed:this.getStorage(),is_flag_pending:!1,title:"",text:"",icon_url:"",button_text:"",button_url:"",continue_text:"",continue_button:"Continue",questions_markdown:"",contact_markdown:""}}},{key:"registerListeners",value:function(){var e=this;b["default"].registerOnce({"hc-init":function(t){e.handleConfig(t)}}),b["default"].register({"updated:config":function(t){e.handleConfig(t)},"dismiss-alert-flag":function(){e.handleDismissAlertFlag()},"dismiss-read-only-modal":function(){e.handleDismissModal()},"API:fetch-read-only-content-success":function(t){e.handleReadOnlyContentSuccess(t)},"API:fetch-read-only-content-failure":function(t){e.handleReadOnlyContentFailure(t)},"API:fetch-alert-flag-success":function(t){e.handleAlertFlagSuccess(t)},"API:fetch-alert-flag-failed":function(t){e.handleAlertFlagFailure(t)}})}},{key:"handleConfig",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.set({read_only_mode:x["default"].coerceBoolean(_.get(e,"read_only_mode"),!1),read_only_input_markdown:_.get(e,"read_only_input_markdown",""),feature_flag_enabled:_.get(e,"feature_flags.web_client_migration_flags",!1)});var t=this.data,a=t.read_only_mode,n=t.is_fetching,i=t.is_fetched,o=t.is_dismissed,s=!n&&!i&&!o;a&&s&&(this.set({is_fetching:!0,is_visible:!0}),setTimeout(function(){I["default"].log("[ReadOnly] Fetching interstitial content"),b["default"].dispatch("API:fetch-read-only-content")},0)),this.checkForAlertFlag(1e3)}},{key:"checkForAlertFlag",value:function(){var e=arguments.length<=0||void 0===arguments[0]?R["default"].alert_flag_poll_interval:arguments[0],t=this.data.alert_flag&&void 0!==this.data.alert_flag.id;!this.data.feature_flag_enabled||this.data.is_flag_pending||t||(I["default"].log("[ReadOnly] Checking for Alert Flag in %sms",e),clearTimeout(this.local.timer),this.set({is_flag_pending:!0}),this.local.timer=setTimeout(function(){b["default"].dispatch("API:fetch-alert-flag")},e))}},{key:"handleAlertFlagSuccess",value:function(e){if(I["default"].log("[ReadOnly] Alert Flag fetch success",e),this.set({is_flag_pending:!1}),!e||void 0===e.id)return I["default"].log("[ReadOnly] Alert Flag response included no or malformed data; will retry..."),void this.checkForAlertFlag();var t=this.data.alert_flag?this.data.alert_flag.id:void 0,a=void 0!==t;if(!this.data.feature_flag_enabled||a)return void I["default"].log("[ReadOnly] Alert Flag already displayed. id: %s",t);var n=new E["default"](e);this.set({alert_flag:n}),b["default"].dispatch("show-flag",(0,o["default"])({},n,{close:"manual",onClose:function(){S["default"].dismissAlertFlag()}}))}},{key:"handleAlertFlagFailure",value:function(e){I["default"].log("[ReadOnly] Alert Flag fetch failure",e),this.set({is_flag_pending:!1}),this.checkForAlertFlag()}},{key:"handleDismissAlertFlag",value:function(){var e=this.data.alert_flag.id;void 0!==e&&(I["default"].log("[ReadOnly] Dismissing Alert Flag",e),b["default"].dispatch("API:dismiss-alert-flag",{id:e}),this.set({alert_flag:{}}),this.checkForAlertFlag())}},{key:"handleReadOnlyContentSuccess",value:function(e){I["default"].log("[ReadOnly] Interstitial content fetch success",e),this.set((0,o["default"])({is_fetching:!1,is_fetched:!0,is_visible:!this.data.is_dismissed},e))}},{key:"handleReadOnlyContentFailure",value:function(e){I["default"].log("[ReadOnly] Interstitial content fetch failure",e),this.set({is_fetching:!1,is_fetched:!0,is_visible:!1})}},{key:"handleDismissModal",value:function(){I["default"].log("[ReadOnly] Dismiss interstitial"),this.setStorage(),this.set({is_visible:!1,is_dismissed:!0})}},{key:"getStorage",value:function(e){return!!window.localStorage.getItem(N)}},{key:"setStorage",value:function(e,t){return window.localStorage.setItem(N,1)}}]),t}(v["default"]);t["default"]=new M},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t={blue:"info",green:"success",yellow:"warning",red:"error"};return _.transform(e,function(e,a,n){switch(n){case"id":e.id=_.isNaN(a)?null:parseInt(a,10);break;case"color":e.type=t[a]||"info";break;case"title":case"body":case"image_url":case"link_url":case"link_text":e[n]=String(a)}})}Object.defineProperty(t,"__esModule",{value:!0});var o=a(148),s=n(o),r=a(52),l=n(r),u=a(4),c=n(u),d=function f(){var e=arguments.length<=0||void 0===arguments[0]?(0,l["default"])(null):arguments[0];(0,c["default"])(this,f),(0,s["default"])(this,i(e))};t["default"]=d,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(276),o=n(i),s=a(337),r=n(s),l=a(9),u=n(l),c=a(121),d=n(c),f=a(314),h=n(f);t["default"]=React.createClass({displayName:"NotificationBanner",mixins:[h["default"]],propTypes:{ready:React.PropTypes.bool.isRequired,notification_permission:React.PropTypes.bool.isRequired,notification_preference:React.PropTypes.bool.isRequired,notification_dismissed:React.PropTypes.oneOfType([React.PropTypes.bool,React.PropTypes.number]).isRequired},getInitialState:function(){return{dismissed:!1}},componentDidMount:function(){this.props.notification_preference&&!this.props.notification_permission&&this._updateBannerState(!0)},componentWillReceiveProps:function(e){this.state.dismissed||(!this.props.notification_preference&&e.notification_preference?this._updateBannerState(!0):this.props.notification_preference&&!e.notification_preference&&this._updateBannerState(!1))},render:function(){return React.createElement("div",{className:"aui-banner hc-banner-warning",role:"banner","aria-hidden":"false"},r["default"].banner_message,"Â ",React.createElement("a",{onClick:this._enableNotifications,ref:"enable_btn",className:"enable"},r["default"].enable_link)," ",this.props.notification_dismissed>0?r["default"].seriously_recommended:r["default"].recommended,React.createElement("strong",null,"Â Â Â·Â Â "),React.createElement("a",{onClick:this._dismiss,ref:"dismiss_btn"},r["default"].dismiss_link),this.props.notification_dismissed>0?React.createElement("span",null,React.createElement("strong",null,"Â Â Â·Â Â "),React.createElement("a",{onClick:this._dismissForever,
ref:"dismiss_forever_btn"},r["default"].dismiss_forever_link)):React.createElement("span",null))},_updateBannerState:function(e){_.delay(function(){u["default"].dispatch("position-app-header-dialogs"),u["default"].dispatch("notification-banner-status",{shown:e})},d["default"].notification_banner_slide)},_enableNotifications:function(){this._hideBanner(),o["default"].requestNotificationPermission()},_dismiss:function(){this._hideBanner(),o["default"].dismissNotificationBanner()},_dismissForever:function(){this._hideBanner(),o["default"].dismissNotificationBannerForever()},_hideBanner:function(){this.setState({dismissed:!0}),u["default"].dispatch("notification-banner-status",{shown:!1})}}),e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={banner_message:"Don't miss out on all those important messages.",enable_link:"Enable desktop notifications",dismiss_link:"Not right now",dismiss_forever_link:"Don't ask me again",recommended:"(Recommended)",seriously_recommended:"(We seriously recommend this)"},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){var t=window.Event?e.which:e.keyCode;27===t&&o.hideInlineDialog()}function i(e){var t=$(e.target);0===t.closest(".aui-inline-dialog-trigger").length&&0===t.parents(".aui-inline-dialog").length&&o.hideInlineDialog()}var o=a(277);e.exports={componentDidMount:function(){window.addEventListener("keydown",n),window.addEventListener("click",i)},componentWillUnmount:function(){window.removeEventListener("keydown",n),window.removeEventListener("click",i)},_onKeyDown:n}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(191),o=n(i),s=a(284),r=n(s),l=a(340),u=n(l),c=a(121),d=n(c),f=a(359),h=n(f),p=a(370),_=n(p),m=a(372),g=n(m),v=a(375),y=n(v),b=a(377),w=n(b),R=a(379),k=n(R),E=a(380),C=n(E),S=a(381),T=n(S),x=a(382),A=n(x),I=a(384),N=n(I),M=a(394),O=n(M),D=a(404),P=n(D),j=a(406),L=n(j),F=a(407),U=n(F),H=a(409),B=n(H),z=a(410),q=n(z),V=a(412),G=n(V),W=a(438),$=n(W),Y=a(443),K=n(Y),X=a(445),J=n(X),Q=a(454),Z=n(Q),ee=a(455),te=n(ee),ae=a(464),ne=n(ae);t["default"]=React.createClass({displayName:"ModalDialogContainer",componentDidMount:function(){r["default"].on("change",this._onChange)},componentWillUnmount:function(){r["default"].off("change",this._onChange)},getInitialState:function(){return r["default"].getAll()},_onChange:function(){this.setState(r["default"].getAll())},_getDialogBackdrop:function(){var e=this.state.dialogData||{},t=e.bgDismiss===!1?e.bgDismiss:d["default"].default_backdrop_dismiss_on_click;return React.createElement(ne["default"],{btnLoading:this.state.btnLoading,bgDismiss:t})},_getDialog:function(){var e=r["default"].getCurrentModalDialog(),t=!1;if(e)switch(e){case"room-notifications-dialog":t=React.createElement(U["default"],this.state.dialogData);break;case"settings-dialog":t=React.createElement(u["default"],this.state.dialogData);break;case"invite-users-dialog":t=React.createElement(h["default"],this.state.dialogData);break;case"remove-users-dialog":t=React.createElement(_["default"],this.state.dialogData);break;case"create-room-dialog":t=React.createElement(g["default"],(0,o["default"])({},this.state.dialogData,{btnLoading:this.state.btnLoading}));break;case"room-privacy-dialog":t=React.createElement(y["default"],(0,o["default"])({},this.state.dialogData,{btnLoading:this.state.btnLoading}));break;case"rename-room-dialog":t=React.createElement(w["default"],(0,o["default"])({},this.state.dialogData,{btnLoading:this.state.btnLoading}));break;case"delete-room-dialog":t=React.createElement(k["default"],(0,o["default"])({},this.state.dialogData,{btnLoading:this.state.btnLoading}));break;case"room-invite-dialog":t=React.createElement(C["default"],this.state.dialogData);break;case"archive-room-dialog":t=React.createElement(T["default"],this.state.dialogData);break;case"disable-guest-dialog":t=React.createElement(L["default"],this.state.dialogData);break;case"addon-dialog":t=React.createElement(N["default"],this.state.dialogData);break;case"invite-teammates-dialog":t=React.createElement(P["default"],(0,o["default"])({},this.state.dialogData,{web_server:this.state.web_server}));break;case"keyboard-shortcuts-dialog":t=React.createElement(B["default"],this.state.dialogData);break;case"release-notes-dialog":t=React.createElement(q["default"],this.state.dialogData);break;case"quick-switcher-dialog":t=React.createElement(O["default"],this.state.dialogData);break;case"integration-dialog":t=React.createElement(G["default"],this.state.dialogData);break;case"desktop-4-dialog":t=React.createElement(A["default"],this.state.dialogData);break;case"integrations-management-dialog":t=React.createElement($["default"],this.state.dialogData);break;case"edit-message-dialog":t=React.createElement(K["default"],this.state.dialogData);break;case"delete-message-dialog":t=React.createElement(J["default"],this.state.dialogData);break;case"not-editable-dialog":t=React.createElement(Z["default"],this.state.dialogData);break;case"welcome-dialog":t=React.createElement(te["default"],this.state.dialogData)}return t},render:function(){var e,t=this._getDialog();return t&&(e=this._getDialogBackdrop()),React.createElement("div",{key:this.state.activeDialog},t,e)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(157),o=n(i),s=a(100),r=n(s),l=a(341),u=n(l),c=a(343),d=n(c),f=a(344),h=n(f),p=a(345),m=n(p),g=a(348),v=n(g),y=a(169),b=n(y),w=a(161),R=n(w),k=a(265),E=n(k),C=a(164),S=n(C),T=a(203),x=n(T),A=a(166),I=n(A),N=a(351),M=n(N),O=a(352),D=n(O),P=a(354),j=n(P),L=a(355),F=n(L),U=a(356),H=n(U),B=a(358),z=n(B),q=a(99),V=n(q),G=a(93),W=n(G);t["default"]=React.createClass({displayName:"SettingsDialog",componentDidMount:function(){R["default"].on("change",this._onChange),b["default"].on("change",this._onChange),document.querySelector("body").addEventListener("keydown",this._onKeyDown)},componentWillUnmount:function(){R["default"].off("change",this._onChange),b["default"].off("change",this._onChange),document.querySelector("body").removeEventListener("keydown",this._onKeyDown)},_onChange:function(){this.setState(this._getState()),this.setState({dirty:!0})},getInitialState:function(){var e=this._getState(),t={errors:{},dirty:!1};return _.merge(e,t)},_getState:function(){var e={},t=R["default"].getAll();return _.assign(e,t,{feature_flags:b["default"].get("feature_flags"),client_subtype:b["default"].get("client_subtype"),display_name:b["default"].get("display_name"),group_name:b["default"].get("group_name")}),e},_isWindows:function(){return V["default"].clientSubType.isWindows(this.state.client_subtype)},_isLinux:function(){return V["default"].clientSubType.isLinux(this.state.client_subtype)},_isMac:function(){return V["default"].clientSubType.isMac(this.state.client_subtype)},_isNative:function(){return V["default"].clientSubType.isNative(this.state.client_subtype)},_getGeneralPanel:function(){var e=this._getGeneralPanelNativeOptions(),t=this._getAttachedCardsOption();return React.createElement(h["default"],{name:x["default"].general,key:"general-settings-panel"},React.createElement("form",{className:"aui",onSubmit:this._onSubmit},React.createElement(m["default"],{id:S["default"].HIDE_PRESENCE_MESSAGES,label:x["default"].hide_presence_messages,value:"false",isReverse:!0}),React.createElement(m["default"],{id:S["default"].USE_24_HR_FORMAT,label:x["default"].use_24_hour_format}),t,React.createElement(m["default"],{id:I["default"].HIDE_GIFS_BY_DEFAULT,label:x["default"].hide_gifs_by_default}),React.createElement(m["default"],{id:I["default"].REPLACE_TEXT_EMOTICONS,label:x["default"].replace_text_emoticons}),React.createElement(m["default"],{id:I["default"].SHOW_UNREAD_DIVIDER,label:x["default"].show_unread_divider}),e))},_getGeneralPanelNativeOptions:function(){var e=[];return this._isWindows()&&e.push(this._getWindowsGeneralOptions()),this._isNative()&&e.push(this._getNativeGeneralOptions()),this._isMac()&&e.push(this._getMacGeneralOptions()),e},_getAttachedCardsOption:function(){return _.get(this.state.feature_flags,"web_client_attach_to_collapsable_enabled")?React.createElement(m["default"],{id:I["default"].HIDE_ATTACHED_CARDS_BY_DEFAULT,label:x["default"].hide_attached_cards_by_default}):void 0},_getWindowsGeneralOptions:function(){return[React.createElement(m["default"],{id:I["default"].LAUNCH_WITH_OS_STARTUP,label:x["default"].start_up_with_windows})]},_getMacGeneralOptions:function(){return[React.createElement(m["default"],{id:I["default"].ENABLE_AUTOCORRECT,label:x["default"].enable_autocorrect})]},_getNativeGeneralOptions:function(){return[React.createElement(M["default"],null,React.createElement(m["default"],{id:S["default"].ENABLE_IDLE,label:x["default"].idle}),React.createElement(D["default"],{id:S["default"].IDLE_MINUTES,key:S["default"].IDLE_MINUTES,label:x["default"].minutes,labelPosition:"right",size:"short-field",defaultValue:this.state[S["default"].IDLE_MINUTES],error:this.state.errors[S["default"].IDLE_MINUTES],type:"text",onChange:this._trackUnsavedChanges,onBlur:this._onPreferenceChanged})),React.createElement(m["default"],{id:I["default"].ENABLE_LOGGING,label:x["default"].enable_logging}),React.createElement(m["default"],{id:I["default"].ENABLE_SPELL_CHECK,label:x["default"].enable_spell_check})]},_getAppearancePanel:function(){var e=React.createElement("span",{name:x["default"].appearance}),t=null;return b["default"].get("feature_flags").web_client_freeze_gifs&&(t=React.createElement(v["default"],{id:I["default"].ANIMATED_AVATARS,label:x["default"].animated_avatars,options:R["default"].getAnimatedAvatarsOptions()})),(this.state.feature_flags&&this.state.feature_flags.web_client_appearance_settings||"production"!==HC.ENV||this._isNative())&&(e=React.createElement(h["default"],{name:x["default"].appearance,key:"appearance-settings-panel"},React.createElement("form",{className:"aui"},React.createElement(v["default"],{id:S["default"].THEME,label:x["default"].theme,options:R["default"].getThemeOptions()}),React.createElement(v["default"],{id:S["default"].DENSITY,label:x["default"].density,options:R["default"].getDensityOptions()}),React.createElement(v["default"],{id:S["default"].CHAT_VIEW,label:x["default"].chat_view,options:R["default"].getChatViewOptions()}),React.createElement(v["default"],{id:S["default"].NAME_DISPLAY,label:x["default"].name_display,options:R["default"].getNameDisplayOptions()}),t))),e},_getNotificationsPanel:function(){var e,t,a,n=_.get(this.state,"feature_flags.web_client_video_chat",!1),i=_.get(this.state,"feature_flags.web_client_per_room_notifications",!1),o=this._getRoomNotificationSettings(i),s=this._getNativeNotificationSettings(),r=this._getSoundsField(n);return i&&(a=React.createElement(m["default"],{id:S["default"].NOTIFY_FOR_PRIVATE,label:x["default"].notify_for_oto_per_room_enabled})),n?e=React.createElement(z["default"],{notifyForVideo:this.state[S["default"].NOTIFY_FOR_VIDEO_WHEN_DND],notifyAlways:this.state[S["default"].NOTIFY_WHEN_DND]}):t=React.createElement(m["default"],{id:S["default"].NOTIFY_WHEN_DND,label:x["default"].do_not_notify_when_dnd_basic}),React.createElement(h["default"],{name:x["default"].notifications,key:"notifications-settings-panel"},React.createElement("form",{className:"aui"},r,a,s,React.createElement(m["default"],{id:S["default"].SHOW_TOASTERS,label:x["default"].show_toasters}),t),o,e)},_getSoundsField:function(e){var t;return t=e?React.createElement(F["default"],{soundsEnabled:this.state[S["default"].SOUNDS_ENABLED],messageSounds:this.state[S["default"].MESSAGE_SOUNDS],videoSounds:this.state[S["default"].VIDEO_SOUNDS]}):React.createElement(m["default"],{id:S["default"].SOUNDS_ENABLED,label:x["default"].basic_play_sound})},_getRoomNotificationSettings:function(e){return e?React.createElement(H["default"],null):React.createElement("form",{className:"aui"},React.createElement("h3",null,x["default"].notify_when_header),React.createElement(m["default"],{id:S["default"].NOTIFY_FOR_ROOM,label:x["default"].notify_for_room}),React.createElement(m["default"],{id:S["default"].NOTIFY_FOR_PRIVATE_ROOM,label:x["default"].notify_for_private_room}),React.createElement(m["default"],{id:S["default"].NOTIFY_FOR_TAG,label:x["default"].notify_for_tag}),React.createElement(m["default"],{id:S["default"].NOTIFY_FOR_PRIVATE,label:x["default"].notify_for_oto}))},_getNativeNotificationSettings:function(){return this._isWindows()?[React.createElement(m["default"],{id:I["default"].KEEP_POPUPS_VISIBLE,label:x["default"].keep_popups_visible}),React.createElement(m["default"],{id:I["default"].BLINK_TASKBAR,label:x["default"].blink_taskbar})]:this._isLinux()?[React.createElement(m["default"],{id:I["default"].KEEP_POPUPS_VISIBLE,label:x["default"].keep_popups_visible})]:this._isMac()?[React.createElement(j["default"],{bounceIcon:this.state.bounceIcon,bounceOnce:this.state.bounceOnce})]:void 0},_getConnectionPanel:function(){return React.createElement(h["default"],{name:x["default"].connection,key:"connection-settings-panel"},React.createElement("p",null,x["default"].proxy_settings_description(this.state.display_name)),React.createElement("br",null),React.createElement("button",{className:"aui-button aui-button-primary","aria-disabled":this.props.btnLoading,onClick:this._onClickProxySettings},x["default"].proxy_settings(this.state.display_name)))},_dialogBody:function(){var e=this._getGeneralPanel(),t=this._getAppearancePanel(),a=this._getNotificationsPanel(),n=this._getConnectionPanel(),i=[e,t,a];return this._isWindows()&&i.push(n),React.createElement(d["default"],{onChange:this._onPreferenceChanged,defaultTab:this.props.activeTab},i)},trackedPreferences:{},_trackUnsavedChanges:function(e){e.stopPropagation(),this.trackedPreferences[e.target.id]=e.target.value},_onKeyDown:function(e){var t=this,a=window.Event?e.which:e.keyCode;a===V["default"].keyCode.Esc&&_.forEach(this.trackedPreferences,function(e,a){var n={id:a,value:e,type:"text"};t._onPreferenceChanged({target:n})})},_getPreference:function(e){var t={};switch(e.type){case"radio":var a=document.querySelector("input[name='"+e.name+"']:checked");t[e.name]=a.id;break;case"checkbox":var n="true"===e.value;t[e.id]=e.checked?n:!n;break;case"text":t[e.id]=e.value}return t},_onPreferenceChanged:function(e){var t=e.target,a=this._getPreference(t),n=this._validate(t);n&&(E["default"].savePreferences(a),W["default"].onPreferencesUpdated(a))},_validate:function(e){var t=e.value;if((0,r["default"])(this.state.errors).length&&this._clearErrors(),e.id===S["default"].IDLE_MINUTES){if(!+t)return this.setState({errors:(0,o["default"])({},S["default"].IDLE_MINUTES,x["default"].minimum_idle_minutes)}),!1;if(0>+t)return this.setState({errors:(0,o["default"])({},S["default"].IDLE_MINUTES,x["default"].minimum_idle_minutes)}),!1;if(+t>99)return this.setState({errors:(0,o["default"])({},S["default"].IDLE_MINUTES,x["default"].maximum_idle_minutes)}),!1}return!0},_clearErrors:function(){this.setState({errors:{}})},_onSubmit:function(e){e.preventDefault()},_onClickProxySettings:function(){W["default"].buttonClickedProxySettings&&W["default"].buttonClickedProxySettings()},render:function(){return React.createElement(u["default"],{dialogId:"settings-dialog",title:x["default"].title_settings(this.state.group_name),dialogBody:this._dialogBody,noCloseLink:!0})}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(95),o=n(i),s=a(342),r=n(s),l=a(203),u=n(l),c=a(329),d=n(c),f=a(121),h=n(f),p=a(99),m=n(p),g=a(313),v=n(g);t["default"]=React.createClass({displayName:"ModalDialog",propTypes:{size:React.PropTypes.oneOf(["small","medium","large","xlarge"])},mixins:[r["default"]],componentDidMount:function(){document.querySelector("body").addEventListener("keydown",this._onKeyDown)},componentWillUnmount:function(){document.querySelector("body").removeEventListener("keydown",this._onKeyDown)},getDefaultProps:function(){return{closeLinkText:u["default"].close,dialogId:"dialog",dialogBody:_.noop,dialogFooterButton:_.noop,dialogFooterLinks:_.noop,dialogFilter:!1,dialogFilterPlaceholder:"",dialogFilterCallback:_.noop,btnLoading:!1,size:"medium",hint:"",isWarning:!1,showFooter:!0}},_getTitle:function(){var e;return e=this.props.lozenge_text?React.createElement("h2",{className:"aui-dialog2-header-main"},this.props.title,React.createElement("span",{className:"aui-lozenge aui-lozenge-current"},this.props.lozenge_text)):React.createElement("h2",{className:"aui-dialog2-header-main"},this.props.title)},_getSecondaryHeader:function(){var e=!1;return this.props.dialogFilter&&(e=React.createElement("div",{className:"aui-dialog2-header-secondary"},React.createElement("form",{className:"aui",action:"#"},React.createElement("input",{className:"text",type:"search",name:"search",placeholder:this.props.dialogFilterPlaceholder,onChange:this.props.dialogFilterCallback})))),e},_getHint:function(){var e;return e=this.props.noHint?!1:React.createElement("div",{className:"aui-dialog2-footer-hint"},this.props.hint)},_getCloseBtn:function(){var e;return e=this.props.btnLoading?!1:React.createElement("a",{className:"aui-dialog2-header-close",onClick:this._onClickClose},React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-close-dialog"},u["default"].close))},_getCloseLink:function(){var e;return e=this.props.noCloseLink?!1:React.createElement("button",{className:"aui-button aui-button-link","aria-disabled":this.props.btnLoading,onClick:this._onClickClose},this.props.closeLinkText)},_getSectionStyle:function(){var e={};return this.props.customWidth&&(e={width:this.props.customWidth}),e},_getDialogContentStyle:function(){var e={};return this.props.customHeight&&(e={height:this.props.customHeight}),e},close:function(){o["default"].closeDialog()},_onKeyDown:function(e){var t=window.Event?e.which:e.keyCode;t!==m["default"].keyCode.Esc||this.props.btnLoading||this.close()},_onClickClose:function(){this.props.btnLoading||this.close()},_getFooter:function(){var e=this._getCloseLink(),t=this._getHint();return React.createElement("footer",{className:"aui-dialog2-footer"},React.createElement("div",{className:"aui-dialog2-footer-actions"},React.createElement("div",{className:"hc-dialog-btn-spinner"},React.createElement(d["default"],{spin:this.props.btnLoading,size:"small",color:h["default"].spinner_colors.light})),this.props.dialogFooterButton(),this.props.dialogFooterLinks(),e),t)},render:function(){var e=this._getCloseBtn(),t=this.props.showFooter?this._getFooter():null,a=this._getTitle(),n=this._getSecondaryHeader(),i=(0,v["default"])({"aui-layer":!0,"aui-dialog2":!0,"aui-dialog2-warning":this.props.isWarning},"aui-dialog2-"+this.props.size);return React.createElement("section",{role:"dialog",id:this.props.dialogId,className:i,style:this._getSectionStyle(),"aria-hidden":!this.state.dialogVisible},React.createElement("header",{className:"aui-dialog2-header"},a,n,e),React.createElement("div",{className:"aui-dialog2-content hc-dialog-content",style:this._getDialogContentStyle()},this.props.dialogBody()),t)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(284),o=n(i);t["default"]={getInitialState:function(){return o["default"].getAll()},_onChange:function(){this.isMounted()&&this.setState(o["default"].getAll())},componentWillMount:function(){o["default"].on("change",this._onChange)},componentWillUnmount:function(){o["default"].off("change",this._onChange)}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(191),o=n(i),s=a(344),r=n(s),l=a(313),u=n(l),c=a(203),d=n(c),f=a(196),h=n(f);t["default"]=React.createClass({displayName:"NavPanel",propTypes:{children:function(e,t){return e[t].length<2?new Error("NavPanel component requires more than one tab (child components)"):_.every(e[t],function(e){return e.props.name})?void 0:new Error("All NavPanel child components *must* have a name attribute")}},_onClick:function(e){var t=e.target.getAttribute("name");this.state.activeTab!==t&&this._handleNavPanelAnalytics(t),this.setState({activeTab:t})},getInitialState:function(){var e={activeTab:this.props.children[0].props.name};return this.props.defaultTab&&_.find(this.props.children,{props:{name:this.props.defaultTab}})&&(e={activeTab:this.props.defaultTab}),e},_handleNavPanelAnalytics:function(e){switch(e){case d["default"].general:h["default"].generalSettingsPanelSelected();break;case d["default"].notifications:h["default"].notificationsSettingsPanelSelected();break;case d["default"].appearance:h["default"].appearanceSettingsPanelSelected()}},render:function(){var e=this,t=React.Children.map(this.props.children,function(t){if("NavPanelContent"===t.type.displayName){var a=(0,u["default"])({"aui-nav-selected":e.state.activeTab===t.props.name});return React.createElement("li",{role:"tab",className:a,selected:e.state.activeTab===t.props.name,key:_.uniqueId()},React.createElement("a",{onClick:e._onClick,name:t.props.name},t.props.name))}}),a=React.Children.map(this.props.children,function(t){return"NavPanelContent"===t.type.displayName?React.createElement(r["default"],{name:t.props.name,selected:e.state.activeTab===t.props.name,key:_.uniqueId(),lozenge_text:t.props.lozenge_text},t.props.children):void 0});return React.createElement("div",(0,o["default"])({},this.props,{className:"hc-nav-panel aui-group"}),React.createElement("div",{className:"aui-item aui-navgroup aui-navgroup-vertical"},React.createElement("ul",{className:"aui-nav","data-skate-ignore":!0},t)),React.createElement("div",{className:"aui-item"},a))}}),e.exports=t["default"]},function(e,t){"use strict";e.exports=React.createClass({displayName:"NavPanelContent",_getTitle:function(){var e;return e=this.props.lozenge_text?React.createElement("h2",null,this.props.name,React.createElement("span",{className:"aui-lozenge aui-lozenge-current"},this.props.lozenge_text)):React.createElement("h2",null,this.props.name)},render:function(){var e=this._getTitle();return React.createElement("div",{className:"nav-panel-content","aria-hidden":!this.props.selected,"aria-labeledby":this.props.tabId},e,this.props.children)}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(191),o=n(i),s=a(346),r=a(161),l=a(164),u=a(166),c=a(196);e.exports=React.createClass({displayName:"PreferenceCheckboxField",getDefaultProps:function(){return{isReverse:!1}},_isDefaultChecked:function(){var e=r.get(this.props.id);return this.props.isReverse&&(e=!e),e},_handleAnalytics:function(){switch(this.props.id){case u.HIDE_GIFS_BY_DEFAULT:this._handleGifsClicked();break;case l.NOTIFY_FOR_PRIVATE_ROOM:this._handlePrivateRoomNotificationClicked();break;case l.NOTIFY_FOR_ROOM:this._handleOpenRoomNotificationClicked()}},_handleGifsClicked:function(){var e=r.get(this.props.id),t=!e;c.hideGifsClicked(e,t)},_handlePrivateRoomNotificationClicked:function(){var e=r.get(this.props.id),t=!e;c.privateRoomNotificationClicked(e,t)},_handleOpenRoomNotificationClicked:function(){var e=r.get(this.props.id),t=!e;c.openRoomNotificationClicked(e,t)},render:function(){return React.createElement(s,(0,o["default"])({},this.props,{onChange:this._handleAnalytics,defaultChecked:this._isDefaultChecked()}))}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(191),o=n(i),s=a(347);e.exports=React.createClass({displayName:"AuiCheckBoxField",render:function(){return React.createElement("div",{className:"checkbox"},React.createElement(s,(0,o["default"])({key:_.uniqueId()},this.props)),React.createElement("label",{htmlFor:this.props.id,key:_.uniqueId()},this.props.label))}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(191),o=n(i);t["default"]=React.createClass({displayName:"AuiCheckbox",propTypes:{defaultChecked:React.PropTypes.bool,onChange:React.PropTypes.func},getDefaultProps:function(){return{value:!0,defaultChecked:!1,onChange:function(){}}},render:function(){var e=_.clone(this.props);return e.name=this.props.name||this.props.id,React.createElement("input",(0,o["default"])({type:"checkbox",className:"checkbox"},e))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(349),o=n(i),s=a(161),r=n(s),l=a(164),u=n(l),c=a(166),d=n(c),f=a(203),h=n(f),p=a(196),_=n(p);e.exports=React.createClass({displayName:"PreferenceRadioField",propTypes:{options:React.PropTypes.array,label:React.PropTypes.string},getDefaultProps:function(){return{options:[]}},_isDefaultChecked:function(e){return e===r["default"].get(this.props.id)},_handleAnalytics:function(e){switch(this.props.id){case u["default"].THEME:this._handleThemeClicked(e);break;case u["default"].DENSITY:this._handleDensityClicked(e);break;case u["default"].CHAT_VIEW:this._handleChatViewClicked(e);break;case u["default"].NAME_DISPLAY:this._handleNameDisplayClicked(e);break;case d["default"].ANIMATED_AVATARS:this._handleAnimatedAvatarsClicked(e)}},_getCurrentPref:function(){return r["default"].get(this.props.id)},_handleThemeClicked:function(e){var t=this._getCurrentPref();"light"===e&&e!==t?_["default"].lightThemeSelected():"dark"===e&&e!==t&&_["default"].darkThemeSelected()},_handleDensityClicked:function(e){var t=this._getCurrentPref();"normal"===e&&e!==t?_["default"].normalTextDensitySelected():"tighter"===e&&e!==t&&_["default"].tighterTextDensitySelected()},_handleChatViewClicked:function(e){var t=this._getCurrentPref();"classic"===e&&e!==t?_["default"].classicChatViewSelected():"classic_neue"===e&&e!==t&&_["default"].classicNeueChatViewSelected()},_handleNameDisplayClicked:function(e){var t=this._getCurrentPref();"names"===e&&e!==t?_["default"].fullNamesNameDisplaySelected():"mentions"===e&&e!==t&&_["default"].mentionNamesNameDisplaySelected()},_handleAnimatedAvatarsClicked:function(e){var t=this._getCurrentPref();"animated"===e&&e!==t?_["default"].animatedAvatarsSelected():"static"===e&&e!==t&&_["default"].staticAvatarsSelected()},render:function(){var e=this;return React.createElement("fieldset",{className:"group"},React.createElement("legend",null,React.createElement("span",null,this.props.label)),this.props.options.map(function(t){var a="radio-"+e.props.id+"-"+t;return React.createElement(o["default"],{val:t,id:t,key:a,label:h["default"][t],name:e.props.id,defaultChecked:e._isDefaultChecked(t),onChange:e._handleAnalytics.bind(e,t)})}))}})},function(e,t,a){"use strict";var n=a(350);e.exports=React.createClass({displayName:"AuiRadio",_getDescription:function(){var e=!1;return this.props.description&&(e=this.props.description_is_link&&this.props.description_link_action?React.createElement("div",{className:"description"},React.createElement("a",{onClick:this.props.description_link_action.bind(this)},this.props.description)):React.createElement("div",{className:"description"},this.props.description)),e},_getIcon:function(){if(this.props.icon){var e="aui-icon hipchat-icon-small icon-"+this.props.icon;return React.createElement("span",{className:e},this.props.icon)}},render:function(){var e=this.props.name||this.props.id,t=this._getDescription(),a=this.props.className||"",i=this._getIcon();return React.createElement("div",{className:"radio "+a},React.createElement(n,{type:"radio",ref:"radio",id:this.props.id,name:e,value:this.props.value,checked:this.props.checked,defaultChecked:this.props.defaultChecked,onChange:this.props.onChange}),React.createElement("label",{htmlFor:this.props.id},i,this.props.label),t)}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(191),o=n(i);e.exports=React.createClass({displayName:"AuiInput",propTypes:{onChange:React.PropTypes.func,onFocus:React.PropTypes.func,onBlur:React.PropTypes.func},getDefaultProps:function(){return{type:"text",onChange:function(){},onFocus:function(){},onBlur:function(){}}},focus:function(){ReactDOM.findDOMNode(this.refs.input).focus()},render:function(){var e=this.props.name||this.props.id,t=this.props.size?this.props.type+" "+this.props.size:this.props.type;return React.createElement("input",(0,o["default"])({},this.props,{ref:"input",className:t,name:e}))}})},function(e,t){"use strict";e.exports=React.createClass({displayName:"AuiFormInlineFieldGroup",getDefaults:function(){return{className:""}},render:function(){return React.createElement("div",{className:"inline-field-group "+this.props.className},this.props.children)}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(191),o=n(i),s=a(353),r=a(350);e.exports=React.createClass({displayName:"AuiInputFieldGroup",focus:function(){this.refs.input.focus()},render:function(){return React.createElement(s,this.props,React.createElement(r,(0,o["default"])({ref:"input"},this.props)))}})},function(e,t){"use strict";e.exports=React.createClass({displayName:"AuiFormFieldGroup",_getDescription:function(){return this.props.description?React.createElement("div",{className:"description"},this.props.description):void 0},_getRequiredIcon:function(){return this.props.required?React.createElement("span",{className:"aui-icon icon-required"}," required"):void 0},getError:function(){return this.props.error?React.createElement("div",{className:"error"},this.props.error):void 0},render:function(){var e=this.props.name||this.props.id,t=this._getDescription(),a=this._getRequiredIcon(),n=this.getError(),i="field-group";return this.props.labelPosition&&(i+=" label-position-"+this.props.labelPosition),React.createElement("div",{className:i},React.createElement("label",{htmlFor:e},this.props.label,a),this.props.children,t,n)}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(166),o=n(i),s=a(203),r=n(s),l=a(265),u=n(l),c=a(351),d=n(c),f=a(347),h=n(f),p=a(313),_=n(p);t["default"]=React.createClass({displayName:"MacDockBounceFieldType",mixins:[React.addons.PureRenderMixin],propTypes:{bounceIcon:React.PropTypes.bool.isRequired,bounceOnce:React.PropTypes.bool.isRequired},componentDidMount:function(){AJS.$(this.refs.dropdown).auiSelect2({minimumResultsForSearch:1/0}).on("change.mac-dock-bounce",this._onBounceOnceChange)},componentWillUnmount:function(){AJS.$(this.refs.dropdown).off(".mac-dock-bounce").auiSelect2("destroy"),AJS.$("#select2-drop-mask").remove(),AJS.$(".select2-sizer").remove()},_onBounceIconChange:function(e){var t={bounceIcon:e.target.checked};t.bounceIcon||(t.bounceOnce=!0),e.stopPropagation(),u["default"].savePreferences(t)},_onBounceOnceChange:function(e){var t={bounceOnce:"once"===e.target.value};e.stopPropagation(),u["default"].savePreferences(t)},render:function(){var e=this.props,t=e.bounceIcon,a=e.bounceOnce,n={once:"once",forever:"forever"},i=a?n.once:n.forever,s=!t,l=(0,_["default"])({"mac-dock-bounce-preference":!0,"checkbox-select2-field":!0,disabled:s});return React.createElement(d["default"],{className:l,key:o["default"].BOUNCE_ICON},React.createElement("div",{className:"checkbox"},React.createElement(h["default"],{id:o["default"].BOUNCE_ICON,defaultChecked:t,onClick:this._onBounceIconChange}),React.createElement("label",{htmlFor:o["default"].BOUNCE_ICON},r["default"].bounce_icon),React.createElement("select",{defaultValue:i,ref:"dropdown",disabled:s,"aria-disabled":s},React.createElement("option",{value:n.once},r["default"].bounce_icon_once),React.createElement("option",{value:n.forever},r["default"].bounce_icon_forever))))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{
"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(157),o=n(i),s=a(203),r=n(s),l=a(164),u=n(l),c=a(265),d=n(c),f=a(351),h=n(f),p=a(347),_=n(p),m=a(313),g=n(m),v="1",y="2",b="3";t["default"]=React.createClass({displayName:"SoundsField",mixins:[React.addons.PureRenderMixin],propTypes:{soundsEnabled:React.PropTypes.bool.isRequired,messageSounds:React.PropTypes.bool.isRequired,videoSounds:React.PropTypes.bool.isRequired},componentDidMount:function(){AJS.$(this.refs.dropdown).auiSelect2({minimumResultsForSearch:1/0}).on("change",this._onSoundPrefChange)},componentWillUnmount:function(){AJS.$(this.refs.dropdown).off("change").auiSelect2("destroy"),AJS.$("#select2-drop-mask").remove(),AJS.$(".select2-sizer").remove()},_onSoundsEnabledChange:function(e){e.stopPropagation(),d["default"].savePreferences((0,o["default"])({},u["default"].SOUNDS_ENABLED,!this.props.soundsEnabled))},_onSoundPrefChange:function(e){var t,a=e.target.value;e.stopPropagation(),d["default"].savePreferences((t={},(0,o["default"])(t,u["default"].MESSAGE_SOUNDS,a===b||a===v),(0,o["default"])(t,u["default"].VIDEO_SOUNDS,a===b||a===y),t))},render:function(){var e=this.props,t=e.soundsEnabled,a=e.messageSounds,n=e.videoSounds,i=a&&!n?v:!1,o=!a&&n?y:!1,s=a&&n?b:!1,l=s||o||i,c=!t,d=(0,g["default"])({"sounds-preference":!0,"checkbox-select2-field":!0,disabled:c});return React.createElement(h["default"],{className:d,key:u["default"].SOUNDS_ENABLED},React.createElement("div",{className:"checkbox"},React.createElement(_["default"],{id:u["default"].SOUNDS_ENABLED,defaultChecked:t,onClick:this._onSoundsEnabledChange}),React.createElement("label",{className:"select-title",htmlFor:u["default"].SOUNDS_ENABLED},r["default"].play_sound_part_1),React.createElement("select",{defaultValue:l,ref:"dropdown",disabled:c,"aria-disabled":c},React.createElement("option",{value:v},r["default"].message_notifications),React.createElement("option",{value:y},r["default"].video_notifications),React.createElement("option",{value:b},r["default"].message_and_video_notifications)),React.createElement("label",{className:"select-title",htmlFor:u["default"].SOUNDS_ENABLED},r["default"].play_sound_part_2)))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(357),o=n(i),s=a(349),r=n(s),l=a(95),u=n(l),c=a(262),d=n(c),f=a(203),h=n(f),p=a(161),m=n(p),g=a(292),v=n(g),y=a(196),b=n(y);e.exports=React.createClass({displayName:"RoomNotificationsForm",getInitialState:function(){return this._getState()},_getNotificationSettings:function(){return{level:m["default"].getGlobalNotificationSetting()}},_saveNotificationSettings:function(e){m["default"].setGlobalNotificationSetting(e.level)},_onChange:function(e){var t=e.target.value.trim();this.state.level!==t&&b["default"].globalNotificationLevelChanged(this.state.level,t),this.setState({level:t}),this._saveNotificationSettings({level:t})},_getState:function(){var e=this._getNotificationSettings(),t=_.get(e,"level","global");return{mention:v["default"].get("mention")||"",level:t}},_showSettingsDialog:function(){u["default"].showSettingDialog()},_closeDialog:function(){u["default"].closeDialog()},render:function(){return React.createElement("form",{id:"room-notifications-form",ref:"form",className:"aui per-room-notifs",onChange:this._onChange},React.createElement("h3",null,h["default"].notify_rooms_header),React.createElement(o["default"],{ref:"override-opts"},React.createElement(r["default"],{id:"notif-loud",name:"notification",defaultChecked:"loud"===this.state.level,value:"loud",icon:"volume-loud",label:d["default"].label.loud,description:d["default"].description.notif_loud}),React.createElement(r["default"],{id:"notif-normal",name:"notification",defaultChecked:"normal"===this.state.level,value:"normal",icon:"volume-normal",label:d["default"].label.normal,description:d["default"].description.notif_normal(this.state.mention)}),React.createElement(r["default"],{id:"notif-quiet",name:"notification",defaultChecked:"quiet"===this.state.level,value:"quiet",icon:"volume-quiet",label:d["default"].label.quiet,description:d["default"].description.notif_quiet(this.state.mention)})))}})},function(e,t){"use strict";e.exports=React.createClass({displayName:"AuiFormFieldSet",render:function(){var e=this.props.className||"";return React.createElement("fieldset",{className:"group "+e},React.createElement("legend",null,React.createElement("label",{htmlFor:this.props.id},this.props.label)),this.props.children)}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(157),o=n(i),s=a(349),r=n(s),l=a(164),u=n(l),c=a(265),d=n(c),f=a(203),h=n(f);t["default"]=React.createClass({displayName:"DoNotDisturbForm",mixins:[React.addons.PureRenderMixin],propTypes:{notifyForVideo:React.PropTypes.bool.isRequired,notifyAlways:React.PropTypes.bool.isRequired},_onChange:function(e){var t,a=e.target.id===u["default"].NOTIFY_WHEN_DND,n=e.target.id===u["default"].NOTIFY_FOR_VIDEO_WHEN_DND;e.stopPropagation(),d["default"].savePreferences((t={},(0,o["default"])(t,u["default"].NOTIFY_FOR_VIDEO_WHEN_DND,n),(0,o["default"])(t,u["default"].NOTIFY_WHEN_DND,a),t))},render:function(){var e=!this.props.notifyForMessages&&!this.props.notifyForMessages;return React.createElement("form",{className:"aui",onChange:this._onChange},React.createElement("h3",null,h["default"].dnd_header),React.createElement("fieldset",null,React.createElement(r["default"],{id:"trueDND",name:"dnd_setting",defaultChecked:e,label:h["default"].do_not_notify_when_dnd}),React.createElement(r["default"],{id:u["default"].NOTIFY_FOR_VIDEO_WHEN_DND,name:"dnd_setting",defaultChecked:this.props.notifyForVideo,label:h["default"].notify_for_video_when_dnd}),React.createElement(r["default"],{id:u["default"].NOTIFY_WHEN_DND,name:"dnd_setting",defaultChecked:this.props.notifyAlways,label:h["default"].notify_when_dnd})))}}),e.exports=t["default"]},function(e,t,a){"use strict";var n=a(341),i=a(360),o=a(203),s=a(368),r=a(99),l=a(369),u=a(342);e.exports=React.createClass({displayName:"InviteUserDialog",mixins:[l,u],componentDidMount:function(){s.on(["change"],this._onStoreChange)},componentWillUnmount:function(){s.off(["change"],this._onStoreChange)},getInitialState:function(){return this._getActiveChatState()},_getActiveChatState:function(){return{active_chat:s.get("active_chat"),rooms:s.get("rooms")}},_onStoreChange:function(){this.setState(this._getActiveChatState())},_dialogTitle:function(){return o.invite_users(r.room.get_room_name(_.keyBy(this.state.rooms.rooms,"jid"),this.state.active_chat))},_dialogBody:function(){if(r.jid.is_room(this.state.active_chat)){var e=this.state.dialogData?this.state.dialogData.type:!1;return React.createElement(i,{type:e,dialogVisible:this.state.dialogVisible,room_jid:this.state.active_chat,invite_user_jids:this.props.invite_users})}},_dialogFooterButton:function(){return React.createElement("button",{form:"invite-users-form",className:"aui-button aui-button-primary",type:"submit",onClick:this.ieSubmit},"Invite people")},render:function(){return React.createElement(n,{dialogId:"invite-users-dialog",title:this._dialogTitle(),dialogBody:this._dialogBody,dialogFooterButton:this._dialogFooterButton,closeLinkText:"Cancel"})}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(59),o=n(i),s=a(361),r=n(s),l=a(363),u=n(l),c=a(204),d=n(c),f=a(286),h=n(f),p=a(95),m=n(p),g=a(365),v=n(g),y=a(292),b=n(y),w=a(262),R=n(w),k=a(366),E=n(k),C=a(99),S=n(C),T=a(367),x=n(T),A=a(196),I=n(A),N=a(197),M=n(N),O=a(183),D=n(O),P=a(126),j=n(P),L="invite-users-select-no-matches-found";t["default"]=React.createClass({displayName:"InviteUsersForm",mixins:[x["default"]],componentDidMount:function(){v["default"].on(["change:activeChatParticipants","change:users","change:web_server"],this._onChange),this.shouldAutoFocus=!0,document.addEventListener("click",this._onDocumentClick,!0)},componentDidUpdate:function(){this.props.dialogVisible&&this.shouldAutoFocus&&(this._focusInput(),this.shouldAutoFocus=!1)},componentWillUnmount:function(){v["default"].off(["change:activeChatParticipants","change:users","change:web_server"],this._onChange),document.removeEventListener("click",this._onDocumentClick,!0)},getInitialState:function(){return this._getState()},_onChange:function(){this.setState(this._getState())},_getState:function(){return{user_is_admin:v["default"].get("user_is_admin"),invite_url:v["default"].get("invite_url"),web_server:v["default"].get("web_server"),users:v["default"].get("users"),jid:b["default"].get("jid"),activeChatParticipants:v["default"].get("activeChatParticipants"),errors:_.get(this,"state.errors",{})}},_onDocumentClick:function(e){if(e.target.id===L){if("_blank"===e.target.getAttribute("target"))return void e.stopPropagation();e.preventDefault(),m["default"].showInviteTeammatesDialog({type:M["default"].INVITE_USERS_DIALOG,default_text:e.target.getAttribute("data-term")}),I["default"].inviteTeamClickedEvent(M["default"].INVITE_USERS_DIALOG)}},_rosterForSelect:function(){var e=S["default"].roster.get_non_guest_users(this.state.users);return S["default"].roster.format_for_select2(_.union(this.state.jid,this.state.activeChatParticipants),e)},_onSubmit:function(e){e.preventDefault();var t,a=$(ReactDOM.findDOMNode(this.refs.form)).serializeArray(),n=a[0].value,i=S["default"].strings.stripHiddenCharacters(a[1].value.trim()).slice(0,250),o=[];t=this._validate(n,i),t?this.setState({errors:t}):(o.push(this._inviteUsers(n.split(","),i)),this._handlePromises(o),this._closeDialog())},_validate:function(e,t){return e?void 0:{user:E["default"].invite_users_form.no_users}},_inviteUsers:function(e,t){var a=this;return new o["default"](function(n){h["default"].inviteUsers({room_jid:a.props.room_jid,user_jids:e,reason:t}),n(e)})},_handlePromises:function(e){o["default"].all(e).then(function(e){this._throwFlagSuccess(),this.props.type&&I["default"].inviteUsersToRoomSent(this.props.type,e[0].length)}.bind(this),function(){this._throwFlagError()}.bind(this))},_throwFlagSuccess:function(){d["default"].showFlag({type:"success",body:R["default"].success.users_invited,close:"auto"})},_throwFlagError:function(){d["default"].showFlag({type:"error",body:this._flagErrorActions(R["default"].fail.invite_fail),close:"manual"})},_flagErrorActions:function(e){var t=this;return function(){return React.createElement("div",null,React.createElement("p",{className:"hc-message-body"},e),React.createElement("ul",{className:"aui-nav-actions-list"},React.createElement("li",null,React.createElement("a",{onClick:t._flagActionClick,href:"#"},"strings.button.try_again"))))}},_flagActionClick:function(e){e.preventDefault();var t=$(e.target).closest(".hc-flag").data("flag-index");d["default"].removeFlag(t),this._showDialog()},_showDialog:function(){m["default"].showInviteUsersDialog()},_closeDialog:function(){m["default"].closeDialog()},_focusInput:function(){ReactDOM.findDOMNode(this).querySelector("input[type=text]:first-of-type").focus()},_selectFormatNoMatches:function(e){var t="";return(this.state.user_is_admin||this.state.invite_url)&&(t='<a href="#" data-term="'+e+'" id="'+L+'" className="aui-inline-dialog-trigger">'+D["default"].buttons.invite_team_in_invite_users_dialog+"</a>",this.state.invite_url||(t='<a href="https://'+this.state.web_server+'/admin" target="_blank" id="'+L+'" className="aui-inline-dialog-trigger">'+D["default"].buttons.invite_team_in_invite_users_dialog+"</a>")),D["default"].no_one_found+". "+t},render:function(){var e=this.state.errors;return React.createElement("form",{id:"invite-users-form",ref:"form",className:"aui",onSubmit:this._onSubmit},React.createElement(r["default"],{id:"invite-users-people",label:R["default"].label.these_people,multiple:!0,data:this._rosterForSelect(),selected:this.props.invite_user_jids,sortResults:function(e,t,a){return j["default"].sort_users(e,a.term,"text")},error:e.user,ref:"user_select",formatNoMatches:this._selectFormatNoMatches}),React.createElement(u["default"],{id:"invite-users-message",label:R["default"].label.message,rows:"5",maxLength:"250",ref:"invite_message"}))}}),e.exports=t["default"]},function(e,t,a){"use strict";var n=a(353),i=a(362);e.exports=React.createClass({displayName:"AuiSelect2FieldGroup",render:function(){var e=this.props,t=e.id,a=e.size,o=e.name,s=e.placeholder,r=e.multiple,l=e.selected,u=e.maxDisplayedItems,c=e.data,d=e.formatNoMatches,f=e.sortResults,h={id:t,size:a,name:o,placeholder:s,multiple:r,selected:l,maxDisplayedItems:u,data:c,formatNoMatches:d};return f&&(h.sortResults=f),React.createElement(n,this.props,React.createElement(i,h))}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(121),o=n(i);t["default"]=React.createClass({displayName:"AuiSelect2Input",propTypes:{multiple:React.PropTypes.bool,placeholder:React.PropTypes.string,data:React.PropTypes.array,sortResults:React.PropTypes.func,maxDisplayedItems:React.PropTypes.number,selected:React.PropTypes.array},componentDidMount:function(){this._setupSelect()},componentWillUnmount:function(){AJS.$(ReactDOM.findDOMNode(this)).auiSelect2("destroy"),AJS.$("#select2-drop-mask").remove(),AJS.$(".select2-sizer").remove()},shouldComponentUpdate:function(e){return!_.isEqual(e,this.props)},componentDidUpdate:function(){this._setupSelect()},getDefaultProps:function(){var e=this;return{multiple:!1,placeholder:"",data:[],sortResults:function(t){return t.slice(0,e.maxDisplayedItems)},maxDisplayedItems:o["default"].select2_max_displayed_items,selected:[],formatNoMatches:function(){return"No matches found."}}},_setupSelect:function(){var e=this._getSelectOptions();AJS.$(ReactDOM.findDOMNode(this)).auiSelect2(e),e.selected&&e.selected.length>0&&AJS.$(ReactDOM.findDOMNode(this)).val(e.selected).trigger("change")},_getSelectOptions:function(){var e=this;return{multiple:this.props.multiple,placeholder:this.props.placeholder,data:this.props.data,selected:this.props.selected,sortResults:function(){var t;return(t=e.props).sortResults.apply(t,arguments).slice(0,e.props.maxDisplayedItems)},formatNoMatches:this.props.formatNoMatches}},render:function(){var e=this.props.name||this.props.id,t=this.props.size?"aui-select2 "+this.props.size:"aui-select2";return React.createElement("input",{type:"hidden",id:this.props.id,className:t,name:e})}}),e.exports=t["default"]},function(e,t,a){"use strict";var n=a(353),i=a(364);e.exports=React.createClass({displayName:"AuiTextAreaFieldGroup",render:function(){return React.createElement(n,this.props,React.createElement(i,this.props))}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(191),o=n(i);e.exports=React.createClass({displayName:"AuiTextarea",propTypes:{onChange:React.PropTypes.func,onFocus:React.PropTypes.func,onBlur:React.PropTypes.func},getDefaultProps:function(){return{onChange:function(){},onFocus:function(){},onBlur:function(){}}},render:function(){var e=this.props.name||this.props.id,t=this.props.size?"textarea "+this.props.size:"textarea";return React.createElement("textarea",(0,o["default"])({},this.props,{className:t,name:e}))}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(51),h=n(f),p=a(97),m=n(p),g=a(190),v=n(g),y=a(9),b=n(y),w=a(121),R=n(w),k=function(e){function t(){return(0,r["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).call(this))}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"getDefaults",value:function(){return{activeChat:null,activeChatParticipants:[],roomNames:[],users:{},user_is_admin:!1,web_server:R["default"].default_web_server,invite_url:!1}}},{key:"registerListeners",value:function(){var e=this;b["default"].registerOnce({"hc-init":function(t){e.set({user_is_admin:t.is_admin,invite_url:t.invite_url})}}),b["default"].register({"updated:activeRooms":function(){e.data.activeChat&&e.handleActiveChatUpdate(e.data.activeChat.jid)},"updated:allRooms":function(t){e.handleAllRoomsUpdate(t)},"updated:roster":function(t){e.handleRosterUpdate(t)},"updated:active_chat":function(t){e.handleActiveChatUpdate(t)},"updated:web_server":function(t){e.set("web_server",t)}})}},{key:"handleAllRoomsUpdate",value:function(e){var t=_.map(e,"name");this.set("roomNames",t)}},{key:"handleRosterUpdate",value:function(e){var t=_.keyBy(_.map(e,function(e){var t=!!e.is_guest;return{name:e.name,jid:e.jid,id:Number(e.id),is_guest:t}}),"jid");this.set("users",t)}},{key:"handleActiveChatUpdate",value:function(e){var t,a=[],n=v["default"].get("activeRooms");n&&(t=n[e],t&&(this.set({activeChat:t}),_.each(t.participants,function(e){_.each(e,function(e){a.push(e)})})),a.length&&this.set({activeChatParticipants:a}))}}]),t}(m["default"]);e.exports=new k},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={create_room_form:{no_permisions:"Your administrator has restricted creating rooms.",no_room_name:"Every room needs a name.",room_already_exists:"That room name is already taken",name_too_long:"That name is too long. You'll have to shorten it."},rename_room_form:{no_room_name:"Every room needs a name.",same_name:"That's the same name.",name_too_long:"That name is too long. You'll have to shorten it.",room_already_exists:"The room name is already taken"},invite_users_form:{no_users:"Who do you want to invite?"}},e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={shouldComponentUpdate:function(e,t){return!_.isEqual(this.props,e)||!_.isEqual(this.state,t)}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(51),h=n(f),p=a(9),m=n(p),g=a(97),v=n(g),y=a(99),b=n(y),w=a(265),R=n(w),k=a(161),E=n(k),C=a(218),S=n(C),T=a(173),x=n(T),A=a(258),I=n(A),N=function(e){function t(){(0,r["default"])(this,t);var e=(0,d["default"])(this,(0,o["default"])(t).call(this));return e.local={auto_join:[],closedChatsIndex:{}},e.savePrefsDebounced=_.debounce(e.savePrefs,2e3,{leading:!1,trailing:!0}),e}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"getDefaults",value:function(){return{current_user:{},active_chat:E["default"].getChatToFocus(),active_chat_type:"",rooms:{people:[],rooms:[]},room_order:[],search_nav_item_visible:!1,group_name:"",group_avatar_url:"",group_avatar_bg:"",feature_flags:{},drag_target:!1,drag_over_target:!1,drag_over_clientY:!1,dragging:!1,ui_available:!1}}},{key:"registerListeners",value:function(){var e=this;m["default"].registerOnce({"app-state-ready":function(){e.hc_init_complete=!0},"updated:ui_available":function(t){e.set("ui_available",t)}}),m["default"].register({"updated:config":function(t){e.handleConfig(t)},"updated:current_user":function(t){e.set("current_user",t)},"updated:roster":function(t){e.handleRosterUpdate(t)},"updated:activeRooms":function(t){e.handleRoomsUpdate(t)},"updated:active_chat":function(t){e.handleSelectRoom(t)},"updated:profiles":function(t){e.handleProfiles(t)},"room-closed":function(t){var a=t.jid;e.handleRoomClosed(a)},"search-history":function(){e.set("search_nav_item_visible",!0)},"remove-search-nav-item":function(){e.set("search_nav_item_visible",!1)},"update-room-order":function(t){e.set({drag_target:!1}),e.updateRoomOrder(t)},"restore-room-order":function(t){var a=t.jid,n=e.local.closedChatsIndex[a];if(void 0!==n){var i=_.cloneDeep(e.data.room_order),o=e.data.room_order.indexOf(a);n!==o&&n<e.data.room_order.length&&(i.splice(o,1),i.splice(n,0,a),e.updateRoomOrder(i)),S["default"].isOnline()&&delete e.local.closedChatsIndex[a]}},"navigate-rooms":function(t){e.navigateRooms(t)},"rooms-nav-drag-start":function(t){e.handleDragStart(t.target)},"rooms-nav-drag-over":function(t){e.handleDragOver(t.event)},"rooms-nav-drag-end":function(){e.handleDragEnd()}})}},{key:"groupRooms",value:function(e){return e=_.groupBy(_.reject(e,function(e){return!e||""===e.name}),function(e){return"groupchat"===e.type?"rooms":"people"})}},{key:"orderRooms",value:function(e){if(this.data.room_order.length){var t=_.compact(_.map(this.data.room_order,function(t){return e[t]?e[t]:void 0})),a=_.map(e,function(e){var a=_.find(t,function(t){return e.jid===t.jid});return a?void 0:e});return _.compact(t.concat(a))}return e}},{key:"setRoomOrder",value:function(e){var t,a=this;t=e?_.map(e,function(e){return e.jid}):_.flatten(_.map(["rooms","people"],function(e){return _.map(a.data.rooms[e],function(e){return e.jid})})),this.set({room_order:t})}},{key:"handleConfig",value:function(e){var t=I["default"].cleanAvatarURL(_.get(e,"group_avatar_url"));this.set({group_avatar_bg:_.get(e,"group_avatar_bg"),group_avatar_url:t,group_name:_.get(e,"group_name"),feature_flags:_.get(e,"feature_flags")})}},{key:"handleRosterUpdate",value:function(e){var t=this;_.map(e,function(a,n){var i=_.find(t.data.rooms.people,function(e){return e.jid===n});i&&(_.assign(i.presence,e[n].presence),_.get(a,"name")&&(i.name=a.name))}),this.set({rooms:this.data.rooms}),this.setRoomOrder()}},{key:"handleRoomsUpdate",value:function(e){var t=void 0,a=void 0;_.reject(e,function(e){return!e}),a=this.orderRooms(e),t=this.groupRooms(a),_.assign(this.data,{rooms:_.defaults(t,{rooms:[],people:[]}),active_chat:this.data.active_chat}),!this.hc_init_complete||e[this.data.active_chat]||b["default"].jid.is_search(this.data.active_chat)||(this.data.active_chat="lobby"),this.saveRooms(a,this.data.active_chat,this.data.rooms)}},{key:"handleProfiles",value:function(e){_.forOwn(this.data.rooms.people,function(t){var a=_.get(e,'["'+t.jid+'"].name');a&&(t.name=a)}),this.set({rooms:this.data.rooms})}},{key:"getRoomIndex",value:function(e){return this.data.room_order.indexOf(e)}},{key:"getNextRoom",value:function(e){var t,a;return this.data.room_order.length&&(a=this.getRoomIndex(e),a>=0&&(a===this.data.room_order.length-1?a--:a++,a>-1&&(t=this.data.room_order[a]))),t||"lobby"}},{key:"handleRoomClosed",value:function(e){var t=this.getRoomIndex(e);if(-1!==t&&(this.local.closedChatsIndex[e]=t),e===this.data.active_chat){var a={jid:this.getNextRoom(e),isClosed:!0};m["default"].dispatch("set-route",a),x["default"].dispatch("analytics-select-room",a)}m["default"].dispatch("close-file-viewer")}},{key:"handleSelectRoom",value:function(e){var t=_.find(this.data.rooms.rooms,{jid:e})||_.find(this.data.rooms.people,{jid:e}),a=t||b["default"].jid.is_search(e)?e:"lobby";_.map(this.data.rooms,function(t){_.assign(_.find(t,function(t){return t.jid===e}))}),this.set({rooms:this.data.rooms,active_chat:a}),this.setRoomOrder(),this.hc_init_complete&&this.savePrefsDebounced()}},{key:"navigateRooms",value:function(e){var t=this,a=_.findIndex(this.data.room_order,function(e){return e===t.data.active_chat});"up"===e.direction?this.navigateRoomsUp(a):"down"===e.direction?this.navigateRoomsDown(a):"top"===e.direction?this.navigateToTopChat():"bottom"===e.direction?this.navigateToBottomChat():"index"===e.direction&&this.navigateToChatAtIndex(e.index),m["default"].dispatch("close-file-viewer")}},{key:"navigateToTopChat",value:function(){var e=_.head(this.data.room_order);e&&e!==this.data.active_chat&&m["default"].dispatch("set-route",{jid:e})}},{key:"navigateToBottomChat",value:function(){var e=_.last(this.data.room_order);e&&e!==this.data.active_chat&&m["default"].dispatch("set-route",{jid:e})}},{key:"navigateToChatAtIndex",value:function(e){var t=this.data.room_order[e];t&&t!==this.data.active_chat&&m["default"].dispatch("set-route",{jid:t})}},{key:"navigateRoomsUp",value:function(e){var t;t=-1===e&&b["default"].jid.is_lobby(this.data.active_chat)?this.data.room_order[this.data.room_order.length-1]:0===e?"lobby":this.data.room_order[e-1],t&&m["default"].dispatch("set-route",{jid:t})}},{key:"navigateRoomsDown",value:function(e){var t;t=-1===e&&b["default"].jid.is_lobby(this.data.active_chat)?this.data.room_order[0]:e===this.data.room_order.length-1?"lobby":this.data.room_order[e+1],t&&m["default"].dispatch("set-route",{jid:t})}},{key:"updateRoomOrder",value:function(e){var t=[],a=void 0,n=void 0;t=t.concat(this.data.rooms.rooms,this.data.rooms.people),a=_.map(e,function(e){return _.find(t,function(t){return t.jid===e})}),n=_.groupBy(a,function(e){return"groupchat"===e.type?"rooms":"people"}),this.saveRooms(a,this.data.active_chat,n)}},{key:"saveRooms",value:function(e,t,a){var n=_.map(e,function(e){return{jid:e.jid,name:e.name}});this.set({rooms:a,active_chat:t}),this.local.auto_join=n.length?n:!1,this.hc_init_complete&&(this.savePrefsDebounced(),this.setRoomOrder())}},{key:"savePrefs",value:function(){var e={};e.autoJoin=this.local.auto_join,"search"!==this.data.active_chat&&(e.chatToFocus=this.data.active_chat),R["default"].savePreferences(e)}},{key:"handleDragStart",value:function(e){e&&this.set({drag_target:e,dragging:!0})}},{key:"handleDragOver",value:function(e){e&&e.target&&e.clientY&&this.set({drag_over_target:e.target,drag_over_clientY:e.clientY,dragging:!0})}},{key:"handleDragEnd",value:function(){this.set({drag_over_target:!1,drag_over_clientY:!1,dragging:!1})}}]),t}(v["default"]);e.exports=new N},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={ieSubmit:function(e){if(!Modernizr.formattribute){e.preventDefault();var t=document.getElementById(e.target.getAttribute("form"));if(t){var a=t.ownerDocument.createElement("input");a.style.display="none",a.type="submit",t.appendChild(a).click(),t.removeChild(a)}}}},e.exports=t["default"]},function(e,t,a){"use strict";var n=a(341),i=a(203),o=a(371),s=a(369);e.exports=React.createClass({displayName:"RemoveUserDialog",mixins:[s],_dialogTitle:function(){return i.choose_removed_members},_dialogBody:function(){return React.createElement(o,null)},_dialogFooterButton:function(){return React.createElement("button",{form:"remove-users-form",className:"aui-button aui-button-primary",type:"submit",onClick:this.ieSubmit},i.ok)},render:function(){return React.createElement(n,{dialogId:"remove-users-dialog",title:this._dialogTitle(),dialogBody:this._dialogBody,dialogFooterButton:this._dialogFooterButton,closeLinkText:"Cancel",size:"small"})}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(346),o=n(i),s=a(204),r=n(s),l=a(95),u=n(l),c=a(286),d=n(c),f=a(365),h=n(f),p=a(262),m=n(p);t["default"]=React.createClass({displayName:"RemoveUsersForm",shouldComponentUpdate:function(){return!ReactDOM.findDOMNode(this.refs.form).querySelectorAll(":checked").length},componentDidMount:function(){h["default"].on(["change:users","change:activeChat","change:activeChatParticipants"],this._onChange)},componentDidUpdate:function(){ReactDOM.findDOMNode(this.refs.form).reset(),$(ReactDOM.findDOMNode(this.refs.form)).find(".aui-select2")&&AJS.$(ReactDOM.findDOMNode(this.refs.form)).find(".aui-select2").auiSelect2("data",null)},componentWillUnmount:function(){h["default"].off(["change:users","change:activeChat","change:activeChatParticipants"],this._onChange)},getInitialState:function(){return this._getState()},_onChange:function(){this.setState(this._getState())},_getState:function(){return{activeChatParticipants:h["default"].get("activeChatParticipants"),users:h["default"].get("users"),activeChat:h["default"].get("activeChat")}},_getName:function(e){return this.state.users[e].name},_getUID:function(e){return Number(this.state.users[e].id)},_isAdmin:function(e){return _.includes(this.state.activeChat.admins,this._getUID(e))},_sortParticipants:function(){var e=this,t=_.map(this.state.activeChatParticipants,function(t){return{jid:t,name:e._getName(t),isAdmin:e._isAdmin(t)}});return _.sortBy(t,["isAdmin","name"])},_onSubmit:function(e){e.preventDefault();var t=$(ReactDOM.findDOMNode(this.refs.form)).serializeArray(),a={room_jid:this.state.activeChat.jid,user_jids:_.map(t,"value")};a.user_jids.length?d["default"].removeUsers(a,this._handleResponse):this._throwFlagError(m["default"].fail.no_users_flag),this._closeDialog()},_handleResponse:function(e){if(e.error){var t=_.get(e,"error.text.__text")?e.error.text.__text:m["default"].fail.remove_users;this._throwFlagError(t)}else this._throwFlagSuccess(m["default"].success.users_removed)},_throwFlagSuccess:function(e){r["default"].showFlag({type:"success",body:e,close:"auto"})},_throwFlagError:function(e){r["default"].showFlag({type:"error",body:this._flagBody(e),close:"manual"})},_flagActionClick:function(e){e.preventDefault();var t=$(e.target).closest(".hc-flag").data("flag-index");r["default"].removeFlag(t),this._showDialog()},_flagBody:function(e){var t=this;return function(){return React.createElement("div",null,React.createElement("p",{className:"hc-message-body"},e),React.createElement("ul",{className:"aui-nav-actions-list"},React.createElement("li",null,React.createElement("a",{onClick:t._flagActionClick,href:"#"},m["default"].button.try_again))))}},_showDialog:function(){u["default"].showRemoveUsersDialog()},_closeDialog:function(){u["default"].closeDialog()},render:function(){var e=this._sortParticipants();return React.createElement("form",{id:"remove-users-form",ref:"form",className:"aui",onSubmit:this._onSubmit},React.createElement("div",null,m["default"].description.choose_people_to_remove),_.map(e,function(e,t){return React.createElement(o["default"],{id:e.jid,value:e.jid,label:e.name,disabled:e.isAdmin,key:t})}))}}),e.exports=t["default"]},function(e,t,a){"use strict";var n=a(341),i=a(203),o=a(373),s=a(369),r=a(342),l=a(313);e.exports=React.createClass({displayName:"CreateRoomDialog",mixins:[s,r],_dialogBody:function(){return React.createElement(o,{dialogVisible:this.state.dialogVisible,loading:this.props.btnLoading,room_name:this.props.room_name,room_topic:this.props.room_topic,privacy:this.props.privacy})},_dialogFooterButton:function(){var e=l({"aui-button":!0,"aui-button-primary":!0});return React.createElement("button",{form:"create-room-form",className:e,"aria-disabled":this.props.btnLoading,disabled:this.props.btnLoading,type:"submit",onClick:this.ieSubmit},i.create_room)},render:function(){return React.createElement(n,{dialogId:"create-room-dialog",title:i.create_a_new_room,dialogBody:this._dialogBody,dialogFooterButton:this._dialogFooterButton,btnLoading:this.props.btnLoading,closeLinkText:"Cancel"})}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(352),o=n(i),s=a(374),r=n(s),l=a(204),u=n(l),c=a(95),d=n(c),f=a(286),h=n(f),p=a(288),m=n(p),g=a(365),v=n(g),y=a(262),b=n(y),w=a(366),R=n(w),k=a(268),E=n(k),C=a(367),S=n(C),T=a(121),x=n(T);t["default"]=React.createClass({displayName:"CreateRoomForm",mixins:[S["default"]],componentDidMount:function(){v["default"].on("change:roomNames",this._onChange),this.shouldAutoFocus=!0},componentWillUnmount:function(){v["default"].off("change:roomNames",this._onChange)},componentDidUpdate:function(){(this.state.errors.name||this.props.dialogVisible&&this.shouldAutoFocus)&&(this._focusInput(),this.shouldAutoFocus=!1)},getInitialState:function(){var e=_.extend({room_name:this.props.room_name||null,room_topic:this.props.room_topic||null,privacy:this.props.privacy||"public"},this._getState());return e},_onChange:function(){this.setState(this._getState())},_getState:function(){return{roomNames:v["default"].get("roomNames"),errors:{}}},_onSubmit:function(e){e.preventDefault();var t=$(this.refs.form).serializeArray(),a=t[2]?t[2].value:"public",n={name:t[0].value.trim(),topic:t[1]?t[1].value.trim():"",privacy:a},i=this._validateFormData(n);i?this.setState({errors:i,privacy:a}):(this.setState({errors:{},privacy:a}),d["default"].startBtnLoading(),h["default"].createRoom(n,this._handleResponse))},_validateFormData:function(e){var t={};return e.name?e.name.length>50?t.name=R["default"].create_room_form.name_too_long:_.find(this.state.roomNames,function(t){
return _.isString(t)&&t.toLowerCase()===e.name.toLowerCase()})&&(t.name=R["default"].create_room_form.room_already_exists):t.name=R["default"].create_room_form.no_room_name,e.topic.length>x["default"].max_topic_text_length&&(t.topic=E["default"].topic_length_error(x["default"].max_topic_text_length)),_.isEmpty(t)?null:t},_handleResponse:function(e,t){if(e)this.setState({errors:{name:403===e.status?R["default"].create_room_form.no_permisions:e.message||b["default"].fail.create_room}}),d["default"].stopBtnLoading();else{var a=t.name||"Room",n=b["default"].success.room_created(a);this._throwFlagSuccess(n),m["default"].select(t.jid,"groupchat")}},_throwFlagSuccess:function(e){u["default"].showFlag({type:"success",body:e,close:"auto"})},_showDialog:function(){d["default"].showCreateRoomDialog()},_focusInput:function(){document.getElementById("create-room-name").focus()},render:function(){var e=this.state.errors,t=this.state.room_name,a=this.state.room_topic,n=this.state.privacy;return React.createElement("form",{id:"create-room-form",ref:"form",className:"aui",onSubmit:this._onSubmit},React.createElement(o["default"],{value:t,disabled:this.props.loading,ref:"nameField",id:"create-room-name",label:b["default"].label.room_name,maxLength:"50",description:b["default"].description.create_room_description,error:e.name}),React.createElement(o["default"],{value:a,disabled:this.props.loading,ref:"topicField",id:"create-room-topic",label:b["default"].label.room_topic,maxLength:x["default"].max_topic_text_length,description:b["default"].description.create_room_topic,error:e.topic}),React.createElement(r["default"],{disabled:this.props.loading,defaultChecked:n}))}}),e.exports=t["default"]},function(e,t,a){"use strict";var n=a(357),i=a(262),o=a(349);e.exports=React.createClass({displayName:"RoomPrivacyRadios",getDefaultProps:function(){return{public_desc:i.description.public_room,private_desc:i.description.private_room}},render:function(){return React.createElement(n,{label:"Access:"},React.createElement(o,{id:"public-room",key:_.uniqueId(),name:"privacy",defaultChecked:"public"===this.props.defaultChecked,value:"public",label:i.label.public_room,description:this.props.public_desc}),React.createElement(o,{id:"private-room",key:_.uniqueId(),name:"privacy",defaultChecked:"private"===this.props.defaultChecked,value:"private",label:i.label.private_room,description:this.props.private_desc}))}})},function(e,t,a){"use strict";var n=a(341),i=a(203),o=a(376),s=a(369),r=a(313);e.exports=React.createClass({displayName:"RoomPrivacyDialog",mixins:[s],_dialogBody:function(){return React.createElement(o,{jid:this.props.jid,name:this.props.name,privacy:this.props.privacy,loading:this.props.btnLoading})},_dialogFooterButton:function(){var e=r({"aui-button":!0,"aui-button-primary":!0});return React.createElement("button",{form:"room-privacy-form",className:e,"aria-disabled":this.props.btnLoading,disabled:this.props.btnLoading,type:"submit",onClick:this.ieSubmit},i.set_privacy)},render:function(){return React.createElement(n,{dialogId:"room-privacy-dialog",title:i.change_privacy,dialogBody:this._dialogBody,dialogFooterButton:this._dialogFooterButton,btnLoading:this.props.btnLoading,closeLinkText:i.cancel})}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(374),o=n(i),s=a(204),r=n(s),l=a(95),u=n(l),c=a(286),d=n(c),f=a(262),h=n(f);t["default"]=React.createClass({displayName:"RoomPrivacyForm",shouldComponentUpdate:function(e){var t;return t=!e.loading},_onSubmit:function(e){e.preventDefault();var t=$(ReactDOM.findDOMNode(this.refs.form)).serializeArray(),a={jid:this.props.jid,privacy:t[0].value};a.privacy!==this.props.privacy&&(u["default"].startBtnLoading(),d["default"].changeRoomPrivacy(a,this._handleResponse))},_handleResponse:function(e){if(e)this._throwFlagError(e.message||h["default"].fail.change_privacy_flag);else{var t="public"===this.props.privacy?"private":"public",a=h["default"].success.privacy_changed(this.props.name,t);this._throwFlagSuccess(a)}this._closeDialog()},_throwFlagSuccess:function(e){r["default"].showFlag({type:"success",body:e,close:"auto"})},_throwFlagError:function(e){r["default"].showFlag({type:"error",body:this._flagBody(e),close:"manual"})},_onFlagActionClick:function(e){e.preventDefault();var t=$(e.target).closest(".hc-flag").data("flag-index");r["default"].removeFlag(t),this._showDialog()},_flagBody:function(e){var t=this;return function(){return React.createElement("div",null,React.createElement("p",{className:"hc-message-body"},e),React.createElement("ul",{className:"aui-nav-actions-list"},React.createElement("li",null,React.createElement("a",{onClick:t._onFlagActionClick,href:"#"},h["default"].button.try_again))))}},_showDialog:function(){u["default"].showRoomPrivacyDialog({jid:this.props.jid,name:this.props.name,privacy:this.props.privacy})},_closeDialog:function(){u["default"].closeDialog()},render:function(){return React.createElement("form",{id:"room-privacy-form",ref:"form",className:"aui",onSubmit:this._onSubmit},React.createElement(o["default"],{defaultChecked:this.props.privacy,private_desc:h["default"].description.privacy}))}}),e.exports=t["default"]},function(e,t,a){"use strict";var n=a(341),i=a(378),o=a(203),s=a(369),r=a(342),l=a(313);e.exports=React.createClass({displayName:"RenameRoomDialog",mixins:[s,r],_dialogBody:function(){return React.createElement(i,{dialogVisible:this.state.dialogVisible,jid:this.props.jid,name:this.props.name,loading:this.props.btnLoading})},_dialogFooterButton:function(){var e=l({"aui-button":!0,"aui-button-primary":!0});return React.createElement("button",{form:"rename-room-form",className:e,"aria-disabled":this.props.btnLoading,disabled:this.props.btnLoading,type:"submit",onClick:this.ieSubmit},o.rename)},render:function(){return React.createElement(n,{dialogId:"rename-room-dialog",title:o.rename_room(this.props.name),dialogBody:this._dialogBody,dialogFooterButton:this._dialogFooterButton,btnLoading:this.props.btnLoading,closeLinkText:o.cancel})}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(352),o=n(i),s=a(204),r=n(s),l=a(95),u=n(l),c=a(286),d=n(c),f=a(366),h=n(f),p=a(365),m=n(p),g=a(262),v=n(g);e.exports=React.createClass({displayName:"RenameRoomForm",componentDidMount:function(){m["default"].on("change:roomNames",this._onChange)},componentWillUnmount:function(){m["default"].off("change:roomNames",this._onChange)},componentDidUpdate:function(){(this.state.errors.name||this.props.dialogVisible)&&this._focusInput()},getInitialState:function(){return this._getState()},_onChange:function(){this.setState(this._getState())},_getState:function(){return{roomNames:m["default"].get("roomNames"),errors:{}}},_onSubmit:function(e){e.preventDefault();var t=$(ReactDOM.findDOMNode(this.refs.form)).serializeArray(),a=t[0].value.trim(),n=this._validate(a);n?this.setState({errors:n}):(this._clearErrors(),u["default"].startBtnLoading(),d["default"].changeRoomName({jid:this.props.jid,name:a},this._handleResponse))},_validate:function(e){return e?e.length>50?{name:h["default"].rename_room_form.name_too_long}:e===this.props.name?{name:h["default"].rename_room_form.same_name}:_.find(this.state.roomNames,function(t){return _.isString(t)&&t.toLowerCase()===e.toLowerCase()})?{name:h["default"].rename_room_form.room_already_exists}:void 0:{name:h["default"].rename_room_form.no_room_name}},_clearErrors:function(){this.setState({errors:{}})},_handleResponse:function(e){e?(this.setState({errors:{name:e.message||v["default"].fail.rename_flag}}),u["default"].stopBtnLoading()):(this._throwFlagSuccess(v["default"].success.rename_flag),this._closeDialog())},_throwFlagSuccess:function(e){r["default"].showFlag({type:"success",body:e,close:"auto"})},_flagActionClick:function(e){e.preventDefault();var t=$(e.target).closest(".hc-flag").data("flag-index");r["default"].removeFlag(t),this._showDialog()},_flagBody:function(){var e=this;return function(){return React.createElement("div",null,React.createElement("ul",{className:"aui-nav-actions-list"},React.createElement("li",null,React.createElement("a",{onClick:e._flagActionClick,href:"#"},v["default"].button.try_again))))}},_showDialog:function(){u["default"].showRenameRoomDialog({jid:this.props.jid,name:this.props.name})},_closeDialog:function(){u["default"].closeDialog()},_focusInput:function(){document.getElementById("room-name").focus()},render:function(){var e=this.state.errors;return React.createElement("form",{id:"rename-room-form",ref:"form",className:"aui",onSubmit:this._onSubmit},React.createElement(o["default"],{id:"room-name",ref:"nameField",disabled:this.props.loading,maxLength:"50",label:v["default"].label.new_room_name,error:e.name}))}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(341),o=n(i),s=a(95),r=n(s),l=a(204),u=n(l),c=a(203),d=n(c),f=a(287),h=n(f),p=a(313),_=n(p);t["default"]=React.createClass({displayName:"DeleteRoomDialog",propTypes:{jid:React.PropTypes.string.isRequired},componentDidMount:function(){this._focusButton()},_dialogBody:function(){return d["default"].confirm_delete(this.props.name)},_dialogFooterButton:function(){var e=(0,_["default"])({"aui-button":!0,"aui-button-primary":!0});return React.createElement("button",{onClick:this._deleteRoom,className:e,"aria-disabled":this.props.btnLoading,disabled:this.props.btnLoading},d["default"].delete_room)},_deleteRoom:function(e){e.preventDefault(),r["default"].startBtnLoading(),h["default"].deleteRoom({jid:this.props.jid,id:this.props.room_id},this._handleResponse)},_handleResponse:function(e){if(e)this._throwFlagError(e.message||d["default"].delete_room_fail);else{var t=d["default"].room_deleted(this.props.name);this._throwFlagSuccess(t),h["default"].closeRoom(this.props.jid)}this._closeDialog()},_throwFlagSuccess:function(e){u["default"].showFlag({type:"success",body:e,close:"auto"})},_throwFlagError:function(e){u["default"].showFlag({type:"error",body:this._flagBody(e),close:"manual"})},_flagBody:function(e){var t=this;return function(){return React.createElement("div",null,React.createElement("p",{className:"hc-message-body"},e),React.createElement("ul",{className:"aui-nav-actions-list"},React.createElement("li",null,React.createElement("a",{onClick:t._flagActionClick,href:"#"},d["default"].try_again))))}},_flagActionClick:function(e){e.preventDefault();var t=$(e.target).closest(".flag").data("flag-index");u["default"].removeFlag(t),this._showDialog()},_showDialog:function(){r["default"].showDeleteRoomDialog({jid:this.props.jid,name:this.props.name})},_closeDialog:function(){r["default"].closeDialog()},_focusButton:function(){ReactDOM.findDOMNode(this).querySelector(".aui-button-primary").focus()},render:function(){return React.createElement(o["default"],{dialogId:"delete-room-dialog",title:d["default"].delete_room,dialogBody:this._dialogBody,dialogFooterButton:this._dialogFooterButton,closeLinkText:d["default"].cancel,btnLoading:this.props.btnLoading,size:"small"})}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(105),o=n(i),s=a(99),r=n(s),l=a(341),u=a(9),c=a(203),d=a(95);e.exports=React.createClass({displayName:"RoomInviteDialog",_dialogBody:function(){var e=c.invited_to_join(this.props.from_user,this.props.room_name);return React.createElement("div",null,e,React.createElement("br",null),React.createElement("br",null),React.createElement("span",{dangerouslySetInnerHTML:this._getReasonHTML()}))},_getReasonHTML:function(){var e={truncate_length:50};if(this.props.reason){var t=o["default"].linkify(r["default"].escape(this.props.reason),void 0,e);return{__html:'"'+t+'"'}}return{__html:""}},_dialogFooterButton:function(){return React.createElement("button",{onClick:this._acceptInvite,className:"aui-button aui-button-primary"},c.join)},_acceptInvite:function(e){e.preventDefault(),u.dispatch("groupchat-invite-accepted",{jid:this.props.room_jid}),d.closeDialog()},render:function(){return React.createElement(l,{dialogId:"room-invite-dialog",title:c.join_room(this.props.room_name),dialogBody:this._dialogBody,dialogFooterButton:this._dialogFooterButton,closeLinkText:"Ignore",size:"small"})}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(341),o=n(i),s=a(368),r=n(s),l=a(95),u=n(l),c=a(204),d=n(c),f=a(203),h=n(f),p=a(287),m=n(p),g=a(99),v=n(g);t["default"]=React.createClass({displayName:"ArchiveRoomDialog",componentDidMount:function(){r["default"].on(["change"],this._onChange)},componentWillUnmount:function(){r["default"].off(["change"],this._onChange)},getInitialState:function(){return this._getActiveChatState()},_getActiveChatState:function(){return{active_chat:r["default"].get("active_chat"),rooms:r["default"].get("rooms")}},_onChange:function(){this.setState(this._getActiveChatState())},_dialogBody:function(){return this.props.archive?React.createElement("div",null,React.createElement("p",null,React.createElement("strong",null,h["default"].really_archive(this._getRoomName()))),React.createElement("p",null,h["default"].confirm_archive)):React.createElement("p",null,h["default"].really_unarchive(this._getRoomName()))},_dialogFooterButton:function(){return React.createElement("button",{onClick:this.onAction(this.props.archive),className:"aui-button aui-button-primary"},this.props.archive?h["default"].archive:h["default"].unarchive)},_getRoomName:function(){return v["default"].room.get_room_name(_.keyBy(this.state.rooms.rooms,"jid"),this.state.active_chat)},_getRoomId:function(){return v["default"].room.get_room_id(_.keyBy(this.state.rooms.rooms,"jid"),this.state.active_chat)},onAction:function(e){var t={jid:this.state.active_chat,id:this._getRoomId()},a=this._buildResponseHandler(e);return function(n){n&&n.preventDefault(),e?m["default"].archiveRoom(t,a):m["default"].unarchiveRoom(t,a),u["default"].closeDialog()}},_buildResponseHandler:function(e){var t=this;return function(a){if(a.error){var n=e?h["default"].archive_fail:h["default"].unarchive_fail;t._throwFlagError(n)}else{var i=e?h["default"].room_archived:h["default"].room_unarchived;t._throwFlagSuccess(i)}}},_throwFlagSuccess:function(e){d["default"].showFlag({type:"success",body:e,close:"auto"})},_throwFlagError:function(e){d["default"].showFlag({type:"error",body:this._flagBody(e),close:"manual"})},_flagBody:function(e){var t=this;return function(){return React.createElement("div",null,React.createElement("p",{className:"hc-message-body"},e),React.createElement("ul",{className:"aui-nav-actions-list"},React.createElement("li",null,React.createElement("a",{onClick:t.onFlagClickAction(t.props.archive)},h["default"].try_again))))}},onFlagClickAction:function(e){var t=this.onAction(e);return function(e){var a=$(e.target).closest(".flag").data("flag-index");d["default"].removeFlag(a),t(e)}},render:function(){return React.createElement(o["default"],{dialogId:"archive-room-dialog",title:this.props.archive?h["default"].archive_room_name(this._getRoomName()):h["default"].unarchive_room_name(this._getRoomName()),dialogBody:this._dialogBody,dialogFooterButton:this._dialogFooterButton,closeLinkText:"Cancel"})}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(383),o=n(i),s=a(203),r=n(s),l=a(95),u=n(l),c=a(93),d=n(c);t["default"]=React.createClass({displayName:"Desktop4Dialog",componentDidMount:function(){d["default"].onDesktop4DialogShown()},getDefaultProps:function(){return{content:{}}},_onClick:function(){u["default"].closeDialog()},_getTitle:function(){var e=_.get(this.props.content,"title");return _.isString(e)?React.createElement("h2",null,e):void 0},_getIntro:function(){var e=_.get(this.props.content,"intro");return _.isString(e)?React.createElement("p",null,e):void 0},_getBullets:function(){var e=_.get(this.props.content,"bullets");return _.isArray(e)&&e.length?React.createElement("ul",null,e.map(function(e){return React.createElement("li",null,e)})):void 0},_getOutro:function(){var e=_.get(this.props.content,"outro");return _.isString(e)?React.createElement("p",null,e):void 0},_getCTA:function(){var e=_.get(this.props.content,"cta",r["default"].close);return _.isString(e)?React.createElement("button",{className:"aui-button aui-button-primary",onClick:this._onClick},e):void 0},_dialogBody:function(){var e=this._getTitle(),t=this._getIntro(),a=this._getBullets(),n=this._getOutro(),i=this._getCTA();return React.createElement("div",null,React.createElement("div",{className:"img"}),e,React.createElement("div",{className:"inner-content"},t,a,n),i)},render:function(){return React.createElement(o["default"],{dialogId:"desktop-4-dialog",dialogBody:this._dialogBody,size:"small"})}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(95),o=n(i),s=a(342),r=n(s),l=a(99),u=n(l),c=a(313),d=n(c);t["default"]=React.createClass({displayName:"ModalDialogAlternate",propTypes:{size:React.PropTypes.oneOf(["small","medium","large","xlarge"])},mixins:[r["default"]],componentDidMount:function(){document.querySelector("body").addEventListener("keydown",this._onKeyDown)},componentWillUnmount:function(){document.querySelector("body").removeEventListener("keydown",this._onKeyDown)},getDefaultProps:function(){return{dialogId:"dialog",size:"medium",dialogBody:_.noop}},close:function(){o["default"].closeDialog()},_onKeyDown:function(e){var t=window.Event?e.which:e.keyCode;t===u["default"].keyCode.Esc&&this.close()},_onClick:function(){this.close()},render:function(){var e="aui-dialog2-"+this.props.size,t=(0,d["default"])({"aui-layer":!0,"aui-dialog2":!0,"modal-dialog-alt":!0},e);return React.createElement("section",{role:"dialog",id:this.props.dialogId,className:t,"aria-hidden":!this.state.dialogVisible},React.createElement("div",{className:"aui-dialog2-content"},this.props.dialogBody()))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(385),o=n(i),s=a(368),r=n(s),l=a(121),u=n(l),c=a(95),d=n(c),f=a(196),h=n(f),p=a(386),_=n(p),m=a(341),g=n(m),v=a(203),y=n(v),b="connect-dialog-container";e.exports=React.createClass({displayName:"AddonDialog",_getAddonOptions:function(){var e=$.extend({},this.props.addon_options);return void 0===e.chrome&&(e.chrome=!0),void 0===e.resize&&(this.props.addon_options.width||this.props.addon_options.height)&&(e.resize=!1),e.width=this._getWidth(e.width||u["default"].default_connect_dialog_width),e.height=this._getHeight(e.height||u["default"].default_connect_dialog_height,e.chrome),e},_getDimension:function(e,t){return this.max_width=o["default"].dialog.getMaxWidth(),this.max_height=o["default"].dialog.getMaxHeight(),!t||parseInt(t,10)>this["max_"+e]?this["max_"+e]:t?parseInt(t,10):u["default"]["default_connect_dialog_"+e]},_getWidth:function(e){return void 0===e&&(e=parseInt(this.props.addon_options.width,10)||u["default"].default_connect_dialog_width),this._getDimension("width",e)},_getHeight:function(e,t){void 0===e&&(e=parseInt(this.props.addon_options.height,10)||u["default"].default_connect_dialog_height),e=this._getDimension("height",e);var a=o["default"].dialog.getMaxHeight()-u["default"].connect_aui_dialog_chrome_height;return t&&e>a?a:e},_getOptions:function(){return $.extend(!0,this._getAddonOptions(),{capabilities:o["default"].dialog.capabilities})},_createDialog:function(){var e=this._getOptions(),t=AJS.$(ReactDOM.findDOMNode(this.refs.connectDialog));t.css({width:this._getWidth(),height:this._getHeight(void 0,e.chrome)}),this.resize(this._getWidth(),this._getHeight(void 0,e.chrome)),t.find(".ap-dialog-submit").hide(),t.on("ra.iframe.destroy",function(){d["default"].closeDialog()})},componentDidMount:function(){o["default"].bindAnalyticsIntercept(),r["default"].on(["change"],this._onChange),this._createDialog()},componentWillUnmount:function(){o["default"].unbindAnalyticsIntercept(),r["default"].off(["change"],this._onChange);var e=this.props.addon_key;h["default"].connectDialogClosedEvent(e)},getInitialState:function(){return this._getActiveChatState()},_getActiveChatState:function(){return{active_chat:r["default"].get("active_chat"),rooms:r["default"].get("rooms")}},_onChange:function(){this.setState(this._getActiveChatState())},_resized:function(e,t){this.resize(e,t)},_dimensions:function(e,t){var a=o["default"].dialog.getMaxHeight(),n=o["default"].dialog.getMaxWidth();return{height:Math.min(parseInt(t,10),a),width:Math.min(parseInt(e,10),n)}},resize:function(e,t){var a,n=this._dimensions(e,t);a=($(document).height()-n.height)/2;var i=$("#"+b).css("top",a);AJS.layer(i).changeSize(n.width,n.height)},dialogBody:function(){var e=_["default"].create({addon_key:this.props.addon_key,key:this.props.module_key}),t=o["default"].getNamespace(this.props.addon_key,this.props.module_key),a=this._getOptions(),n=o["default"].getIframeUrl(this.props.addon_url,t,a);return React.createElement("iframe",{className:"hc-addon-iframe",id:e.id,name:e.name,src:n,onLoad:this._onLoad})},render:function(){var e=this._getOptions(),t=this._dimensions(this._getWidth(),this._getHeight(void 0,e.chrome));return React.createElement(g["default"],{ref:"connectDialog",dialogId:b,title:this.props.addon_options.header,dialogBody:this.dialogBody,closeLinkText:y["default"].close,customWidth:t.width,customHeight:t.height})}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t="";return(0,u["default"])(e).forEach(function(a){t+=a+"="+encodeURIComponent(e[a])+"&"}),t.substring(0,t.length-1)}function o(e,t){"undefined"!=typeof t&&h["default"].dispatch("analytics-connect-event",t)}var s=a(91),r=n(s),l=a(100),u=n(l),c=a(121),d=n(c),f=a(173),h=n(f),p=a(190),m=n(p),g=a(142),v=n(g);e.exports={bindAnalyticsIntercept:function(){AJS&&"function"==typeof AJS.bind&&AJS.bind("analyticsEvent",o)},unbindAnalyticsIntercept:function(){AJS&&"function"==typeof AJS.unbind&&AJS.unbind("analyticsEvent",o)},getCapabilities:function(){return{hostlib:"https://"+m["default"].get("web_server")+"/min/?b=js&f=connect/all-debug.js,connect/plugin-init.js"}},getIframeUrl:function(e,t,a){var n=v["default"].parse(window.location.href),o={xdm_e:n.getBase(),xdm_c:"channel-"+t,cp:"",lic:"none",embedded:!0},s=$.extend({},this.getCapabilities(),a),l=""+e+(_.includes(e,"?")?"&":"?")+i(o)+"#"+(0,r["default"])(s);return l},getNamespace:function(e,t){return e+"__"+t},getDocumentHeight:function(){return $(document).height()},dialog:{getMaxWidth:function(){var e=$(document).width();return e-Math.min(120,e/100*10)},getMaxHeight:function(t){var a=e.exports.getDocumentHeight();return t&&(a-=d["default"].connect_aui_dialog_chrome_height),a-Math.min(60,a/100*10)},capabilities:{resize:{},close:{}}}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(387),o=n(i);e.exports=o["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(91),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(388),d=n(c),f=a(392),h=n(f),p=function(){function e(){(0,r["default"])(this,e),this._xdm=new d["default"]}return(0,u["default"])(e,[{key:"dispatch",value:function(e,t,a,n){return this._xdm.queueEvent(e,t,a,n),this.getExtensions(t)}},{key:"broadcast",value:function(e,t,a){return this._xdm.dispatch(e,t,a,null,null),this.getExtensions(t)}},{key:"_createId",value:function(e){if(!e.addon_key||!e.key)throw Error("Extensions require addon_key and key");return e.addon_key+"__"+e.key+"__"+h["default"].randomString()}},{key:"create",value:function(e,t){var a=this.registerExtension(e,t),n={extension_id:a,api:this._xdm.getApiSpec(),origin:h["default"].locationOrigin(),options:e.options||{}};return{id:a,name:(0,o["default"])(n),src:e.url}}},{key:"registerRequestNotifier",value:function(e){this._xdm.registerRequestNotifier(e)}},{key:"registerExtension",value:function(e,t){var a=this._createId(e);return this._xdm.registerExtension(a,{extension:e,initCallback:t}),a}},{key:"registerKeyListener",value:function(e,t,a,n){this._xdm.registerKeyListener(e,t,a,n)}},{key:"unregisterKeyListener",value:function(e,t,a,n){this._xdm.unregisterKeyListener(e,t,a,n)}},{key:"defineModule",value:function(e,t){this._xdm.defineAPIModule(t,e)}},{key:"defineGlobals",value:function(e){this._xdm.defineAPIModule(e)}},{key:"getExtensions",value:function(e){return this._xdm.getRegisteredExtensions(e)}},{key:"unregisterExtension",value:function(e){return this._xdm.unregisterExtension(e)}}]),e}();e.exports=new p},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(23),o=n(i),s=a(389),r=n(s),l=a(100),u=n(l),c=a(10),d=n(c),f=a(4),h=n(f),p=a(5),_=n(p),m=a(22),g=n(m),v=a(51),y=n(v),b=a(392),w=n(b),R=a(393),k=n(R),E=3e4,C=function(e){function t(e){(0,h["default"])(this,t),e=e||{};var a=(0,g["default"])(this,(0,d["default"])(t).call(this,e));return a._registeredExtensions=e.extensions||{},a._registeredAPIModules={},a._pendingCallbacks={},a._keycodeCallbacks={},a._pendingEvents={},a._messageHandlers={init:a._handleInit,req:a._handleRequest,resp:a._handleResponse,event_query:a._handleEventQuery,broadcast:a._handleBroadcast,key_listen:a._handleKeyListen},a}return(0,y["default"])(t,e),(0,_["default"])(t,[{key:"_handleInit",value:function(e,t){this._registeredExtensions[t.extension_id].source=e.source,t.initCallback&&(t.initCallback(e.data.eid),delete t.initCallback)}},{key:"_handleResponse",value:function(e){var t=e.data,a=this._pendingCallbacks[t.mid];a&&(delete this._pendingCallbacks[t.mid],a.apply(window,t.args))}},{key:"registerRequestNotifier",value:function(e){this._registeredRequestNotifier=e}},{key:"_handleRequest",value:function(e,t){function a(){var a=w["default"].argumentsToArray(arguments);e.source.postMessage({mid:e.data.mid,type:"resp",args:a},t.extension.url)}var n=e.data,i=this._registeredAPIModules[n.mod],o=this.getRegisteredExtensions(t.extension)[0];if(i){var s=n.fn;n._cls&&!function(){var e=i[n._cls],t=n.mod+"-"+n._cls+"-";a._id=n._id,"constructor"===s?(e._construct||(e.constructor.prototype._destroy=function(){delete this._context._proxies[t+this._id]},e._construct=function(){for(var a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];var o=new(Function.prototype.bind.apply(e.constructor,[null].concat(n))),s=n[n.length-1];return o._id=s._id,o._context=s._context,o._context._proxies[t+o._id]=o,o}),i=e,s="_construct"):i=o._proxies[t+n._id]}();var r=i[s];if(r){var l=n.args;a._context=o,l.push(a),r.apply(i,l),this._registeredRequestNotifier&&this._registeredRequestNotifier.call(null,{module:n.mod,fn:n.fn,type:n.type,addon_key:t.extension.addon_key,key:t.extension.key,extension_id:t.extension_id})}}}},{key:"_handleBroadcast",value:function(e,t){var a=e.data,n=function(e){return e.extension.addon_key===t.extension.addon_key&&e.extension_id!==t.extension_id};this.dispatch(a.etyp,n,a.evnt,null,null)}},{key:"_handleKeyListen",value:function(e,t){var a=e.data,n=this._keycodeKey(a.keycode,a.modifiers,t.extension_id),i=this._keycodeCallbacks[n];i&&i.forEach(function(e){e.call(null,{addon_key:t.extension.addon_key,key:t.extension.key,extension_id:t.extension_id,keycode:a.keycode,modifiers:a.modifiers})},this)}},{key:"defineAPIModule",value:function(e,t){return t?this._registeredAPIModules[t]=e:this._registeredAPIModules._globals=w["default"].extend({},this._registeredAPIModules._globals,e),this._registeredAPIModules}},{key:"_fullKey",value:function(e){var t=e.addon_key||"global";return e.key&&(t=t+"@@"+e.key),t}},{key:"queueEvent",value:function(e,t,a,n){var i,o=this._findRegistrations(t);i=o.some(function(e){return void 0!==e.registered_events},this),i?this.dispatch(e,t,a,n):this._pendingEvents[this._fullKey(t)]={type:e,targetSpec:t,event:a,callback:n,time:(new Date).getTime(),uid:w["default"].randomString()}}},{key:"_handleEventQuery",value:function(e,t){var a=this,n={},i=(new Date).getTime(),o=(0,u["default"])(this._pendingEvents);return o.forEach(function(o){var s=a._pendingEvents[o],r=i-s.time<=E,l=!s.targetSpec||0!==a._findRegistrations(s.targetSpec).length;r&&l?(n[o]=s,s.targetSpec=s.targetSpec||{},s.targetSpec.addon_key=t.extension.addon_key,s.targetSpec.key=t.extension.key,a.dispatch(s.type,s.targetSpec,s.event,s.callback,e.source)):r||delete a._pendingEvents[o]}),this._registeredExtensions[t.extension_id].registered_events=e.data.args,n}},{key:"dispatch",value:function(e,t,a,n,i){function o(t,a){if(t.source){var i;n&&(i=w["default"].randomString(),this._pendingCallbacks[i]=n),t.source.postMessage({type:"evt",mid:i,etyp:e,evnt:a},t.extension.url)}}var s=this._findRegistrations(t||{});s.forEach(function(e){i&&(e.source=i),e.source&&w["default"]._bind(this,o)(e,a)},this)}},{key:"_findRegistrations",value:function(e){var t=this;if(0===this._registeredExtensions.length)return w["default"].error("no registered extensions",this._registeredExtensions),[];var a=(0,r["default"])(e),n=(0,r["default"])(this._registeredExtensions).map(function(e){return t._registeredExtensions[e]});return e instanceof Function?n.filter(e):n.filter(function(t){return a.every(function(a){return t.extension[a]===e[a]})})}},{key:"registerExtension",value:function(e,t){if(t.extension.addon_key&&t.extension.key){var a=this._findRegistrations({addon_key:t.extension.addon_key,key:t.extension.key});0!==a.length&&delete this._registeredExtensions[a[0].extension_id]}t._proxies={},t.extension_id=e,this._registeredExtensions[e]=t}},{key:"_keycodeKey",value:function(e,t,a){var n=e;return t&&("string"==typeof t&&(t=[t]),t.sort(),t.forEach(function(e){n+="$$"+e},this)),n+"__"+a}},{key:"registerKeyListener",value:function(e,t,a,n){"string"==typeof a&&(a=[a]);var i=this._registeredExtensions[e],o=this._keycodeKey(t,a,e);this._keycodeCallbacks[o]||(this._keycodeCallbacks[o]=[],i.source.postMessage({type:"key_listen",keycode:t,modifiers:a,action:"add"},i.source.location.href)),this._keycodeCallbacks[o].push(n)}},{key:"unregisterKeyListener",value:function(e,t,a,n){var i=this._keycodeKey(t,a,e),o=this._keycodeCallbacks[i],s=this._registeredExtensions[e];if(o){if(n){var r=o.indexOf(n);this._keycodeCallbacks[i].splice(r,1)}else delete this._keycodeCallbacks[i];s.source.postMessage({type:"key_listen",keycode:t,modifiers:a,action:"remove"},s.source.location.href)}}},{key:"getApiSpec",value:function(){function e(e){function a(e){return(0,r["default"])(e).reduce(function(t,n){var i=e[n];switch("undefined"==typeof i?"undefined":(0,o["default"])(i)){case"function":t[n]={args:w["default"].argumentNames(i)};break;case"object":i.hasOwnProperty("constructor")&&(t[n]=a(i))}return t},{})}var n=t._registeredAPIModules[e];if(!n)throw new Error("unregistered API module: "+e);return a(n)}var t=this;return(0,r["default"])(this._registeredAPIModules).reduce(function(t,a){return t[a]=e(a),t},{})}},{key:"_checkOrigin",value:function(e,t){var a=["init","event_query"],n=t&&!t.source&&a.indexOf(e.data.type)>-1,i=t&&e.source===t.source,o=t&&0===t.extension.url.indexOf(e.origin),s=o&&(n||i);return s||w["default"].warn("Failed to validate origin: "+e.origin),s}},{key:"getRegisteredExtensions",value:function(e){return e?this._findRegistrations(e):this._registeredExtensions}},{key:"unregisterExtension",value:function(e){var t=this._findRegistrations(e);0!==t.length&&t.forEach(function(e){var t=this,a=(0,u["default"])(this._pendingEvents);a.forEach(function(a){var n=t._pendingEvents[a],i=n.targetSpec||{};i.addon_key===e.extension.addon_key&&delete t._pendingEvents[a]}),delete this._registeredExtensions[e.extension_id]},this)}}]),t}(k["default"]);e.exports=C},function(e,t,a){e.exports={"default":a(390),__esModule:!0}},function(e,t,a){var n=a(8);a(391),e.exports=function(e){return n.getNames(e);
}},function(e,t,a){a(15)("getOwnPropertyNames",function(){return a(40).get})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(389),o=n(i),s=a(23),r=n(s),l=a(4),u=n(l),c=a(5),d=n(c),f="[Simple-XDM] ",h=function(){function e(){(0,u["default"])(this,e)}return(0,d["default"])(e,[{key:"locationOrigin",value:function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}},{key:"randomString",value:function(){return Math.floor(1e9*Math.random()).toString(16)}},{key:"isString",value:function(e){return"string"==typeof e||e instanceof String}},{key:"argumentsToArray",value:function(e){return Array.prototype.slice.call(e)}},{key:"argumentNames",value:function(e){return e.toString().replace(/((\/\/.*$)|(\/\*[^]*?\*\/))/gm,"").replace(/[^(]+\(([^)]*)[^]+/,"$1").match(/([^\s,]+)/g)||[]}},{key:"hasCallback",value:function(e){var t=e.length;return t>0&&"function"==typeof e[t-1]}},{key:"error",value:function(e){window.console&&console.error(f+e)}},{key:"warn",value:function(e){window.console&&console.warn(f+e)}},{key:"_bind",value:function(e,t){return Function.prototype.bind?t.bind(e):function(){return t.apply(e,arguments)}}},{key:"each",value:function(e,t){var a,n;if(e)if(a=e.length,null!=a&&"function"!=typeof e)for(n=0;a>n&&t.call(e[n],n,e[n])!==!1;)n+=1;else for(n in e)if(e.hasOwnProperty(n)&&t.call(e[n],n,e[n])===!1)break}},{key:"extend",value:function(e){var t=arguments,a=[].slice.call(t,1,t.length);return a.forEach(function(t){"object"===("undefined"==typeof t?"undefined":(0,r["default"])(t))&&(0,o["default"])(t).forEach(function(a){e[a]=t[a]})}),e}}]),e}();e.exports=new h},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(4),o=n(i),s=a(5),r=n(s),l=a(392),u=n(l),c=function(){function e(t){(0,o["default"])(this,e);var a=t||{};this._registerListener(a.listenOn)}return(0,r["default"])(e,[{key:"_registerListener",value:function(e){e&&e.addEventListener||(e=window),e.addEventListener("message",u["default"]._bind(this,this._receiveMessage),!1)}},{key:"_receiveMessage",value:function(e){var t=e.data.eid,a=void 0;if(t&&this._registeredExtensions&&(a=this._registeredExtensions[t]),!this._checkOrigin(e,a))return!1;var n=this._messageHandlers[e.data.type];n&&n.call(this,e,a)}}]),e}();e.exports=c},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(342),o=n(i),s=a(95),r=n(s),l=a(196),u=n(l),c=a(395),d=n(c),f=a(99),h=n(f);t["default"]=React.createClass({displayName:"QuickSwitcherDialog",mixins:[o["default"]],componentDidMount:function(){u["default"].quickSwitcherViewed(),document.querySelector("body").addEventListener("keydown",this._onKeyDown,!0),this._focusInput()},componentWillUnmount:function(){clearTimeout(this.timeout),document.querySelector("body").removeEventListener("keydown",this._onKeyDown,!0)},close:function(){this.timeout||(this.timeout=setTimeout(function(){r["default"].closeDialog()},300))},_onKeyDown:function(e){var t=window.Event?e.which:e.keyCode;t===h["default"].keyCode.Esc&&(e.stopPropagation(),e.preventDefault(),this.close())},_focusInput:function(){var e=$(ReactDOM.findDOMNode(this.refs.qs_content)).find("input");e.length&&e.focus()},render:function(){return React.createElement("section",{role:"dialog",id:"quick-switcher-dialog",className:"hc-qs","aria-hidden":!this.state.dialogVisible},React.createElement(d["default"],{ref:"qs_content",hideHint:this.props.hideHint}))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(396),o=n(i),s=a(399),r=n(s),l=a(400),u=n(l),c=a(401),d=n(c),f=a(161),h=n(f),p=a(196),m=n(p),g=a(166),v=n(g),y=a(397),b=n(y),w=a(402),R=n(w),k=a(403),E=n(k),C=a(99),S=n(C),T=a(313),x=n(T);t["default"]=React.createClass({displayName:"QuickSwitcherContent",componentDidMount:function(){d["default"].on(["change"],this._onChange),h["default"].on(["change:"+v["default"].SHOW_QUICK_SWITCHER_HINT],this._onChange),this._throttledScrollToSelected=_.throttle(this._scrollToSelected,100,{leading:!1,trailing:!0})},componentWillUnmount:function(){d["default"].off(["change"],this._onChange),h["default"].off(["change:"+v["default"].SHOW_QUICK_SWITCHER_HINT],this._onChange),b["default"].reset(),this._throttledScrollToSelected.cancel()},componentWillUpdate:function(e,t){0===t.total&&this.state.total>0&&m["default"].quickSwitcherNoResults(t.text)},componentDidUpdate:function(){ReactDOM.findDOMNode(this.refs.input.refs.input_field).focus()},getInitialState:function(){return this._getState()},_getState:function(){var e=d["default"].getAll();return{text:e.text,filtered:e.filtered,filtered_time:e.filtered_time,selected_item:e.selected_item,rows:e.list,total:e.list.length,show_hint:h["default"].getShowQuickSwitcherHint(),should_animate_avatar:h["default"].shouldAnimateAvatars()}},_onChange:function(){this.setState(this._getState())},_getEmptyState:function(){var e=null;return this.state.text&&!this.state.total&&this.state.filtered&&(e=React.createElement(r["default"],{ref:"empty_state"})),e},_getHint:function(){var e=null;return this.state.show_hint&&!this.props.hideHint&&(e=React.createElement(u["default"],{ref:"qs_hint",with_results:this.state.total>0})),e},_scrollTop:function(){this.refs.scrollable&&this.refs.scrollable.scrollTo(0)},_scrollToSelected:function(){if(this.refs.scrollable&&this.state.rows.length){var e=ReactDOM.findDOMNode(this.refs.scrollable_wrap),t=document.getElementsByClassName("hc-qs-item")[0].clientHeight,a=Math.ceil(e.scrollTop/t),n=Math.floor((e.clientHeight+e.scrollTop)/t);if(this.state.selected_item<a||this.state.selected_item>n-1){var i=e.querySelector(".hc-qs-item.selected");i||(i=e.querySelector(".hc-qs-item-container:last-child .hc-qs-item")),S["default"].scrollIntoViewIfNeeded(i,e,!1)}}},renderItem:function(e,t){var a,n=this.state.rows[e];if("user"===n.item_type){var i="@"+n.mention_match_markup;a=React.createElement(R["default"],{key:"qs-item-"+n.jid,name:n.name,id:n.id,name_markup:n.name_match_markup,mention_name:n.mention_name,mention_markup:i,jid:n.jid,photo_url:n.photo_url,show:n.presence_show,mobile:n.presence_mobile,idx:e,should_animate_avatar:this.state.should_animate_avatar,selected:this.state.selected_item===e})}else a=React.createElement(E["default"],{key:"qs-item-"+n.jid,name:n.name,name_markup:n.name_match_markup,jid:n.jid,privacy:n.privacy,idx:e,selected:this.state.selected_item===e});return React.createElement("div",{key:t,className:"hc-qs-item-container"},a)},render:function(){var e=(0,x["default"])({"hc-qs-list-wrap":!0,"with-hint":this.state.show_hint}),t=this._getEmptyState(),a=this._getHint();return React.createElement("div",{className:"hc-qs-content"},React.createElement(o["default"],{text:this.state.text,scrollTop:this._scrollTop,canNavigate:this.state.rows.length>0,scrollToSelected:this._throttledScrollToSelected,ref:"input"}),React.createElement("div",{ref:"scrollable_wrap",className:e},t,React.createElement(ReactList,{ref:"scrollable",itemRenderer:this.renderItem,length:this.state.rows.length,selected:this.state.selected_item,filtered_time:this.state.filtered_time,threshold:10,type:"simple"})),a)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(397),o=n(i),s=a(95),r=n(s),l=a(398),u=n(l),c=a(99),d=n(c),f=a(314),h=n(f),p=a(187),m=n(p);t["default"]=React.createClass({displayName:"QuickSwitcherInput",mixins:[h["default"]],propTypes:{scrollTop:React.PropTypes.func,scrollToSelected:React.PropTypes.func,text:React.PropTypes.string,canNavigate:React.PropTypes.bool},componentDidMount:function(){this.debouncedFilter=_.debounce(this._filter,150)},componentWillUnmount:function(){this.debouncedFilter.cancel()},_onInputChange:function(e){o["default"].setInputText({text:e.target.value}),this.debouncedFilter()},_filter:function(){o["default"].filter(),this.props.scrollTop()},_onKeyDown:function(e){if(e.keyCode===d["default"].keyCode.UpArrow||e.keyCode===d["default"].keyCode.DownArrow){if(e.preventDefault(),m["default"].useLatest(),!this.props.canNavigate)return;e.keyCode===d["default"].keyCode.UpArrow&&(o["default"].selectPrev(),this.props.scrollToSelected()),e.keyCode===d["default"].keyCode.DownArrow&&(o["default"].selectNext(),this.props.scrollToSelected())}else e.keyCode===d["default"].keyCode.Tab?e.preventDefault():e.keyCode===d["default"].keyCode.Enter&&(e.preventDefault(),r["default"].closeDialog(),o["default"].selectItem())},render:function(){var e=this.props.text.length?"hidden":"";return React.createElement("div",{className:"hc-qs-input-wrap"},React.createElement("form",{className:"aui",autoComplete:"off"},React.createElement("label",{ref:"input_label",htmlFor:"quickSwitcher",className:e},u["default"].input_placeholder),React.createElement("input",{name:"quickSwitcher",id:"quickSwitcher",className:"text long-field hc-qs-input",type:"text",ref:"input_field",onChange:this._onInputChange,onKeyDown:this._onKeyDown,value:this.props.text})))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i);t["default"]={setInputText:function(e){o["default"].dispatch("qs-input-value",e)},selectPrev:function(){o["default"].dispatch("qs-select-prev")},selectNext:function(){o["default"].dispatch("qs-select-next")},selectItem:function(){o["default"].dispatch("qs-select-item")},itemHovered:function(e){o["default"].dispatch("qs-item-hover",{index:e.index})},reset:function(){o["default"].dispatch("qs-reset")},filter:function(){o["default"].dispatch("qs-filter")},hideHint:function(){o["default"].dispatch("qs-hide-hint")}},e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={input_placeholder:"Find rooms and people",empty_state:"Nothing matches your search",hint_text:"Quickly open this dialog with"},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(398),o=n(i);t["default"]=React.createClass({displayName:"QuickSwitcherEmptyState",render:function(){return React.createElement("div",{className:"hc-qs-list"},React.createElement("div",{className:"hc-qs-item hc-qs-empty-state",ref:"text"},o["default"].empty_state))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(397),o=n(i),s=a(282),r=n(s),l=a(279),u=n(l),c=a(398),d=n(c),f=a(99),h=n(f),p=a(313),_=n(p);t["default"]=React.createClass({displayName:"QuickSwitcherHint",componentWillMount:function(){var e=u["default"].getCommandByTitle(r["default"].new_chat);e&&(this._keyCommand=e.join("+").toUpperCase())},getIcon:function(){var e=void 0;return e=h["default"].platform.isMac()?React.createElement("span",{className:"hc-qs-hint-key mac-hint-key"},r["default"].command):React.createElement("span",{className:"hc-qs-hint-key"},React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-info"}))},_onClick:function(){o["default"].hideHint()},render:function(){var e=(0,_["default"])({"hc-qs-hint":!0,hidden:!this._keyCommand,"with-results":this.props.with_results}),t=this.getIcon();return React.createElement("div",{className:e,ref:"hint"},t,React.createElement("span",{className:"hc-qs-hint-text"},d["default"].hint_text+" "+this._keyCommand),React.createElement("span",{onClick:this._onClick,ref:"close_hint",className:"aui-icon aui-icon-small aui-iconfont-remove-label hc-qs-hint-close"}))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(157),o=n(i),s=a(10),r=n(s),l=a(4),u=n(l),c=a(5),d=n(c),f=a(22),h=n(f),p=a(51),m=n(p),g=a(9),v=n(g),y=a(173),b=n(y),w=a(190),R=n(w),k=a(166),E=n(k),C=a(265),S=n(C),T=a(97),x=n(T),A=a(273),I=a(99),N=n(I),M=function(e){function t(){(0,u["default"])(this,t);var e=(0,h["default"])(this,(0,r["default"])(t).call(this));return e.local=e.getLocalDefaults(),e}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"getDefaults",value:function(){return{text:"",list:[],filtered:!1,filtered_time:null,selected_item:0}}},{key:"getLocalDefaults",value:function(){return{enabled:!1,all:[],active:{},rooms:[],roster:[]}}},{key:"registerListeners",value:function(){var e=this;v["default"].register({"qs-input-value":function(t){e.handleInputValueChange(t.text)},"qs-item-hover":function(t){e.set({selected_item:t.index})},"qs-select-item":function(){e.selectItem()},"qs-select-prev":function(){e.selectPrev()},"qs-select-next":function(){e.selectNext()},"qs-filter":function(){e.filterList(!0)},"qs-reset":function(){e.resetQuickSwitcher()},"qs-hide-hint":function(){e.hideHint()},"before:show-modal-dialog":function(t){e.enableQuickSwitcher(t)},"before:hide-modal-dialog":function(){e.disableQuickSwitcher()},"updated:roster":function(){e.local.enabled&&(e.setupLocalData(),e.filterList())}})}},{key:"enableQuickSwitcher",value:function(e){this.local.enabled||"quick-switcher-dialog"!==_.get(e,"dialog_type")||(this.local.enabled=!0,this.setupLocalData())}},{key:"disableQuickSwitcher",value:function(){this.local.enabled&&this.clearLocalData()}},{key:"setupLocalData",value:function(){this.updateRooms(R["default"].get("allRooms")),this.updateActive(R["default"].get("activeRooms")),this.updateRoster(R["default"].get("roster"))}},{key:"clearLocalData",value:function(){this.local=this.getLocalDefaults()}},{key:"filterList",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],t=this.data.text;if(t){var a=_.keysIn(this.local.active),n=(0,A.chatSearch)(this.local.all,t,a);(e||this.data.selected_item>n.length-1)&&(this.data.selected_item=0),this.set({list:n,filtered_time:(new Date).getTime(),selected_item:this.data.selected_item,filtered:!0})}else this.set({list:[],selected_item:0,filtered_time:null,filtered:!1})}},{key:"handleInputValueChange",value:function(e){this.set({text:e,filtered:!1})}},{key:"updateAll",value:function(){var e=this;this.local.all=_.map(this.local.all,function(t){return e.local.active[t.jid]?_.assign(t,e.local.active[t.jid]):_.assign(t,{unreadCount:0,unreadMentionCount:0,hasMention:!1}),t})}},{key:"updateActive",value:function(e){this.local.active=_.mapValues(e,function(e){return _.pick(e,"unreadCount","unreadMentionCount","hasMention")}),this.updateAll()}},{key:"updateRooms",value:function(e){var t=[];_.forOwn(e,function(e){t.push({item_type:"room",name:e.name,jid:e.jid,privacy:e.privacy})}),this.local.rooms=t,this.updateAndConcatAll()}},{key:"removeGuests",value:function(e){return _.reject(e,N["default"].user.is_guest)}},{key:"mapUserData",value:function(e){return{item_type:"user",id:e.id,name:e.display_name||e.name,mention_name:e.mention_name,jid:e.jid,photo_url:e.photo_url,presence_show:e.presence.show,presence_mobile:e.presence.mobile}}},{key:"updateRoster",value:function(e){var t=_.values(e);this.local.roster=this.removeGuests(t).map(this.mapUserData),this.updateAndConcatAll()}},{key:"updateAndConcatAll",value:function(){this.local.all=[].concat(this.local.roster,this.local.rooms),this.updateAll()}},{key:"selectItem",value:function(){var e=this.data.list[this.data.selected_item];e&&(v["default"].dispatch("set-route",{jid:e.jid}),b["default"].dispatch("analytics-open-room",{jid:e.jid,source:"switcher"}))}},{key:"selectNext",value:function(){var e;this.data.selected_item!==this.data.list.length-1&&(e=this.data.selected_item+1),this.set("selected_item",e)}},{key:"selectPrev",value:function(){var e;0!==this.data.selected_item&&(e=this.data.selected_item-1),this.set("selected_item",e)}},{key:"resetQuickSwitcher",value:function(){this.set({text:"",list:[],selected_item:0,filtered:!1})}},{key:"hideHint",value:function(){S["default"].savePreferences((0,o["default"])({},E["default"].SHOW_QUICK_SWITCHER_HINT,!1))}}]),t}(x["default"]);t["default"]=new M,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(310),o=n(i),s=a(397),r=n(s),l=a(95),u=n(l),c=a(313),d=n(c),f=a(314),h=n(f),p=a(187),_=n(p);t["default"]=React.createClass({displayName:"QuickSwitcherPerson",mixins:[h["default"]],propTypes:{selected:React.PropTypes.bool,photo_url:React.PropTypes.string,name:React.PropTypes.string,name_markup:React.PropTypes.string,mention_name:React.PropTypes.string,mention_markup:React.PropTypes.string,show:React.PropTypes.string,mobile:React.PropTypes.string,idx:React.PropTypes.number,id:React.PropTypes.oneOfType([React.PropTypes.number,React.PropTypes.string]),should_animate_avatar:React.PropTypes.bool},_onEnter:function(e){_["default"].hasChanged(e)&&r["default"].itemHovered({index:this.props.idx})},_onClick:function(e){e.preventDefault(),u["default"].closeDialog(),r["default"].selectItem()},render:function(){var e=(0,d["default"])({"hc-qs-item":!0,selected:this.props.selected});return React.createElement("div",{className:e,onClick:this._onClick,onMouseEnter:this._onEnter},React.createElement("span",{className:"hc-qs-aui-avatar"},React.createElement(o["default"],{avatar_url:this.props.photo_url,size:"medium",uid:this.props.id,presence:this.props.show,mobile:this.props.mobile,shouldAnimate:this.props.should_animate_avatar,active:"false"})),React.createElement("span",{className:"hc-qs-name",dangerouslySetInnerHTML:{__html:this.props.name_markup||this.props.name}}),React.createElement("span",{className:"hc-qs-mention-name",dangerouslySetInnerHTML:{__html:this.props.mention_markup||this.props.mention_name}}))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(397),o=n(i),s=a(95),r=n(s),l=a(313),u=n(l),c=a(314),d=n(c),f=a(187),h=n(f);t["default"]=React.createClass({displayName:"QuickSwitcherRoom",mixins:[d["default"]],propTypes:{selected:React.PropTypes.bool,name:React.PropTypes.string,name_markup:React.PropTypes.string,privacy:React.PropTypes.string,idx:React.PropTypes.number},_onEnter:function(e){h["default"].hasChanged(e)&&o["default"].itemHovered({index:this.props.idx})},_onClick:function(e){e.preventDefault(),r["default"].closeDialog(),o["default"].selectItem()},render:function(){var e=(0,u["default"])({"hc-qs-item":!0,selected:this.props.selected});return React.createElement("div",{className:e,onClick:this._onClick,onMouseEnter:this._onEnter},React.createElement("span",{className:"hc-qs-room-icon aui-icon hipchat-icon-medium icon-"+(this.props.privacy||"dot")}),React.createElement("span",{className:"hc-qs-name",dangerouslySetInnerHTML:{__html:this.props.name_markup||this.props.name}}))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(342),o=n(i),s=a(95),r=n(s),l=a(405),u=n(l),c=a(121),d=n(c),f=a(99),h=n(f),p=a(196),m=n(p);t["default"]=React.createClass({displayName:"InviteTeammatesDialog",mixins:[o["default"]],componentDidMount:function(){var e=this;this._setClientCookie(),this._getIframe().on("load",this._onIframeLoad),this.spinTimer=_.delay(function(){e._getIframe().hasClass("loaded")||AJS.$("#invite-teammates-dialog >.aui-dialog2-content").spin("large")},d["default"].modal_transition_allowance),$(window).on("beforeunload",this._removeClientCookie)},componentWillUnmount:function(){this._removeClientCookie(),clearTimeout(this.spinTimer),this._getIframe().off("load",this._onIframeLoad),$(window).off("beforeunload",this._removeClientCookie)},_setClientCookie:function(){u["default"].setItem("client","web")},_removeClientCookie:function(){u["default"].removeItem("client","web")},_onIframeLoad:function(){var e=this;AJS.$("#invite-teammates-dialog >.aui-dialog2-content").spinStop(),this._getIframe().addClass("loaded");var t=$(this._getIframeBody());t.find("#btn_copy_invite_link").remove(),t.find(".external-link").click(function(t){var a=$(t.target);a.attr("target","_blank"),a.attr("href",e._getExternalUrl(a.attr("href")))}),t.find("a[href='#hcnative:close']").click(this._close),t.on("keydown",this._onKeyDown),t.find("#btn_send_invites").click(function(t){if("true"!==$(t.target).attr("aria-disabled")){var a=$(t.target).text().replace(/\D/g,"");e.state.dialogData&&e.state.dialogData.type&&m["default"].inviteTeamSent(e.state.dialogData.type,a)}})},_getExternalUrl:function(e){var t,a="#hcnative:externalLinkClicked:",n=e.indexOf(a);if(n>-1){var i=decodeURIComponent(e.substr(n+a.length));try{var o=JSON.parse(i);t=o.url}catch(s){t=null}}return t},_getIframe:function(){return $(ReactDOM.findDOMNode(this.refs.inviteUsersIframe))},_getIframeBody:function(){return _.get(this._getIframe().get(0),"contentWindow.document.body")},_close:function(){r["default"].closeDialog()},_onKeyDown:function(e){var t=window.Event?e.which:e.keyCode;t===h["default"].keyCode.Esc&&this._close()},_dialogBody:function(){return React.createElement("iframe",{ref:"inviteUsersIframe",id:"invite-users-frame",src:"https://"+this.props.web_server+"/native/invite?default_text="+(this.props.default_text||"")})},render:function(){return React.createElement("section",{role:"dialog",id:"invite-teammates-dialog",className:"aui-layer aui-dialog2 aui-dialog2-medium","aria-hidden":!this.state.dialogVisible},React.createElement("div",{className:"aui-dialog2-content"},this._dialogBody()))}}),e.exports=t["default"]},function(e,t){"use strict";e.exports={getItem:function(e){return e?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},setItem:function(e,t,a,n,i,o){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var s="";if(a)switch(a.constructor){case Number:s=a===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+a;break;case String:s="; expires="+a;break;case Date:s="; expires="+a.toUTCString()}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+s+(i?"; domain="+i:"")+(n?"; path="+n:"")+(o?"; secure":""),!0},removeItem:function(e,t,a){return this.hasItem(e)?(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(a?"; domain="+a:"")+(t?"; path="+t:""),!0):!1},hasItem:function(e){return e?new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie):!1},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=e.length,a=0;t>a;a++)e[a]=decodeURIComponent(e[a]);return e}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(341),o=n(i),s=a(368),r=n(s),l=a(95),u=n(l),c=a(204),d=n(c),f=a(203),h=n(f),p=a(287),_=n(p),m=a(342),g=n(m);t["default"]=React.createClass({displayName:"GuestAccessDialog",mixins:[g["default"]],getInitialState:function(){return this._getActiveChatState()},_getActiveChatState:function(){return{active_chat:r["default"].get("active_chat"),rooms:r["default"].get("rooms")}},_dialogBody:function(){return React.createElement("div",null,React.createElement("p",null,React.createElement("strong",null,h["default"].really_disable_guest)),React.createElement("p",null,h["default"].confirm_disable_guest))},_dialogFooterButton:function(){return React.createElement("button",{onClick:this._onFooterButtonClicked,className:"aui-button aui-button-primary","aria-disabled":this.state.btnLoading,disabled:this.state.btnLoading},h["default"].ok)},_onFooterButtonClicked:function(e){e.preventDefault(),this._disableGuestAccess()},_disableGuestAccess:function(){u["default"].startBtnLoading(),_["default"].disableGuestAccess({jid:this.state.active_chat},this._disableGuestCallback)},_disableGuestCallback:function(e){e&&this._throwFlagError(e.message||h["default"].disable_guest_fail),u["default"].closeDialog()},_throwFlagError:function(e){d["default"].showFlag({type:"error",body:this._flagBody(e),close:"manual"})},_flagBody:function(e){var t=this;return function(){return React.createElement("div",null,React.createElement("p",{className:"hc-message-body"},e),React.createElement("ul",{className:"aui-nav-actions-list"},React.createElement("li",null,React.createElement("a",{onClick:t._flagActionClick,href:"#"},h["default"].try_again))))}},_flagActionClick:function(e){e.preventDefault();var t=$(e.target).closest(".flag").data("flag-index");d["default"].removeFlag(t),this._showDialog()},_showDialog:function(){u["default"].showDisableGuestAccessDialog()},render:function(){return React.createElement(o["default"],{dialogId:"disable-guest-dialog",title:h["default"].disable_guest,dialogBody:this._dialogBody,dialogFooterButton:this._dialogFooterButton,btnLoading:this.state.btnLoading,closeLinkText:h["default"].cancel})}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(341),o=n(i),s=a(203),r=n(s),l=a(408),u=n(l),c=a(369),d=n(c);e.exports=React.createClass({displayName:"RoomNotificationsDialog",mixins:[d["default"]],_dialogBody:function(){return React.createElement(u["default"],{jid:this.props.jid,room_name:this.props.room_name})},render:function(){return React.createElement(o["default"],{dialogId:"room-notifications-dialog",title:r["default"].room_notifications,size:"small",dialogBody:this._dialogBody,noCloseLink:!0})}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(357),o=n(i),s=a(349),r=n(s),l=a(95),u=n(l),c=a(262),d=n(c),f=a(203),h=n(f),p=a(161),m=n(p),g=a(292),v=n(g),y=a(196),b=n(y);e.exports=React.createClass({displayName:"RoomNotificationsForm",getInitialState:function(){return this._getState()},_getNotificationSettings:function(){return _.get(m["default"].getRoomNotificationOverrides(),this.props.jid,{})},_saveNotificationSettings:function(e){"global"===e.level?m["default"].removeRoomNotificationOverride(this.props.jid):m["default"].overrideNotificationForRoom(this.props.jid,e)},_getSelection:function(e){var t=_.get(e,"target.id","notif-global"),a={is_overridden:!0};switch(t){case"notif-loud":a.level="loud";break;case"notif-normal":a.level="normal";break;case"notif-quiet":a.level="quiet";break;case"notif-custom":a.level=this.state.global_setting;break;case"notif-global":a.level="global",a.is_overridden=!1}return a},_onChange:function(e){var t=this._getSelection(e);this.state.level===t.level&&this.state.is_overridden===t.is_overridden||b["default"].roomNotificationLevelChanged(this.state.level,t.level);var a=_.merge({},this._getState(),{level:t.level,is_overridden:t.is_overridden});this.setState(a),this._saveNotificationSettings({level:t.level})},_getState:function(){var e=m["default"].getGlobalNotificationSetting(),t=this._getNotificationSettings(),a=_.get(t,"level","global"),n="global"!==a;return{mention:v["default"].get("mention")||"",global_setting:e,level:a,is_overridden:n}},_showSettingsDialog:function(){u["default"].showSettingDialog({activeTab:h["default"].notifications})},_closeDialog:function(){u["default"].closeDialog()},_getDefaultLabelDecoration:function(){var e="icon-volume-"+this.state.global_setting,t=d["default"].label[this.state.global_setting],a="aui-icon hipchat-icon-small global "+e;return React.createElement("span",null,React.createElement("span",{className:a},t),React.createElement("span",{className:"global-level-label"},t))},render:function(){var e=this._getDefaultLabelDecoration();return React.createElement("div",null,React.createElement("div",{className:"heading"},React.createElement("span",{className:"prefix"},d["default"].description.notif_header_prefix),React.createElement("span",{className:"room-name",title:this.props.room_name},this.props.room_name),React.createElement("div",{className:"settings-info"},d["default"].description.notif_settings_info_prefix,React.createElement("a",{onClick:this._showSettingsDialog},d["default"].description.notif_settings_link),d["default"].description.notif_settings_info_suffix)),React.createElement("form",{id:"room-notifications-form",ref:"form",className:"aui",onChange:this._onChange},React.createElement(o["default"],{ref:"global"},e,React.createElement(r["default"],{id:"notif-global",name:"override",className:"notif-global-radio",defaultChecked:"global"===this.state.level,checked:!this.state.is_overridden,value:"global",label:d["default"].label.default_text}),React.createElement(r["default"],{id:"notif-custom",name:"override",defaultChecked:this.state.is_overridden,checked:this.state.is_overridden,value:"custom",label:d["default"].label.custom})),React.createElement(o["default"],{ref:"override-opts",className:"override-opts"},React.createElement(r["default"],{id:"notif-loud",name:"notification",defaultChecked:"loud"===this.state.level,checked:this.state.is_overridden&&"loud"===this.state.level,value:"loud",label:d["default"].label.loud,icon:"volume-loud",description:d["default"].description.notif_loud}),React.createElement(r["default"],{id:"notif-normal",name:"notification",defaultChecked:"normal"===this.state.level,checked:this.state.is_overridden&&"normal"===this.state.level,value:"normal",label:d["default"].label.normal,icon:"volume-normal",description:d["default"].description.notif_normal(this.state.mention)}),React.createElement(r["default"],{id:"notif-quiet",name:"notification",defaultChecked:"quiet"===this.state.level,checked:this.state.is_overridden&&"quiet"===this.state.level,value:"quiet",label:d["default"].label.quiet,icon:"volume-quiet",description:d["default"].description.notif_quiet(this.state.mention)}))))}})},function(e,t,a){"use strict";var n=a(341),i=a(282);e.exports=React.createClass({displayName:"KeyboardShortcutsDialog",getDefaultProps:function(){return{shortcuts:{}}},_getKeyItem:function(e,t){var a=this._getKeyLayout(e.keys);return React.createElement("li",{className:"hc-list-item",key:t},React.createElement("span",{className:"hc-list-item-desc"},e.title),a)},_getKeyLayout:function(e){var t=this;return React.createElement("span",{className:"hc-list-item-action"},_.map(e,function(e,a){return t._getKey(e,a)}))},_getKey:function(e,t){var a,n="hc-key-"+e.type,o=e.name;return a=0!==t?React.createElement("span",{key:t},React.createElement("span",{className:"hc-key-separator"},i.separator),React.createElement("kbd",{className:n},o)):React.createElement("kbd",{className:n,key:t},o)},_dialogBody:function(){var e=this;return React.createElement("ul",{className:"hc-list"},_.map(this.props.shortcuts,function(t,a){return e._getKeyItem(t,a)}))},render:function(){var e={dialogId:"keyboard-shortcuts-dialog",title:"Keyboard Shortcuts",dialogBody:this._dialogBody,size:"medium"};return React.createElement(n,e)}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){switch(e){case"qt":return i(t);case"windows":return"qtwindows";case"linux":return"qtlinux";default:return e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(383),s=n(o),r=a(121),l=n(r),u=a(411),c=n(u),d=a(95),f=n(d),h=a(190),p=n(h);t["default"]=React.createClass({displayName:"ReleaseNotesDialog",getInitialState:function(){return{asset_base_uri:p["default"].get("asset_base_uri"),client_version_id:p["default"].get("client_version_id"),endpoint:i(p["default"].get("client_type"),p["default"].get("client_subtype"))}},_onClick:function(){f["default"].closeDialog()},_dialogBody:function(){return React.createElement("div",{className:"release-notes"},React.createElement("img",{src:this.state.asset_base_uri+l["default"].new_hotness_image_asset}),React.createElement("h2",{
className:"release-notes-header"},c["default"].header),React.createElement("div",{className:"inner-content"},React.createElement("iframe",{ref:"iframe",src:"https://www.hipchat.com/release_notes/client_embed/"+this.state.endpoint+"?version_str="+this.state.client_version_id})),React.createElement("button",{className:"aui-button aui-button-primary",onClick:this._onClick},c["default"].close))},render:function(){return React.createElement(s["default"],{dialogId:"release-notes-dialog",dialogBody:this._dialogBody,size:"small"})}}),e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={header:"Release Notes",close:"Close"},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(341),o=n(i),s=a(413),r=n(s),l=a(436),u=n(l),c=a(428),d=n(c),f=a(427),h=n(f),p=a(161),m=n(p),g=a(121),v=n(g),y=a(99),b=n(y),w=a(90),R=n(w),k=a(203),E=n(k),C=a(329),S=n(C),T=a(425),x=n(T),A=a(437),I=n(A);e.exports=React.createClass({displayName:"IntegrationDialog",propTypes:{integration:React.PropTypes.shape({full_key:React.PropTypes.string.isRequired}).isRequired,room_id:React.PropTypes.string.isRequired,init_event:React.PropTypes.object},componentWillMount:function(){this.filterChange=_.debounce(h["default"].filterChange,v["default"].dialog.filter_debounce_wait)},componentDidMount:function(){d["default"].on("change",this._onChange),u["default"].onIntegrationViewStatusChange(this.props.room_id,this.props.integration.full_key,this._onChange),m["default"].on("change:theme",this._onChange)},componentWillUnmount:function(){d["default"].off("change",this._onChange),u["default"].offIntegrationViewStatusChange(this.props.room_id,this.props.integration.full_key,this._onChange),m["default"].off("change:theme",this._onChange)},getInitialState:function(){return _.merge({view:{signed_url_loading:!0}},this._getState())},_onChange:function(){this.setState(this._getState())},_getState:function(){return{dialog:d["default"].getAll(),view:u["default"].getIntegrationViewStatus(this.props.room_id,this.props.integration.full_key)||{},theme:m["default"].get("theme")}},_renderErrorFrame:function(){return this.state.view.error?React.createElement("div",{className:"hc-integrations-error"},React.createElement("div",{className:"hc-integrations-error-image"}),React.createElement("p",null,I["default"].integration_failed_to_load),React.createElement("button",{onClick:this._retryLoadingPanel,className:"aui-button aui-button-primary"},I["default"].retry)):null},_renderIntegrationFrame:function(){if(!this._canRender())return null;var e=b["default"].appendQueryParameter(this.state.view.signed_url,"theme",this.state.theme);return React.createElement(r["default"],{integration:this.state.dialog,signed_url:e,room_id:this.props.room_id,init_event:this.props.init_event})},_dialogBody:function(){var e=!1,t="hc-integration-view-dialog";return this.props.integration.internal||(e=this.state.view.signed_url_loading||this.state.view.signed_url&&this.state.view.frame_loading!==!1,t+=" hc-integration-view-dialog-loading"),React.createElement("div",{className:t},React.createElement(S["default"],{spin:e}),this._renderIntegrationFrame(),this._renderErrorFrame())},_dialogFilterPlaceholder:function(){var e=this.state.dialog.options.filter;return e?e.placeholder:""},_dialogFooterButton:function(){var e=this.state.dialog.options.primaryAction;return e?this._renderButton(e,"aui-button-primary"):void 0},_dialogFooterLinks:function(){var e=this,t=this.state.dialog.options.secondaryActions;return t?_.map(t,function(t,a){var n=e.props.integration.full_key+":"+a;return e._renderButton(t,"aui-button-link",n)}):this._renderButton({enabled:!0,name:E["default"].close},"aui-button-link")},_renderButton:function(e,t,a){var n=!_.get(e,"enabled",!0);return React.createElement("button",{"aria-disabled":n,disabled:n,className:"aui-button "+t,key:a,onClick:this._onButtonClick,"data-action-key":e.key},e.name)},_isWarning:function(){return"warning"===this.state.dialog.options.style},_auiDialogSize:function(){var e=this.state.dialog.options.size;return _.isString(e)?e:"medium"},_customDialogWidth:function(){return this._customDialogDimension("width",$(window).width())},_customDialogHeight:function(){return this._customDialogDimension("height",$(window).height()-v["default"].dialog.max_size_margin)},_customDialogDimension:function(e,t){var a=_.get(this.state.dialog.options,["size",e]);if(a){var n=b["default"].strings.splitUnit(a);if(n)switch(n.unit){case"%":return Math.min(100,n.num)+"%";case"px":return Math.min(t,n.num)+"px";default:R["default"].error("[HC-Integrations]","Unsupported unit: "+n.unit)}else R["default"].error("[HC-Integrations]","Unsupported  format: "+a)}},_onButtonClick:function(e){var t=e.target.getAttribute("data-action-key");h["default"].buttonClick(this.state.dialog,t)},_onFilterChange:function(e){this.filterChange(this.state.dialog,e.target.value)},_canRender:function(){return _.isString(this.state.view.signed_url)&&_.isString(this.state.dialog.addon_key)&&_.isString(this.state.dialog.key)},render:function(){return React.createElement(o["default"],{dialogId:"integration-dialog",size:this._auiDialogSize(),customWidth:this._customDialogWidth(),customHeight:this._customDialogHeight(),title:this.state.dialog.title,dialogBody:this._dialogBody,dialogFilter:!!this.state.dialog.options.filter,dialogFilterPlaceholder:this._dialogFilterPlaceholder(),dialogFilterCallback:this._onFilterChange,dialogFooterButton:this._dialogFooterButton,dialogFooterLinks:this._dialogFooterLinks,hint:this.state.dialog.options.hint,isWarning:this._isWarning(),noCloseLink:!0})},_retryLoadingPanel:function(){this.state.view.error&&x["default"].fetchSignedUrl(this.state.dialog,this.props.room_id,this.state.view.url_template_values)}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(314),o=n(i),s=a(386),r=n(s),l=a(414),u=n(l),c=a(425),d=n(c),f=a(99),h=n(f),p=a(90),_=n(p);e.exports=React.createClass({displayName:"IntegrationFrameView",propTypes:{integration:React.PropTypes.shape({addon_key:React.PropTypes.string.isRequired,key:React.PropTypes.string.isRequired}).isRequired,signed_url:React.PropTypes.string.isRequired,room_id:React.PropTypes.string.isRequired,init_event:React.PropTypes.object},mixins:[o["default"]],getInitialState:function(){u["default"].registerModules();var e=r["default"].create(this.props.integration);return{xdm:e}},componentWillUnmount:function(){r["default"].unregisterExtension({addon_key:this.props.integration.addon_key,key:this.props.integration.key})},componentDidMount:function(){this._dispatchInitEvent()},componentDidUpdate:function(){this._dispatchInitEvent()},_dispatchInitEvent:function(){this.props.init_event&&(_["default"].debug("[HC-Integrations]","Dispatching event "+this.props.init_event.event+" to "+this.props.integration.full_key,this.props.init_event.parameters),r["default"].dispatch(this.props.init_event.event,this.props.integration,this.props.init_event.parameters))},_onLoad:function(){d["default"].iframeLoaded({integration:this.props.integration,room_id:this.props.room_id,duration:Math.floor(h["default"].timings.now()-this.startTimestamp)})},render:function(){this.startTimestamp=h["default"].timings.now();var e=this.state.xdm;return React.createElement("iframe",{className:"hc-addon-iframe",id:e.id,name:e.name,src:this.props.signed_url,onLoad:this._onLoad})}})},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.modules=void 0;var o=a(4),s=i(o),r=a(5),l=i(r),u=a(386),c=i(u),d=a(9),f=i(d),h=a(415),p=n(h),m=a(419),g=n(m),v=a(426),y=n(v),b=a(429),w=n(b),R=a(432),k=n(R),E=a(433),C=n(E),S=a(434),T=n(S);f["default"].register("integration-iframe-event",function(e,t,a){c["default"].broadcast(e,t,a)});var x=t.modules={dialog:y,sidebar:k,room:w,chat:g,auth:p,user:C,file:T},A=function(){function e(){(0,s["default"])(this,e)}return(0,l["default"])(e,[{key:"registerModules",value:function(){_.each(x,function(e,t){c["default"].defineModule(t,e)})}}]),e}();t["default"]=new A},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=e._context.extension,a=l["default"].getActiveChat().id;s["default"].getToken(t,a).then(function(t){e(null,t.getToken())})["catch"](function(n){c["default"].error("[HC-Integrations]","Unable to create token for '"+t.full_key+"' in room "+a,n),e({message:"Unable to create token"})})}Object.defineProperty(t,"__esModule",{value:!0}),t.withToken=i;var o=a(416),s=n(o),r=a(264),l=n(r),u=a(90),c=n(u)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(127),o=n(i),s=a(59),r=n(s),l=a(4),u=n(l),c=a(5),d=n(c),f=a(9),h=n(f),p=a(206),m=n(p),g=a(417),v=n(g),y=a(90),b=n(y),w=a(418),R=6e4,k=function(){function e(){var t=this;(0,u["default"])(this,e),this.cache={},this._pruneCacheThrottled=_.throttle(this._pruneCache,R),h["default"].register(w.event_names.ON_INTEGRATIONS_UPDATE_SUMMARY,function(e){return t._clear(e)})}return(0,d["default"])(e,[{key:"getToken",value:function(e,t){var a=this;return this._pruneCacheThrottled(),new r["default"](function(n,i){var o=a._get(e,t);o&&!o.expiresSoon()?n(o):m["default"].getSignedUrl({extension:e,room_id:t},{},function(s,r){if(s&&!s.error&&r.status<400)try{o=a._set(e,t,s.jwt),n(o)}catch(l){b["default"].error("[HC-Integrations]","Invalid token ("+s.jwt+"): "+l.message),i()}else{var u="Error while fetching token ("+r.status+")";b["default"].error("[HC-Integrations]",u,s),i()}})})}},{key:"_get",value:function(e,t){return _.get(this.cache,[t,e.addon_key,e.key])}},{key:"_set",value:function(e,t,a){var n=v["default"].parse(a);return _.set(this.cache,[t,e.addon_key,e.key],n),n}},{key:"_pruneCache",value:function(){this.cache=_.mapValues(this.cache,function(e){return _.mapValues(e,function(e){return _.omitBy(e,function(e){return e.isExpired()})})}),this.cache=_.omitBy(this.cache,function(e){return _.isEmpty(e)}),b["default"].debug("[HC-Integrations]","Token cache pruned",this.cache)}},{key:"_clear",value:function(e){var t=this;_.forOwn(e,function(e,a){var n=(0,o["default"])(e,2),i=n[0],s=n[1],r=_.flatten([i,s]),l=_.map(r,function(e){return e.addon_key}),u="global"===a?_.keys(t.cache):[a];_.each(u,function(e){var a=_.get(t.cache,[e],{});_.set(t.cache,[e],_.omit(a,l))}),b["default"].debug("[HC-Integrations]","Token invalidated for "+l,t.cache)})}}]),e}();t["default"]=new k,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){return Math.floor(Date.now()/1e3)}Object.defineProperty(t,"__esModule",{value:!0});var o=a(4),s=n(o),r=a(5),l=n(r),u=120,c=function(){function e(t,a){(0,s["default"])(this,e),this.jwt=t,this.token=a}return(0,l["default"])(e,null,[{key:"parse",value:function(t){var a=t.split(".");if(3!==a.length)throw new Error("Invalid JWT format: "+t);var n=JSON.parse(atob(a[1]));return new e(n,t)}}]),(0,l["default"])(e,[{key:"isExpired",value:function(){return i()>this.jwt.exp}},{key:"expiresSoon",value:function(){return i()+u>this.jwt.exp}},{key:"getToken",value:function(){return this.token}}]),e}();t["default"]=c,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.extension_types=t.glance_room_states=t.states=t.event_names=void 0;var i=a(136),o=n(i);t.event_names=(0,o["default"])({REMOVE_DATA_FOR_ROOMS:"integrations-remove-data-for-rooms",ON_INTEGRATIONS_REMOVED:"integrations-removed",ON_INTEGRATIONS_UPDATED:"integration-update",ON_INTEGRATIONS_UPDATE_SUMMARY:"integrations-update-summary"}),t.states=(0,o["default"])({INIT:"init",STARTING:"starting",STARTED:"started",STOPPED:"stopped",DISABLED:"disabled",ERROR:"error"}),t.glance_room_states=(0,o["default"])({WAITING:"waiting",INIT:"init",LOADING:"loading",LOADED:"loaded",DIRTY:"dirty"}),t.extension_types=(0,o["default"])({GLANCE:"glance",DIALOG:"dialog",ACTION:"action",EXTERNAL_PAGE:"externalPage",WEB_PANEL:"webPanel"})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){l["default"].focusChatText()}function o(e){var t="string"==typeof e?e:"";c["default"].appendMessage({text:t})}function s(e,t){c["default"].addFileForUploadWithBase64(e,t,"paste")}Object.defineProperty(t,"__esModule",{value:!0}),t.focus=i,t.appendMessage=o,t.addFileForUploadWithBase64=s;var r=a(420),l=n(r),u=a(264),c=n(u)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(59),o=n(i),s=a(9),r=n(s),l=a(95),u=n(l),c=a(90),d=n(c),f=a(93),h=n(f),p=a(167),m=n(p),g=a(421),v=n(g),y=a(173),b=n(y),w=a(425),R=n(w),k=a(198);e.exports={invokeAction:function(e){var t=this,a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return b["default"].dispatch("analytics-event",{name:"hipchat.client.integrations.action.invoke",properties:{addon_key:e.addon_key,action_key:e.full_key,target_key:e.target.key}}),a.msg&&a.msg.file_data&&a.msg.file_data.is_authenticated&&!a.msg.file_data.fetched_url?void r["default"].dispatch("API:fetch-signed-file",a.msg.file_data,function(n){return a.msg.file_data.fetched_url=n.temp_url,t._initOpen(e,a)}):this._initOpen(e,a)},_initOpen:function(e,t){var a=_.cloneDeep(t.msg);a&&a.file_data&&a.file_data.fetched_url&&(a.file_data.url=a.file_data.fetched_url);var n=m["default"].extractIntegrationParametersFromMessage(a);return this.open(e.addon_key,e.target.key,{event:e.key,parameters:n,urlTemplateValues:{message:n}})},openDialog:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],n=arguments.length<=3||void 0===arguments[3]?"":arguments[3];return this.open(e,t,a,["dialog"],n)},openSidebarView:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],n=arguments.length<=3||void 0===arguments[3]?"":arguments[3];return this.open(e,t,a,["webPanel","glance"],n)},openExternalPage:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],n=arguments.length<=3||void 0===arguments[3]?"":arguments[3];return this.open(e,t,a,["externalPage"],n)},closeSidebarView:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];r["default"].dispatch("show-sidebar-integration",{activeIntegration:null}),b["default"].dispatch("analytics-event",{name:"hipchat.client.integrations.action.close.view",properties:{source:e}})},open:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],n=arguments.length<=3||void 0===arguments[3]?null:arguments[3],i=arguments.length<=4||void 0===arguments[4]?"":arguments[4],o=m["default"].to_full_key(e,t),s=v["default"].getExtensionByKey(o);if(s||(s=v["default"].getInternalExtensionByKey(o)),!s)return d["default"].error("[HC-Integrations]","Unknown action target: "+o),!1;if(n&&!_.includes(n,s.type))return d["default"].error("[HC-Integrations]","The target "+o+" is not in allowed types. Expected: "+n),!1;var r=v["default"].get("active_chat");switch(s.type){case"webPanel":return this._dispatchAnalyticEvent("hipchat.client.integrations.action.open.view",s,i),this._openSidebarView(s,a,r.id);case"glance":return _.isString(s.target)?(this._dispatchAnalyticEvent("hipchat.client.integrations.action.open.glance",s,i),this._openGlance(s,a,r.id)):(d["default"].error("[HC-Integrations]","Cannot open a glance that does not have a target attribute",s.full_key),this._dispatchAnalyticEvent("hipchat.client.integrations.action.open.unsupported.type",s,i),!1);case"dialog":return this._dispatchAnalyticEvent("hipchat.client.integrations.action.open.dialog",s,i),this._openDialog(s,a,r.id);case"externalPage":return this._dispatchAnalyticEvent("hipchat.client.integrations.action.open.external.page",s,i),this._openExternalPage(s,a,r.id);default:return d["default"].error("[HC-Integrations]","Unsupported target type",s.type),this._dispatchAnalyticEvent("hipchat.client.integrations.action.open.unsupported.type",s,i),!1}},focusChatText:function(){r["default"].dispatch("application-focused")},_dispatchAnalyticEvent:function(e,t,a){b["default"].dispatch("analytics-event",{name:e,properties:{addon_key:t.addon_key,full_key:t.full_key,source:a}})},_openSidebarView:function(e,t,a){return R["default"].fetchSignedUrlConditionally(e,a,t.urlTemplateValues),this._showIntegrationView(e.full_key,t.glance_key,t),!0},_openGlance:function(e,t){var a=_.isString(e.target)?e.target:e.target.key,n=m["default"].to_full_key(e.addon_key,a);if(v["default"].getInternalExtensionByKey(n))return this._showIntegrationView(n,e.full_key,t);var i=_.extend({glance_key:e.full_key},t);return this.open(e.addon_key,a,i,["webPanel","dialog","externalPage"])},_openDialog:function(e,t,a){var n=e;t.options&&(n=_.merge({},e,{title:t.options.title,options:t.options.options})),d["default"].info("[HC-Integrations]","Rendering dialog",n);var i=this._getUrlTemplateValues(t),o=this._createInitEvent(t);return R["default"].fetchSignedUrlConditionally(e,a,i),u["default"].showIntegrationDialog({room_id:a,integration:n,init_event:o}),b["default"].dispatch("analytics-show-dialog",{key:e.full_key}),!0},_openExternalPage:function(e,t,a){var n=new o["default"](function(n,i){R["default"].fetchSignedUrlWithResult(e,a,t.urlTemplateValues,function(e,t){e&&!e.error&&t.status<400?n(e.location):(d["default"].error("[HC-Integrations]","Error while fetching signed url ("+t.status+")",e),i())})});return h["default"].openExternalWindowWithPromise(n),b["default"].dispatch("analytics-show-external-page",{key:e.full_key}),!0},_showIntegrationView:function(e,t,a){var n=this._getUrlTemplateValues(a),i=this._createInitEvent(a);r["default"].dispatch("show-sidebar-integration",{activeIntegration:{key:e,glance_key:t,url_template_values:n,init_event:i}});var o=m["default"].split_full_key(e)[0];return b["default"].dispatch("analytics-event",{name:"hipchat.client.integrations.sidebar.show.view",properties:{addon_key:o,full_key:e,glance_key:t}}),!0},_createInitEvent:function(e){var t=null;return _.has(e,"parameters")&&(t={event:e.event||k.RECEIVE_PARAMETERS,parameters:e.parameters}),t},_getUrlTemplateValues:function(e){var t=null;return _.has(e,"urlTemplateValues")&&(t=e.urlTemplateValues),t}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){var e=arguments.length<=0||void 0===arguments[0]?ie:arguments[0];return e>=se&&oe>=e}Object.defineProperty(t,"__esModule",{value:!0});var o=a(136),s=n(o),r=a(127),l=n(r),u=a(157),c=n(u),d=a(10),f=n(d),h=a(4),p=n(h),m=a(5),g=n(m),v=a(22),y=n(v),b=a(47),w=n(b),R=a(51),k=n(R),E=a(97),C=n(E),S=a(9),T=n(S),x=a(173),A=n(x),I=a(422),N=n(I),M=a(121),O=n(M),D=a(292),P=n(D),j=a(423),L=n(j),F=a(167),U=n(F),H=a(161),B=n(H),z=a(265),q=n(z),V=a(269),G=n(V),W=a(166),$=n(W),Y=a(99),K=n(Y),X=a(425),J=n(X),Q=a(90),Z=n(Q),ee=a(418),te=a(141),ae=n(te),ne=100,ie=1,oe=ae["default"].connect_api_version,se=ae["default"].minimum_connect_api_version,re=function(e){function t(){(0,p["default"])(this,t);var e=(0,y["default"])(this,(0,f["default"])(t).call(this));return e.storage=new N["default"],e.states=ee.states,e}return(0,k["default"])(t,e),(0,g["default"])(t,[{key:"reset",value:function(){(0,w["default"])((0,f["default"])(t.prototype),"reset",this).call(this),this.storage.reset()}},{key:"getDefaults",value:function(){return{integrations:{},active_rooms:{},active_chat:null,loading:!0,enabled:!1,error:null,integration_timestamps:{},addon_avatars:{},pending_updates:{},state:t.states.INIT,unsupported_integrations:[],should_show_warning_icon:!1}}},{key:"registerListeners",value:function(){var e=this;T["default"].register({"updated:config":function(a){var n=U["default"].isFeatureEnabled(a);e.data.state!==t.states.INIT&&(n===!0&&e.data.state===t.states.DISABLED?e._setState(t.states.STARTING):n===!1&&e._setState(t.states.DISABLED)),e.set("enabled",n)},"integration-update":function(t){e.data.enabled&&e._writeIntegrations(e._processIntegrationChanges(t,!0))},"open-room":function(t){if(e.data.enabled){var a=e.get("active_chat");a&&a.jid===t.jid&&e._updateIntegrations([a.id])}},"room-deleted":function(t){var a=e.get("integrations"),n=e.get("integration_timestamps"),i=e.get("pending_updates");delete a[t.id],delete n[t.id],delete i[t.id],e._writeIntegrations({integrations:a,timestamps:n,pending_updates:i})},"groupchat-invite-accepted":function(t){if(e.data.enabled){var a=e.data.active_rooms[t.jid];_.isUndefined(a)||e._updateIntegrations([a.id])}},"app-state-ready":function(){e.data.enabled?e._setState(t.states.STARTING):e._setState(t.states.DISABLED)},"strophe-disconnected":function(){e.data.enabled&&e._setState(t.states.STOPPED)},"strophe-connection-failed":function(){e.data.enabled&&e._setState(t.states.STOPPED)},"strophe-disconnecting":function(){e.data.enabled&&e._setState(t.states.STOPPED)},"DAL:cache-configured":function(){e.data.enabled&&(e.storage.ready=!0,e.storage.getIntegrations().then(function(t){e.data.integrations=t}))},"strophe-reconnected":function(){e.data.enabled&&e._setState(t.states.STARTING)},"updated:activeRooms":function(t){e._handleActiveRoomsUpdate(t)},"updated:active_chat":function(t){e._handleSelectRoom(t);var a=e.get("active_chat");if(a){var n=e.getActiveIntegration(a.type),i=_.get(n,"key",null),o=e._isGroupchat(a.type),s=o?e.getInternalExtensions():e.getInternalExtensionsOTO();if(i){var r=!_.isUndefined(_.find(s,function(e){return e.full_key===i})),l=e.getExtensionByKey(i);r||l?!r&&a.id&&J["default"].fetchSignedUrlConditionally(l,a.id,{}):o?q["default"].savePreferences((0,c["default"])({},$["default"].ACTIVE_GROUPCHAT_INTEGRATION,null)):q["default"].savePreferences((0,c["default"])({},$["default"].ACTIVE_CHAT_INTEGRATION,null))}e._fetchPanelContentForInternalGlances(n)}},"refresh-integrations":function(){e._updateIntegrations(["global",_.get(e.data,"active_chat.id")])},"show-sidebar-integration":function(t){var a=e.get("active_chat");e._isGroupchat(a.type)?e._setActiveGroupchatIntegration(t):e._setActiveChatIntegration(t),t.activeIntegration&&e._fetchPanelContentForInternalGlances(t.activeIntegration)}})}},{key:"_syncIntegrations",value:function(){var e=this,a=_.values(this.data.active_rooms).filter(function(e){return"groupchat"===e.type}).map(function(e){return e.id});this._updateIntegrations(["global"].concat(a),function(a){e.data.state!==t.states.DISABLED&&(a?e._setState(t.states.ERROR):e._setState(t.states.STARTED))})}},{key:"_setActiveChatIntegration",value:function(e){if(e.activeIntegration){var t;q["default"].savePreferences((t={},(0,c["default"])(t,$["default"].SHOW_CHAT_SIDEBAR,!0),(0,c["default"])(t,$["default"].CHAT_ACTIVE_PANEL,"integrations"),(0,c["default"])(t,$["default"].ACTIVE_CHAT_INTEGRATION,e.activeIntegration),t))}else q["default"].savePreferences((0,c["default"])({},$["default"].ACTIVE_CHAT_INTEGRATION,null))}},{key:"_setActiveGroupchatIntegration",value:function(e){if(e.activeIntegration){var t;q["default"].savePreferences((t={},(0,c["default"])(t,$["default"].SHOW_GROUPCHAT_SIDEBAR,!0),(0,c["default"])(t,$["default"].GROUPCHAT_ACTIVE_PANEL,"integrations"),(0,c["default"])(t,$["default"].ACTIVE_GROUPCHAT_INTEGRATION,e.activeIntegration),t))}else q["default"].savePreferences((0,c["default"])({},$["default"].ACTIVE_GROUPCHAT_INTEGRATION,null))}},{key:"_fetchPanelContentForInternalGlances",value:function(e){T["default"].dispatch("fetch-panel-content-for-internal-glances",{activeIntegration:e})}},{key:"_fetchIntegrations",value:function(e,t,a){var n=this,i=K["default"].timings.now();T["default"].dispatch("API:sync-integrations",{integrations:e,room_ids:t},function(e,t){var o=Math.floor(K["default"].timings.now()-i);if(!e||e.error){clearTimeout(n.loadingTimerId),n.set({error:e.error,loading:!1});var s=_.get(e,"error.message",t.statusText);return A["default"].dispatch("analytics-event",{name:"hipchat.client.integrations.sync.error",properties:{error:s,duration:o,status:t.status}}),a.call(n,_.get(e,"error","Unknown error when synchronising with client"),null),!1}a.call(n,null,e),A["default"].dispatch("analytics-event",{name:"hipchat.client.integrations.sync.success",properties:{duration:o}})})}},{key:"_removeIntegrations",value:function(e,t){return _.filter(e,function(e){return!_.includes(t,e.addon_key)})}},{key:"_mergeIntegrations",value:function(e,t){return _.merge({},_.keyBy(e,"version"),_.keyBy(t,"version"))}},{key:"_processIntegrationChanges",value:function(e){var t=this,a=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],n=this.get("integrations"),i=this.get("integration_timestamps"),o=_.clone(this.get("pending_updates")),s=_.get(e,"pendingUpdates",{}),r=Date.now(),u={};return _.each(e.changedIntegrations,function(e,c){a?!function(){var t=_.map(e,function(e){return e.addon_key});_.remove(o[c],function(e){return _.includes(t,e)})}():o[c]=_.get(s,c,[]);var d=_.partition(e,function(e){return e.is_deleted}),f=(0,l["default"])(d,2),h=f[0],p=f[1];if(_.isEmpty(h)&&_.isEmpty(p)||(u[c]=[h,p]),_.each(p,function(e){return _.set(i,[c,e.addon_key],r)}),n[c]=t._removeIntegrations(n[c],_.map(e,"addon_key")),n[c]=t._mergeIntegrations(n[c],p),!_.isEmpty(h)){var m=void 0;m="global"===c?_.reduce(t.data.active_rooms,function(e,a){return t._isGroupchat(a.type)&&e.push({id:a.id}),e},[]):[{id:c}],t._removeIntegrationIfActive(h,m),T["default"].dispatch(ee.event_names.ON_INTEGRATIONS_REMOVED,{integrations:h,rooms:m})}}),T["default"].dispatch(ee.event_names.ON_INTEGRATIONS_UPDATE_SUMMARY,u),{integrations:n,timestamps:i,pending_updates:o}}},{key:"_updateIntegrations",value:function(e){var t=this,a=arguments.length<=1||void 0===arguments[1]?_.noop:arguments[1];this.data.error=null,clearTimeout(this.loadingTimerId),this.loadingTimerId=_.delay(function(){t.set("loading",!0)},O["default"].integrations.loading_indicator_delay_ms);var n=this.get("integrations");this._fetchIntegrations(n,e,function(e,n){e||t._writeIntegrations(t._processIntegrationChanges(n)),a(e,n)})}},{key:"_writeIntegrations",value:function(e){var t=e.integrations,a=e.timestamps,n=e.pending_updates;clearTimeout(this.loadingTimerId),this.set({integrations:t,pending_updates:n,unsupported_integrations:this._getUnsupportedIntegrationsPerRoom(t),loading:!1,integration_timestamps:a,addon_avatars:this._getAddonAvatars(t,this.data.active_chat)}),this.setShouldShowIntegrationsWarningIcon(),this.storage.save(t),T["default"].dispatch("integrations-updated",t)}},{key:"_getUnsupportedIntegrationsPerRoom",value:function(e){var t={};return _.forEach(e,function(e,a){var n=_.reduce(e,function(e,t){return i(t.client_api_version)||e.push(t.addon_key),e},[]);n.length&&(t[a]=n)}),t}},{key:"_getIntegrationsForRooms",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],a=this.get("integrations");return t&&(e=e.concat("global")),_.pick(a,e)}},{key:"_getIntegrationsForContext",value:function(){var e=this.get("active_chat");return e&&"groupchat"===e.type?this._getIntegrationsForRooms([e.id],!0):this._getIntegrationsForRooms([])}},{key:"getExtensionsByLocation",value:function(e){return this.getExtensionsByLocationAndContext(e,{})}},{key:"getExtensionsByLocationAndContext",value:function(e,t){var a=this._createConditionContext(t.message),n=this._getIntegrationsForContext();return this._getExtensions(n,{},{location:e},a)}},{key:"getExtensionsByType",value:function(e){var t=this._getIntegrationsForContext();return this._getExtensions(t,{},{type:e})}},{key:"getExtensionsByTypeAndRoom",value:function(e,t){var a=this._getIntegrationsForRooms([t],!0);return this._getExtensions(a,{},{type:e})}},{key:"getUnsupportedIntegrationsForRoom",value:function(){var e=this.get("active_chat");if(!e||!this._isGroupchat(e.type))return[];var t=this.get("unsupported_integrations"),a=["global",e.id],n=_.pick(t,a),i=_.values(n);return _.flatten(i)}},{key:"setShouldShowIntegrationsWarningIcon",value:function(){var e=!1;this.getUnsupportedIntegrationsForRoom().length>0&&(e=!0),_.get(this.get("pending_updates"),"global",[]).length>0&&P["default"].get("is_admin")&&(e=!0);var t=_.get(this.get("active_chat"),"id");_.get(this.get("pending_updates"),t,[]).length>0&&G["default"].canUpdateRoomIntegrations()&&(e=!0),this.set({should_show_warning_icon:e})}},{key:"getExtensionByKey",value:function(e){if(_.isEmpty(e))return null;var t=this._getIntegrationsForContext(),a=U["default"].split_full_key(e),n=(0,l["default"])(a,2),i=n[0],o=n[1],s=this._getExtensions(t,{addon_key:i},{key:o});return s.length>0?s[0]:null}},{key:"getInternalExtensions",value:function(){return[O["default"].people_glance,O["default"].files_glance,O["default"].links_glance]}},{key:"getInternalExtensionsOTO",value:function(){return[O["default"].files_glance,O["default"].links_glance]}},{key:"getInternalExtensionByKey",value:function(e){return _.find(this.getInternalExtensions(),function(t){return t.full_key===e})}},{key:"getScopesForAddon",value:function(e){var t=_.mapValues(this._getIntegrationsForContext(),_.toArray),a=_.flatten(_.toArray(t));return _.get(_.find(a,function(t){return t.addon_key===e}),"scopes",[])}},{key:"_getExtensions",value:function(e,t,a){var n=this,o=arguments.length<=3||void 0===arguments[3]?null:arguments[3],s=[],r=_.matches(t),l=_.matches(a);return _.each(e,function(e,t){_.each(e,function(e){r(e)&&i(e.client_api_version)&&_.each(e.ui_extensions,function(a){!l(a)||o&&!o.evaluate(a.conditions)||s.push(_.extend({addon_key:e.addon_key,full_key:U["default"].to_full_key(e.addon_key,a.key),addon_version:e.version,addon_timestamp:n._getTimestamp(t,e.addon_key)},a))})})}),this._sort_extensions(s)}},{key:"_sort_extensions",value:function(e){var t=_.toPairs(_.groupBy(e,function(e){return e.addon_key})),a=_.sortBy(t,function(e){var t=(0,l["default"])(e,2),a=t[0];t[1];return a});return _.flatten(_.map(a,function(e){var t=(0,l["default"])(e,2),a=(t[0],t[1]);return _.sortBy(a,function(e){return e.weight?-e.weight:-ne})}))}},{key:"_createConditionContext",value:function(e){return(new L["default"]).withRoom(this.get("active_chat")).withUser(P["default"].getAll()).withMessage(e)}},{key:"_handleSelectRoom",value:function(e){if(e){var t=this.data.active_rooms[e];_.isObject(t)&&(this.set({active_chat:t,addon_avatars:this._getAddonAvatars(this.data.integrations,t)}),this.setShouldShowIntegrationsWarningIcon())}}},{key:"_handleActiveRoomsUpdate",value:function(e){var t=_.difference(_.keys(this.data.active_rooms),_.keys(e));if(t.length){var a=[];for(var n in t){var i=t[n],o=this.data.active_rooms[i];"groupchat"===o.type&&o.id&&a.push({id:o.id})}a.length&&T["default"].dispatch(ee.event_names.REMOVE_DATA_FOR_ROOMS,{rooms:a}),this.data.active_rooms=_.omit(this.data.active_rooms,t)}else this.data.active_rooms=_.merge(this.data.active_rooms,e)}},{key:"_getTimestamp",value:function(e,t){var a=_.get(this.data.integration_timestamps,[e,t],null);return null===a&&(a=Date.now(),_.set(this.data.integration_timestamps,[e,t],a)),a}},{key:"_getAddonAvatars",value:function(e,t){var a=_.get(e,"global",[]),n=_.get(e,_.get(t,"id",""),[]),i=_.values(a),o=_.values(n),s=_.filter([].concat(i,o),function(e){return e.avatar}),r=_.map(s,function(e){return[e.addon_key,e.avatar]});return _.fromPairs(r)}},{key:"_isGroupchat",value:function(e){return"groupchat"===e}},{key:"getActiveIntegration",value:function(e){return this._isGroupchat(e)?B["default"].getActiveGroupchatIntegration():B["default"].getActiveChatIntegration()}},{key:"_removeIntegrationIfActive",value:function(e,t){var a=this.get("active_chat");if(a&&_.find(t,{id:a.id})){var n=B["default"].getActiveGroupchatIntegration();if(n){var i=U["default"].split_full_key(n.key),o=(0,l["default"])(i,1),s=o[0];_.find(e,{addon_key:s})&&this._setActiveGroupchatIntegration({})}}}},{key:"_setState",value:function(e){this.data.state!==e&&(Z["default"].debug("[HC-Integrations]","State transition from "+this.data.state+" -> "+e),
this.set("state",e),e===t.states.STARTING&&this._syncIntegrations())}},{key:"getUniqueIntegrationsForContext",value:function(){var e=this._getIntegrationsForContext(),t=_.map(e,function(e,t){return _.map(e,function(e){return{context:t,addon_key:e.addon_key,name:e.name,icon:_.get(e,"icon.url")}})}),a=_.flatten(_.map(t,_.values));return _.uniqBy(a,function(e){return e.addon_key})}},{key:"getIntegrationStatusesForContext",value:function(){var e=this,t=this.getUniqueIntegrationsForContext(),a=this.getUnsupportedIntegrationsForRoom(),n=_.filter(t,function(t){var a=_.get(e.get("pending_updates"),t.context,[]);return _.includes(a,t.addon_key)}),i=_.partition(n,function(e){return"global"===e.context}),o=(0,l["default"])(i,2),s=o[0],r=o[1],u=_.partition(t,function(e){return _.includes(a,e.addon_key)}),c=(0,l["default"])(u,2),d=c[0],f=c[1];return{pending_global:s,pending_room:r,disabled:d,installed:f}}}]),t}(C["default"]);re.states=(0,s["default"])({INIT:"init",STARTING:"starting",STARTED:"started",STOPPED:"stopped",DISABLED:"disabled",ERROR:"error"}),t["default"]=new re,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(91),o=n(i),s=a(59),r=n(s),l=a(4),u=n(l),c=a(5),d=n(c),f=a(206),h=n(f),p=a(121),m=n(p),g=function(){function e(){(0,u["default"])(this,e),this.ready=!1}return(0,d["default"])(e,[{key:"_getDefaults",value:function(){return{versions:{}}}},{key:"save",value:function(e){return e=this._deflate(e),e=this._bisect(e,0,_.keys(e.versions).length,m["default"].integrations.persistent_store_max_size_bytes),this.integrations=e,this.ready&&h["default"].Cache.set(h["default"].Cache.Keys.INTEGRATIONS,this.integrations),e}},{key:"getIntegrations",value:function(){var e=this;return this.ready?h["default"].Cache.get(h["default"].Cache.Keys.INTEGRATIONS).then(function(t){var a=t||e._getDefaults();return e._inflateIntegrations(a)}):r["default"].resolve(this._getDefaults())}},{key:"reset",value:function(){this.ready&&h["default"].Cache.unset(h["default"].Cache.Keys.INTEGRATIONS)}},{key:"_cleanRooms",value:function(e){var t=_.clone(e);delete t.versions;var a=_.keys(e.versions);return _.each(t,function(e,n){t[n]=_.intersection(a,e)}),t.versions=e.versions,t}},{key:"_objectLength",value:function(e){var t=(0,o["default"])(e);return 2*t.length}},{key:"_bisect",value:function(e,t,a,n){for(var i=e,o=void 0,s=function(e,t){var a=e.versions,n=_.keys(a),i=n.slice(0,t),o=_.clone(e,!0);return o.versions=_.pick(a,i),this._cleanRooms(o)};a>t+1;){var r=t+Math.floor((a-t)/2);i=s.call(this,e,r),this._objectLength(i)>n?a=r:t=r}return o=s.call(this,e,a),this._objectLength(o)<=n?o:i}},{key:"_inflateIntegrations",value:function(e){var t={},a=e.versions||{};return e=e||{},_.each(e,function(e,n){"versions"!==n&&(t[n]={},_.each(e,function(e){var i=a[e];_.isUndefined(i)||(t[n][i.addon_key]=i)}))}),t}},{key:"_deflate",value:function(e){var t={versions:{}};return _.each(e,function(e,a){t[a]=[],_.each(e,function(e){t[a].push(e.version),t.versions[e.version]=e})}),t}}]),e}();e.exports=g},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(4),o=n(i),s=a(5),r=n(s),l=a(90),u=n(l),c=a(99),d=n(c),f=a(108),h=n(f),p=a(424),m=n(p),g={check:function(e,t){var a=e[t];return a||(u["default"].error("Context {ctx} is not set"),a={}),a},ROOM:"room",USER:"user",MESSAGE:"message",GLANCE_DATA:"glanceData"},v=function(){function e(t){(0,o["default"])(this,e),this.metadata=t}return(0,r["default"])(e,[{key:"match",value:function(e){var t=this;return _.every(e,function(e){if(!e.attr)return u["default"].error('Metadata conditions must specify an "attr" attribute'),!1;var a=_.get(t.metadata,e.attr);return"undefined"!=typeof e.eq?a===e.eq:"undefined"!=typeof e.lt?_.lt(a,e.lt):"undefined"!=typeof e.gt?_.gt(a,e.gt):(u["default"].error("Unknown metadata operator in condition: "+e),!1)})}}]),e}(),y={room_is_public:function(e){var t=g.check(e,g.ROOM).privacy;return d["default"].jid.is_public_room(t)},user_is_admin:function(e){return g.check(e,g.USER).is_admin},user_is_guest:function(e){return g.check(e,g.USER).is_guest},user_is_room_owner:function(e){var t=g.check(e,g.ROOM),a=g.check(e,g.USER);return t.owner===a.id},message_matches:function(e,t){function a(){var e=_.get(t,"type");return e?s.type===e:!0}function n(){var e=_.get(t,"file_type");return e?_.get(s,"file_data.file_type")===e.replace("image","img"):!0}function i(){var e=_.get(t,"regex");if(e){if(!e.pattern)return u["default"].error('Regular Expression condition must specify a "pattern" attribute'),!1;try{var a=new RegExp(e.pattern,e.flags);return a.test(s.body)}catch(n){return u["default"].error(n),!1}}return!0}function o(){var e=_.get(t,"sender");return e?s.sender===e:!0}var s=g.check(e,g.MESSAGE);return a()&&n()&&i()&&o()},message_contains_link:function(e){var t=g.check(e,g.MESSAGE);return h["default"].contains_url(t.body)},message_sent_by_current_user:function(e){var t=g.check(e,g.MESSAGE),a=g.check(e,g.USER);return t.sender_id===a.id},card_matches:function(e,t){function a(){var e=_.get(t,"style");return e?i.card&&i.card.style===e:!0}function n(){var e=_.get(t,"metadata");if(_.isArray(e)){if(i.metadata){var a=new v(i.metadata);return a.match(e)}return!1}return!0}var i=g.check(e,g.MESSAGE);return a()&&n()},glance_matches:function(e,t){function a(){var e=_.get(t,"metadata");if(_.isArray(e)){if(n.metadata){var a=new v(n.metadata);return a.match(e)}return!1}return!0}var n=g.check(e,g.GLANCE_DATA);return a()}},b=function(){function e(){(0,o["default"])(this,e),this.context={}}return(0,r["default"])(e,null,[{key:"no_match",value:function(){return!1}},{key:"getEvaluator",value:function(t){var a=y[t];return a||(u["default"].warn("Unknown condition type: "+t),a=e.no_match),a}}]),(0,r["default"])(e,[{key:"withRoom",value:function(e){return this.context[g.ROOM]=e,this}},{key:"withUser",value:function(e){return this.context[g.USER]=e,this}},{key:"withMessage",value:function(e){return this.context[g.MESSAGE]=e,this}},{key:"withGlanceData",value:function(e){return this.context[g.GLANCE_DATA]=e,this}},{key:"evaluate",value:function(e){try{return _.isEmpty(e)||this._and(e)}catch(t){return u["default"].error(t),!1}}},{key:"canEvaluate",value:function(e){var t=(0,m["default"])(e).reduce(function(e,t){var a=void 0;return a="glance_matches"===t.condition?!0:e},!1);return!t||!_.isEmpty(this.context[g.GLANCE_DATA])}},{key:"_evaluateCondition",value:function(t){var a=t.condition;if(!a){var n=t.conditions||[],i=(t.type||"and").toLowerCase();switch(i){case"and":return this._and(n);case"or":return this._or(n);default:return u["default"].error("Illegal operator: "+i),no_match()}}var o=e.getEvaluator(a),s=o(this.context,t.params||{});return t.invert===!0?!s:s}},{key:"_and",value:function(e){var t=this;return _.every(e,function(e){return t._evaluateCondition(e)})}},{key:"_or",value:function(e){var t=this;return _.some(e,function(e){return t._evaluateCondition(e)})}}]),e}();e.exports=b},function(e,t){function a(e){this.value=e}function n(e,t,a){var n=[],o=[],s=!0;return function r(e){function l(){if("object"==typeof f.node&&null!==f.node){f.keys&&f.node_===f.node||(f.keys=h(f.node)),f.isLeaf=0==f.keys.length;for(var t=0;t<o.length;t++)if(o[t].node_===e){f.circular=o[t];break}}else f.isLeaf=!0,f.keys=null;f.notLeaf=!f.isLeaf,f.notRoot=!f.isRoot}var u=a?i(e):e,c={},d=!0,f={node:u,node_:e,path:[].concat(n),parent:o[o.length-1],parents:o,key:n.slice(-1)[0],isRoot:0===n.length,level:n.length,circular:null,update:function(e,t){f.isRoot||(f.parent.node[f.key]=e),f.node=e,t&&(d=!1)},"delete":function(e){delete f.parent.node[f.key],e&&(d=!1)},remove:function(e){p(f.parent.node)?f.parent.node.splice(f.key,1):delete f.parent.node[f.key],e&&(d=!1)},keys:null,before:function(e){c.before=e},after:function(e){c.after=e},pre:function(e){c.pre=e},post:function(e){c.post=e},stop:function(){s=!1},block:function(){d=!1}};if(!s)return f;l();var g=t.call(f,f.node);return void 0!==g&&f.update&&f.update(g),c.before&&c.before.call(f,f.node),d?("object"!=typeof f.node||null===f.node||f.circular||(o.push(f),l(),_(f.keys,function(e,t){n.push(e),c.pre&&c.pre.call(f,f.node[e],e);var i=r(f.node[e]);a&&m.call(f.node,e)&&(f.node[e]=i.node),i.isLast=t==f.keys.length-1,i.isFirst=0==t,c.post&&c.post.call(f,i),n.pop()}),o.pop()),c.after&&c.after.call(f,f.node),f):f}(e).node}function i(e){if("object"==typeof e&&null!==e){var t;if(p(e))t=[];else if(s(e))t=new Date(e.getTime?e.getTime():e);else if(r(e))t=new RegExp(e);else if(l(e))t={message:e.message};else if(u(e))t=new Boolean(e);else if(c(e))t=new Number(e);else if(d(e))t=new String(e);else if(Object.create&&Object.getPrototypeOf)t=Object.create(Object.getPrototypeOf(e));else if(e.constructor===Object)t={};else{var a=e.constructor&&e.constructor.prototype||e.__proto__||{},n=function(){};n.prototype=a,t=new n}return _(h(e),function(a){t[a]=e[a]}),t}return e}function o(e){return Object.prototype.toString.call(e)}function s(e){return"[object Date]"===o(e)}function r(e){return"[object RegExp]"===o(e)}function l(e){return"[object Error]"===o(e)}function u(e){return"[object Boolean]"===o(e)}function c(e){return"[object Number]"===o(e)}function d(e){return"[object String]"===o(e)}var f=e.exports=function(e){return new a(e)};a.prototype.get=function(e){for(var t=this.value,a=0;a<e.length;a++){var n=e[a];if(!t||!m.call(t,n)){t=void 0;break}t=t[n]}return t},a.prototype.has=function(e){for(var t=this.value,a=0;a<e.length;a++){var n=e[a];if(!t||!m.call(t,n))return!1;t=t[n]}return!0},a.prototype.set=function(e,t){for(var a=this.value,n=0;n<e.length-1;n++){var i=e[n];m.call(a,i)||(a[i]={}),a=a[i]}return a[e[n]]=t,t},a.prototype.map=function(e){return n(this.value,e,!0)},a.prototype.forEach=function(e){return this.value=n(this.value,e,!1),this.value},a.prototype.reduce=function(e,t){var a=1===arguments.length,n=a?this.value:t;return this.forEach(function(t){this.isRoot&&a||(n=e.call(this,n,t))}),n},a.prototype.paths=function(){var e=[];return this.forEach(function(t){e.push(this.path)}),e},a.prototype.nodes=function(){var e=[];return this.forEach(function(t){e.push(this.node)}),e},a.prototype.clone=function(){var e=[],t=[];return function a(n){for(var o=0;o<e.length;o++)if(e[o]===n)return t[o];if("object"==typeof n&&null!==n){var s=i(n);return e.push(n),t.push(s),_(h(n),function(e){s[e]=a(n[e])}),e.pop(),t.pop(),s}return n}(this.value)};var h=Object.keys||function(e){var t=[];for(var a in e)t.push(a);return t},p=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},_=function(e,t){if(e.forEach)return e.forEach(t);for(var a=0;a<e.length;a++)t(e[a],a,e)};_(h(a.prototype),function(e){f[e]=function(t){var n=[].slice.call(arguments,1),i=new a(t);return i[e].apply(i,n)}});var m=Object.hasOwnProperty||function(e,t){return t in e}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(9),o=n(i),s=a(173),r=n(s),l=a(121),u=n(l),c=a(167),d=n(c),f=a(90),h=n(f),p=a(99),m=n(p),g=a(170),v=n(g);e.exports={fetchSignedUrlConditionally:function(e,t,a){if("none"===e.authentication){var n=new v["default"](e.url),i=n.replaceVariables(a);o["default"].dispatch("signed-extension-url-fetched",{extension:e,room_id:t,signed_url:m["default"].addConnectApiVersionToUrl(i)})}else this.fetchSignedUrl(e,t,a)},fetchSignedUrl:function(e,t,a){o["default"].dispatch("signed-extension-url-fetching",{extension:e,room_id:t,url_template_values:a}),this.fetchSignedUrlWithResult(e,t,a,function(a,n){if(!a||a.error||n.status>=400)h["default"].error("[HC-Integrations]","Could not get a signed URL for "+e.full_key+"."),o["default"].dispatch("signed-extension-url-error",{extension:e,room_id:t,error:_.get(a,"error","Error fetching signed url"),status:n.status});else{var i=m["default"].addConnectApiVersionToUrl(a.location);o["default"].dispatch("signed-extension-url-fetched",{extension:e,room_id:t,signed_url:i})}})},fetchSignedUrlWithResult:function(e,t,a,n){o["default"].dispatch("API:get-signed-url",{extension:e,room_id:t,timeout:u["default"].integrations.signed_url_timeout},a||{},n)},iframeLoaded:function(e){o["default"].dispatch("integration-iframe-loaded",{integration:e.integration,room_id:e.room_id}),r["default"].dispatch("analytics-event",{name:"hipchat.client.integrations.view.iframe.loaded",properties:{room_id:e.room_id,addon_key:e.integration.addon_key,full_key:d["default"].to_full_key(e.integration.addon_key,e.integration.key),duration:e.duration}})}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return e&&e.key?void d["default"].openDialog(t._context.extension.addon_key,e.key,{options:e.options,parameters:e.parameters,urlTemplateValues:e.urlTemplateValues},"api"):void h["default"].error("[HC-Integrations]","No key specified. Use open({key: 'dialog-key'}).")}function o(e,t){u["default"].update(e,t._context.extension.addon_key)}function s(e,t){u["default"].update({options:{primaryAction:e}},t._context.extension.addon_key)}function r(e){u["default"].closeDialog(e._context.extension.addon_key)}Object.defineProperty(t,"__esModule",{value:!0}),t.open=i,t.update=o,t.updatePrimaryAction=s,t.close=r;var l=a(427),u=n(l),c=a(420),d=n(c),f=a(90),h=n(f)},function(e,t,a){"use strict";var n=a(95),i=a(386),o=a(9),s=a(428),r=a(198);e.exports={update:function(e,t){o.dispatch("update-integration-dialog",{dialog:e,origin:t})},closeDialog:function(e){s.isActiveDialogOwner(e)&&n.closeDialog()},_btnClickCallback:function(e){e!==!1&&n.closeDialog()},buttonClick:function(e,t){var a=i.dispatch(r.DIALOG_CLICK,{addon_key:e.addon_key,key:e.key},{action:t},this._btnClickCallback),o=[];a&&(o=a.filter(function(e){return e.registered_events?-1!==e.registered_events.indexOf(r.DIALOG_CLICK):!1})),0===o.length&&n.closeDialog()},filterChange:function(e,t){i.dispatch(r.DIALOG_FILTER_CHANGED,{addon_key:e.addon_key,key:e.key},{value:t})}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(51),h=n(f),p=a(97),m=n(p),g=a(9),v=n(g),y=a(95),b=n(y),w=a(284),R=n(w),k=a(421),E=n(k),C=a(418),S=function(e){function t(){(0,r["default"])(this,t);var e=(0,d["default"])(this,(0,o["default"])(t).call(this));return e.local={active_chat:""},e}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"getDefaults",value:function(){return{title:"",options:{}}}},{key:"registerListeners",value:function(){var e=this;v["default"].register({"update-integration-dialog":function(t){var a=e.getAll();if(!t.origin||a.addon_key===t.origin){var n=_.merge({title:"",options:{}},a,{title:t.dialog.title,options:t.dialog.options});e.set(n)}},"show-modal-dialog":function(t){"integration-dialog"===t.dialog_type&&e.set(_.merge({title:"",options:{}},t.dialog_data.integration))},"hide-modal-dialog":function(){e.reset()},"updated:active_chat":function(t){if(t&&(!t||t!==e.local.active_chat)){e.local.active_chat=t;var a=R["default"].getCurrentModalDialog();"integration-dialog"===a&&b["default"].closeDialog()}}}),v["default"].register(C.event_names.ON_INTEGRATIONS_REMOVED,function(t){var a=E["default"].get("active_chat");if(a&&_.find(t.rooms,{id:a.id})){var n=_.find(t.integrations,{addon_key:e.get("addon_key"),is_deleted:!0});n&&b["default"].closeDialog()}})}},{key:"isActiveDialogOwner",value:function(e){return this.get("addon_key")===e}}]),t}(m["default"]);t["default"]=new S,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return{mention_name:e.mention_name,id:parseInt(e.id),name:e.name,presence:e.presence,photo_url:e.photo_url,is_admin:e.is_admin,email:e.email}}function o(e){return{id:parseInt(e.id),name:e.name,privacy:e.privacy,topic:e.topic}}function s(e,t){return _.reduce(t,function(t,a){return _.isUndefined(t)&&a.handle(e)?a.convert(e):t},void 0)}function r(e,t,a){var n="string"==typeof e?e:"",i="string"==typeof t?t:"",o="string"==typeof a?a:"public";h["default"].createRoom({room_name:n,room_topic:i,privacy:o})}function l(e){var t=e.roomId,a=e.roomName,n=e.userId,i=e.userMentionName,o=e.message,r=void 0,l=t||a,u=n||i;if(_.isUndefined(l)){if(_.isUndefined(u))return void E["default"].warn("[HC-Integrations]","'roomId', 'roomName', 'userId' or 'userMentionName' parameter must be specified.");var c=s(u,C);r=_.get(c,"jid")}else{var d=s(l,S);r=_.get(d,"jid")}_.isUndefined(r)?E["default"].warn("[HC-Integrations]","Failed to open room, room or user was not found."):h["default"].openChat({jid:r}),"string"==typeof o&&h["default"].appendMessage({text:o})}function u(e){var t=[];e=R["default"].toArray(e),e.forEach(function(e){var a=s(e,C),n=_.get(a,"jid");n&&t.push(n)}),d["default"].showInviteUsersDialog({invite_users:t})}Object.defineProperty(t,"__esModule",{value:!0}),t.getRoomDetails=t.getParticipants=void 0,t.create=r,t.open=l,t.invite=u;var c=a(95),d=n(c),f=a(264),h=n(f),p=a(430),m=n(p),g=a(271),v=n(g),y=a(431),b=n(y),w=a(99),R=n(w),k=a(90),E=n(k),C=[m["default"].get("idToUser"),m["default"].get("jidToUser"),m["default"].get("mentionNameToUser")],S=[m["default"].get("idToRoom"),m["default"].get("jidToRoom"),m["default"].get("nameToRoom")];t.getParticipants=(0,b["default"])("view_room",function(){return{guests:_.map(v["default"].getSortedRosterByPresenceAndName(["guests"]),i),members:_.map(v["default"].getSortedRosterByPresenceAndName(["members"]),i)}}),t.getRoomDetails=(0,b["default"])("view_room",function(){var e=h["default"].getActiveChat();return o(e)})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(4),o=n(i),s=a(5),r=n(s),l=a(190),u=a(99),c=function(){function e(){(0,o["default"])(this,e),this.converters={}}return(0,r["default"])(e,[{key:"register",value:function(e,t,a){this.converters[e]={handle:t,convert:a}}},{key:"get",value:function(e){return this.converters[e]}}]),e}(),d={isNumber:function(e){return!isNaN(Number(e))},isHalfJid:function(e){return/\d+_[^@]+/.test(e)},isMention:function(e){return 0===e.indexOf("@")},isAnything:function(){return!0}},f=function(e){var t=e.toString();return _.find(l.get("allRooms"),function(e){return _.get(e,"id","").toString()===t})},h=function(e){return l.get("allRooms")[e]},p=function(e){var t=l.get("conference_server"),a=e+"@"+t;return l.get("allRooms")[a]},m=function(e){return _.find(l.get("allRooms"),function(t){return t.name===e})},g=function(e){var t=l.get("chat_server"),a=l.get("group_id"),n=a+"_"+e+"@"+t;return l.get("roster")[n]},v=function(e){var t=l.get("chat_server");return l.get("roster")[e+"@"+t]},y=function(e){return l.get("roster")[e]},b=function(e){var t=e.substring(1);return _.find(l.get("roster"),function(e){return e.mention_name===t})},w=new c;w.register("idToUser",d.isNumber,g),w.register("jidToUser",u.jid.is_private_chat,y),w.register("halfJidToUser",d.isHalfJid,v),w.register("mentionNameToUser",d.isMention,b),w.register("idToRoom",d.isNumber,f),w.register("jidToRoom",u.jid.is_room,h),w.register("halfJidToRoom",d.isHalfJid,p),w.register("nameToRoom",d.isAnything,m),e.exports=w},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return function(a){var n=_.last(arguments),i=_.get(n,"_context.extension.addon_key");if(i){var o=s["default"].getScopesForAddon(i);if(_.includes(o,e)){var r=null,u=null;try{u=t(_.slice(arguments,0,arguments.length-1))}catch(c){r=c.message,l["default"].error("[HC-Integrations]","Error executing API method - "+c+".")}n(r,u)}else{var d="Error executing API method - insufficient scopes, needed "+e+" have "+o+".";n(d),l["default"].error("[HC-Integrations]",d)}}else{var f="Error executing API method - could not find addon information for call.";n(f),l["default"].error("[HC-Integrations]",f)}}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i;var o=a(421),s=n(o),r=a(90),l=n(r);e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return e&&e.key?void r["default"].openSidebarView(t._context.extension.addon_key,e.key,{options:e.options,parameters:e.parameters,urlTemplateValues:e.urlTemplateValues},"api"):void u["default"].error("[HC-Integrations]","No key specified. Use open({key: 'sidebar-key'}).")}function o(){r["default"].closeSidebarView("api")}Object.defineProperty(t,"__esModule",{value:!0}),t.openView=i,t.closeView=o;var s=a(420),r=n(s),l=a(90),u=n(l)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=e.userId,a=e.userMentionName,n=e.message;return(0,u.open)({userId:t,userMentionName:a,message:n})}Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentUser=void 0,t.open=i;var o=a(431),s=n(o),r=a(292),l=n(r),u=a(429);t.getCurrentUser=(0,s["default"])("view_room",function(){var e=l["default"].getAll();return{mention_name:e.mention,id:e.id,name:e.user_name,presence:{show:e.show},photo_url:e.photo_large,is_admin:e.is_admin,is_guest:e.is_guest,email:e.email,title:e.title}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var a={file:e,filesList:t||[]};s["default"].openExternalFileInFileViewer(a)}Object.defineProperty(t,"__esModule",{value:!0}),t.openInFileViewer=i;var o=a(435),s=n(o)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i);t["default"]={openInFileViewer:function(e){o["default"].dispatch("open-in-file-viewer",e)},openExternalFileInFileViewer:function(e){o["default"].dispatch("open-external-file-in-file-viewer",e)},fileViewerClosed:function(){o["default"].dispatch("file-viewer-closed")},fetchSignedFile:function(e,t,a){o["default"].dispatch("API:fetch-signed-file",e,t,a)}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(51),h=n(f),p=a(97),m=a(9),g=a(167),v=function(e){function t(){return(0,r["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"getDefaults",value:function(){return{}}},{key:"registerListeners",value:function(){var e=this;m.register({"signed-extension-url-fetching":function(t){e.set(e.fullKey(t.room_id,t.extension.full_key),{signed_url:null,signed_url_loading:!0,url_template_values:t.url_template_values,error:null,is_error:!1})},"signed-extension-url-fetched":function(t){e.set(e.fullKey(t.room_id,t.extension.full_key),{signed_url:t.signed_url,signed_url_loading:!1})},"signed-extension-url-error":function(t){var a=e.fullKey(t.room_id,t.extension.full_key),n=_.get(e.get(a),"url_template_values",{});e.set(a,{error:t.error,is_error:!0,status:t.status,signed_url:null,signed_url_loading:!1,url_template_values:n})},"integration-iframe-loaded":function(t){var a=g.to_full_key(t.integration.addon_key,t.integration.key),n=e.fullKey(t.room_id,a);e.set(n,_.extend({frame_loading:!1},e.get(n)))}})}},{key:"onIntegrationViewStatusChange",value:function(e,t,a){var n=this.fullKey(e,t);this.on("change:"+n,a)}},{key:"offIntegrationViewStatusChange",value:function(e,t,a){var n=this.fullKey(e,t);this.off("change:"+n,a)}},{key:"getIntegrationViewStatus",value:function(e,t){var a=this.fullKey(e,t);return this.get(a)}},{key:"fullKey",value:function(e,t){return e+":"+t}}]),t}(p);e.exports=new v},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={fetch_error:"Couldn't load integrations",retry:"Try again",glance_fetch_error:"Can't load",glance_loading:"Loading...",empty_message_actions:"No actions available",empty_message_actions_title:"There are no actions available for this message.",configure_integrations:"Integrations",add_integrations:"Add integrations",configure_integration:"Configure integration",update_integration:"Update integration",disabled_integrations:"Disabled",update:"Update",the_following_integrations_require_the_latest_version_of_hipchat:"The following integrations require the latest version of HipChat.",active:"Active",pending_updates:"Pending Updates",pending_updates_contact_admin:"The following integrations require a room administrator to approve an update.",pending_global_updates:"Pending Global Updates",pending_global_updates_contact_admin:"The following integrations require a global administrator to approve an update.",install_integrations:"Install integrations",install_new_integrations:"Install new integrations",install_integrations_tooltip_title:"ADD AND CONFIGURE INTEGRATIONS",install_integrations_tooltip_content:"Just so you know, you can always add more integrations, or manage your existing ones here.",got_it:"Got it!",installed_count:function(e){return e+" installed"},pending_updates_count:function(e){return e+" pending update"+(e>1?"s":"")},integration_failed_to_load:"Unable to load"},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(341),o=n(i),s=a(421),r=n(s),l=a(269),u=n(l),c=a(292),d=n(c),f=a(169),h=n(f),p=a(167),m=n(p),g=a(439),v=n(g),y=a(437),b=n(y),w=a(441),R=n(w),k="com.atlassian.bitbucket.hipbucket",E=["change:integrations","change:unsupported_integrations","change:active_chat","change:pending_updates"];t["default"]=React.createClass({displayName:"IntegrationsDialog",getInitialState:function(){return this._getState()},componentDidMount:function(){r["default"].on(E,this._onChange),d["default"].on("change:id",this._onChange),h["default"].on("change:web_server",this._onChange)},componentWillUnmount:function(){r["default"].off(E,this._onChange),d["default"].off("change:id",this._onChange),h["default"].off("change:web_server",this._onChange)},_onChange:function(){this.setState(this._getState())},_getState:function(){var e=r["default"].getIntegrationStatusesForContext(),t=e.pending_global,a=e.pending_room,n=e.disabled,i=e.installed;return{active_chat:r["default"].get("active_chat"),pending_global:t,pending_room:a,disabled:n,installed:i,integrations:r["default"].getUniqueIntegrationsForContext(),web_server:h["default"].get("web_server"),current_user_id:d["default"].get("id")}},_getConfigButton:function(e){var t=m["default"].getIntegrationsConfigUrl(this.state.web_server,this.state.active_chat.id,e.addon_key);return React.createElement("a",{href:t,target:"_blank",className:"hc-integration-configure"},React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-configure","aria-label":b["default"].configure_integration}))},_getUpdateButton:function(e){var t="global"===e.context,a=t?-1:this.state.active_chat.id,n=m["default"].getIntegrationsUpdateUrl(this.state.web_server,a,e.addon_key);return React.createElement("a",{href:n,target:"_blank",className:"hc-integration-update"},b["default"].update)},_getDisabledIntegrationsSection:function(e){return React.createElement(R["default"],{title:b["default"].disabled_integrations,section:"unsupported",description:b["default"].the_following_integrations_require_the_latest_version_of_hipchat,integrations:e,showGlobalLozenge:!1})},_getInstalledIntegrationsSection:function(e){var t=_.noop;return u["default"].canUpdateRoomIntegrations()&&(t=this._getConfigButton),React.createElement(R["default"],{title:b["default"].active,status:b["default"].installed_count(e.length),section:"installed",integrations:e,actions:t,showGlobalLozenge:!0})},_getPendingRoomUpdatesSection:function(e){var t=_.noop;return u["default"].canUpdateRoomIntegrations()&&(t=this._getUpdateButton),React.createElement(R["default"],{title:b["default"].pending_updates,status:b["default"].pending_updates_count(e.length),section:"pending-room",description:u["default"].canUpdateRoomIntegrations()?null:b["default"].pending_updates_contact_admin,integrations:e,actions:t,showGlobalLozenge:!1})},_getPendingGlobalUpdatesSection:function(e){var t=_.noop;return u["default"].get("user_is_admin")&&(t=this._getUpdateButton),React.createElement(R["default"],{title:b["default"].pending_global_updates,status:b["default"].pending_updates_count(e.length),section:"pending-global",description:u["default"].get("user_is_admin")?null:b["default"].pending_global_updates_contact_admin,integrations:e,actions:t,showGlobalLozenge:!1})},_getInstallNewIntegrationsSection:function(){if(!u["default"].canManageRoomIntegrations())return null;var e=m["default"].getIntegrationsUrl(this.state.web_server,this.state.active_chat.id,this.state.current_user_id,m["default"].DIALOG_LINK_SOURCE_ID);return React.createElement("div",{className:"hc-integration-section"},React.createElement("a",{href:e,target:"_blank",className:"hc-install-link"},React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-add-small"}),React.createElement("span",null,b["default"].install_new_integrations)))},_isBitbucketInstalledButNotConfigured:function(e){var t=this,a=function(){return _.find(r["default"].getExtensionsByType("glance"),function(e){return e.addon_key===k})},n=function(){return _.find(t.state.disabled,function(e){return e.addon_key===k})};return 1===e.length&&e[0].addon_key===k&&!n()&&!a()},_shouldShowEmptyState:function(){var e=this.state.integrations;return 0===e.length?!0:this._isBitbucketInstalledButNotConfigured(e)},_getDialogBody:function(){if(this._shouldShowEmptyState()){var e=u["default"].canManageRoomIntegrations();return React.createElement(v["default"],{active_chat_id:this.state.active_chat.id,user_id:this.state.current_user_id,web_server:this.state.web_server,can_manage_integrations:e})}return React.createElement("div",null,this._getInstallNewIntegrationsSection(),this._getPendingRoomUpdatesSection(this.state.pending_room),this._getPendingGlobalUpdatesSection(this.state.pending_global),this._getDisabledIntegrationsSection(this.state.disabled),this._getInstalledIntegrationsSection(this.state.installed))},render:function(){return React.createElement(o["default"],{dialogId:"integrations-management-dialog",title:"Integrations",size:"medium",dialogBody:this._getDialogBody,showFooter:!1,noCloseLink:!0})}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(440),o=n(i),s=a(314),r=n(s),l=a(167),u=n(l),c=React.PropTypes;t["default"]=React.createClass({displayName:"IntegrationsDialogEmptyState",mixins:[r["default"]],propTypes:{active_chat_id:c.string,user_id:c.number,web_server:c.string,can_manage_integrations:c.bool},render:function(){var e=this.props.can_manage_integrations?u["default"].getIntegrationsUrl(this.props.web_server,this.props.active_chat_id,this.props.user_id):u["default"].getIntegrationsBaseUrl(this.props.web_server);return React.createElement("div",{className:"hc-integrations-empty-state"},React.createElement("div",{className:"hc-integrations-es-img"}),React.createElement("p",null,o["default"].empty_integrations_text),React.createElement("p",null,React.createElement("a",{className:"aui-button aui-button-primary",href:e,target:"_blank"},o["default"].check_out_integrations)))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(183),o=n(i);t["default"]={no_files:"No files shared yet",no_links:"No links shared yet",no_glance_integration:"No integration installed yet",share_a_file:"Share the first file",share_a_link:"Recently shared links will appear here.",check_out_integrations:"Check out "+o["default"].app_name+" integrations",empty_private_room:"You're the only one here",invite_to_team:o["default"].app_name+" is awesome with teammates.",invite_to_team_action:"Invite your team to join",invite_to_room:"Rooms are more fun with teammates.",invite_to_room_action:"Ask them to join you",empty_lobby_title:"WELCOME TO "+o["default"].app_name.toUpperCase(),empty_lobby_message:"It looks like you're just starting out, so things are a little bare.",
empty_search_lobby:"Sorry, nothing matches your search.",empty_integrations_text:"Connect your team with the tools they love. With over 100 integrations, transform HipChat from simple chat to your team's command center."},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(442),o=n(i),s=React.PropTypes,r=React.createClass({displayName:"IntegrationsSection",defaultProps:{showGlobalLozenge:!1,actions:_.noop},propTypes:{actions:s.func,showGlobalLozenge:s.bool,section:s.string.isRequired,status:s.string,integrations:s.arrayOf(s.object).isRequired},render:function(){var e=this;if(0===this.props.integrations.length)return null;var t=null,a=null;this.props.description&&(t=React.createElement("div",{className:"hc-integration-section-description"},React.createElement("p",null,this.props.description))),this.props.status&&(a=React.createElement("span",{className:"hc-integrations-installed-count"},this.props.status));var n=_.map(this.props.integrations,function(t,a){return React.createElement(o["default"],{key:a,integration:t,actions:e.props.actions,showGlobalLozenge:e.props.showGlobalLozenge})});return React.createElement("div",{className:"hc-integration-section hc-integration-section-"+this.props.section},React.createElement("div",{className:"hc-integration-section-title"},React.createElement("h5",null,this.props.title),a),t,React.createElement("ul",{className:"hc-integrations-list"},n))}});t["default"]=r,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=React.PropTypes,n=React.createClass({displayName:"Integration",propTypes:{actions:a.func.isRequired,showGlobalLozenge:a.bool.isRequired,integration:a.shape({name:a.string,icon:a.string}).isRequired},render:function(){var e=null,t=React.createElement("div",{className:"hc-integration-icon hc-integration-icon-default"}),a=null;return this.props.integration.icon&&(t=React.createElement("img",{src:this.props.integration.icon,className:"hc-integration-icon"})),"global"===this.props.integration.context&&this.props.showGlobalLozenge&&(a=React.createElement("span",{className:"aui-lozenge aui-lozenge-subtle"},"Global")),this.props.actions&&(e=this.props.actions(this.props.integration)),React.createElement("li",null,t,React.createElement("div",{className:"hc-integration-name"},this.props.integration.name),React.createElement("span",{className:"hc-integration-management-right"},a,e))}});t["default"]=n,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(341),o=n(i),s=a(444),r=n(s),l=a(203),u=n(l),c=a(369),d=n(c),f=a(342),h=n(f);t["default"]=React.createClass({displayName:"EditMessageDialog",mixins:[d["default"],h["default"]],getInitialState:function(){return this._getState()},_getState:function(){return{dialogButtonInactive:!0}},_dialogBody:function(){return React.createElement(r["default"],{message:this.props.message,activateDialogButton:this._activateDialogButton,deactivateDialogButton:this._deactivateDialogButton})},_activateDialogButton:function(){this.setState({dialogButtonInactive:!1})},_deactivateDialogButton:function(){this.setState({dialogButtonInactive:!0})},_dialogFooterButton:function(){return React.createElement("button",{form:"edit-message-form",className:"aui-button aui-button-primary","aria-disabled":this.state.dialogButtonInactive,type:"submit",onClick:this.ieSubmit},u["default"].save)},render:function(){return React.createElement(o["default"],{dialogId:"edit-message-dialog",title:u["default"].edit_message,dialogBody:this._dialogBody,dialogFooterButton:this._dialogFooterButton,closeLinkText:"Cancel"})}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(363),o=n(i),s=a(95),r=n(s),l=a(286),u=n(l),c=a(367),d=n(c),f=a(121),h=n(f),p=a(99),m=n(p);t["default"]=React.createClass({displayName:"EditMessageForm",mixins:[d["default"]],componentDidMount:function(){this._focusInput(),this.shouldAutoFocus=!0},componentDidUpdate:function(){this.props.dialogVisible&&this.shouldAutoFocus&&(this._focusInput(),this.shouldAutoFocus=!1)},componentWillUpdate:function(e,t){t.body!==this.props.message.body?this.props.activateDialogButton():this.props.deactivateDialogButton()},componentWillUnmount:function(){this.delayedFocus&&clearTimeout(this.delayedFocus)},getInitialState:function(){var e=this.props.message;return"file"===this.props.message.message_type&&0===this.props.message.body.indexOf("File uploaded")&&""===this.props.message.rendered_body&&(e=_.assign({},this.props.message,{body:""})),e},_handleKeyDown:function(e){e.keyCode!==m["default"].keyCode.Enter||m["default"].keyCode.isModified(e)||this._onSubmit(e)},_onChange:function(e){this.setState({body:e.target.value})},_onSubmit:function(e){e.preventDefault(),u["default"].editMessage({jid:this.state.from,message:this.state.body,original_mid:this.state.mid,ts:this.state.ts}),this._closeDialog()},_closeDialog:function(){r["default"].closeDialog()},_focusInput:function(){var e=this;this.delayedFocus=_.delay(function(){var t=ReactDOM.findDOMNode(e).querySelector("#message-to-edit");t.focus(),t.setSelectionRange(e.state.body.length,e.state.body.length)},h["default"].modal_transition_allowance)},render:function(){return React.createElement("form",{id:"edit-message-form",ref:"form",className:"aui",onSubmit:this._onSubmit},React.createElement(o["default"],{id:"message-to-edit",label:this.state.sender,rows:"5",cols:"400",maxLength:h["default"].max_message_text_length,value:this.state.body,onKeyDown:this._handleKeyDown,onChange:this._onChange}),React.createElement("span",{className:"edit-display-time"},this.state.display_time))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(341),o=n(i),s=a(446),r=n(s),l=a(203),u=n(l),c=a(313),d=n(c);t["default"]=React.createClass({displayName:"DeleteMessageDialog",_dialogBody:function(){return React.createElement(r["default"],{message:this.props.message})},_dialogFooterButtons:function(){var e=(0,d["default"])({"aui-button":!0});return React.createElement("button",{form:"delete-message-form",className:e,type:"submit"},u["default"]["delete"])},render:function(){return React.createElement(o["default"],{dialogId:"delete-message-dialog",isWarning:"true",title:u["default"].delete_message,dialogBody:this._dialogBody,dialogFooterButton:this._dialogFooterButtons,closeLinkText:u["default"].cancel,hint:u["default"].edit_message_hint})}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(286),o=n(i),s=a(95),r=n(s),l=a(447),u=n(l);t["default"]=React.createClass({displayName:"DeleteMessageForm",_onSubmit:function(e){e.preventDefault(),o["default"].deleteMessage(this.props.message),r["default"].closeDialog()},_renderMessage:function(){var e=this.props.message;return React.createElement(u["default"],{key:"msg-"+e.mid,ref:"msg_"+e.mid,msg:e})},render:function(){var e=this._renderMessage();return React.createElement("form",{id:"delete-message-form",ref:"delete_message_form",className:"aui",onSubmit:this._onSubmit},e)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return React.createElement("div",{"data-mid":e,dangerouslySetInnerHTML:{__html:t}})}function o(e,t,a){return u["default"].messageShouldBeTruncated(t)?React.createElement(h["default"],{mid:e},React.createElement("div",{className:"msg-wrap","data-copyable":'{"format": "plain-message", "mid": "'+e+'"}',dangerouslySetInnerHTML:{__html:a}})):React.createElement("div",{className:"msg-line","data-mid":e,"data-copyable":'{"format": "plain-message", "mid": "'+e+'"}',dangerouslySetInnerHTML:{__html:a}})}function s(e){return React.createElement("div",{className:"msg-line deleted","data-mid":e},React.createElement("div",{className:"hc-msg-deleted-icon"}),y["default"].message_deleted)}function r(e){if(e.is_deleted)return s(e.mid);switch(e.format){case"code":return React.createElement(k["default"],{mid:e.mid,body:e.rendered_body});case"monospace":return React.createElement(C["default"],{mid:e.mid,body:e.rendered_body});case"quotation":return React.createElement(w["default"],{mid:e.mid,body:e.body});case"html":return i(e.mid,e.xhtml_im_body);default:return o(e.mid,e.body,e.rendered_body)}}Object.defineProperty(t,"__esModule",{value:!0});var l=a(99),u=n(l),c=a(110),d=n(c),f=a(448),h=n(f),p=a(449),_=n(p),m=a(450),g=n(m),v=a(185),y=n(v),b=a(451),w=n(b),R=a(452),k=n(R),E=a(453),C=n(E),S=React.addons.PureRenderMixin;t["default"]=React.createClass({displayName:"MessageMessageType",mixins:[S,_["default"],g["default"]],propTypes:{msg:React.PropTypes.shape({body:React.PropTypes.string.isRequired,rendered_body:React.PropTypes.string.isRequired,format:React.PropTypes.string.isRequired,mid:React.PropTypes.string.isRequired,status:React.PropTypes.string.isRequired})},componentDidMount:function(){d["default"]._replaceSpecials(ReactDOM.findDOMNode(this))},render:function(){var e=this.props.msg,t=r(e);return t}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(178),o=n(i),s=a(185),r=a(313);e.exports=React.createClass({displayName:"Expando",getInitialState:function(){return{truncated:!0,height:0}},componentDidMount:function(){var e=$(ReactDOM.findDOMNode(this.refs.expando)).height();this.setState({height:e,truncated:e>120})},componentDidUpdate:function(){o["default"].preserveScrollValue({animation:!1})},render:function(){var e=r({"msg-line":!0,truncatable:!0,truncated:this.state.truncated,expanded:!this.state.truncated}),t=r({truncatable:!0,truncated:this.state.truncated,expanded:!this.state.truncated,hidden:this.state.height<=120});return React.createElement("div",{className:e+" "+this.props.className,"data-mid":this.props.mid},React.createElement("div",{className:"truncate-wrap"},React.createElement("div",{ref:"expando",className:"msg-wrap"},this.props.children)),React.createElement("div",{className:t},React.createElement("a",{name:"truncate",onClick:this._toggleTruncatedText},this.state.truncated?s.show_more:s.show_less)))},_toggleTruncatedText:function(e){e.preventDefault(),this.setState({truncated:!this.state.truncated})}})},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={_tooltipElements:function(){return ReactDOM.findDOMNode(this).querySelectorAll(".hc-mention-user, .remoticon")},_createTooltips:function(){AJS.$(this._tooltipElements()).tooltip({title:function(){var e=this.querySelector("a");return e&&e.getAttribute("data-title")||this.getAttribute("data-title")||this.alt||""}})},_destroyTooltips:function(){AJS.$(this._tooltipElements()).tooltip("destroy")}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(121),o=n(i),s=a(178),r=n(s);t["default"]={getInitialState:function(){return{failed:!1}},componentDidMount:function(){r["default"].preserveScrollValue({animation:!0}),this._observeMediaTags()},componentDidUpdate:function(){r["default"].preserveScrollValue({animation:!1})},componentWillUnmount:function(){this._cleanupMediaTagObservers()},_getIdForMediaTag:function(e){var t=e.getAttribute("data-reactid")||e.getAttribute("id");if(!t){var a="hc-fake-react-id-"+_.uniqueId();e.id=a,t=a}return t},_observeMediaTag:function(e){var t=this,a=this._getIdForMediaTag(e),n=this._getReadyEvent(e);this.props.msg.media_loaded?e.addEventListener(n,this._onMediaTagReady):(e.style.display="none",this._media_timeouts[a]=setTimeout(function(){t._onMediaTagFailed({target:e})},o["default"].message_image_loading_timeout),this._isImageTag(e)&&(this._media_size_intervals[a]=setInterval(function(){e.naturalHeight&&e.naturalWidth&&(clearInterval(t._media_size_intervals[a]),delete t._media_size_intervals[a],t._onMediaSizeKnown(e))},o["default"].message_image_size_check_interval)),e.addEventListener(n,this._onMediaTagReady),e.addEventListener("error",this._onMediaTagFailed))},_onMediaSizeKnown:function(e){var t=$(e),a=t.parents(".hc-chat-row"),n=a.outerHeight();e.style.display="",r["default"].updateScrollPosition({heightDiff:a.outerHeight()-n,offsetTop:a[0]&&a[0].offsetTop}),r["default"].messageMediaSizeFound({jid:this.props.msg.room,mid:this.props.msg.mid,src:e.src,size:{width:t.width(),height:t.height()}})},_getMedia:function(){var e=ReactDOM.findDOMNode(this),t=_.toArray(e.querySelectorAll("img"));t=t.filter(function(e){return!e.height&&0===e.naturalHeight||!e.width&&0===e.naturalWidth});var a=_.toArray(e.querySelectorAll("video"));return t.concat(a)},_observeMediaTags:function(){this._media=this._getMedia(),this._media_timeouts={},this._media_size_intervals={},this._media_count=this._media.length,this._media.forEach(this._observeMediaTag)},_cleanupMediaTagObserver:function(e){if(e){var t=this._getIdForMediaTag(e),a=this._getReadyEvent(e);e.removeEventListener(a,this._onMediaTagReady),e.removeEventListener("error",this._onMediaTagFailed),this._media_timeouts[t]&&(clearTimeout(this._media_timeouts[t]),delete this._media_timeouts[t]),this._media_size_intervals[t]&&(clearInterval(this._media_size_intervals[t]),delete this._media_size_intervals[t]),this._media=_.without(this._media,e)}},_getReadyEvent:function(e){return this._isImageTag(e)?"load":"loadedmetadata"},_isImageTag:function(e){return"video"!==e.tagName.toLowerCase()},_cleanupMediaTagObservers:function(){this._media&&(this._media.forEach(this._cleanupMediaTagObserver),delete this._media)},_onMediaTagReady:function(e){this._onMediaTagResolved(e,!0)},_onMediaTagFailed:function(e){this._onMediaTagResolved(e,!1)},_onMediaTagResolved:function(e,t){var a=e.target;this._cleanupMediaTagObserver(a),this.props.msg.media_loaded||(t?(this._media_count--,""!==a.style.display&&this._onMediaSizeKnown(a)):(a.style.display="",this.setState({failed:!0})),_.size(this._media)||this._media_count||r["default"].messageMediaLoaded({jid:this.props.msg.room,mid:this.props.msg.mid})),r["default"].preserveScrollValue({animation:!1})}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(448),o=n(i);t["default"]=React.createClass({displayName:"QuoteMessageType",mixins:[React.addons.PureRenderMixin],propTypes:{mid:React.PropTypes.string.isRequired,body:React.PropTypes.string.isRequired},render:function(){return React.createElement(o["default"],{mid:this.props.mid},React.createElement("blockquote",{"data-copyable":'{"format": "quotation", "mid": "'+this.props.mid+'"}'},this.props.body))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(99),o=n(i),s=a(448),r=n(s);t["default"]=React.createClass({displayName:"CodeMessageType",mixins:[React.addons.PureRenderMixin],propTypes:{mid:React.PropTypes.string.isRequired,body:React.PropTypes.string.isRequired},render:function(){var e=this.props,t=e.mid,a=e.body,n=o["default"].getNumberOfLines(a)>1,i=prettyPrintOne('<pre class="prettyprint '+(n?"linenums":"")+'">'+_.escape(a)+"</pre>",void 0,n),s=void 0;return s=o["default"].messageShouldBeTruncated(a)?React.createElement(r["default"],{className:"code",mid:t},React.createElement("div",{className:"msg-line","data-mid":t,"data-copyable":'{"format": "code", "mid": "'+t+'"}'},React.createElement("div",{className:"pre-wrap",dangerouslySetInnerHTML:{__html:i}}))):React.createElement("div",{className:"msg-line code","data-mid":t,"data-copyable":'{"format": "code", "mid": "'+t+'"}'},React.createElement("div",{className:"pre-wrap",dangerouslySetInnerHTML:{__html:i}}))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(99),o=n(i),s=a(448),r=n(s);t["default"]=React.createClass({displayName:"MonospaceMessageType",mixins:[React.addons.PureRenderMixin],propTypes:{mid:React.PropTypes.string.isRequired,body:React.PropTypes.string.isRequired},render:function(){var e=this.props,t=e.mid,a=e.body,n='<pre class="prettyprint">'+_.escape(a)+"</pre>",i=void 0;return i=o["default"].messageShouldBeTruncated(a)?React.createElement(r["default"],{className:"monospace",mid:t},React.createElement("div",{className:"msg-line","data-mid":t,"data-copyable":'{"format": "monospace", "mid": "'+t+'"}'},React.createElement("div",{className:"pre-wrap",dangerouslySetInnerHTML:{__html:n}}))):React.createElement("div",{className:"msg-line monospace","data-mid":t,"data-copyable":'{"format": "monospace", "mid": "'+t+'"}'},React.createElement("div",{className:"pre-wrap",dangerouslySetInnerHTML:{__html:n}}))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(95),o=n(i),s=a(341),r=n(s),l=a(203),u=n(l),c=a(369),d=n(c),f=a(342),h=n(f),p=a(121),_=n(p);t["default"]=React.createClass({displayName:"NotEditableDialog",mixins:[d["default"],h["default"]],_dialogBody:function(){var e=36e5,t=Math.round(_["default"].edit_message_threshold/e);return React.createElement("p",null,u["default"].not_editable_body(t))},_dialogFooterButton:function(){return React.createElement("button",{form:"not-editable-message-form",className:"aui-button aui-button-primary",type:"submit",onClick:o["default"].closeDialog},u["default"].OK)},render:function(){return React.createElement(r["default"],{dialogId:"not-editable-dialog",title:u["default"].not_editable(this.props.action),dialogBody:this._dialogBody,dialogFooterButton:this._dialogFooterButton,noCloseLink:!0})}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(341),o=n(i),s=a(203),r=n(s),l=a(342),u=n(l),c=a(456),d=n(c),f=a(99),h=n(f),p=a(457),m=n(p),g=a(459),v=n(g),y=a(458),b=n(y),w=a(329),R=n(w),k=a(460),E=n(k),C=a(270),S=n(C);t["default"]=React.createClass({displayName:"WelcomeDialog",mixins:[u["default"]],componentDidMount:function(){d["default"].on(["change"],this._onStoreChange),b["default"].dialogRendered()},componentWillUnmount:function(){d["default"].off(["change"],this._onStoreChange)},componentDidUpdate:function(e,t){this.state.new_forced_caret_position&&(h["default"].setCaretPosition(ReactDOM.findDOMNode(this).querySelector(".textarea"),this.state.new_forced_caret_position),b["default"].resetNewForcedCaretPosition())},getInitialState:function(){return this._getState()},_getState:function(){return d["default"].getAll()},_onStoreChange:function(){this.setState(this._getState())},_getStarIcon:function(){return React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-star"})},_getInfoIcon:function(){return React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-info"})},_dialogTitle:function(){var e="";switch(this.state.current_step){case"welcome":e=r["default"].welcome_to_hipchat;break;case"people":e=r["default"].choose_people_to_chat;break;case"rooms":e=r["default"].join_some_rooms;break;case"message":e=r["default"].introduce_yourself}return React.createElement("div",{className:"welcome"===this.state.current_step?"hc-welcome-dialog-title-center":null},e)},_dialogBody:function(){var e=null;switch(this.state.current_step){case"welcome":e=this._getWelcomeStep();break;case"people":e=this._getPeopleStep();break;case"rooms":e=this._getRoomsStep();break;case"message":e=this._getMessageStep()}return React.createElement("div",{className:"hc-welcome-dialog-content"},e)},_dialogFooterButton:function(){var e=[],t=this._getSpinner();switch(this.state.current_step){case"welcome":e=this._isFirstPeopleItemExist()?[this._getStartButton(),this._getSkipDialogButton()]:t;break;case"people":e=[this._getNextButton(),this._getSkipThisStepButton()];break;case"rooms":e=[this._getNextButton(),this._getSkipThisStepButton()];break;case"message":e=[this._getFinishButton(),this._getSkipThisStepButton()]}return React.createElement("div",{className:"hc-welcome-footer-buttons"},e)},_getWelcomeStep:function(){return React.createElement("div",null,React.createElement("div",{className:"hc-welcome-welcome-img"}),React.createElement("div",{className:"hc-welcome-welcome-text"},React.createElement("p",null,r["default"].we_ll_help_you),React.createElement("p",null,r["default"].this_won_t_take_long)))},_getPeopleStep:function(){var e=_.toArray(this.state.people);return React.createElement("div",null,React.createElement("p",null,r["default"].lets_put_together_a_list_of_people),React.createElement("h6",null,r["default"].suggestions),React.createElement(ReactList,{itemRenderer:this._renderPeopleItem,length:e.length,selected:this.state.selected_people.length,people:e,threshold:0,pageSize:20,type:"simple"}))},_getRoomsStep:function(){var e=_.toArray(this.state.rooms),t=this.state.selected_people.length,a=1===t?r["default"].got_that_person_down:r["default"].got_those_people_down(t),n=t?React.createElement("p",null,this._getStarIcon()," ",a):null;return React.createElement("div",null,n,React.createElement("p",null,r["default"].weve_got_a_few_sugg_on_rooms),React.createElement("h6",null,r["default"].suggestions),React.createElement(ReactList,{itemRenderer:this._renderRoomsItem,length:e.length,selected:this.state.selected_rooms.length,rooms:e,threshold:0,pageSize:20,type:"simple"}))},_getMessageStep:function(){var e=this.state.selected_rooms.length,t=1===e?r["default"].that_is_a_good_roome_choice:r["default"].those_are_some_good_roome_choices,a=e?React.createElement("p",null,this._getStarIcon()," ",t):null,n=React.createElement("p",null,this._getInfoIcon()," ",r["default"].use_here_in_tour_message),i=this.state.is_welcome_message_too_long?React.createElement("p",{className:"error"},r["default"].welcome_message_err(this.state.max_length_of_welcome_message)):null;return React.createElement("div",null,a,React.createElement("p",null,r["default"].you_are_all_set),n,React.createElement("h6",null,r["default"].message),React.createElement("div",{className:"hc-welcome-message"},React.createElement("textarea",{rows:"2",className:"textarea",onChange:this._onValueChange,value:this.state.welcome_message}),React.createElement("div",{className:"hc-welcome-smiley-icon"+(e?" star-toggled":""),onClick:this._onSmileyClick},React.createElement("span",{className:"aui-icon hipchat-icon-small icon-emoticon"},"Emoticons"),React.createElement(E["default"],{type:"smiley_selector"}))),i)},_onSmileyClick:function(e){var t=e.currentTarget.className;~t.indexOf(" selected")?e.currentTarget.className=t.replace(" selected",""):e.currentTarget.className+=" selected",b["default"].toggleTooltip({type:"smiley_selector",data:{smileys:this.state.smileys}})},_renderPeopleItem:function(e,t){var a=_.toArray(this.state.people)[e];return a.jid?React.createElement(m["default"],{key:a.jid,jid:a.jid,name:a.name,title:a.title,user_id:a.id,item_index:e,is_selected:-1!==this.state.selected_people.indexOf(a.jid),is_first_selection:this.state.is_first_selection,photo_url:a.photo_small,presence_show:a.presence.show}):void 0},_renderRoomsItem:function(e,t){var a=_.toArray(this.state.rooms)[e];return a.jid?React.createElement(v["default"],{key:a.jid,jid:a.jid,name:a.name,topic:a.topic,privacy:a.privacy,type:h["default"].room.detect_chat_type(a.jid),is_selected:-1!==this.state.selected_rooms.indexOf(a.jid),avatar_url:a.avatar_url,all_participants:a.participants_fetched,roster:this.state.roster,current_user_jid:this.state.current_user_jid,max_amount_of_people_icons:this.state.max_amount_of_people_icons}):void 0},_onValueChange:function(e){var t=this.state.max_length_of_welcome_message;e.target.value.length<t?(b["default"].changeWelcomeMessage(e.target.value),this.state.is_welcome_message_too_long&&b["default"].setIsWelcomeMessageTooLong(!1)):(b["default"].changeWelcomeMessage(e.target.value.slice(0,t)),b["default"].setIsWelcomeMessageTooLong(!0))},_getStartButton:function(){return React.createElement("button",{key:"start_button",className:"aui-button aui-button-primary",onClick:this._nextStep},r["default"].start_button)},_getSkipDialogButton:function(){return React.createElement("button",{key:"skip_button",className:"aui-button aui-button-link",onClick:this._skipDialog},r["default"].skip_dialog_button)},_getNextButton:function(){var e=null;switch(this.state.current_step){case"people":e=0===this.state.selected_people.length;break;case"rooms":e=0===this.state.selected_rooms.length}return React.createElement("button",{key:"next_button",className:"aui-button aui-button-primary",disabled:e,onClick:this._nextStep},r["default"].next_button)},_getSkipThisStepButton:function(){return React.createElement("button",{key:"skip_button",className:"aui-button aui-button-link",onClick:this._skipThisStep},r["default"].skip_this_step_button)},_getFinishButton:function(){var e=this.state.selected_people.length+this.state.selected_rooms.length===0,t=""===this.state.welcome_message.trim();return React.createElement("button",{key:"finish_button",className:"aui-button aui-button-primary",disabled:e||t,onClick:this._createChats},r["default"].finish_and_send_button)},_getSpinner:function(){return React.createElement(R["default"],{spin:!0,size:"small",spinner_class:"hc-loading-spinner"})},_skipDialog:function(){b["default"].skipDialog()},_nextStep:function(){var e=this.state.steps.indexOf(this.state.current_step),t=e+1;b["default"].nextStep(this.state.steps[t])},_skipThisStep:function(){var e=this.state.current_step,t=this.state.steps.indexOf(e),a=t+1;switch(e){case"people":b["default"].clearPeopleSelection(),b["default"].skipThisStep(this.state.steps[a]);break;case"rooms":b["default"].clearRoomsSelection(),b["default"].skipThisStep(this.state.steps[a]);break;case"message":this._createChats(!1)}},_createChats:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?!0:arguments[0],a=h["default"].strings.stripHiddenCharacters(this.state.welcome_message.trim());this.state.selected_people.forEach(function(n){b["default"].createChats({jid:e.state.people[n].jid,name:e.state.people[n].name,type:e.state.people[n].type}),t&&b["default"].sendMessage({text:a,jid:e.state.people[n].jid,id:S["default"].get("message_id"),active_chat_id:e.state.people[n].id,chat_type:e.state.people[n].type})}),this.state.selected_rooms.forEach(function(n){b["default"].createChats({jid:e.state.rooms[n].jid,name:e.state.rooms[n].name,type:e.state.rooms[n].type}),t&&b["default"].sendMessage({text:a,jid:e.state.rooms[n].jid,id:S["default"].get("message_id"),active_chat_id:e.state.rooms[n].id,chat_type:e.state.rooms[n].type})}),b["default"].closeDialog()},_isFirstPeopleItemExist:function(){var e=_.toArray(this.state.people);return!(!e[0]||!e[0].jid)},render:function(){return React.createElement(o["default"],{dialogId:"welcome-dialog",title:this._dialogTitle(),dialogBody:this._dialogBody,dialogFooterButton:this._dialogFooterButton,noCloseLink:!0})}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(51),h=n(f),p=a(9),m=n(p),g=a(97),v=n(g),y=a(121),b=n(y),w=a(203),R=n(w),k=a(206),E=n(k),C=a(190),S=n(C),T=function(e){function t(){(0,r["default"])(this,t);var e=(0,d["default"])(this,(0,o["default"])(t).call(this));return e.local={welcome_init:!1},e}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"getDefaults",value:function(){return{steps:["welcome","people","rooms","message"],current_step:"welcome",people:{},rooms:{},selected_people:[],selected_rooms:[],welcome_message:R["default"].welcome_messages(),is_first_selection:!0,current_user_jid:"",max_length_of_welcome_message:b["default"].welcome_dialog.max_length_of_welcome_message,max_amount_of_people_icons:b["default"].welcome_dialog.max_amount_of_people_icons,is_welcome_message_too_long:!1,roster:{},smileys:{},new_forced_caret_position:0}}},{key:"registerListeners",value:function(){var e=this;m["default"].registerOnce({"hc-init":function(t){e.set({current_user_jid:t.jid})},"welcome-init":function(){e.local.welcome_init=!0,e._handleRoster(),e._handleAllRooms()}}),m["default"].register({"updated:roster":function(t){e.local.welcome_init&&e._handleRoster(t)},"updated:allRooms":function(t){e.local.welcome_init&&e._handleAllRooms(t)},"updated:smileys":function(t){var a=_.keyBy(_.keyBy(t,"file"),"shortcut");e.set({smileys:a})},"welcome-select-people":function(t){e._selectPeople(t)},"welcome-unselect-people":function(t){e._unselectPeople(t)},"welcome-select-rooms":function(t){e._selectRooms(t)},"welcome-unselect-rooms":function(t){e._unselectRooms(t)},"welcome-change-message":function(t){e._changeWelcomeMessage(t)},"smiley-chosen":function(t){e.handleSmileyChosen(t)},"reset-new-forced-caret-position":function(){e.set("new_forced_caret_position",0)},"welcome-is-message-too-long":function(t){e.set("is_welcome_message_too_long",t)},"welcome-change-current-step":function(t){e.set("current_step",t)},"welcome-clear-people-selection":function(){e.set("selected_people",[])},"welcome-clear-rooms-selection":function(){e.set("selected_rooms",[])}})}},{key:"_handleRoster",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],a=this.data.people,n=this.data.current_user_jid,i=b["default"].welcome_dialog.max_displayed_people;_.isEmpty(t)&&(t=S["default"].get("roster")),_.size(a)<i&&""!==n&&_.each(t,function(o,s){_.size(a)<i&&n!==s&&!a[s]&&(a[s]={},m["default"].dispatch("request-profile",s,function(n){a[s]=n.query,a[s].jid=t[s].jid,a[s].id=t[s].id,a[s].presence=t[s].presence,e.set({people:a})}))}),this.set({roster:t})}},{key:"_handleAllRooms",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],a=this.data.rooms,n=b["default"].welcome_dialog.max_displayed_rooms;_.isEmpty(t)&&(t=S["default"].get("allRooms")),_.size(a)<n&&_.each(t,function(i,o){_.size(a)<n&&"public"===t[o].privacy&&!a[o]&&(a[o]={},m["default"].dispatch("fetch-room",o,function(t,n){n&&(a[o].jid=n.jid,a[o].name=n.name,a[o].topic=n.topic,a[o].privacy=n.privacy,a[o].avatar_url=n.avatar_url,e.set({rooms:a}))}),E["default"].fetchParticipants(t[o].id).then(function(t){a[o].participants_fetched=[],_.each(t.participants,function(e,t){a[o].participants_fetched.push(e.xmpp_jid)}),e.set({rooms:a})}))})}},{key:"handleSmileyChosen",value:function(e){var t=this.data.welcome_message+e.shortcut+" ";this.set({welcome_message:t,new_forced_caret_position:t.length})}},{key:"_selectPeople",value:function(e){var t=this.get("selected_people");-1===t.indexOf(e)&&(t.push(e),this.set({selected_people:t})),this.data.is_first_selection===!0&&this.set({is_first_selection:!1})}},{key:"_unselectPeople",value:function(e){var t=this.get("selected_people");-1!==t.indexOf(e)&&this.set({selected_people:t.filter(function(t){return t!==e})})}},{key:"_selectRooms",value:function(e){var t=this.get("selected_rooms");-1===t.indexOf(e)&&(t.push(e),this.set({selected_rooms:t}))}},{key:"_unselectRooms",value:function(e){var t=this.get("selected_rooms");-1!==t.indexOf(e)&&this.set({selected_rooms:t.filter(function(t){return t!==e})})}},{key:"_changeWelcomeMessage",value:function(e){this.set({welcome_message:e})}}]),t}(v["default"]);t["default"]=new T,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(310),o=n(i),s=a(458),r=n(s),l=a(313),u=n(l),c=a(314),d=n(c);
t["default"]=React.createClass({displayName:"WelcomePeopleItem",mixins:[d["default"]],componentDidMount:function(){0===this.props.item_index&&this.props.is_first_selection&&this.selectItem(this.props.jid)},getDefaultProps:function(){return{key:"",jid:"",name:"",title:"",user_id:null,item_index:0,is_selected:!1,photo_url:"",presence_show:""}},propTypes:{key:React.PropTypes.string.isRequired,jid:React.PropTypes.string.isRequired,name:React.PropTypes.string.isRequired,title:React.PropTypes.string,user_id:React.PropTypes.oneOfType([React.PropTypes.number,React.PropTypes.string]).isRequired,item_index:React.PropTypes.number.isRequired,is_selected:React.PropTypes.bool.isRequired,photo_url:React.PropTypes.string.isRequired,presence_show:React.PropTypes.string.isRequired},_onClick:function(){var e=this.props.jid;this.props.is_selected?this.unselectItem(e):this.selectItem(e)},selectItem:function(e){r["default"].selectPeopleItem(e)},unselectItem:function(e){r["default"].unselectPeopleItem(e)},_getIcon:function(){return React.createElement(o["default"],{avatar_url:this.props.photo_url,presence:this.props.presence_show,size:"medium",uid:this.props.user_id,active:!0})},render:function(){var e=(0,u["default"])({"hc-welcome-person-item":!0,selected:this.props.is_selected}),t=this._getIcon(),a=this.props.name,n=this.props.title;return React.createElement("div",{className:e,onClick:this._onClick},React.createElement("div",{className:"hc-welcome-person-icon"},t),React.createElement("div",{className:"hc-welcome-person-info hc-welcome-person-info-ellipsis"},React.createElement("span",{className:"hc-welcome-person-name"},a),React.createElement("br",null),React.createElement("span",{className:"hc-welcome-person-job-title"},n)))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i),s=a(173),r=n(s),l=a(456),u=n(l);t["default"]={dialogRendered:function(){o["default"].dispatch("welcome-init"),r["default"].dispatch("analytics-event",{name:"hipchat.client.welcome.dialog.render"})},selectPeopleItem:function(e){o["default"].dispatch("welcome-select-people",e)},unselectPeopleItem:function(e){o["default"].dispatch("welcome-unselect-people",e)},selectRoomsItem:function(e){o["default"].dispatch("welcome-select-rooms",e)},unselectRoomsItem:function(e){o["default"].dispatch("welcome-unselect-rooms",e)},changeWelcomeMessage:function(e){o["default"].dispatch("welcome-change-message",e)},createChats:function(e){var t=u["default"].get("welcome_message");switch(e.source="welcome_dialog",r["default"].dispatch("analytics-open-room",e),!0){case""===t:r["default"].dispatch("analytics-event",{name:"hipchat.client.welcome.dialog.message.skip",properties:{step:"message",message:t}});break;case""!==t:r["default"].dispatch("analytics-event",{name:"hipchat.client.welcome.dialog.message.finish",properties:{step:"message",message:t}})}o["default"].dispatch("set-multiple-routes",e)},closeDialog:function(){o["default"].dispatch("hide-modal-dialog")},skipDialog:function(){o["default"].dispatch("hide-modal-dialog"),r["default"].dispatch("analytics-event",{name:"hipchat.client.welcome.dialog.welcome.skip",properties:{step:"welcome"}})},resetNewForcedCaretPosition:function(){o["default"].dispatch("reset-new-forced-caret-position")},toggleTooltip:function(e){o["default"].dispatch("toggle-tooltip",e)},setIsWelcomeMessageTooLong:function(e){o["default"].dispatch("welcome-is-message-too-long",e)},nextStep:function(e){var t=u["default"].get("current_step");switch(t){case"welcome":r["default"].dispatch("analytics-event",{name:"hipchat.client.welcome.dialog.welcome.start",properties:{step:t}});break;case"people":r["default"].dispatch("analytics-event",{name:"hipchat.client.welcome.dialog.people.next",properties:{step:t,selected:u["default"].get("selected_people").length}});break;case"rooms":r["default"].dispatch("analytics-event",{name:"hipchat.client.welcome.dialog.rooms.next",properties:{step:t,selected:u["default"].get("selected_rooms").length}})}o["default"].dispatch("welcome-change-current-step",e)},skipThisStep:function(e){var t=u["default"].get("current_step");switch(t){case"people":r["default"].dispatch("analytics-event",{name:"hipchat.client.welcome.dialog.people.skip",properties:{step:t}});break;case"rooms":r["default"].dispatch("analytics-event",{name:"hipchat.client.welcome.dialog.rooms.skip",properties:{step:t}})}o["default"].dispatch("welcome-change-current-step",e)},sendMessage:function(e){o["default"].dispatch("send-message",e),r["default"].dispatch("analytics-send-message",e)},clearPeopleSelection:function(){o["default"].dispatch("welcome-clear-people-selection")},clearRoomsSelection:function(){o["default"].dispatch("welcome-clear-rooms-selection")}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(310),o=n(i),s=a(458),r=n(s),l=a(313),u=n(l),c=a(314),d=n(c);t["default"]=React.createClass({displayName:"WelcomeRoomsItem",mixins:[d["default"]],getDefaultProps:function(){return{key:"",jid:"",name:"",topic:"",privacy:"",type:"",is_selected:!1,avatar_url:"",all_participants:[],roster:{},current_user_jid:"",presence_show:"",max_amount_of_people_icons:null}},propTypes:{key:React.PropTypes.string.isRequired,jid:React.PropTypes.string.isRequired,name:React.PropTypes.string.isRequired,topic:React.PropTypes.string,privacy:React.PropTypes.string.isRequired,type:React.PropTypes.string.isRequired,is_selected:React.PropTypes.bool.isRequired,avatar_url:React.PropTypes.string.isRequired,all_participants:React.PropTypes.array.isRequired,roster:React.PropTypes.object.isRequired,current_user_jid:React.PropTypes.string.isRequired,presence_show:React.PropTypes.string.isRequired,max_amount_of_people_icons:React.PropTypes.number.isRequired},_onClick:function(){var e=this.props.jid;this.props.is_selected?this.unselectItem(e):this.selectItem(e)},selectItem:function(e){r["default"].selectRoomsItem(e)},unselectItem:function(e){r["default"].unselectRoomsItem(e)},_getIcon:function(){var e=void 0;return e="groupchat"===this.props.type&&""===this.props.avatar_url?React.createElement("span",{className:"aui-icon hipchat-icon-small icon-"+this.props.privacy}):React.createElement(o["default"],{avatar_url:this.props.avatar_url,show_presence:!1,size:"medium"})},_getParticipantsIcon:function(){var e=this,t=[],a=this.props.all_participants;return a.indexOf(this.props.current_user_jid)>-1&&a.splice(a.indexOf(this.props.current_user_jid),1),a.forEach(function(a){t.length<e.props.max_amount_of_people_icons&&a in e.props.roster&&t.push(React.createElement(o["default"],{key:e.props.roster[a].jid,avatar_url:e.props.roster[a].photo_url,show_presence:!1,size:"small"}))}),t},render:function(){var e=(0,u["default"])({"hc-welcome-room-item":!0,selected:this.props.is_selected}),t=this.props.name,a=this._getIcon(),n=this.props.all_participants?this._getParticipantsIcon():[],i=this.props.topic;return React.createElement("div",{className:e,onClick:this._onClick},React.createElement("div",{className:"hc-welcome-room-icon"},a),React.createElement("div",{className:"hc-welcome-room-info hc-welcome-room-info-ellipsis"},React.createElement("span",{className:"hc-welcome-room-name"},t),React.createElement("br",null),React.createElement("span",{className:"hc-welcome-room-topic"},i)),React.createElement("div",{className:"hc-welcome-room-participants"},n))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i),s=a(461),r=n(s),l=a(463),u=n(l);t["default"]=React.createClass({displayName:"Tooltip",propTypes:{type:React.PropTypes.oneOf(["upload_preview","smiley_selector"]).isRequired},componentDidMount:function(){var e=this;o["default"].register({"toggle-tooltip":this._onToggle,"close-tooltip":this._onClose,"open-tooltip":this._onOpen}),this.toggle=_.bind(function(t){ReactDOM.findDOMNode(e).parentNode.contains(t.target)||e._onToggle({type:e.props.type})}),this.outside_click_dismiss="smiley_selector"===this.props.type},componentWillUnmount:function(){var e=this,t=ReactDOM.findDOMNode(this);document.removeEventListener("click",this.toggle),o["default"].unregister({"toggle-tooltip":this._onToggle,"close-tooltip":this._onClose,"open-tooltip":this._onOpen}),[].map.call(t.querySelectorAll(".file-preview"),function(e){return e}).forEach(function(t){t.removeEventListener("load",e._positionTooltip)})},componentDidUpdate:function(){this.state.is_visible&&this._positionTooltip()},getInitialState:function(){return{is_visible:!1}},_getToolTip:function(e){var t={smiley_selector:r["default"],upload_preview:u["default"]};return t[e]},render:function(){var e=this._getToolTip(this.props.type);return React.createElement("div",{className:"hc-tooltip "+(this.state.is_visible?"":"hidden")},React.createElement("div",{className:"hc-tooltip-content"},React.createElement(e,{data:this.state.data})),React.createElement("div",{className:"aui-inline-dialog-arrow arrow aui-css-arrow"}))},_onClose:function(e){this.isMounted()&&(e.type===this.props.type&&(this.outside_click_dismiss&&document.removeEventListener("click",this.toggle),this.setState({is_visible:!1})),this._resetArrow())},_onOpen:function(e){e.type===this.props.type&&(this.outside_click_dismiss&&document.addEventListener("click",this.toggle),this.setState({is_visible:!0,data:e.data}))},_onToggle:function(e){this.state.is_visible?this._onClose(e):this._onOpen(e)},_resetArrow:function(){ReactDOM.findDOMNode(this).querySelector(".arrow").classList.remove("right")},_positionTooltip:function(){var e=this,t=ReactDOM.findDOMNode(this),a=t.parentElement,n=a.offsetHeight+8,i=Math.floor(-t.offsetWidth/2+a.offsetWidth/2);t.style.bottom=n+"px",t.style.left=i+"px",t.getBoundingClientRect().right>window.innerWidth&&(t.style.left=t.offsetLeft-8-(t.getBoundingClientRect().right-window.innerWidth)+"px",t.querySelector(".arrow").classList.add("right")),[].map.call(t.querySelectorAll(".file-preview"),function(e){return e}).forEach(function(t){t.addEventListener("load",e._positionTooltip)})}}),e.exports=t["default"]},function(e,t,a){"use strict";var n=a(298),i=a(462),o=a(110);e.exports=React.createClass({displayName:"TooltipTypeSmileySelector",getDefaultProps:function(){return{data:{smileys:{},user_is_admin:!1}}},render:function(){var e,t=this;return this.props.data.user_is_admin&&(e=React.createElement("div",{className:"smiley-custom-link"},React.createElement("a",{target:"_blank",href:"https://"+this.props.data.web_server+"/admin/emoticons",onClick:this._onCustomClick},i.custom_emoticon_link))),React.createElement("div",{className:"smileys-selection"},_.map(this.props.data.smileys,function(e){return React.createElement("span",{key:e.shortcut,onClick:t._onSmileyClick,"data-shortcut":e.shortcut,dangerouslySetInnerHTML:{__html:o.render(">:-("===e.shortcut?_.escape(e.shortcut):e.shortcut)}})}),React.createElement("div",{className:"clear"}),React.createElement("div",{className:this.props.data.user_is_admin?"more-emoticons-link-admin":"more-emoticons-link"},React.createElement("a",{target:"_blank",href:"https://"+this.props.data.web_server+"/emoticons",onClick:this._onMoreClick},i.emoticon_more_link)),e)},_onSmileyClick:function(e){n.smileyChosen({shortcut:e.currentTarget.getAttribute("data-shortcut")})},_onMoreClick:function(){n.moreEmoticonsChosen()},_onCustomClick:function(){n.customEmoticonsChosen()}})},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={emoticon_more_link:"Moreâ¦",custom_emoticon_link:"Custom",admin:"Room Admin",status:"Status:",message:"Message:"},e.exports=t["default"]},function(e,t){"use strict";e.exports=React.createClass({displayName:"TooltipTypeUploadPreview",getDefaultProps:function(){return{data:{file:{src:"",file_type:""}}}},render:function(){var e={image:React.createElement("img",{className:"file-preview",src:this.props.data.file.src_processed}),text:React.createElement("iframe",{className:"file-preview",src:this.props.data.file.src}),video:React.createElement("video",{className:"file-preview",src:this.props.data.file.src,autoPlay:!0,muted:!0}),audio:React.createElement("audio",{className:"file-preview",src:this.props.data.file.src,controls:!0})};return e[this.props.data.file.file_type]||React.createElement("div",null)}})},function(e,t,a){"use strict";var n=a(342),i=a(95);e.exports=React.createClass({displayName:"ModalDialogBackdrop",mixins:[n],componentDidMount:function(){document.querySelector("body").addEventListener("keydown",this._onKeydown)},componentWillUnmount:function(){document.querySelector("body").removeEventListener("keydown",this._onKeydown)},getDefaultProps:function(){return{btnLoading:!1,bgDismiss:!0}},_onKeydown:function(e){var t=window.Event?e.which:e.keyCode;27!==t||this.props.btnLoading||this.close()},_onClick:function(){!this.props.btnLoading&&this.props.bgDismiss&&this.close()},close:function(){i.closeDialog()},render:function(){return React.createElement("div",{className:"aui-blanket","aria-hidden":!this.state.dialogVisible,tabIndex:"0",onClick:this._onClick})}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(278),o=n(i),s=a(466),r=n(s),l=a(468),u=n(l),c=a(469),d=n(c),f=a(471),h=n(f),p=a(313),_=n(p);t["default"]=React.createClass({displayName:"InlineDialogContainer",componentDidMount:function(){o["default"].on("change",this._onChange)},componentWillUnmount:function(){o["default"].off("change",this._onChange)},getInitialState:function(){return o["default"].getAll()},_onChange:function(){this.setState(o["default"].getAll())},_getDialog:function(){var e=this.state.activeDialog,t=!1;if(e)switch(e){case"user-status-message-inline-dialog":t=React.createElement(r["default"],this.state.dialogData);break;case"connection-status-message-inline-dialog":t=React.createElement(u["default"],this.state.dialogData);break;case"guest-access-information-inline-dialog":t=React.createElement(d["default"],this.state.dialogData);break;case"add-integrations-help-dialog":t=React.createElement(h["default"],this.state.dialogData)}return t},_isDialogInvisible:function(e){return this.state.activeDialog!==e},render:function(){var e=(0,_["default"])({"banner-shown":this.state.bannerShown}),t=this._getDialog();return React.createElement("div",{className:e},t)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(467),o=n(i),s=a(311),r=n(s),l=a(9),u=n(l),c=a(277),d=n(c),f=a(257),h=n(f),p=a(121),m=n(p);t["default"]=React.createClass({displayName:"UserStatusMessageForm",getInitialState:function(){return{text:this.props.status,is_status_updated:!1}},getDefaultProps:function(){return{visible:!1}},componentDidMount:function(){u["default"].register("position-app-header-dialogs",this._positionDialog),this._positionDialog(),this._focusAndSelect()},componentDidUpdate:function(){this._positionDialog()},componentWillUnmount:function(){u["default"].unregister("position-app-header-dialogs",this._positionDialog),this.state.is_status_updated||h["default"].changeStatus({show:this.props.show,status:"",type:"status"})},_positionDialog:function(){var e,t=this.props.anchor,a=ReactDOM.findDOMNode(this);t&&_.delay(function(){e=t.getBoundingClientRect().bottom+5,$(a).css({top:e+"px",display:"block"})},m["default"].notification_banner_slide)},_focusAndSelect:function(){var e=this.refs.input;_.delay(function(){e.focus(),e.select()},m["default"].notification_banner_slide)},_onSubmit:function(e){var t=this;e.preventDefault(),this.setState({is_status_updated:!0},function(){h["default"].changeStatus({show:t.props.show,status:t.state.text,type:"status"}),d["default"].hideInlineDialog()})},render:function(){return React.createElement(o["default"],{dialogId:"userStatusMessage"},React.createElement("form",{id:"userStatusForm",className:"aui aui-group",onSubmit:this._onSubmit},React.createElement("div",{className:"aui-item status-icon"},React.createElement(r["default"],{presence:this.props.show,uid:this.props.current_user_id})),React.createElement("div",{className:"aui-item status-message"},React.createElement("input",{type:"text",className:"text",placeholder:"Set your status",maxLength:m["default"].max_presence_text_length,name:"status-message",value:this.state.text,ref:"input",onChange:this._onChange})),React.createElement("div",{className:"aui-item"},React.createElement("button",{className:"aui-button aui-button-small",type:"submit"},"OK"))))},_onChange:function(e){this.setState({text:e.target.value})}}),e.exports=t["default"]},function(e,t,a){"use strict";var n=a(313);e.exports=React.createClass({displayName:"InlineDialog",propTypes:{onShow:React.PropTypes.func},componentDidMount:function(){this.props.invisible||this.props.onShow()},componentDidUpdate:function(e){e.invisible!==this.props.invisible&&(this.props.invisible?this.props.onHide():this.props.onShow())},componentWillUnmount:function(){this.props.invisible||this.props.onHide()},getDefaultProps:function(){return{invisible:!1,dialogId:"dialog",dialog_callout:!1,onShow:_.noop,onHide:_.noop,onMouseOver:_.noop,arrowLocation:"top"}},render:function(){var e=n({"aui-inline-dialog":!0,"dialog-callout":this.props.dialog_callout}),t=n("aui-inline-dialog-arrow arrow aui-css-arrow",{"aui-bottom-arrow":"bottom"===this.props.arrowLocation}),a=n("aui-inline-dialog-contents",{"hc-tooltip-helper":this.props.tooltip_helper});return React.createElement("div",{className:e,"aria-hidden":this.props.invisible?"true":"false",id:this.props.dialogId,onMouseOver:this.props.onMouseOver},React.createElement("div",{className:a},this.props.children,React.createElement("div",{className:t})))}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(121),o=n(i),s=a(9),r=n(s),l=a(467),u=n(l),c=a(323),d=n(c),f=a(326),h=n(f),p=a(169),m=n(p),g=a(327),v=n(g),y=a(328),b=n(y);t["default"]=React.createClass({displayName:"ConnectionStatusMessage",getInitialState:function(){return this._getState()},componentDidMount:function(){m["default"].on(["change:feature_flags"],this._onChange),h["default"].on(["change:connection_status","change:reconnectingIn"],this._onChange),r["default"].register("position-app-header-dialogs",this._positionDialog),this._positionDialog()},componentWillUnmount:function(){m["default"].off(["change:feature_flags"],this._onChange),h["default"].off(["change:connection_status","change:reconnectingIn"],this._onChange),r["default"].unregister("position-app-header-dialogs",this._positionDialog)},render:function(){var e=this._getContent();return React.createElement(u["default"],{dialogId:"connectionStatusMessage"},e)},_getContent:function(){switch(this.props.status){case v["default"].RECONNECT_DELAY:return React.createElement("div",null,React.createElement("p",null,d["default"].check_network));case v["default"].DISCONNECTED:return React.createElement("div",null,this.state.isBTF?!1:React.createElement("p",{dangerouslySetInnerHTML:{__html:d["default"].unable_to_connect_hipchat(o["default"].status_page_url)}}));case b["default"].OFFLINE:return React.createElement("div",null,React.createElement("p",null,d["default"].offline_status));default:return React.createElement("span",null)}},_onChange:function(){this.setState(this._getState())},_getState:function(){var e=Math.round(h["default"].get("reconnectingIn")/1e3);return{isBTF:_.get(m["default"].get("feature_flags"),"btf",!1),reconnectSeconds:e}},_positionDialog:function(){var e,t,a=this.props.anchor,n=ReactDOM.findDOMNode(this);a&&_.delay(function(){e=a.getBoundingClientRect().bottom+5,t=a.getBoundingClientRect().right-$(n).width(),$(n).css({top:e+"px",left:t+"px"})},o["default"].notification_banner_slide)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i),s=a(121),r=n(s),l=a(467),u=n(l),c=a(277),d=n(c),f=a(470),h=n(f);t["default"]=React.createClass({displayName:"GuestAccessInformation",debouncedMouseOut:null,getDefaultProps:function(){return{visible:!1}},componentDidMount:function(){var e=this;o["default"].register("position-app-header-dialogs",this._positionDialog),this._positionDialog(),this.debouncedMouseOut=_.debounce(function(t){return e._onMouseOut(t)},r["default"].guest_access_information.mouseout_delay),document.addEventListener("mouseout",this.debouncedMouseOut),_.delay(function(){e._focusAndSelectInput()},r["default"].guest_access_information.focus_and_select_delay)},componentDidUpdate:function(){this._positionDialog()},componentWillUnmount:function(){o["default"].unregister("position-app-header-dialogs",this._positionDialog),document.removeEventListener("mouseout",this.debouncedMouseOut),this.debouncedMouseOut.cancel(),this.debouncedMouseOut=null},_positionDialog:function(){var e=this.props.anchor,t=ReactDOM.findDOMNode(this),a=void 0,n=void 0,i=void 0;e&&_.delay(function(){a=e.getBoundingClientRect(),n=a.bottom+5,i=a.left+a.width/2,$(t).css({top:n+"px",left:i+"px",display:"block"})},r["default"].notification_banner_slide)},_onMouseOut:function(){d["default"].hideInlineDialog()},_onMouseOver:function(){this.debouncedMouseOut.cancel()},_focusAndSelectInput:function(){if(this.isMounted()){var e=ReactDOM.findDOMNode(this.refs.input);e.focus(),e.setSelectionRange(0,e.value.length)}},render:function(){var e=h["default"].share_this_link_to_invite;return React.createElement(u["default"],{dialogId:"guestAccessInformation",onMouseOver:this._onMouseOver},React.createElement("form",{className:"aui aui-group"},React.createElement("div",{className:"aui-item guest-access-url"},React.createElement("input",{type:"text",className:"text",value:this.props.guest_url,ref:"input",readOnly:!0}),React.createElement("div",{className:"description"},e))))}}),e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={share_this_link_to_invite:"Share this link to invite a guest"},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(437),o=n(i),s=a(467),r=n(s),l=a(121),u=n(l),c=a(277),d=n(c),f=a(9),h=n(f);t["default"]=React.createClass({displayName:"AddIntegrationsDiscoverTooltip",componentDidMount:function(){$(window).on("resize",this._positionDialog),this._positionDialog(),h["default"].register("set-right-sidebar-visible-width-is-changing",this._closeDialog)},componentDidUpdate:function(){this._positionDialog()},componentWillUnmount:function(){$(window).off("resize",this._positionDialog),h["default"].unregister("set-right-sidebar-visible-width-is-changing",this._closeDialog)},_positionDialog:function(){var e=this.props.anchor,t=ReactDOM.findDOMNode(this),a=void 0,n=void 0,i=void 0;e&&_.delay(function(){a=e.getBoundingClientRect(),n=45,i=a.left-a.width/2,$(t).css({bottom:n+"px",left:i+"px",display:"block"})},u["default"].notification_banner_slide)},_closeDialog:function(){d["default"].hideInlineDialog()},render:function(){return React.createElement(r["default"],{dialogId:"add-integrations-discover-tooltip",tooltip_helper:"hc-tooltip-helper",arrowLocation:"bottom"},React.createElement("div",{className:"add-integrations-tooltip"},React.createElement("div",{className:"add-integrations-tooltip-title"},o["default"].install_integrations_tooltip_title),React.createElement("p",{className:"add-integration-tooltip-content"},o["default"].install_integrations_tooltip_content),React.createElement("p",null,React.createElement("a",{className:"add-integration-tooltip-close",onClick:this._closeDialog},o["default"].got_it))))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(334),o=n(i),s=a(473),r=n(s),l=a(329),u=n(l);t["default"]=React.createClass({displayName:"ReadOnlyContainer",componentDidMount:function(){o["default"].on("change",this._onChange)},componentWillUnmount:function(){o["default"].off("change",this._onChange)},getInitialState:function(){return o["default"].getAll()},_onChange:function(){this.setState(o["default"].getAll())},_getContent:function(){return React.createElement(r["default"],this.state)},_getSpinner:function(){return React.createElement(u["default"],{size:"large",spin:!0})},render:function(){var e=this.state,t=e.read_only_mode,a=e.is_dismissed,n=e.is_visible,i=e.is_fetching,o=e.is_fetched;if(!t||a||!n||!i&&!o)return React.createElement("div",null);var s=i?this._getSpinner():this._getContent();return React.createElement("div",{className:"hc-read-only-container"},React.createElement("div",{className:"hc-read-only-inner"},s))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(195),o=n(i),s=a(474),r=n(s);t["default"]=React.createClass({displayName:"ReadOnlyContent",_onDismiss:function(){o["default"].dismissReadOnlyModal()},_getIcon:function(){return React.createElement("img",{src:this.props.icon_url})},_getDownloadButton:function(){return React.createElement("div",{className:"button-wrapper"},React.createElement("a",{className:"aui-button aui-button-primary",href:this.props.button_url,target:"_blank"},this.props.button_text))},render:function(){var e=this.props.icon_url?this._getIcon():null,t=this.props.button_url?this._getDownloadButton():null;return React.createElement("div",{className:"hc-read-only-content"},React.createElement("h3",null,this.props.title),React.createElement("p",null,this.props.text),e,t,React.createElement("hr",null),React.createElement("p",null,this.props.continue_text),React.createElement("div",{className:"button-wrapper"},React.createElement("a",{className:"aui-button",onClick:this._onDismiss},this.props.continue_button)),React.createElement("p",{className:"help"},React.createElement(r["default"],null,this.props.questions_markdown),React.createElement("br",null),React.createElement(r["default"],null,this.props.contact_markdown)))}}),e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=/(.*)\[(.*?)\]\((.*?)\)(.*)/;t["default"]=React.createClass({displayName:"markdown_link",render:function(){var e=this.props.children||"";if(!e.match(a))return React.createElement("span",null,e);var t=void 0,n=void 0,i=void 0;return e.replace(a,function(e,a,o,s,r){t=a,i=React.createElement("a",{href:s,target:"_blank"},o),n=r}),React.createElement("span",null,t,i,n)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(191),o=n(i),s=a(476),r=n(s),l=a(477),u=n(l),c=a(478),d=n(c),f=a(479),h=n(f);t["default"]=React.createClass({displayName:"FlagsContainer",componentDidMount:function(){r["default"].on("change",this._onChange)},componentWillUnmount:function(){r["default"].off("change",this._onChange)},getInitialState:function(){return r["default"].getAll()},_onChange:function(){this.setState(r["default"].getAll())},_getFlag:function(e,t){var a=void 0;switch(e.type){case"video":a=React.createElement(h["default"],{ref:"incoming_call_flag",flag_index:t,sender:e.sender,photo:e.photo,message:e.message,service:e.service,key:t});break;case"video_popup_blocked":a=React.createElement(d["default"],{title:e.title,body:e.body,close:e.close,promise:e.promise,key:t});break;default:a=React.createElement(u["default"],(0,o["default"])({flag_index:t},e,{key:t}))}return a},render:function(){var e=this;return React.createElement("div",{className:"hc-flags-container"},_.map(this.state.flags,function(t){return e._getFlag(t,_.uniqueId())}))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(51),h=n(f),p=a(97),m=a(9),g=function(e){function t(){(0,r["default"])(this,t);var e=(0,d["default"])(this,(0,o["default"])(t).call(this));return e.data={flags:[]},e.flag_defaults={type:"info",close:"manual",title:"",body:null,image_url:null,link_url:null,link_text:null,onClose:null},e.register_listeners(),e}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"register_listeners",value:function(){var e=this;m.register({"show-flag":function(t){e.add_flag(t)},"remove-flag":function(t){e.remove_flag(t)}})}},{key:"add_flag",value:function(e){this.data.flags.unshift(_.defaults(e,this.flag_defaults)),this.set("flags",this.data.flags)}},{key:"remove_flag",value:function(e){var t=_.findIndex(this.data.flags,{id:e});t&&(e=t),this.data.flags.splice(e,1),this.set("flags",this.data.flags)}}]),t}(p);e.exports=new g},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(157),o=n(i),s=a(204),r=n(s),l=a(121),u=n(l),c=a(313),d=n(c);t["default"]=React.createClass({displayName:"Flag",propTypes:{type:React.PropTypes.oneOf(["info","success","warning","error"]).isRequired,close:React.PropTypes.oneOf(["manual","auto","never"]).isRequired},_isCloseable:function(){return"never"!==this.props.close},_getCloseButton:function(){return this._isCloseable()?React.createElement("span",{onClick:this.close,className:"aui-icon hipchat-icon-small icon-close",role:"button",tabIndex:"0"}):void 0},_getImage:function(){return this.props.image_url?React.createElement("p",{className:"image"},React.createElement("img",{src:this.props.image_url})):null},_getAction:function(){return this.props.link_url&&this.props.link_text?React.createElement("ul",{className:"aui-nav-actions-list"},React.createElement("li",null,React.createElement("a",{href:this.props.link_url,target:"_blank"},this.props.link_text))):null},close:function(){var e=this.props.flag_index;this.isMounted()&&$(ReactDOM.findDOMNode(this)).attr("aria-hidden",!0),"function"==typeof this.props.onClose&&this.props.onClose(),_.delay(function(){r["default"].removeFlag(e)},u["default"].flag_close_animation_time)},render:function(){var e,t=(0,d["default"])((e={"hc-message":!0},(0,o["default"])(e,"hc-message-"+this.props.type,!0),(0,o["default"])(e,this.props.type,!0),(0,o["default"])(e,"closeable",this._isCloseable()),e));return"auto"===this.props.close&&_.delay(this.close,this.props.delay||2e3),React.createElement("div",{className:"hc-flag","data-flag-index":this.props.flag_index,"aria-hidden":"false"},React.createElement("div",{className:t},this._getImage(),React.createElement("p",{className:"title"},React.createElement("strong",null,this.props.title)),"function"==typeof this.props.body?this.props.body():this.props.body,this._getAction(),this._getCloseButton()))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(204),o=n(i),s=a(121),r=n(s),l=a(203),u=n(l);t["default"]=React.createClass({displayName:"Flag",propTypes:{close:React.PropTypes.oneOf(["manual","auto","never"]).isRequired,promise:React.PropTypes.func.isRequired},_getCloseButton:function(){return React.createElement("span",{onClick:this.close,className:"aui-icon hipchat-icon-small icon-close",role:"button",tabIndex:"0"})},close:function(){var e=this.props.flag_index;this.isMounted()&&$(ReactDOM.findDOMNode(this)).attr("aria-hidden",!0),_.delay(function(){o["default"].removeFlag(e)},r["default"].flag_close_animation_time)},_executePromise:function(){var e=this;this.props.promise().then(function(t){t&&e.close()})},render:function(){var e="hc-message hc-message-"+this.props.type+" hc-message-info closeable",t=this._getCloseButton();return"auto"===this.props.close&&_.delay(this.close,2e3),
React.createElement("div",{className:"hc-flag","data-flag-index":this.props.flag_index,"aria-hidden":"false"},React.createElement("div",{className:e},"function"==typeof this.props.body?this.props.body():this.props.body,t,React.createElement("br",null),React.createElement("a",{onClick:this._executePromise},u["default"].try_again)))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(121),o=n(i),s=a(176),r=n(s),l=a(480),u=n(l),c=a(310),d=n(c);t["default"]=React.createClass({displayName:"IncomingCallFlag",componentDidMount:function(){var e=this;this.closing=!1,this.missed_call_timeout=setTimeout(function(){e._close()},o["default"].missed_video_call_timeout-o["default"].flag_close_animation_time)},componentWillUnmount:function(){clearTimeout(this.missed_call_timeout),this.missed_call_timeout=null},_onAnswer:function(){this.closing||(u["default"].answerCall(this.props.message,this.props.service),this._close())},_onIgnore:function(){this.closing||(u["default"].declineCall(this.props.message,this.props.service),this._close())},_close:function(){this.closing=!0,clearTimeout(this.missed_call_timeout),this.isMounted()&&ReactDOM.findDOMNode(this).setAttribute("aria-hidden",!0)},render:function(){return React.createElement("div",{className:"hc-flag","data-flag-index":this.props.flag_index,"aria-hidden":"false"},React.createElement("div",{className:"hc-message hc-message-video info"},React.createElement("h6",null,"Incoming call"),React.createElement("div",{className:"sender-container"},React.createElement(d["default"],{avatar_url:this.props.photo,size:"large",show_presence:!1}),React.createElement("h3",{className:"sender"},this.props.sender)),React.createElement("button",{ref:"answer",className:"aui-button aui-button-primary",onClick:this._onAnswer},r["default"].answer),React.createElement("button",{ref:"ignore",className:"aui-button",onClick:this._onIgnore},r["default"].ignore)))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i),s=a(173),r=n(s);t["default"]={answerCall:function(e,t){r["default"].dispatch("analytics-event",{name:"hipchat.client.user.oto.video.answer",properties:{service:t}}),o["default"].dispatch(t+".answer-audio-video-call",e)},declineCall:function(e,t){r["default"].dispatch("analytics-event",{name:"hipchat.client.user.oto.video.decline",properties:{service:t}}),o["default"].dispatch(t+".decline-audio-video-call",e)}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(482),o=n(i),s=a(483),r=n(s),l=a(161),u=n(l),c=a(484),d=n(c),f=a(498),h=n(f),p=a(121),_=n(p),m=a(266),g=n(m);t["default"]=React.createClass({displayName:"MainBodyLayout",getInitialState:function(){return this.getState()},getState:function(){return{errors:o["default"].get("errors"),ready:r["default"].get("ready"),leftColumnWidth:u["default"].get("leftColumnWidth"),leftColumnVisible:u["default"].get("showNavigationSidebar")}},componentDidMount:function(){o["default"].on("change:errors",this._onChange),r["default"].on("change:ready",this._onChange),u["default"].on(["change:leftColumnWidth","change:showNavigationSidebar"],this._onChange),this._resizeColumns(this.state.leftColumnWidth)},componentDidUpdate:function(){this.state.leftColumnVisible&&this._resizeColumns(this.state.leftColumnWidth)},componentWillUnmount:function(){o["default"].off("change:errors",this._onChange),r["default"].off("change:ready",this._onChange),u["default"].off(["change:leftColumnWidth","change:showNavigationSidebar"],this._onChange)},_onChange:function(){this.setState(this.getState())},_getSidebar:function(){var e=null;return this.state.leftColumnVisible&&(e=React.createElement("div",{className:"hc-left-sidebar-col",ref:"left_column"},React.createElement(d["default"],null),React.createElement("div",{className:"resize-handle",onMouseDown:this._onResizeStart}))),e},render:function(){var e,t=this._getSidebar();return e=React.createElement("div",{className:"hc-layout"},t,React.createElement(h["default"],{ref:"main_column",is_guest:this.props.is_guest}))},_resizeColumns:function(e){this.state.ready&&!this.state.errors.length&&($(".hc-unread-scroller").width(e),this.refs.left_column.style.width=e+"px")},_onResizeStart:function(e){e.preventDefault(),this.beginX=e.pageX,this.beginWidth=this.state.leftColumnWidth,document.addEventListener("mouseup",this._onResizeEnd),document.addEventListener("mousemove",this._onHandleDrag)},_onHandleDrag:function(e){var t=e.pageX-this.beginX;if(this.beginWidth+t>=_["default"].column_width_limits.left.min&&this.beginWidth+t<=_["default"].column_width_limits.left.max){var a=Math.floor(this.beginWidth)+Math.floor(t);this._resizeColumns(a),this.setState({leftColumnWidth:a})}},_onResizeEnd:function(e){e.preventDefault(),document.removeEventListener("mouseup",this._onResizeEnd),document.removeEventListener("mousemove",this._onHandleDrag),g["default"].saveLeftColumnWidth(this.state.leftColumnWidth)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(51),h=n(f),p=a(97),_=a(9),m=function(e){function t(){return(0,r["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"getDefaults",value:function(){return{errors:[],web_server:""}}},{key:"registerListeners",value:function(){var e=this;_.register({"general-error":function(t){var a=e.data.errors;a.push(t),e.set("errors",a)},"updated:web_server":function(t){e.data.web_server=t}})}}]),t}(p);e.exports=new m},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(51),h=n(f),p=a(97),_=n(p),m=a(9),g=n(m),v=function(e){function t(){return(0,r["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"getDefaults",value:function(){return{ready:!1,active_chat:null,search_opened:!1,rightSidebarVisibleWidthIsChanging:!1}}},{key:"registerListeners",value:function(){var e=this;g["default"].register({"app-state-ready":function(){e.set("ready",!0)},"updated:active_chat":function(t){e.set("active_chat",t)},"set-right-sidebar-visible-width-is-changing":function(t){e.set("rightSidebarVisibleWidthIsChanging",t)},"search-history":function(){e.set("search_opened",!0)},"remove-search-nav-item":function(){e.set("search_opened",!1)}})}}]),t}(_["default"]);e.exports=new v},function(e,t,a){"use strict";function n(){return{can_create_room:o.canCreateRoom(),can_invite_users:o.canInviteUsersToGroup()}}var i=a(485),o=a(269),s=a(496);e.exports=React.createClass({displayName:"LeftSideBar",getInitialState:function(){return n()},componentDidMount:function(){o.on("change",this._onChange)},componentWillUnmount:function(){o.off("change",this._onChange)},_onChange:function(){this.setState(n())},render:function(){return React.createElement(s,null,React.createElement(i,{can_create_room:this.state.can_create_room,can_invite_users:this.state.can_invite_users}))}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){var e=p["default"].get("rooms");return{rooms:e.rooms,people:e.people,room_order:p["default"].get("room_order"),active_chat:p["default"].get("active_chat"),feature_flags:p["default"].get("feature_flags"),group_name:p["default"].get("group_name"),group_avatar_url:p["default"].get("group_avatar_url"),group_avatar_bg:p["default"].get("group_avatar_bg"),search_nav_item_visible:p["default"].get("search_nav_item_visible"),drag_target:p["default"].get("drag_target"),drag_over_target:p["default"].get("drag_over_target"),drag_over_clientY:p["default"].get("drag_over_clientY"),dragging:p["default"].get("dragging"),ui_available:p["default"].get("ui_available")}}var o=a(486),s=n(o),r=a(487),l=n(r),u=a(488),c=n(u),d=a(493),f=n(d),h=a(368),p=n(h),m=a(288),g=n(m),v=a(196),y=n(v),b=a(9),w=n(b),R=a(99),k=n(R);e.exports=React.createClass({displayName:"RoomsNav",getInitialState:function(){return i()},componentDidMount:function(){p["default"].on("change",this._onChange),this.placeholder=document.createElement("li"),this.placeholder.className="hc-sortable-placeholder",this.launchToActiveChatCalled=!1},componentWillMount:function(){w["default"].register("after:restore-room-order",this._scrollToActiveChat)},componentWillUnmount:function(){p["default"].off("change",this._onChange),this.placeholder=null,w["default"].unregister("after:restore-room-order",this._scrollToActiveChat)},componentDidUpdate:function(e,t){this.state.ui_available&&!this.launchToActiveChatCalled&&this._handleLaunchToActiveChatList(),t.active_chat===this.state.active_chat||k["default"].jid.is_search(this.state.active_chat)||this._scrollToActiveChat(),this.state.dragging&&this.state.drag_over_target&&this.state.drag_over_clientY?this._dragOver():!this.state.dragging&&this.state.drag_target&&this._dragEnd()},_onChange:function(){this.setState(i())},_getChatCount:function(){return this.state.rooms.length+this.state.people.length},_handleLaunchToActiveChatList:function(){y["default"].handleLaunchToActiveChatList({size:this._getChatCount()}),this.launchToActiveChatCalled=!0},_scrollToActiveChat:function(){var e=$(ReactDOM.findDOMNode(this)).find("[data-jid='"+this.state.active_chat+"']"),t=ReactDOM.findDOMNode(this).parentNode;e&&e.length&&k["default"].scrollIntoViewIfNeeded(e[0],t)},_dragOver:function(){var e,t=$(this.state.drag_over_target).closest(".hc-tab"),a=t.closest(".hc-sortable"),n=this.state.drag_over_clientY,i=t.height(),o=i/2;this._allowDrop(a)&&t.length&&(t.hasClass("hc-room")||t.hasClass("hc-person"))&&(e=n-t.offset().top,e>o?t.after(this.placeholder):o>e&&t.before(this.placeholder))},_dragEnd:function(){var e=_.cloneDeep(this.state.room_order),t=$(".hc-sortable").find(".hc-sortable-placeholder"),a=_.indexOf(e,$(this.state.drag_target).data("jid")),n=Number(t.index()-1);this.state.drag_target&&this.state.drag_target.classList.contains("hc-person")&&(n+=ReactDOM.findDOMNode(this).querySelectorAll(".hc-room").length),t.remove(),n>a&&n--,e.splice(n,0,e.splice(a,1)[0]),g["default"].update_room_order(e)},_allowDrop:function(e){return this.state.drag_target&&(this.state.drag_target.classList.contains("hc-room")&&e.hasClass("hc-rooms")||this.state.drag_target.classList.contains("hc-person")&&e.hasClass("hc-people"))},_getLobbyItem:function(){var e=!this.state.active_chat||k["default"].jid.is_lobby(this.state.active_chat);return React.createElement(s["default"],{ref:"lobby",active:e,group_avatar_url:this.state.group_avatar_url,group_avatar_bg:this.state.group_avatar_bg,group_name:this.state.group_name})},_getSearchItem:function(){return React.createElement(l["default"],{ref:"search",active:k["default"].jid.is_search(this.state.active_chat)})},render:function(){var e=this.state.search_nav_item_visible?this._getSearchItem():!1,t=this._getLobbyItem();return React.createElement("div",{className:"aui-navgroup-inner"},t,e,React.createElement(f["default"],{rooms:this.state.rooms,active_chat:this.state.active_chat,can_create_room:this.props.can_create_room}),React.createElement(c["default"],{people:this.state.people,active_chat:this.state.active_chat,can_invite_users:this.props.can_invite_users}))}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(196),o=n(i),s=a(310),r=n(s),l=a(288),u=n(l),c=a(183),d=n(c),f=a(313),h=n(f),p=a(314),m=n(p);t["default"]=React.createClass({displayName:"LobbyNavItem",mixins:[m["default"]],_onClick:function(){u["default"].select("lobby"),o["default"].lobbyRoomNavItemClicked()},_getLobbyIcon:function(){var e;return e=_.isString(this.props.group_name)?React.createElement(r["default"],{text:this.props.group_name.charAt(0),avatar_url:this.props.group_avatar_url,avatar_bg_color:this.props.group_avatar_bg,size:"xsmall",show_presence:!1}):React.createElement("span",{className:"aui-icon hipchat-icon-small icon-lobby"})},_getLobbyText:function(){var e=d["default"].lobby;return _.isString(this.props.group_name)&&(e=this.props.group_name),React.createElement("span",{className:"aui-nav-item-label"},e)},_getLobbyContent:function(){var e=this._getLobbyText(),t=this._getLobbyIcon();return React.createElement("a",{ref:"link",className:"aui-nav-item",onClick:this._onClick},t,e)},render:function(){var e=(0,h["default"])({"hc-tab":!0,"aui-nav-selected":this.props.active}),t=this._getLobbyContent();return React.createElement("ul",{className:"aui-nav hc-sidebar-nav hc-lobby","data-skate-ignore":!0},React.createElement("li",{className:e,"data-jid":"lobby"},t))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(314),o=n(i),s=a(288),r=n(s),l=a(183),u=n(l),c=a(313),d=n(c);t["default"]=React.createClass({displayName:"SearchNavItem",mixins:[o["default"]],_closeSearch:function(){r["default"].closeSearchResults()},_showSearch:function(){r["default"].openSearchResults()},render:function(){var e=(0,d["default"])({"hc-tab":!0,"aui-nav-selected":this.props.active});return React.createElement("ul",{className:"aui-nav hc-sidebar-nav hc-search-results","data-skate-ignore":!0},React.createElement("li",{className:e,"data-jid":"search"},React.createElement("a",{className:"aui-nav-item aui-nav-selected",onClick:this._showSearch},React.createElement("span",{className:"aui-icon hipchat-icon-small icon-search"}),React.createElement("span",{className:"aui-nav-item-label"},u["default"].search_results)),React.createElement("a",{className:"hc-tab-close",onClick:this._closeSearch},React.createElement("span",{className:"aui-icon hipchat-icon-xsmall hc-close-icon icon-close"}))))}}),e.exports=t["default"]},function(e,t,a){"use strict";var n=a(489),i=a(490),o=a(288),s=a(183);e.exports=React.createClass({displayName:"RoomsNavPeopleList",_onDragOver:function(e){o.dragOver({event:e})},_getInviteUsers:function(){return React.createElement(n,null)},_getPeopleList:function(){var e=this,t=_.map(this.props.people,function(t){return React.createElement(i,{key:"RoomsNavPersonItem"+t.jid+t.type,unreadCount:t.unreadCount,isUpdating:t.isUpdatingUnreadCount,active:e.props.active_chat===t.jid,name:t.name,jid:t.jid,type:t.type,uid:t.id,presence:t.presence.show,status:t.presence.status,mobile:t.mobile})});return t},_getPeopleContent:function(e){var t=this.props.people&&this.props.people.length?this._getPeopleList():!1;return React.createElement("ul",{ref:"people_list",className:"aui-nav hc-sidebar-nav hc-sortable hc-people",onDragOver:this._onDragOver,"data-skate-ignore":!0},React.createElement("li",{className:"aui-nav-heading"},React.createElement("strong",null,s.people)),t,e)},render:function(){var e=this.props.can_invite_users?this._getInviteUsers():!1,t=this.props.people&&this.props.people.length||e?this._getPeopleContent(e):!1;return React.createElement("div",{key:"RoomsNavPeople"},t)}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(314),o=n(i),s=a(196),r=n(s),l=a(95),u=n(l),c=a(183),d=n(c),f=a(197),h=n(f);t["default"]=React.createClass({displayName:"InviteUsersNavItem",mixins:[o["default"]],_onClick:function(){u["default"].showInviteTeammatesDialog({type:h["default"].LEFT}),r["default"].inviteTeamClickedEvent("left.navigation")},render:function(){return React.createElement("li",{className:"hc-tab hc-add-item-link hc-invite-users-link"},React.createElement("a",{ref:"link",className:"aui-nav-item aui-inline-dialog-trigger",onClick:this._onClick},React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-add-small"}),React.createElement("span",{className:"room-name"},d["default"].buttons.invite_team)))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(311),o=n(i),s=a(491),r=n(s),l=a(314),u=n(l),c=a(492),d=n(c),f=a(313),h=n(f);t["default"]=React.createClass({displayName:"RoomsNavItemPerson",mixins:[u["default"],d["default"]],_getUnreadBadge:function(){return React.createElement(r["default"],{unreadCount:this.props.unreadCount,hasMention:!0,isUpdating:this.props.isUpdating})},render:function(){var e=this.props.unreadCount>0&&!this.props.active,t=e?this._getUnreadBadge():!1,a=(0,h["default"])({"hc-tab":!0,"aui-nav-selected":this.props.active,"hc-has-badge":e,"hc-person":!0});return React.createElement("li",{ref:"nav_item",draggable:"true",className:a,onDragStart:this._onDragStart,onDragEnd:this._onDragEnd,"data-jid":this.props.jid},React.createElement("a",{ref:"link",className:"aui-nav-item",onClick:this._onSelectTab,"aria-label":this.props.name,"data-tipsify-ignore":!0},React.createElement(o["default"],{active:!0,presence:this.props.presence,mobile:this.props.mobile,uid:this.props.uid}),React.createElement("span",{className:"room-name"},this.props.name),t),React.createElement("a",{ref:"close_link",className:"hc-tab-close",onClick:this._onCloseTab},React.createElement("span",{className:"aui-icon hipchat-icon-xsmall hc-close-icon icon-close"})))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(314),o=n(i),s=a(313),r=n(s),l=a(121),u=n(l),c=u["default"].max_unread_count;t["default"]=React.createClass({displayName:"UnreadBadge",mixins:[o["default"]],render:function(){var e=this.props.unreadCount>c?c+"+":this.props.unreadCount,t=(0,r["default"])({"aui-badge":this.props.unreadCount>0,"hc-badge":!0,"hc-mention":!!this.props.hasMention,"hc-updating":!!this.props.isUpdating});return React.createElement("span",{className:t},e)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(288),o=n(i),s=a(99),r=n(s);t["default"]={_onDragStart:function(e){e.dataTransfer.effectAllowed="move";try{e.dataTransfer.setData("application/x-moz-node",e.currentTarget)}catch(t){e.dataTransfer.setData("text","IE node placeholder")}o["default"].dragStart({target:e.currentTarget})},_onDragEnd:function(){o["default"].dragEnd()},_onSelectTab:function(e){e.nativeEvent.which===r["default"].mouseButton.middle?this._onCloseTab(e):this.props.active||o["default"].select(this.props.jid,this.props.type)},_onCloseTab:function(){o["default"].close(this.props.jid,this.props.type)}},e.exports=t["default"]},function(e,t,a){"use strict";var n=a(494),i=a(495),o=a(288),s=a(183);e.exports=React.createClass({displayName:"RoomsNavRoomList",_onDragOver:function(e){o.dragOver({event:e})},_getCreateRoomLink:function(){return React.createElement(n,null)},_getRoomList:function(){var e=this;return _.map(this.props.rooms,function(t){return React.createElement(i,{key:"RoomsNavRoomItem"+t.jid+t.type,unreadCount:t.unreadCount,hasMention:t.hasMention,isUpdating:t.isUpdatingUnreadCount,active:e.props.active_chat===t.jid,name:t.name,jid:t.jid,type:t.type,privacy:t.privacy})})},_getRoomsContent:function(e){var t=this.props.rooms&&this.props.rooms.length?this._getRoomList():!1;return React.createElement("ul",{ref:"room_list",className:"aui-nav hc-sidebar-nav hc-sortable hc-rooms",onDragOver:this._onDragOver,"data-skate-ignore":!0},React.createElement("li",{className:"aui-nav-heading"},React.createElement("strong",null,s.rooms)),t,e)},render:function(){var e=this.props.can_create_room?this._getCreateRoomLink():!1,t=this.props.rooms&&this.props.rooms.length||e?this._getRoomsContent(e):!1;return React.createElement("div",{key:"RoomsNavRooms"},t)}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(314),o=n(i),s=a(196),r=n(s),l=a(95),u=n(l),c=a(183),d=n(c);t["default"]=React.createClass({displayName:"CreateRoomNavItem",mixins:[o["default"]],_onClick:function(){u["default"].showCreateRoomDialog(),r["default"].createRoomClickedEvent("left.navigation")},render:function(){return React.createElement("li",{className:"hc-tab hc-add-item-link"},React.createElement("a",{ref:"link",className:"aui-nav-item hc-create-room-link",onClick:this._onClick},React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-add-small"}),React.createElement("span",{className:"room-name"},d["default"].buttons.create_room)))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(491),o=n(i),s=a(312),r=n(s),l=a(314),u=n(l),c=a(492),d=n(c),f=a(313),h=n(f);t["default"]=React.createClass({displayName:"RoomsNavItemRoom",mixins:[u["default"],d["default"]],_getUnreadBadge:function(){return React.createElement(o["default"],{unreadCount:this.props.unreadCount,hasMention:this.props.hasMention,isUpdating:this.props.isUpdating})},render:function(){var e=this.props.unreadCount>0&&!this.props.active,t=e?this._getUnreadBadge():!1,a=(0,h["default"])({"hc-tab":!0,"aui-nav-selected":this.props.active,"hc-has-badge":e,"hc-room":!0});return React.createElement("li",{ref:"nav_item",draggable:"true",className:a,onDragStart:this._onDragStart,onDragEnd:this._onDragEnd,"data-jid":this.props.jid},React.createElement("a",{ref:"link",className:"aui-nav-item",onClick:this._onSelectTab,"aria-label":this.props.name,"data-tipsify-ignore":!0},this.props.privacy?React.createElement("span",{className:"aui-icon hipchat-icon-small icon-"+this.props.privacy}):React.createElement(r["default"],{classes:{"aui-icon":!0,"hipchat-icon-small":!0},iconName:"dot"}),React.createElement("span",{className:"room-name"},this.props.name),t),React.createElement("a",{ref:"close_link",className:"hc-tab-close",onClick:this._onCloseTab},React.createElement("span",{className:"aui-icon hipchat-icon-xsmall hc-close-icon icon-close"})))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return e.offsetTop+.5*e.offsetHeight>t}function o(e,t){return e.offsetTop+.5*e.offsetHeight<t}Object.defineProperty(t,"__esModule",{value:!0});var s=a(368),r=n(s),l=a(99),u=n(l),c=a(497),d=n(c),f=a(288),h=n(f),p=a(313),m=n(p),g=20,v=12;t["default"]=React.createClass({displayName:"UnreadScroller",getInitialState:function(){return{hideTop:!0,hideBottom:!0,topMention:!1,bottomMention:!1}},componentWillMount:function(){this._throttledOnChange=_.throttle(this._onChange,100,{trailing:!0,leading:!0}),this._tabsAbove=[],this._tabsBelow=[],r["default"].on("change",this._throttledOnChange)},componentWillUnmount:function(){this._throttledOnChange.cancel(),r["default"].off("change",this._throttledOnChange)},render:function(){var e=(0,m["default"])({hidden:this.state.hideTop,"has-mention":this.state.topMention}),t=(0,m["default"])({hidden:this.state.hideBottom,"has-mention":this.state.bottomMention}),a=u["default"].browser.is.firefox()||u["default"].browser.is.safari()||u["default"].browser.is.ie();a=a||"unknown"===u["default"].browser.family();var n=a?this._dragOver:null;return React.createElement("nav",{className:"aui-navgroup aui-navgroup-vertical hc-sidebar hc-sidebar-scroll",ref:"target",onScroll:this._throttledOnChange,onDragOver:n},React.createElement("div",{className:"hc-unread-scroller hc-unread-scroller-top "+e},React.createElement("a",{href:"#",onClick:this._scrollUpToUnread},React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-arrows-up"},d["default"].scroll_up_to_unread))),this.props.children,React.createElement("div",{className:"hc-unread-scroller hc-unread-scroller-bottom "+t},React.createElement("a",{href:"#",onClick:this._scrollDownToUnread},React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-arrows-down"},d["default"].scroll_down_to_unread))))},_onChange:function(){this.setState(this._getState())},_getState:function(){var e=ReactDOM.findDOMNode(this.refs.target),t=$(".hc-badge").closest(".hc-tab");return this._tabsAbove=t.filter(function(t,a){return o(a,e.scrollTop)}),this._tabsBelow=t.filter(function(t,a){return i(a,e.scrollTop+e.offsetHeight)}),{hideTop:!this._tabsAbove.length,hideBottom:!this._tabsBelow.length,topMention:$(this._tabsAbove).find(".hc-mention").length,bottomMention:$(this._tabsBelow).find(".hc-mention").length}},_dragOver:function(e){var t=e.currentTarget.scrollTop>0,a=e.currentTarget.scrollHeight-e.currentTarget.scrollTop-e.currentTarget.clientHeight>0,n=e.currentTarget.getBoundingClientRect(),i=e.clientY-n.top;t&&g>=i&&(e.currentTarget.scrollTop-=v),a&&e.currentTarget.clientHeight-i<=g&&(e.currentTarget.scrollTop+=v)},_scrollUpToUnread:function(e){if(e.preventDefault(),this.setState(this._getState()),this._tabsAbove.length>0){var t=this._tabsAbove.get(this._tabsAbove.length-1),a=$(t).data("jid"),n=u["default"].jid.is_private_chat(a)?"chat":"groupchat";u["default"].scrollIntoViewIfNeeded(t,ReactDOM.findDOMNode(this.refs.target)),h["default"].select(a,n)}},_scrollDownToUnread:function(e){if(e.preventDefault(),this.setState(this._getState()),this._tabsBelow.length>0){var t=this._tabsBelow.get(0),a=$(t).data("jid"),n=u["default"].jid.is_private_chat(a)?"chat":"groupchat";u["default"].scrollIntoViewIfNeeded(t,ReactDOM.findDOMNode(this.refs.target)),h["default"].select(a,n)}}}),e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={scroll_up_to_unread:"Scroll up to unread",scroll_down_to_unread:"Scroll down to unread"},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){var e=k["default"].get("active_chat");return{active_chat:e,chat_type:w["default"].room.detect_chat_type(e),rightChatSidebarVisibility:C["default"].shouldShowChatSidebar(),rightGroupChatSidebarVisibility:C["default"].shouldShowGroupChatSidebar(),rightColumnWidth:C["default"].getRightColumnWidth(),search_opened:k["default"].get("search_opened"),is_resizing:!1}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(499),s=n(o),r=a(505),l=n(r),u=a(508),c=n(u),d=a(554),f=n(d),h=a(566),p=n(h),m=a(604),g=n(m),v=a(619),y=n(v),b=a(99),w=n(b),R=a(483),k=n(R),E=a(161),C=n(E),S=a(266),T=n(S),x=a(121),A=n(x),I=a(313),N=n(I);t["default"]=React.createClass({displayName:"MainColumn",shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)},getInitialState:i,componentDidMount:function(){C["default"].on(["change:showChatSidebar","change:showGroupChatSidebar","change:rightColumnWidth"],this._onChange),k["default"].on(["change:active_chat","change:search_opened"],this._onChange),w["default"].jid.is_chat(this.state.active_chat)&&this._resizeColumns(this.state.rightColumnWidth)},componentDidUpdate:function(){w["default"].jid.is_chat(this.state.active_chat)&&this._resizeColumns(this.state.rightColumnWidth)},componentWillUnmount:function(){C["default"].off(["change:showChatSidebar","change:showGroupChatSidebar","change:rightColumnWidth"],this._onChange),k["default"].off(["change:active_chat","change:search_opened"],this._onChange)},_getRightSidebar:function(){return React.createElement("div",{className:"hc-right-sidebar-col"},React.createElement(c["default"],{is_guest:this.props.is_guest}),React.createElement(y["default"],{show_overlay:this.state.is_resizing}),React.createElement("div",{className:"resize-handle",onMouseDown:this._onResizeStart}))},render:function(){var e,t=(0,N["default"])({"hc-rooms-container":!0,hidden:!w["default"].jid.is_chat(this.state.active_chat)}),a=w["default"].jid.is_search(this.state.active_chat)&&!this.props.is_guest,n=this._showRightSidebar()?this._getRightSidebar():!1;return e=w["default"].jid.is_lobby(this.state.active_chat)&&!this.props.is_guest?React.createElement(s["default"],null):React.createElement("div",{className:t,"data-skate-ignore":!0},React.createElement("div",{className:"hc-chat-panel-header-container"},React.createElement(f["default"],{is_guest:this.props.is_guest})),React.createElement("div",{className:"hc-chat-panel-container"},React.createElement("div",{className:"hc-chat-panel-left-column"},React.createElement(p["default"],{is_guest:this.props.is_guest}),React.createElement(g["default"],{is_guest:this.props.is_guest})),React.createElement("div",{className:"hc-chat-panel-right-column",ref:"right_column"},n))),React.createElement("div",{className:"hc-main-col"},this.state.search_opened?React.createElement(l["default"],{visible:a}):!1,a?!1:e)},_showRightSidebar:function(){return"chat"===this.state.chat_type?C["default"].shouldShowChatSidebar():"groupchat"===this.state.chat_type?C["default"].shouldShowGroupChatSidebar():void 0},_onChange:function(){this.setState(i())},_resizeColumns:function(e){e=this._showRightSidebar()?e+"px":"0px",this.refs.right_column.style.width=e},_onResizeStart:function(e){e.preventDefault(),this.beginX=e.pageX,this.beginWidth=this.state.rightColumnWidth,document.addEventListener("mouseup",this._onResizeEnd),document.addEventListener("mousemove",this._onHandleDrag),T["default"].setRightColumnWidthIsChanging(!0),this.setState({is_resizing:!0})},_onHandleDrag:function(e){var t=e.pageX-this.beginX;if(this.beginWidth-t>=0&&this.beginWidth-t<=A["default"].column_width_limits.right.max){var a=this.beginWidth-t;this._resizeColumns(a),this.setState({rightColumnWidth:a})}},_onResizeEnd:function(e){if(e.preventDefault(),document.removeEventListener("mouseup",this._onResizeEnd),document.removeEventListener("mousemove",this._onHandleDrag),ReactDOM.findDOMNode(this.refs.right_column).offsetWidth<=A["default"].column_width_limits.right.min){var t=!1;"chat"===this.state.chat_type?T["default"].setRightChatSidebarVisibility(t):"groupchat"===this.state.chat_type&&T["default"].setRightGroupChatSidebarVisibility(t),T["default"].saveRightColumnWidth(this.beginWidth)}else T["default"].saveRightColumnWidth(this.state.rightColumnWidth);T["default"].setRightColumnWidthIsChanging(!1),this.setState({is_resizing:!1})}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(500),o=n(i),s=a(169),r=n(s),l=a(269),u=n(l),c=a(161),d=n(c),f=a(296),h=n(f),p=a(501),m=n(p),g=a(502),v=n(g),y=a(183),b=n(y),w=a(99),R=n(w),k=a(9),E=n(k),C=a(95),S=n(C),T=a(196),x=n(T),A=a(313),I=n(A),N=a(503),M=n(N),O=a(504),D=n(O),P=a(197),j=n(P),L=a(187),F=n(L);t["default"]=React.createClass({displayName:"Lobby",getInitialState:function(){return this._getState()},componentDidMount:function(){this.debouncedFilter=_.debounce(this._debouncableFilter,200),r["default"].on("change",this._onChange),o["default"].on("change",this._onChange),u["default"].on("change",this._onChange),E["default"].register("new-active-chat",this._roomSelected),h["default"].lobbyMounted(),h["default"].resetSelectedItem(),this._focusInput(),this.throttledSetScrollPosition=_.throttle(this._setScrollPosition,100,{leading:!1,trailing:!0})},componentWillUnmount:function(){r["default"].off("change",this._onChange),o["default"].off("change",this._onChange),u["default"].off("change",this._onChange),E["default"].unregister("new-active-chat",this._roomSelected),this.throttledSetScrollPosition.cancel()},_onKeyDown:function(e){if(!this.state.dialog_visible)if(e.keyCode===R["default"].keyCode.UpArrow||e.keyCode===R["default"].keyCode.DownArrow){if(e.preventDefault(),F["default"].useLatest(),!this.state.rows.length)return;e.keyCode===R["default"].keyCode.UpArrow&&this.state.selected_item>0&&h["default"].selectedPrevItem(),e.keyCode===R["default"].keyCode.DownArrow&&this.state.selected_item<this.state.rows.length-1&&h["default"].selectedNextItem(),
this.throttledSetScrollPosition()}else e.keyCode===R["default"].keyCode.Enter?this._openChat(e):e.keyCode===R["default"].keyCode.Esc&&this._clearInput()},_setScrollPosition:function(){var e=ReactDOM.findDOMNode(this.refs.scrollable),t=document.getElementsByClassName("hc-lobby-list-item")[0].offsetHeight,a=Math.ceil(e.scrollTop/t),n=Math.floor((e.offsetHeight+e.scrollTop)/t);if(this.state.selected_item<a||this.state.selected_item>n-1){var i=e.querySelector(".hc-lobby-list-item.selected");i||(i=e.querySelector(".hc-lobby-list-item:last-child")),R["default"].scrollIntoViewIfNeeded(i,e,!1)}},renderItem:function(e,t){var a=this.state.rows[e];return React.createElement(M["default"],{key:a.jid,jid:a.jid,name:a.name,user_id:a.id,mention_name:a.mention_name,privacy:a.privacy,type:R["default"].room.detect_chat_type(a.jid),name_match_markup:a.name_match_markup,mention_match_markup:a.mention_match_markup,item_index:e,selected:this.state.selected_item===e,photo_url:a.photo_url,should_animate_avatar:this.state.should_animate_avatar,presence_show:a.presence?a.presence.show:"unknown"})},render:function(){var e,t=(0,I["default"])({"filtered-lobby-content":!("all"===this.state.filter.scope&&""===this.state.filter.query),"hc-lobby-panel":!0,"hc-lobby-panel-content":!0});return e=_.isEmpty(this.state.rows)?this.state.input_text?React.createElement(v["default"],{inviteAction:this._inviteYourTeam,userIsAdmin:this.state.userIsAdmin,inviteUrl:this.state.inviteUrl,inputText:this.state.input_text,webServer:this.state.webServer}):React.createElement(m["default"],null):React.createElement(ReactList,{itemRenderer:this.renderItem,length:this.state.rows.length,selected:this.state.selected_item,filtered_time:this.state.filtered_time,threshold:10,pageSize:20,type:"simple"}),React.createElement("div",{className:"hc-rooms-container",tabIndex:"1",onKeyDown:this._onKeyDown},React.createElement("header",{className:"aui-page-header lobby-header"},React.createElement("div",{className:"aui-page-header-inner"},React.createElement("div",{className:"aui-page-header-main hc-lobby-search-content"},React.createElement("form",{className:"aui hc-filter-form",onSubmit:this._onSubmit},React.createElement("label",{className:"assistive",htmlFor:"rosterfilter"},b["default"].filter),React.createElement("input",{ref:"lobbySearchInput",type:"text",placeholder:b["default"].filter,className:"text hc-filter long-field mousetrap",onChange:this._onInputChange,value:this.state.input_text}))),React.createElement("div",{className:"aui-page-header-actions"},React.createElement("div",{className:"aui-buttons"},React.createElement("button",{className:"aui-button aui-button-light "+("all"===this.state.filter.scope?"active":""),onClick:this._onFilter.bind(null,"all")},b["default"].all),React.createElement("button",{className:"aui-button aui-button-light "+("rooms"===this.state.filter.scope?"active":""),onClick:this._onFilter.bind(null,"rooms")},b["default"].rooms),React.createElement("button",{className:"aui-button aui-button-light "+("people"===this.state.filter.scope?"active":""),onClick:this._onFilter.bind(null,"people")},b["default"].people)),this._getCreateRoomButton(),this._getInviteTeamButton()))),React.createElement("div",{className:t,ref:"scrollable"},e),this._getLobbyMessage())},_getLobbyMessage:function(){return!this.state.isBTF&&this.state.lobbyMessageEnabled?React.createElement(D["default"],{webServer:this.state.webServer,theme:this.state.theme}):void 0},_canCreateRoom:function(){return this.state.can_create_room},_canInviteTeam:function(){return this.state.userIsAdmin||this.state.inviteUrl},_getCreateRoomButton:function(){return this._canCreateRoom()?React.createElement("div",{className:"aui-buttons"},React.createElement("button",{onClick:this._onCreateRoom,className:"aui-button aui-button-light",id:"create-room-button"},b["default"].buttons.create_room)):null},_getInviteTeamButton:function(){return this._canInviteTeam()?React.createElement("div",{className:"aui-buttons"},React.createElement("button",{ref:"invite_team_button",onClick:this._inviteYourTeam,className:"aui-button aui-button-light aui-inline-dialog-trigger",id:"invite-team-button"},b["default"].buttons.invite_team)):null},_getState:function(){return{rows:o["default"].get("filtered"),filter:o["default"].get("filter"),filtered_time:o["default"].get("filtered_time"),userIsAdmin:o["default"].get("user_is_admin"),inviteUrl:o["default"].get("invite_url"),webServer:o["default"].get("web_server"),isBTF:_.get(r["default"].get("feature_flags"),"btf",!1),lobbyMessageEnabled:_.get(r["default"].get("feature_flags"),"web_client_lobby_message_enabled",!1),input_text:o["default"].get("input_text"),selected_item:o["default"].get("selected_item"),dialog_visible:o["default"].get("dialog_visible"),theme:o["default"].get("theme"),can_create_room:u["default"].canCreateRoom(),should_animate_avatar:d["default"].shouldAnimateAvatars()}},_openChat:function(e){var t=_.keys(this.state.rows)[this.state.selected_item];if(t){e.preventDefault();var a=_.cloneDeep(this.state.rows[t]);a.query=this.state.filter.query,h["default"].openChat(a),h["default"].resetFilter()}},_clearInput:function(){this.state.input_text&&this._setInputText("")},_debouncableFilter:function(){h["default"].applyFilter({query:this.state.input_text,scope:this.state.filter.scope})},_onInputChange:function(e){this._setInputText(e.target.value)},_setInputText:function(e){h["default"].setInputText(e),this.debouncedFilter(),ReactDOM.findDOMNode(this.refs.scrollable).scrollTop=0},_onChange:function(){this.setState(this._getState())},_onFilter:function(e){h["default"].applyFilter({query:this.state.input_text,scope:e}),h["default"].resetSelectedItem(),ReactDOM.findDOMNode(this.refs.scrollable).scrollTop=0},_onCreateRoom:function(e){e.preventDefault(),h["default"].showCreateRoomDialog()},_onSubmit:function(e){e.preventDefault()},_roomSelected:function(e){R["default"].jid.is_lobby(e.jid)&&this._focusInput()},_focusInput:function(){if(this.refs.lobbySearchInput!==document.activeElement)try{this.refs.lobbySearchInput.select()}catch(e){this.refs.lobbySearchInput.focus()}},_inviteYourTeam:function(e){e.preventDefault(),S["default"].showInviteTeammatesDialog({type:j["default"].LOBBY,default_text:this.state.input_text}),x["default"].inviteTeamClickedEvent("lobby")}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(51),h=n(f),p=a(9),m=n(p),g=a(190),v=n(g),y=a(121),b=n(y),w=a(97),R=n(w),k=a(273),E=a(99),C=n(E),S=function(e){function t(){(0,r["default"])(this,t);var e=(0,d["default"])(this,(0,o["default"])(t).call(this));return e.local={all:[],active:[],forceUpdate:!1},e}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"getDefaults",value:function(){return{is_active:!1,filtered:[],input_text:"",filter:{scope:"all",query:""},user_is_admin:!1,invite_url:!1,web_server:b["default"].default_web_server,selected_item:0,dialog_visible:!1,filtered_time:!1,theme:"light"}}},{key:"registerListeners",value:function(){var e=this;m["default"].registerOnce({"hc-init":function(t){e.handleConfig(t)}}),m["default"].register({"updated:config":function(t){e.handleConfig(t)},"updated:roster":function(){e.populateAll()},"updated:active_chat":function(t){e.handleNewActiveChat(t)},"updated:allRooms":function(){e.handleAllRoomsUpdate()},"updated:activeRooms":function(t){e.handleActiveRoomsUpdate(t)},"updated:preferences":function(t){t.theme!==e.data.theme&&e.set("theme",t.theme)},"room-deleted":function(t){e.handleRoomDeleted(t.jid)},"filter-lobby":function(t){e.handleFilter(!0,t)},"set-lobby-filter-text":function(t){e.set("input_text",t.text)},"updated:web_server":function(t){e.set("web_server",t)},"lobby-reset-selected-item":function(){e.set("selected_item",0)},"lobby-item-hover":function(t){e.set({selected_item:t.index})},"lobby-select-next-item":function(){e._selectNextItem()},"lobby-select-prev-item":function(){e._selectPrevItem()},"show-modal-dialog":function(){e.set("dialog_visible",!0)},"hide-modal-dialog":function(){e.set("dialog_visible",!1)}})}},{key:"handleConfig",value:function(e){this.set({user_is_admin:_.get(e,"is_admin",!1),invite_url:_.get(e,"invite_url",!1)})}},{key:"handleNewActiveChat",value:function(e){this.data.is_active=C["default"].jid.is_lobby(e),this.data.is_active?(this.populateAll(),this.handleFilter()):this.clearAll()}},{key:"handleAllRoomsUpdate",value:function(){this.data.is_active&&(this.populateAll(),this.handleFilter())}},{key:"handleActiveRoomsUpdate",value:function(e){var t=_.keys(e),a=!_.isEqual(this.local.active,t);this.local.active=t,this.data.is_active&&this.handleFilter(a)}},{key:"clearAll",value:function(){this.local.all=[]}},{key:"populateAll",value:function(){if(this.data.is_active){var e=this.removeGuests(v["default"].get("roster")),t=_.toArray(v["default"].get("allRooms")),a=t.concat(e),n=this.removeArchivedAndEmpty(a);this.local.forceUpdate=!_.isEqual(this.local.all,n),this.local.all=n}}},{key:"handleFilter",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=e||this.local.forceUpdate,n=!a&&this.data.filtered?this.data.filtered:this.local.all,i=t.scope||this.data.filter.scope,o="rooms"===i||"people"===i,s=_.isString(t.query)?t.query:this.data.filter.query;o&&(a||t.scope)&&(n=_.filter(n,function(e){return"rooms"===i?C["default"].jid.is_room(e.jid):"people"===i?C["default"].jid.is_private_chat(e.jid):!1})),(a||_.isString(t.query))&&(n=(0,k.chatSearch)(n,s,this.local.active)),this.local.forceUpdate=!1,this.set({filtered:n,filter:{scope:i||"all",query:s||""},selected_item:a?0:this.data.selected_item,filtered_time:(new Date).getTime()})}},{key:"removeGuests",value:function(e){return _.reject(e,C["default"].user.is_guest)}},{key:"removeArchivedAndEmpty",value:function(e){return _.reject(e,function(e){return!e||""===e.name||C["default"].room.is_archived(e)})}},{key:"handleRoomDeleted",value:function(e){this.data.is_active&&(this.local.all=_.reject(this.data.all,{jid:e}),this.local.forceUpdate=!0,this.handleFilter())}},{key:"_selectNextItem",value:function(){this.set("selected_item",this.data.selected_item+1)}},{key:"_selectPrevItem",value:function(){this.set("selected_item",this.data.selected_item-1)}}]),t}(R["default"]);e.exports=new S},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(440),o=n(i);t["default"]=React.createClass({displayName:"LobbyEmptyState",shouldComponentUpdate:function(){return!1},render:function(){return React.createElement("div",{className:"empty empty-lobby"},React.createElement("div",{className:"empty-state"},React.createElement("div",{className:"empty-lobby-state-img"}),React.createElement("div",{className:"empty-state-msg"},React.createElement("p",{className:"empty-header"},o["default"].empty_lobby_title),React.createElement("p",{className:"empty-msg"},o["default"].empty_lobby_message))))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(183),o=n(i),s=a(440),r=n(s),l=a(196),u=n(l),c=a(314),d=n(c);t["default"]=React.createClass({displayName:"LobbyEmptySearchState",mixin:[d["default"]],getDefaultProps:function(){return{inputText:""}},componentDidMount:function(){u["default"].lobbyNoResults(this.props.inputText)},_inviteLink:function(){if(this.props.userIsAdmin||this.props.inviteUrl){var e=React.createElement("a",{target:"_blank",className:"aui-inline-dialog-trigger",onClick:this.props.inviteAction},o["default"].buttons.invite_team_in_lobby);return this.props.inviteUrl||(e=React.createElement("a",{target:"_blank",className:"aui-inline-dialog-trigger",href:"https://"+this.props.webServer+"/admin"},o["default"].buttons.invite_team_in_lobby)),React.createElement("p",{className:"empty-msg"},e)}},render:function(){return React.createElement("div",{className:"empty empty-lobby empty-search-lobby"},React.createElement("div",{className:"empty-state"},React.createElement("div",{className:"empty-search-lobby-state-img"}),React.createElement("div",{className:"empty-state-msg"},React.createElement("p",{className:"empty-header"},r["default"].empty_search_lobby),this._inviteLink())))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(310),o=n(i),s=a(296),r=n(s),l=a(313),u=n(l),c=a(314),d=n(c),f=a(187),h=n(f);t["default"]=React.createClass({displayName:"LobbyItem",mixins:[d["default"]],_onMouseEnter:function(e){h["default"].hasChanged(e)&&r["default"].itemHovered({index:this.props.item_index})},_onOpenChat:function(){r["default"].openChat({jid:this.props.jid,name:this.props.name,type:this.props.type})},_getIcon:function(){var e=void 0;return e="groupchat"===this.props.type?React.createElement("span",{className:"aui-icon hipchat-icon-small icon-"+this.props.privacy}):React.createElement(o["default"],{avatar_url:this.props.photo_url,presence:this.props.presence_show,size:"small",uid:this.props.user_id,shouldAnimate:this.props.should_animate_avatar,active:!0})},_getMention:function(){var e=this.props.mention_match_markup||this.props.mention_name,t={__html:"@"+e};return React.createElement("span",{className:"hc-lobby-list-mention-name",dangerouslySetInnerHTML:t})},render:function(){var e=(0,u["default"])({"hc-lobby-list-item":!0,selected:this.props.selected}),t=this._getIcon(),a=this.props.mention_name?this._getMention():null;return React.createElement("div",{className:e,onClick:this._onOpenChat,onMouseEnter:this._onMouseEnter},React.createElement("div",{className:"hc-lobby-list-icon"},t),React.createElement("div",{className:"hc-lobby-list-names"},React.createElement("span",{className:"hc-lobby-list-name "+this.props.type,dangerouslySetInnerHTML:{__html:this.props.name_match_markup||_.escape(this.props.name)}}),a))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(314),o=n(i),s=a(173),r=n(s),l=a(90),u=n(l);t["default"]=React.createClass({displayName:"LobbyMessage",mixin:[o["default"]],propTypes:{webServer:React.PropTypes.string.isRequired,theme:React.PropTypes.string},getDefaultProps:function(){return{webServer:"",theme:"light"}},componentDidMount:function(){var e=this._getIframe();e.hide(),e.on("load",this._onIframeLoad)},componentWillUnmount:function(){this._getIframe().off("load",this._onIframeLoad)},_getIframe:function(){return $(ReactDOM.findDOMNode(this.refs.blog_info))},_getIframeBody:function(){return _.get(this._getIframe().get(0),"contentWindow.document.body")},_onIframeLoad:function(){u["default"].type("blog-info-iframe").log("Iframe was loaded");var e=this._getIframe(),t=e.contents().has("#blog-info").length;if(t){var a=$(this._getIframeBody()),n=a.children().length;if(n){e.show();var i=e.contents().find("html").outerHeight();e.height(i),a.find("a").on("click",this._handleIframeClick),u["default"].type("blog-info-iframe").log("Iframe is shown with height:",i)}else u["default"].type("blog-info-iframe").log("Iframe is hidden because content is not found")}else u["default"].type("blog-info-iframe").log("Iframe is hidden because error occurred")},_handleIframeClick:function(e){var t=$(e.currentTarget),a=t.attr("href"),n=t.attr("analytics");e.preventDefault(),a&&(window.open(a,"_blank"),u["default"].type("blog-info-iframe").log("Link opened: ",a)),n&&r["default"].dispatch("analytics-event",{name:n})},render:function(){return React.createElement("iframe",{ref:"blog_info",id:"blog-info-iframe",src:"https://"+this.props.webServer+"/blog_info?theme="+this.props.theme})}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(506),o=n(i),s=a(161),r=n(s),l=a(169),u=n(l),c=a(99),d=n(c),f=a(90),h=n(f),p=a(313),m=n(p),g=a(121),v=n(g),y=a(507),b=n(y),w=a(196),R=n(w),k=(new Date).getTime();t["default"]=React.createClass({displayName:"SearchResults",getInitialState:function(){return this._getState()},_getState:function(){return{apiv1_token:u["default"].get("apiv1_token"),text:o["default"].get("text"),jid:o["default"].get("jid"),web_server:o["default"].get("web_server"),active_chat:o["default"].get("active_chat"),theme:r["default"].getTheme()}},componentDidMount:function(){o["default"].on(["change:text","change:jid","change:web_server","change:active_chat"],this._onChange),u["default"].on(["change:apiv1_token"],this._onChange),r["default"].on(["change:theme"],this._onChange),this.previousSearchURL=this._getSearchUrl(),this._bindIframeLoad()},componentWillUnmount:function(){o["default"].off(["change:text","change:jid","change:web_server","change:active_chat"],this._onChange),u["default"].off(["change:apiv1_token"],this._onChange),r["default"].off(["change:theme"],this._onChange),this._unbindIframeLoad()},componentWillUpdate:function(e,t){t.active_chat!==this.state.active_chat&&d["default"].jid.is_search(this.state.active_chat)&&!d["default"].jid.is_search(t.active_chat)&&$(this._getIframeBody()).find("#select2-drop-mask").click()},componentDidUpdate:function(e,t){var a=this;t.text===this.state.text&&t.jid===this.state.jid||this._hideIframe(),t.apiv1_token!==this.state.apiv1_token&&_.delay(function(){$(a._getIframe()).attr("src",a.previousSearchURL),$(a._getIframe()).show()},1e3),t.theme!==this.state.theme&&(this._unbindIframeLoad(),this._bindIframeLoad(),this._reloadIframe())},_onChange:function(){this.setState(this._getState())},_bindIframeLoad:function(){this._getIframe().on("load",this._onIframeLoad)},_unbindIframeLoad:function(){this._getIframe().off("load",this._onIframeLoad)},_reloadIframe:function(){var e=_.get(this._getIframe().get(0),"contentWindow.location");e&&"function"==typeof e.reload&&e.reload(!0)},_getIframe:function(){return $(ReactDOM.findDOMNode(this.refs.search_results))},_getIframeHead:function(){return _.get(this._getIframe().get(0),"contentWindow.document.head")},_getIframeBody:function(){return _.get(this._getIframe().get(0),"contentWindow.document.body")},_onIframeLoad:function(){var e=$(this._getIframeBody()),t=this._getIframe();if(v["default"].login_page_redirect_regex.test(_.get(t.get(0),"contentWindow.location.pathname","")))return this._handleLoginRedirect();if(this.previousSearchURL=_.get(t.get(0),"contentWindow.location.href"),e.hasClass("embedded-search-page")||e.addClass("embedded-search-page"),e.find("form").on("submit",this._hideIframe),e.find("a").on("click",this._handleIframeClick),e.find("form [type=text]").on("keydown",function(t){t.keyCode===d["default"].keyCode.Esc?e.find("form [type=text]").val(""):t.keyCode===d["default"].keyCode.Enter&&R["default"].searchInputSubmitted(e.find("#chat-select").val())}),"light"!==this.state.theme){var a=$(this._getIframeHead()),n=this._getThemeStyles();a.append(n)}t.show()},_handleIframeClick:function(e){var t=$(e.currentTarget),a=t.attr("href");"_blank"===t.attr("target")||t.parent().hasClass("file-meta")||!t.parents(".hc-chat-row").length||t.parents(".hc-chat-time").length?a||(h["default"].type("search-results").log("Link is empty and it skipped."),e.preventDefault()):0===a.indexOf("javascript")?e.preventDefault():a?(h["default"].type("search-results").log("Target contains external link, it will be opened in new window: ",a),e.preventDefault(),window.open(a,"_blank")):this._hideIframe()},_hideIframe:function(){$(this._getIframe()).hide()},_handleLoginRedirect:function(){this._hideIframe(),b["default"].updateAPIV1Token()},_getThemeStyles:function(){var e="https://"+this.state.web_server+"/wc/"+this.state.theme+".css?v="+k;return"<link rel='stylesheet' href='"+e+"' type='text/css'>"},_getSearchUrl:function(){if(this.state.jid){var e=this.state.jid,t="https://"+this.state.web_server+"/embedded/search?adg=true&q="+this.state.text;return d["default"].jid.is_chat(e)&&d["default"].jid.is_private_chat(e)?t+="&t=uid-"+d["default"].jid.user_id(e):d["default"].jid.is_chat(e)&&d["default"].jid.is_room(e)&&(t+="&r="+d["default"].jid.room_name(e)),encodeURI(t)}},render:function(){var e=(0,m["default"])({"hc-rooms-container":!0,"hc-rooms-container-hidden":!this.props.visible}),t={display:"light"!==this.state.theme?"none":"block"};return React.createElement("div",{className:e},React.createElement("iframe",{ref:"search_results",id:"search-container",src:this._getSearchUrl(),style:t}))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(51),h=n(f),p=a(9),_=a(195),m=a(97),g=a(99),v=a(121),y=function(e){function t(){return(0,r["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"getDefaults",value:function(){return{jid:"",text:"",web_server:v.default_web_server,url:"",active_chat:""}}},{key:"registerListeners",value:function(){var e=this;p.register({"search-history":function(t){e.handleSearch(t)},"search-history-externally":function(t){e.handleSearchExternally(t)},"updated:web_server":function(t){e.set("web_server",t)},"updated:active_chat":function(t){e.set("active_chat",t)}})}},{key:"handleSearch",value:function(e){this.set({jid:e.jid,text:e.text})}},{key:"handleSearchExternally",value:function(e){var t=e.jid,a="https://"+this.data.web_server+"/search?q="+e.text;t&&g.jid.is_chat(t)&&g.jid.is_private_chat(t)?a+="&t=uid-"+g.jid.user_id(t):t&&g.jid.is_chat(t)&&g.jid.is_room(t)&&(a+="&r="+g.jid.room_name(t)),a=encodeURI(a),_.openExternalWindow(a,"_blank"),this.set({url:a,jid:e.jid,text:e.text})}}]),t}(m);e.exports=new y},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i);t["default"]={updateAPIV1Token:function(){o["default"].dispatch("apiv1-token-update-requested")}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){var e=m["default"].get("web_client_integrations_enabled");return{groupchat_active_panel:v["default"].getGroupChatActivePanel(),chat_active_panel:v["default"].getChatActivePanel(),chat_type:m["default"].get("chat_type"),loading:m["default"].get("loading")&&!e,initialized:m["default"].get("initialized"),web_client_integrations:e,guest_url:m["default"].get("guest_url"),active_chat:m["default"].get("active_chat")}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(509),s=n(o),r=a(515),l=n(r),u=a(329),c=n(u),d=a(519),f=n(d),h=a(522),p=n(h),_=a(271),m=n(_),g=a(161),v=n(g),y=a(314),b=n(y);t["default"]=React.createClass({displayName:"RightSideBar",mixins:[b["default"]],getInitialState:function(){return i()},componentDidMount:function(){m["default"].on("change",this._onChange),v["default"].on(["change"],this._onChange)},componentWillUnmount:function(){m["default"].off("change",this._onChange),v["default"].off(["change"],this._onChange)},_getActivePanel:function(){var e;if("chat"===this.state.chat_type)switch(this.state.chat_active_panel){case"files":e=this._filesPanel();break;case"links":e=this._linksPanel();break;case"integrations":this.state.web_client_integrations&&(e=this._integrationsPanel())}else if("groupchat"===this.state.chat_type)switch(this.state.groupchat_active_panel){case"roster":e=this._rosterPanel();break;case"files":e=this._filesPanel();break;case"links":e=this._linksPanel();break;case"integrations":this.state.web_client_integrations&&(e=this._integrationsPanel())}return e},_rosterPanel:function(){return React.createElement(s["default"],{is_guest:this.props.is_guest})},_filesPanel:function(){return React.createElement(l["default"],{is_guest:this.props.is_guest})},_linksPanel:function(){return React.createElement(f["default"],{is_guest:this.props.is_guest})},_integrationsPanel:function(){return React.createElement(p["default"],null)},_onChange:function(){this.setState(i())},_shouldHidePanelWhenLoading:function(){return"files"!==this.state.chat_active_panel&&"links"!==this.state.chat_active_panel},render:function(){var e=this.state.loading&&this._shouldHidePanelWhenLoading()?"":this._getActivePanel();return React.createElement("div",{className:"hc-roster-container"},React.createElement(c["default"],{spin:this.state.loading&&this.state.initialized,zIndex:1}),e)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(510),o=n(i),s=a(310),r=n(s),l=a(511),u=n(l),c=a(512),d=n(c),f=a(99),h=n(f),p=a(271),m=n(p),g=a(269),v=n(g),y=a(169),b=n(y),w=a(513),R=n(w),k=a(95),E=n(k),C=a(514),S=n(C),T=a(313),x=n(T),A=a(272),I=n(A),N=a(121);e.exports=React.createClass({displayName:"RightSideBarRoster",propTypes:{is_guest:React.PropTypes.bool.isRequired},getInitialState:function(){return _.assign(this._getState(),{selectedPerson:!1})},componentDidMount:function(){var e=0,t=_.get(this.state,"participants.members");t&&(e=t.length),m["default"].on(["change"],this._onChange);var a=m["default"].get("active_chat");R["default"].rosterMounted({id:a,size:e})},componentWillUnmount:function(){m["default"].off(["change"],this._onChange)},_getState:function(){return{can_view_guest_access:v["default"].canViewGuestAccess(),should_animate_gif_avatars:!b["default"].get("feature_flags").web_client_freeze_gifs,active_chat_privacy:m["default"].get("active_chat_privacy"),admins:m["default"].get("admins"),owner:m["default"].get("owner"),participants:m["default"].get("participants"),users:m["default"].get("users"),current_user:m["default"].get("current_user"),user_is_admin:m["default"].get("user_is_admin"),guest_url:m["default"].get("guest_url"),invite_url:m["default"].get("invite_url"),active_chat:m["default"].get("active_chat"),size:m["default"].get("size"),roster:m["default"].getRoster()}},_onChange:function(){var e=_.assign(this._getState(),{selectedPerson:this.state.selectedPerson});this.isMounted()&&this.setState(e)},_onClick:function(e){this.setState({selectedPerson:e})},_onDoubleClick:function(e,t){_.find(this.state.participants.members,{jid:e})&&!this.props.is_guest&&S["default"].openChat({jid:e,name:t})},_showEmptyState:function(){var e,t=this.state.current_user.user_jid,a=this.state.participants.members,n=this.state.participants.guests;return 1!==a.length||n.length?1!==n.length||a.length||(e=_.find(n,{jid:t})):e=_.find(a,{jid:t}),!!e},_isAdmin:function(e){return h["default"].user.is_admin(this.state.admins,!1,e)},_isOwner:function(e){var t=_.get(e,"user_id")||_.get(e,"id");return Number(t)===Number(this.state.owner)},_hasMembersAndGuests:function(){return _.size(this.state.participants.members)&&_.size(this.state.participants.guests)},_getTooltip:function(e){return o["default"].get_user_tooltip({name:e.name,mention_name:e.mention_name,is_admin:this._isAdmin(e),is_owner:this._isOwner(e),presence:e.presence})},_renderItem:function(e,t){var a=this.state.roster[e],n={height:N.roster_panel.group_title_item_height+"px"};return a.group_title?React.createElement("li",{key:t,className:"aui-nav-heading",style:n},React.createElement("div",{className:"uppercase"},d["default"][a.group_title])):a.letter?React.createElement("li",{key:t,className:"aui-nav-heading",style:n},React.createElement("div",{className:"uppercase"},a.letter)):this._getPerson(a,t)},_getPerson:function(e,t){var a=_.get(e,"presence",{}),n=this._getTooltip(e),i=(0,x["default"])({"hc-roster-link":!0,"hc-roster-admin":this._isAdmin(e)}),o=(0,x["default"])({"hc-roster-item":!0,"aui-nav-selected":this.state.selectedPerson===e.jid}),s={height:"auto"},l=e.id||h["default"].jid.user_id(e.jid);return this.state.size!==I["default"].SMALL&&(s.height=N.roster_panel.person_item_height+"px"),React.createElement("li",{key:"user-"+l,className:o,"data-status":a.show,onClick:this._onClick.bind(this,e.jid),onDoubleClick:this._onDoubleClick.bind(this,e.jid,e.name),style:s},React.createElement("div",{className:"aui-nav-item"},React.createElement(r["default"],{avatar_url:e.photo_url,name:e.name,presence:a.show,size:this._getAvatarSize(),shouldAnimate:this.state.should_animate_gif_avatars,uid:e.id}),React.createElement("a",{className:i,"aria-label":n},e.name)))},_getItemSize:function(e){var t=this.state.roster[e];return t.group_title||t.letter?N.roster_panel.group_title_item_height:N.roster_panel.person_item_height},_getAvatarSize:function(){return this.state.size===I["default"].SMALL?"small":"xsmall"},_onClickQuickSwitcher:function(){E["default"].showQuickSwitcherDialog()},_getXLargeState:function(){return React.createElement("div",{className:"hc-roster-xlarge-msg"},d["default"].xlarge_message," ",React.createElement("a",{onClick:this._onClickQuickSwitcher},d["default"].quick_switcher),".")},_getEmptyState:function(){return React.createElement(u["default"],{room_privacy:this.state.active_chat_privacy,isAdmin:this._isAdmin(this.state.users[this.state.current_user.user_jid]),invite_url:this.state.invite_url,user_is_admin:this.state.user_is_admin})},_getList:function(){return this.state.size===I["default"].XLARGE?null:this.state.size===I["default"].LARGE?this._getDynamicList():this._getStaticList()},_getStaticList:function(){var e=this;return _.map(this.state.roster,function(t,a){return e._renderItem(a,a)})},_getDynamicList:function(){return React.createElement(ReactList,{itemRenderer:this._renderItem,itemSizeGetter:this._getItemSize,items:this.state.roster,length:this.state.roster.length,selected:this.state.selectedPerson,threshold:200,useTranslate3d:!1,type:"variable"})},render:function(){var e=this.state.guest_url&&!this.props.is_guest&&this.state.can_view_guest_access,t=this._showEmptyState()?this._getEmptyState():null,a=this.state.size===I["default"].XLARGE?this._getXLargeState():null,n=void 0,i=(0,x["default"])({"roster-wrap":!0,"guest-access-enabled":e}),o=(0,x["default"])({"hc-roster":!0,"hc-sidebar-scroll":!0}),s=(0,x["default"])({"aui-nav":!0,"aui-navgroup-vertical":!0,"roster-list":!0}),r=this._getList();if(e){var l=this.state.guest_url.split("://").pop();n=React.createElement("div",{className:"guest-access"},React.createElement("strong",null,d["default"].guest_access_enabled),React.createElement("br",null),React.createElement("a",{href:this.state.guest_url,target:"_blank"},l))}return React.createElement("div",{className:i},React.createElement("div",{className:o},a,React.createElement("ul",{className:s,"data-skate-ignore":!0},r),t),n)}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(462),o=n(i),s=a(99),r=n(s),l=a(184),u=n(l);t["default"]={get_user_tooltip_flat:function(e,t,a,n,i,s){var l=e+"\n"+("@"+t+"\n")+(o["default"].status+" "+r["default"].user.get_user_status(n));return n===u["default"].IDLE&&s&&(l+=" - "+s),a&&(l+="\n"+o["default"].admin),i&&(l+="\n"+this._splitToLines(o["default"].message+" "+i)),l},_splitToLines:function(e){var t=arguments.length<=1||void 0===arguments[1]?50:arguments[1],a=0;return e.length<=t?e:e.split(" ").reduce(function(e,n,i,o){return a+=n.length,i===o.length-1?e.push(n):a>t?(e.push(n+"\n"),a=0):(e.push(n+" "),a=n.match("\n")?0:a),e},[]).join("")},get_user_tooltip:function(e){var t=e.presence||{};return this.get_user_tooltip_flat(e.name,e.mention_name,e.is_admin,t.show,t.status,t.idleTime)}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(440),o=n(i),s=a(95),r=n(s),l=a(196),u=n(l),c=a(197),d=n(c);t["default"]=React.createClass({displayName:"RightSideBarRosterEmptyState",_openInviteUsers:function(e){e.preventDefault(),r["default"].showInviteUsersDialog({type:d["default"].RIGHT_SIDEBAR}),u["default"].inviteUserToRoomClickedEvent("roster"),u["default"].inviteToRoomRightSidebarClicked();
},_openInviteTeam:function(e){e.preventDefault(),r["default"].showInviteTeammatesDialog(),u["default"].inviteTeamClickedEvent("roster")},_getInviteMessage:function(){var e;if("private"!==this.props.room_privacy||this.props.isAdmin){var t,a,n;1===_.size(this.props.users)&&(this.props.user_is_admin||this.props.invite_url)?(t=this._openInviteTeam,a=o["default"].invite_to_team,n=o["default"].invite_to_team_action):(t=this._openInviteUsers,a=o["default"].invite_to_room,n=o["default"].invite_to_room_action),e=React.createElement("div",null,React.createElement("div",{className:"hc-tab-es-title"},a),React.createElement("div",{className:"hc-tab-es-msg"},React.createElement("a",{className:"hc-tab-es-invite aui-inline-dialog-trigger",onClick:t},n)))}else e=React.createElement("div",null,React.createElement("div",{className:"hc-tab-es-title"},o["default"].empty_private_room));return e},render:function(){var e=this._getInviteMessage();return React.createElement("div",{className:"hc-tab-es"},React.createElement("div",{className:"hc-tab-es-img roster"}),e)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(121),o=n(i);t["default"]={members:"members",guests:"guests",guest_access_enabled:"Room publicly available",xlarge_message:"This room has "+o["default"].roster_panel.breakpoints.large+" or more members. Thatâs too many to show. Looking for specific people? Try ",quick_switcher:"searching for them"},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(173),o=n(i),s=a(9),r=n(s);t["default"]={filesMounted:function(e){o["default"].dispatch("analytics-files-mount",e)},rosterMounted:function(e){o["default"].dispatch("analytics-roster-mount",e)},fetchFilesHistory:function(){r["default"].dispatch("fetch-files-history")},fetchLinksHistory:function(){r["default"].dispatch("fetch-links-history")},setPanelScrollTopPosition:function(e){r["default"].dispatch("set-right-sidebar-panel-scrolltop",e)}},e.exports=t["default"]},function(e,t,a){"use strict";var n=a(9),i=a(173),o={openChat:function(e){n.dispatch("set-route",{jid:e.jid}),e.source="sidebar",i.dispatch("analytics-open-room",e)}};e.exports=o},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(516),o=n(i),s=a(517),r=n(s),l=a(513),u=n(l),c=a(271),d=n(c),f=a(161),h=n(f),p=a(164),m=n(p),g=a(313),v=n(g),y=a(90),b=n(y),w=a(518),R=n(w),k=a(314),E=n(k);t["default"]=React.createClass({displayName:"RightSideBarFiles",mixins:[E["default"]],propTypes:{is_guest:React.PropTypes.bool},getInitialState:function(){return this._getState()},componentDidMount:function(){d["default"].on(["change:files","change:rooms","change:panels_scroll_top","change:active_chat"],this._onChange),h["default"].on(["change:"+m["default"].USE_24_HR_FORMAT],this._onChange),u["default"].filesMounted({id:_.uniqueId(),size:this.state.size}),this.debouncedSetScrollPosition=_.debounce(this._setScrollPosition,200,{leading:!1,trailing:!0})},componentWillUnmount:function(){d["default"].off(["change:files","change:rooms","change:panels_scroll_top","change:active_chat"],this._onChange),h["default"].off(["change:"+m["default"].USE_24_HR_FORMAT],this._onChange),this.debouncedSetScrollPosition.cancel()},componentDidUpdate:function(e,t){if(t.room!==this.state.room&&this.state.files_fetched&&this.state.size>0){var a=this._getInitialIndex();this.refs.list.scrollTo(a),b["default"].type("files-panel").log("Scrolled to index: ",a)}},_getState:function(){var e=d["default"].getAll(),t=e.active_chat,a=e.files,n=e.can_share_files,i=e.panels_scroll_top,o=e.rooms,s=_.get(i[t],"files",0),r=_.get(o[t],"files_fetched",!1),l=_.get(o[t],"files_fetching",!1),u=_.get(o[t],"all_files_fetched",!1),c=a.length;return{room:t,scroll_top:s,files_fetched:r,files_fetching:l,all_files_fetched:u,files:a,size:c,can_share_files:n,use24hrTime:h["default"].shouldUse24HrTime()}},_onChange:function(){this.setState(this._getState())},_getRowHeight:function(){return 42},_getInitialIndex:function(e){var t=this._getRowHeight();return Math.floor((e||this.state.scroll_top)/t)},_getFile:function(e,t){var a=this.state.files[e];return a?React.createElement(o["default"],{key:t,file:a,use_24hr_time:this.state.use24hrTime}):React.createElement(R["default"],{key:t,height:this._getRowHeight()})},_filesBody:function(){return React.createElement("ul",{className:"aui-nav aui-navgroup-vertical","data-skate-ignore":!0},React.createElement(ReactList,{ref:"list",itemRenderer:this._getFile,length:this._getListSize(),use_24hr_time:this.state.use24hrTime,initialIndex:this._getInitialIndex(),threshold:0,pageSize:50,itemSizeGetter:this._getRowHeight,type:"variable"}))},_getListSize:function(){var e=this.state.size;return this.state.files_fetching&&e++,e},_setScrollPosition:function(){var e=this.refs.scrollbox;if(e){u["default"].setPanelScrollTopPosition({room:this.state.room,type:"files",scroll_top:e.scrollTop});var t=this._getInitialIndex(e.scrollTop);b["default"].type("files-panel").log("Scrolled to index:",t)}},_onScroll:function(){if(this.debouncedSetScrollPosition(),!this.state.all_files_fetched&&!this.state.files_fetching){var e=this.refs.scrollbox;e.scrollHeight-e.offsetHeight<e.scrollTop+e.offsetHeight&&u["default"].fetchFilesHistory()}},render:function(){if(!this.props.is_guest&&!this.state.files_fetched)return null;var e=(0,v["default"])({"hc-files":!0,"hc-sidebar-scroll":!0}),t=_.isEmpty(this.state.files)?React.createElement(r["default"],{can_share_files:this.state.can_share_files}):this._filesBody();return React.createElement("div",{className:e,ref:"scrollbox",onScroll:this._onScroll},t)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(99),o=n(i),s=a(435),r=n(s),l=a(195),u=n(l),c=a(177),d=n(c),f=a(314),h=n(f);t["default"]=React.createClass({displayName:"RightSideBarFile",propTypes:{file:React.PropTypes.object.isRequired,use_24hr_time:React.PropTypes.bool.isRequired},mixins:[h["default"]],render:function(){var e=o["default"].format_time(this.props.file.date,this.props.use_24hr_time);return React.createElement("li",{className:"hc-roster-item"},React.createElement("div",{className:"aui-nav-item",title:this.props.file.file_name},React.createElement("a",{className:"hc-file-link",target:"_blank",rel:"noreferrer",href:this.props.file.url,onClick:this._onClick},React.createElement("span",{className:"hc-file-icon "+this.props.file.icon_class}),React.createElement("span",{className:"hc-file-name"},this.props.file.file_name)),React.createElement("span",{className:"hc-roster-user-name"},this.props.file.user_name),React.createElement("span",{className:"hc-roster-date"},e)))},_onClick:function(e){d["default"].shouldOpenFileViewer(e)&&(e.preventDefault(),e.metaKey?u["default"].openExternalWindow(this.props.file.url,"_blank"):r["default"].openInFileViewer(this.props.file))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(440),o=n(i),s=a(260),r=n(s);e.exports=React.createClass({displayName:"RightSideBarEmptyFileState",_openFilePicker:function(e){e.preventDefault(),r["default"].openFilePicker()},_getShareFileLink:function(){var e=void 0;return this.props.can_share_files&&(e=React.createElement("a",{href:"#",onClick:this._openFilePicker},o["default"].share_a_file)),e},render:function(){return React.createElement("div",{className:"hc-tab-es"},React.createElement("div",{className:"hc-tab-es-img files"}),React.createElement("div",{className:"hc-tab-es-title"},o["default"].no_files),React.createElement("div",{className:"hc-tab-es-msg"},this._getShareFileLink()))}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(329),o=n(i),s=a(314),r=n(s);t["default"]=React.createClass({displayName:"SidebarListSpinner",mixins:[r["default"]],render:function(){return React.createElement("li",{className:"hc-roster-item hc-spinner-item",style:{height:this.props.height}},React.createElement(o["default"],{key:this.props.key,size:"small",spin:!0,zIndex:1}))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(520),o=n(i),s=a(521),r=n(s),l=a(271),u=n(l),c=a(513),d=n(c),f=a(172),h=n(f),p=a(161),m=n(p),g=a(164),v=n(g),y=a(132),b=n(y),w=a(313),R=n(w),k=a(90),E=n(k),C=a(518),S=n(C);t["default"]=React.createClass({displayName:"RightSideBarLinks",propTypes:{is_guest:React.PropTypes.bool},getInitialState:function(){return this._getState()},componentDidMount:function(){u["default"].on(["change:links","change:rooms","change:panels_scroll_top","change:active_chat"],this._onChange),m["default"].on(["change:"+v["default"].USE_24_HR_FORMAT],this._onChange),this.throttledSetScrollPosition=_.throttle(this._setScrollPosition,200,{leading:!1,trailing:!0})},componentWillUnmount:function(){u["default"].off(["change:links","change:rooms","change:panels_scroll_top","change:active_chat"],this._onChange),m["default"].off(["change:"+v["default"].USE_24_HR_FORMAT],this._onChange),this.throttledSetScrollPosition.cancel()},componentDidUpdate:function(e,t){if(t.room!==this.state.room&&this.state.links_fetched&&this.state.size>0){var a=this._getInitialIndex();this.refs.list.scrollTo(a),E["default"].type("links-panel").log("Scrolled to index: ",a)}},onScrollStop:function(){var e=this.refs.scrollbox;d["default"].setPanelScrollTopPosition({room:this.state.room,type:"links",scroll_top:e.scrollTop}),!this.state.all_links_fetched&&e.scrollHeight<=e.scrollTop+e.offsetHeight&&d["default"].fetchLinksHistory();var t=this._getInitialIndex(e.scrollTop);E["default"].type("links-panel").log("Scroll is stopped on index:",t)},_getState:function(){var e=u["default"].getAll(),t=e.active_chat,a=e.links,n=e.panels_scroll_top,i=e.rooms,o=_.get(n[t],"links",0),s=_.get(i[t],"links_fetched",!1),r=_.get(i[t],"links_fetching",!1),l=_.get(i[t],"all_links_fetched",!1),c=_.get(i[t],"id"),d=a.length;return{room:t,room_id:c,scroll_top:o,links_fetched:s,all_links_fetched:l,links_fetching:r,links:a,size:d,use24hrTime:m["default"].shouldUse24HrTime()}},_onChange:function(){this.setState(this._getState())},_onClick:function(e){var t="a"===_.get(e,"target.tagName","").toLowerCase(),a=_.get(e,"target.href",null),n=this.state.room,i=this.state.room_id;!this.props.is_guest&&t&&a&&b["default"].isVideoLink(a)&&(e.preventDefault(),h["default"].joinRoomVideoCall({url:a,jid:n,room_id:i}))},_getLink:function(e,t){var a=this.state.links[e];return a?React.createElement(o["default"],{key:t,name:a.user_name,url:a.url,date:a.date,use_24hr_time:this.state.use24hrTime,display_url:a.display_url}):React.createElement(S["default"],{key:t,height:this._getRowHeight()})},_getRowHeight:function(){return 42},_getInitialIndex:function(e){var t=this._getRowHeight();return Math.floor((e||this.state.scroll_top)/t)},_linksBody:function(){return React.createElement("ul",{className:"aui-nav aui-navgroup-vertical","data-skate-ignore":!0},React.createElement(ReactList,{ref:"list",itemRenderer:this._getLink,length:this._getListSize(),initialIndex:this._getInitialIndex(),use_24hr_time:this.state.use24hrTime,threshold:0,pageSize:50,type:"variable"}))},_getListSize:function(){var e=this.state.size;return this.state.links_fetching&&e++,e},_setScrollPosition:function(){var e=this.refs.scrollbox;if(e){d["default"].setPanelScrollTopPosition({room:this.state.room,type:"links",scroll_top:e.scrollTop});var t=this._getInitialIndex(e.scrollTop);E["default"].type("links-panel").log("Scrolled to index:",t)}},_onScroll:function(){if(this.throttledSetScrollPosition(),!this.state.all_links_fetched&&!this.state.links_fetching){var e=this.refs.scrollbox;e.scrollHeight-e.offsetHeight<e.scrollTop+e.offsetHeight&&d["default"].fetchLinksHistory()}},render:function(){if(!this.props.is_guest&&!this.state.links_fetched)return null;var e=(0,R["default"])({"hc-links":!0,"hc-sidebar-scroll":!0,"hc-bg-striped":!_.isEmpty(this.state.links)}),t=_.isEmpty(this.state.links)?React.createElement(r["default"],null):this._linksBody();return React.createElement("div",{className:e,ref:"scrollbox",onClick:this._onClick,onScroll:this._onScroll},t)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(314),o=n(i),s=a(99),r=n(s);t["default"]=React.createClass({displayName:"RightSideBarLink",propTypes:{url:React.PropTypes.string.isRequired,display_url:React.PropTypes.string.isRequired,name:React.PropTypes.string.isRequired,date:React.PropTypes.instanceOf(Date).isRequired,use_24hr_time:React.PropTypes.bool.isRequired},mixins:[o["default"]],render:function(){var e=r["default"].format_time(this.props.date,this.props.use_24hr_time);return React.createElement("li",{className:"hc-roster-item"},React.createElement("div",{className:"aui-nav-item",title:this.props.url},React.createElement("a",{className:"hc-link",target:"_blank",rel:"noopener noreferrer",href:this.props.url},this.props.display_url),React.createElement("span",{className:"hc-roster-user-name"},this.props.name),React.createElement("span",{className:"hc-roster-date"},e)))}}),e.exports=t["default"]},function(e,t,a){"use strict";var n=a(440);e.exports=React.createClass({displayName:"RightSideBarLinksEmptyState",render:function(){return React.createElement("div",{className:"hc-tab-es"},React.createElement("div",{className:"hc-tab-es-img links"}),React.createElement("div",{className:"hc-tab-es-title"},n.no_links),React.createElement("div",{className:"hc-tab-es-msg"},n.share_a_link))}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(421),o=n(i),s=a(269),r=n(s),l=a(161),u=n(l),c=a(164),d=n(c),f=a(523),h=n(f),p=a(535),m=n(p),g=a(546),v=n(g),y=a(548),b=n(y),w=a(549),R=n(w),k=a(420),E=n(k),C=a(166),S=n(C),T=a(550),x=n(T),A=a(329),I=n(A),N=a(313),M=n(N),O=a(90),D=n(O),P=a(271),j=n(P),L=a(509),F=n(L),U=a(551),H=n(U),B=a(515),z=n(B),q=a(519),V=n(q),G=a(121),W=n(G),$=a(190),Y=n($),K=a(314),X=n(K),J=a(169),Q=n(J),Z={people:function(){return React.createElement(F["default"],{is_guest:Y["default"].get("current_user").is_guest})},files:function(){return React.createElement(z["default"],null)},links:function(){return React.createElement(V["default"],null)}},ee=3;t["default"]=React.createClass({displayName:"RightSideBarIntegrations",mixins:[X["default"]],getInitialState:function(){return this._getState()},componentDidMount:function(){o["default"].on(["change:integrations","change:active_chat","change:loading","change:error"],this._onChange),u["default"].on(["change:"+S["default"].ACTIVE_CHAT_INTEGRATION,"change:"+S["default"].ACTIVE_GROUPCHAT_INTEGRATION],this._onChange),h["default"].on(["change:dynamic_glances","change:visible_glances"],this._onChange),j["default"].on("change:loading",this._onChange),o["default"].on(["change:state"],this._onConnectionChange),u["default"].on(["change:"+d["default"].IGNORE_ADD_INTEGRATIONS_GLANCE],this._onChange)},componentWillMount:function(){this._fetchGlanceData()},componentWillUnmount:function(){o["default"].off(["change:integrations","change:active_chat","change:loading","change:error"],this._onChange),u["default"].off(["change:"+S["default"].ACTIVE_CHAT_INTEGRATION,"change:"+S["default"].ACTIVE_GROUPCHAT_INTEGRATION],this._onChange),h["default"].off(["change:dynamic_glances","change:visible_glances"],this._onChange),j["default"].off("change:loading",this._onChange),o["default"].off(["change:state"],this._onConnectionChange),u["default"].off(["change:"+d["default"].IGNORE_ADD_INTEGRATIONS_GLANCE],this._onChange)},_fetchGlanceData:function(){var e=h["default"].get("dynamic_glances"),t=o["default"].get("active_chat");t&&_.has(t,"id")&&e.forEach(function(e){var a=o["default"].getExtensionByKey(e.full_key),n=!_.isEmpty(a);n&&h["default"].shouldFetch(t.id,e.full_key)&&m["default"].fetchGlanceMetadata(t.id,e)})},_onChange:function(){this.setState(this._getState()),this._fetchGlanceData()},_onConnectionChange:function(e){e===o["default"].states.STARTED&&this._onChange()},_getState:function(){var e=o["default"].get("active_chat"),t=h["default"].get("visible_glances"),a=h["default"].get("dynamic_glances"),n=Q["default"].get("feature_flags"),i=j["default"].get("chat_type"),s="groupchat"===i&&e&&e.id;return{roomId:s?e.id:void 0,glances:s?t:[],dynamic_glances:s?a:[],internal_glances:this._getInternalGlances(i),active_integration:o["default"].getActiveIntegration(i),loading:o["default"].get("loading"),error:o["default"].get("error"),chat_type:i,loading_internal:j["default"].get("loading"),show_integrations_glance:this._setShowAddIntegrationsGlance(e,t.length,n)}},_renderSummaryView:function(e){return e.full_key===W["default"].people_glance.full_key?React.createElement(H["default"],{max_items_to_render:W["default"].people_glance.max_items_to_render_collapsed}):!1},_getGlanceBody:function(e){if(!e)return!1;var t=""+e.full_key;return React.createElement("li",{key:t},React.createElement(v["default"],{glance:e,room_id:this.state.roomId},this._renderSummaryView(e)))},_getRenderedGlances:function(){var e=_.union(this.state.internal_glances,this.state.glances);return _.map(e,this._getGlanceBody)},_glancesBody:function(e){var t;return this.state.show_integrations_glance&&(t=React.createElement("li",null,React.createElement(b["default"],{room_id:this.state.roomId}))),React.createElement("ul",{className:"aui-nav aui-navgroup-vertical hc-glances","data-skate-ignore":!0},e,t)},_setShowAddIntegrationsGlance:function(e,t,a){if(e){var n=!1;if("groupchat"===e.type){var i=u["default"].getIgnoreAddIntegrationGlanceRooms();e.id&&!_.includes(i,parseInt(e.id))&&this._shouldShowIntegrationsDiscoveryGlance(t,a)&&(n=!0)}return n}},_shouldShowIntegrationsDiscoveryGlance:function(e,t){return _.get(t,"web_client_enable_integration_discovery_glance")&&r["default"].canManageRoomIntegrations()&&ee>e},_getIntegrationsConfigureButton:function(){return"chat"!==this.state.chat_type&&r["default"].canManageRoomIntegrations()?React.createElement(x["default"],{room_id:this.state.roomId}):null},_renderGlanceList:function(){var e=this._getRenderedGlances(),t=_.isEmpty(e)?null:this._glancesBody(e),a=(0,M["default"])({"hc-integrations-wrap":!0,"hc-can-manage-integrations":r["default"].canManageRoomIntegrations()});return React.createElement("div",{className:a},t)},_hideIntegrationView:function(){E["default"].closeSidebarView("sidebar")},_renderIntegrationView:function(e,t){if(_.isNull(e)||_.isUndefined(e))return D["default"].warn("[HC-Integrations]","Unknown integration view "+t+"."),null;if(e.internal)return this._renderInternalIntegrationView(e);var a=this.state.roomId+":"+e.full_key,n=o["default"].getExtensionByKey(_.get(this.state.active_integration,"glance_key"));return React.createElement(R["default"],{integration:e,room_id:this.state.roomId,url_template_values:this.state.active_integration.url_template_values,init_event:this.state.active_integration.init_event,hideIntegrationView:this._hideIntegrationView,glance:n,key:a})},_renderInternalIntegrationView:function(e){var t=Z[e.key];return React.createElement(R["default"],{integration:e,room_id:this.state.roomId,hideIntegrationView:this._hideIntegrationView,key:e.key,glance:e,loading:this.state.loading_internal},t())},_getInternalGlances:function(e){var t=e||this.state.chat_type;return _.isEqual(this.props.internal,"false")?[]:"chat"===t?o["default"].getInternalExtensionsOTO():o["default"].getInternalExtensions()},_getIntegration:function(e){var t=o["default"].getExtensionByKey(e);return t||_.find(this._getInternalGlances(),function(t){return t.full_key===e})},render:function(){var e,t,a=_.get(this.state.active_integration,"key",null),n=this._getIntegration(a),i=!_.isUndefined(n)&&!_.isNull(n),o=!(_.isNull(a)||!i),s=o?null:this._getIntegrationsConfigureButton();return o?(t=this._renderIntegrationView(n,a),e=(0,M["default"])({"hc-integrations":!0,"glance-selected":!0})):(t=this._renderGlanceList(),e=(0,M["default"])({"hc-integrations":!0})),React.createElement("div",{className:e},React.createElement(I["default"],{spin:this.state.loading,zIndex:1}),t,s)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(51),h=n(f),p=a(292),m=n(p),g=a(97),v=n(g),y=a(9),b=n(y),w=a(524),R=n(w),k=a(167),E=n(k),C=a(421),S=n(C),T=a(423),x=n(T),A=a(534),I=n(A),N=a(90),M=n(N),O=a(198),D=a(418),P=new R["default"](["b","strong","em","i"]),j=function(e){function t(){return(0,r["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).call(this))}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"getDefaults",value:function(){return{active_rooms:{},visible_glances:[],dynamic_glances:[],room_state:{},integrations_state:D.states.INIT,active_chat:""}}},{key:"registerListeners",value:function(){var e=this;b["default"].register({"fetch-glance-metadata":function(t,a){var n=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];e._fetchGlanceMetadata(t,a,n)},"glance-metadata-loading":function(t,a,n){e._setGlanceLoading(t,a),e._updateGlances()},"glance-metadata-fetched":function(t,a,n){var i=e._sanitizeMetadata(n);e._setRoomMetadata(t,a,i),e._updateGlances()},"glances-finished-loading-for-room":function(t,a){e._finishLoadingForRoom(t,a)},"glance-metadata-pushed":function(t){_.each(t,function(t){var a=E["default"].to_full_key(t.addon_key,t.key),n=e._sanitizeMetadata(t.content);b["default"].dispatch("integration-iframe-event",O.GLANCE_UPDATE,{addon_key:t.addon_key},{addon_key:t.addon_key,module_key:t.key,metadata:_.get(t,"content.metadata",{})}),t.room_id?e._setRoomMetadata(t.room_id,a,n):e._setGlobalMetadata(a,n)}),e._updateGlances()},"integrations-updated":function(t){e._updateGlances()},"updated:activeRooms":function(t){e._handleActiveRoomsUpdate(t)},"after:updated:active_chat":function(t){e._handleActiveChatUpdate(t)}}),b["default"].register(D.event_names.REMOVE_DATA_FOR_ROOMS,function(t){e._cleanMetadataForRooms(t.rooms)}),b["default"].register(D.event_names.ON_INTEGRATIONS_REMOVED,function(t){_.each(t.integrations,function(a){e._handleUninstalledIntegration(a,t.rooms)})}),S["default"].on("change:state",function(t,a){e.set("integrations_state",t),t===D.states.STARTED||t===D.states.ERROR?e._handleActiveChatUpdate(e.data.active_chat):t===D.states.STOPPED&&e.setDirty()})}},{key:"onGlanceMetadataChange",value:function(e,t,a){var n=this.fullKey(e,t);this.on("change:"+n,a)}},{key:"offGlanceMetadataChange",value:function(e,t,a){var n=this.fullKey(e,t);this.off("change:"+n,a)}},{key:"getValidCachedMetadata",value:function(e,t){var a=this.get(this.fullKey(e,t));return!_.isUndefined(a)&&_.isEmpty(a.error)?a:void 0}},{key:"getCachedMetadata",value:function(e,t){var a=this.get(this.fullKey(e,t));return _.isUndefined(a)?{}:(a.error||(a.error=null),a)}},{key:"fullKey",value:function(e,t){return e+":"+t}},{key:"setDirty",value:function(){this.set("room_state",_.mapValues(this.data.room_state,_.constant(D.glance_room_states.DIRTY)))}},{key:"shouldFetch",value:function(e,t){var a=this.getCachedMetadata(e,t);return _.isEmpty(a)||a.dirty===!0&&!a.loading}},{key:"_setGlanceLoading",value:function(e,t){var a=this.fullKey(e,t),n=this.getCachedMetadata(e,t);_.isUndefined(n)&&(n={}),n.error=null,n.loading=!0,this.set(a,n)}},{key:"_updateGlances",value:function(){var e=this,t=S["default"].getExtensionsByType(D.extension_types.GLANCE),a=t.filter(function(t){return e._shouldDisplayGlance(t)}),n=t.filter(function(e){return!_.isUndefined(e.query_url)});this.set({visible_glances:a,dynamic_glances:n})}},{key:"_shouldDisplayGlance",value:function(e){var t=S["default"].get("active_chat");if(_.isEmpty(t))return!1;var a=this.getCachedMetadata(t.id,e.full_key);if(_.isEmpty(e.conditions)||!_.isEmpty(a.error))return!0;var n=m["default"].getAll(),i=(new x["default"]).withRoom(t).withUser(n);return i.canEvaluate(e.conditions)?i.evaluate(e.conditions):_.isUndefined(a)||a.loading?!1:i.withGlanceData(a).evaluate(e.conditions)}},{key:"_setRoomMetadata",value:function(e,t,a){this.set(this.fullKey(e,t),_.merge({loading:!1,dirty:!1},a))}},{key:"_setGlobalMetadata",value:function(e,t){var a=this;_.each(this._getAllActiveRoomIds(),function(n){a._setRoomMetadata(n,e,t)})}},{key:"_sanitizeMetadata",value:function(e){return e.label=this._sanitizeMetadataContent(e.label),e.status=this._sanitizeMetadataContent(e.status),e}},{key:"_sanitizeMetadataContent",value:function(e){if(!_.isObject(e))return{};switch(e.type){case"html":e.type="safe_html",e.value=P.sanitize(e.value)}return e}},{key:"_handleActiveRoomsUpdate",value:function(e){var t={};for(var a in e)"groupchat"===e[a].type&&e[a].id&&(t[a]=e[a].id);this.set({active_rooms:t})}},{key:"_getMetadataKeysMatching",value:function(e){return _.filter(_.keys(this.data),function(t){return _.startsWith(t,e)})}},{key:"_clearMetadataForContext",value:function(e,t){var a=this,n=_.map(e,function(e){var n=t(e);return a._getMetadataKeysMatching(n)}),i=_.flatten(n);i.forEach(function(e){return a.unset(e)})}},{key:"_cleanMetadataForRooms",value:function(e){var t=this;this._clearMetadataForContext(e,function(e){return e.id+":"});var a=_.map(e,"id");this.set("room_state",_.pickBy(this.data.room_state,function(e,n){return _.includes(a,n)?(M["default"].debug("[HC-Integrations]","glances:"+n+" state transition from "+_.get(t.data.room_state,n,D.glance_room_states.INIT)+" -> unloaded"),!1):void 0}))}},{key:"_handleUninstalledIntegration",value:function(e,t){this._clearMetadataForContext(t,function(t){return t.id+":"+e.addon_key+":"})}},{key:"_handleActiveChatUpdate",value:function(e){var t=this.data.active_rooms[e];if(t){var a=this._getRoomState(t);a!==D.glance_room_states.INIT&&a!==D.glance_room_states.DIRTY||this._setRoomState(t,D.glance_room_states.LOADING)}this.set("active_chat",e),this._updateGlances()}},{key:"_getAllActiveRoomIds",value:function(){return _.values(this.data.active_rooms)}},{key:"_getRoomState",value:function(e){return this.data.integrations_state===D.states.STARTED||this.data.integrations_state===D.states.ERROR?_.get(this.data.room_state,e,D.glance_room_states.INIT):D.glance_room_states.WAITING}},{key:"_setRoomState",value:function(e,t){var a=_.get(this.data.room_state,e,D.glance_room_states.INIT);if(a!==t){t===D.glance_room_states.LOADING&&I["default"].fetchGlanceMetadataForRoom(e);var n=_.clone(this.data.room_state);n[e]=t,M["default"].debug("[HC-Integrations]","glances:"+e+" state transition from "+a+" -> "+t),this.set({room_state:n})}}},{key:"_fetchGlanceMetadata",value:function(e,t,a){var n=this.get(this.fullKey(e,t.full_key)),i=_.get(n,"dirty",!1);_.isUndefined(n)&&D.glance_room_states.LOADED===this._getRoomState(e)&&(M["default"].debug("[HC-Integrations]","Fetching single glance as no metadata exists and room was already loaded - glances:"+e+":"+t.full_key),i=!0),_.get(n,"error",!1)&&a&&(M["default"].debug("[HC-Integrations]","Fetching single glance as currently in error state and reload was triggered - glances:"+e+":"+t.full_key),i=!0),i&&(this._setGlanceLoading(e,t.full_key),I["default"].fetchGlanceRemoteMetadata(e,t))}},{key:"_finishLoadingForRoom",value:function(e,t){var a=this;t||(S["default"].getExtensionsByTypeAndRoom(D.extension_types.GLANCE,e).forEach(function(t){t.query_url&&a.set(a.fullKey(e,t.full_key),{loading:!1,error:"Failed to load glance"})}),this._updateGlances()),this._setRoomState(e,D.glance_room_states.LOADED)}}]),t}(v["default"]);t["default"]=new j,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(525),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(532),d=function(){function e(t,a){(0,r["default"])(this,e);var n=new o["default"](t),i=new o["default"](a),s=c.makeTagPolicy();this.customPolicy=function(e,t){for(var a=[],o=0;o<t.length;o+=2){var r=t[o],l=t[o+1];i.has(r)&&a.push(r,l)}return n.has(e)?s(e,a):void 0}}return(0,u["default"])(e,[{key:"sanitize",value:function(e){return c.sanitizeWithPolicy(e,this.customPolicy)}}]),e}();e.exports=d},function(e,t,a){e.exports={"default":a(526),__esModule:!0}},function(e,t,a){a(46),a(61),a(67),a(527),a(530),e.exports=a(18).Set},function(e,t,a){"use strict";var n=a(528);a(529)("Set",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return n.def(this,e=0===e?0:e,e)}},n)},function(e,t,a){"use strict";var n=a(8),i=a(30),o=a(86),s=a(19),r=a(73),l=a(14),u=a(74),c=a(64),d=a(70),f=a(35)("id"),h=a(27),p=a(44),_=a(87),m=a(28),g=Object.isExtensible||p,v=m?"_s":"size",y=0,b=function(e,t){if(!p(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!h(e,f)){if(!g(e))return"F";if(!t)return"E";i(e,f,++y)}return"O"+e[f]},w=function(e,t){var a,n=b(t);if("F"!==n)return e._i[n];for(a=e._f;a;a=a.n)if(a.k==t)return a};e.exports={getConstructor:function(e,t,a,i){var c=e(function(e,o){r(e,c,t),e._i=n.create(null),e._f=void 0,e._l=void 0,e[v]=0,void 0!=o&&u(o,a,e[i],e)});return o(c.prototype,{clear:function(){for(var e=this,t=e._i,a=e._f;a;a=a.n)a.r=!0,a.p&&(a.p=a.p.n=void 0),delete t[a.i];e._f=e._l=void 0,e[v]=0},"delete":function(e){var t=this,a=w(t,e);if(a){var n=a.n,i=a.p;delete t._i[a.i],a.r=!0,i&&(i.n=n),n&&(n.p=i),t._f==a&&(t._f=n),t._l==a&&(t._l=i),t[v]--}return!!a},forEach:function(e){for(var t,a=s(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.n:this._f;)for(a(t.v,t.k,this);t&&t.r;)t=t.p},has:function(e){return!!w(this,e)}}),m&&n.setDesc(c.prototype,"size",{get:function(){return l(this[v])}}),c},def:function(e,t,a){var n,i,o=w(e,t);return o?o.v=a:(e._l=o={i:i=b(t,!0),k:t,v:a,p:n=e._l,n:void 0,r:!1},e._f||(e._f=o),n&&(n.n=o),e[v]++,"F"!==i&&(e._i[i]=o)),e},getEntry:w,setStrong:function(e,t,a){c(e,t,function(e,t){this._t=e,this._k=t,this._l=void 0},function(){for(var e=this,t=e._k,a=e._l;a&&a.r;)a=a.p;return e._t&&(e._l=a=a?a.n:e._t._f)?"keys"==t?d(0,a.k):"values"==t?d(0,a.v):d(0,[a.k,a.v]):(e._t=void 0,d(1))},a?"entries":"values",!a,!0),_(t)}}},function(e,t,a){"use strict";var n=a(8),i=a(17),o=a(16),s=a(21),r=a(30),l=a(86),u=a(74),c=a(73),d=a(44),f=a(33),h=a(28);e.exports=function(e,t,a,p,_,m){var g=i[e],v=g,y=_?"set":"add",b=v&&v.prototype,w={};return h&&"function"==typeof v&&(m||b.forEach&&!s(function(){(new v).entries().next()}))?(v=t(function(t,a){c(t,v,e),t._c=new g,void 0!=a&&u(a,_,t[y],t)}),n.each.call("add,clear,delete,forEach,get,has,set,keys,values,entries".split(","),function(e){var t="add"==e||"set"==e;e in b&&(!m||"clear"!=e)&&r(v.prototype,e,function(a,n){if(!t&&m&&!d(a))return"get"==e?void 0:!1;var i=this._c[e](0===a?0:a,n);return t?this:i})}),"size"in b&&n.setDesc(v.prototype,"size",{get:function(){return this._c.size}})):(v=p.getConstructor(t,e,_,y),l(v.prototype,a)),f(v,e),w[e]=v,o(o.G+o.W+o.F,w),m||p.setStrong(v,e,_),v}},function(e,t,a){var n=a(16);n(n.P,"Set",{toJSON:a(531)("Set")})},function(e,t,a){var n=a(74),i=a(72);e.exports=function(e){return function(){if(i(this)!=e)throw TypeError(e+"#toJSON isn't generic");var t=[];return n(this,!1,t.push,t),t}}},function(e,t,a){var n=a(533),i=a(143);if("i"!=="I".toLowerCase())throw"I/i problem";var o=function(e){function t(e){if(N.hasOwnProperty(e))return N[e];var t=e.match(M);if(t)return String.fromCharCode(parseInt(t[1],10));if(t=e.match(O))return String.fromCharCode(parseInt(t[1],16));if(P&&D.test(e)){P.innerHTML="&"+e+";";var a=P.textContent;return N[e]=a,a}return"&"+e+";"}function a(e,a){return t(a)}function n(e){return e.replace(j,"")}function o(e){return e?e.replace(L,a):e}function s(e){return e?(""+e).replace(U,"&amp;").replace(B,"&lt;").replace(z,"&gt;").replace(q,"&#34;"):e;
}function r(e){return e?e.replace(H,"&amp;$1").replace(B,"&lt;").replace(z,"&gt;"):e}function l(e){var t={cdata:e.cdata||e.cdata,comment:e.comment||e.comment,endDoc:e.endDoc||e.endDoc,endTag:e.endTag||e.endTag,pcdata:e.pcdata||e.pcdata,rcdata:e.rcdata||e.rcdata,startDoc:e.startDoc||e.startDoc,startTag:e.startTag||e.startTag};return function(e,a){return u(e,t,a)}}function u(e,t,a){var n=f(e),i={noMoreGT:!1,noMoreEndComments:!1};d(t,n,0,i,a)}function c(e,t,a,n,i){return function(){d(e,t,a,n,i)}}function d(t,a,n,i,o){try{t.startDoc&&0==n&&t.startDoc(o);for(var s,r,l,u=n,d=a.length;d>u;){var f=a[u++],m=a[u];switch(f){case"&":F.test(m)?(t.pcdata&&t.pcdata("&"+m,o,$,c(t,a,u,i,o)),u++):t.pcdata&&t.pcdata("&amp;",o,$,c(t,a,u,i,o));break;case"</":(s=/^([-\w:]+)[^\'\"]*/.exec(m))?s[0].length===m.length&&">"===a[u+1]?(u+=2,l=s[1].toLowerCase(),t.endTag&&t.endTag(l,o,$,c(t,a,u,i,o))):u=h(a,u,t,o,$,i):t.pcdata&&t.pcdata("&lt;/",o,$,c(t,a,u,i,o));break;case"<":if(s=/^([-\w:]+)\s*\/?/.exec(m))if(s[0].length===m.length&&">"===a[u+1]){u+=2,l=s[1].toLowerCase(),t.startTag&&t.startTag(l,[],o,$,c(t,a,u,i,o));var g=e.ELEMENTS[l];if(g&W){var v={name:l,next:u,eflags:g};u=_(a,v,t,o,$,i)}}else u=p(a,u,t,o,$,i);else t.pcdata&&t.pcdata("&lt;",o,$,c(t,a,u,i,o));break;case"<!--":if(!i.noMoreEndComments){for(r=u+1;d>r&&(">"!==a[r]||!/--$/.test(a[r-1]));r++);if(d>r){if(t.comment){var y=a.slice(u,r).join("");t.comment(y.substr(0,y.length-2),o,$,c(t,a,r+1,i,o))}u=r+1}else i.noMoreEndComments=!0}i.noMoreEndComments&&t.pcdata&&t.pcdata("&lt;!--",o,$,c(t,a,u,i,o));break;case"<!":if(/^\w/.test(m)){if(!i.noMoreGT){for(r=u+1;d>r&&">"!==a[r];r++);d>r?u=r+1:i.noMoreGT=!0}i.noMoreGT&&t.pcdata&&t.pcdata("&lt;!",o,$,c(t,a,u,i,o))}else t.pcdata&&t.pcdata("&lt;!",o,$,c(t,a,u,i,o));break;case"<?":if(!i.noMoreGT){for(r=u+1;d>r&&">"!==a[r];r++);d>r?u=r+1:i.noMoreGT=!0}i.noMoreGT&&t.pcdata&&t.pcdata("&lt;?",o,$,c(t,a,u,i,o));break;case">":t.pcdata&&t.pcdata("&gt;",o,$,c(t,a,u,i,o));break;case"":break;default:t.pcdata&&t.pcdata(f,o,$,c(t,a,u,i,o))}}t.endDoc&&t.endDoc(o)}catch(b){if(b!==$)throw b}}function f(e){var t=/(<\/|<\!--|<[!?]|[&<>])/g;if(e+="",G)return e.split(t);for(var a,n=[],i=0;null!==(a=t.exec(e));)n.push(e.substring(i,a.index)),n.push(a[0]),i=a.index+a[0].length;return n.push(e.substring(i)),n}function h(e,t,a,n,i,o){var s=m(e,t);return s?(a.endTag&&a.endTag(s.name,n,i,c(a,e,t,o,n)),s.next):e.length}function p(e,t,a,n,i,o){var s=m(e,t);return s?(a.startTag&&a.startTag(s.name,s.attrs,n,i,c(a,e,s.next,o,n)),s.eflags&W?_(e,s,a,n,i,o):s.next):e.length}function _(t,a,n,i,o,s){var l=t.length;Y.hasOwnProperty(a.name)||(Y[a.name]=new RegExp("^"+a.name+"(?:[\\s\\/]|$)","i"));for(var u=Y[a.name],d=a.next,f=a.next+1;l>f&&("</"!==t[f-1]||!u.test(t[f]));f++);l>f&&(f-=1);var h=t.slice(d,f).join("");if(a.eflags&e.eflags.CDATA)n.cdata&&n.cdata(h,i,o,c(n,t,f,s,i));else{if(!(a.eflags&e.eflags.RCDATA))throw new Error("bug");n.rcdata&&n.rcdata(r(h),i,o,c(n,t,f,s,i))}return f}function m(t,a){var n=/^([-\w:]+)/.exec(t[a]),i={};i.name=n[1].toLowerCase(),i.eflags=e.ELEMENTS[i.name];for(var o=t[a].substr(n[0].length),s=a+1,r=t.length;r>s&&">"!==t[s];s++)o+=t[s];if(!(s>=r)){for(var l=[];""!==o;)if(n=V.exec(o)){if(n[4]&&!n[5]||n[6]&&!n[7]){for(var u=n[4]||n[6],c=!1,d=[o,t[s++]];r>s;s++){if(c){if(">"===t[s])break}else 0<=t[s].indexOf(u)&&(c=!0);d.push(t[s])}if(s>=r)break;o=d.join("");continue}var f=n[1].toLowerCase(),h=n[2]?g(n[3]):"";l.push(f,h),o=o.substr(n[0].length)}else o=o.replace(/^[\s\S][^a-z\s]*/,"");return i.attrs=l,i.next=s+1,i}}function g(e){var t=e.charCodeAt(0);return 34!==t&&39!==t||(e=e.substr(1,e.length-2)),o(n(e))}function v(t){var a,n,i=function(e,t){n||t.push(e)};return l({startDoc:function(e){a=[],n=!1},startTag:function(i,o,r){if(!n&&e.ELEMENTS.hasOwnProperty(i)){var l=e.ELEMENTS[i];if(!(l&e.eflags.FOLDABLE)){var u=t(i,o);if(!u)return void(n=!(l&e.eflags.EMPTY));if("object"!=typeof u)throw new Error("tagPolicy did not return object (old API?)");if(!("attribs"in u))throw new Error("tagPolicy gave no attribs");o=u.attribs;var c,d;if("tagName"in u?(d=u.tagName,c=e.ELEMENTS[d]):(d=i,c=l),l&e.eflags.OPTIONAL_ENDTAG){var f=a[a.length-1];!f||f.orig!==i||f.rep===d&&i===d||r.push("</",f.rep,">")}l&e.eflags.EMPTY||a.push({orig:i,rep:d}),r.push("<",d);for(var h=0,p=o.length;p>h;h+=2){var _=o[h],m=o[h+1];null!==m&&void 0!==m&&r.push(" ",_,'="',s(m),'"')}r.push(">"),l&e.eflags.EMPTY&&!(c&e.eflags.EMPTY)&&r.push("</",d,">")}}},endTag:function(t,i){if(n)return void(n=!1);if(e.ELEMENTS.hasOwnProperty(t)){var o=e.ELEMENTS[t];if(!(o&(e.eflags.EMPTY|e.eflags.FOLDABLE))){var s;if(o&e.eflags.OPTIONAL_ENDTAG)for(s=a.length;--s>=0;){var r=a[s].orig;if(r===t)break;if(!(e.ELEMENTS[r]&e.eflags.OPTIONAL_ENDTAG))return}else for(s=a.length;--s>=0&&a[s].orig!==t;);if(0>s)return;for(var l=a.length;--l>s;){var u=a[l].rep;e.ELEMENTS[u]&e.eflags.OPTIONAL_ENDTAG||i.push("</",u,">")}s<a.length&&(t=a[s].rep),a.length=s,i.push("</",t,">")}}},pcdata:i,rcdata:i,cdata:i,endDoc:function(e){for(;a.length;a.length--)e.push("</",a[a.length-1].rep,">")}})}function y(e,t,a,n,o){if(!o)return null;try{var s=i.parse(""+e);if(s&&(!s.hasScheme()||K.test(s.getScheme()))){var r=o(s,t,a,n);return r?r.toString():null}}catch(l){return null}return null}function b(e,t,a,n,i){if(a||e(t+" removed",{change:"removed",tagName:t}),n!==i){var o="changed";n&&!i?o="removed":!n&&i&&(o="added"),e(t+"."+a+" "+o,{change:o,tagName:t,attribName:a,oldValue:n,newValue:i})}}function w(e,t,a){var n;return n=t+"::"+a,e.hasOwnProperty(n)?e[n]:(n="*::"+a,e.hasOwnProperty(n)?e[n]:void 0)}function R(t,a){return w(e.LOADERTYPES,t,a)}function k(t,a){return w(e.URIEFFECTS,t,a)}function E(t,a,n,i,o){for(var s=0;s<a.length;s+=2){var r,l=a[s],u=a[s+1],c=u,d=null;if(r=t+"::"+l,(e.ATTRIBS.hasOwnProperty(r)||(r="*::"+l,e.ATTRIBS.hasOwnProperty(r)))&&(d=e.ATTRIBS[r]),null!==d)switch(d){case e.atype.NONE:break;case e.atype.SCRIPT:u=null,o&&b(o,t,l,c,u);break;case e.atype.STYLE:if("undefined"==typeof x){u=null,o&&b(o,t,l,c,u);break}var f=[];x(u,{declaration:function(t,a){var i=t.toLowerCase();A(i,a,n?function(t){return y(t,e.ueffects.SAME_DOCUMENT,e.ltypes.SANDBOXED,{TYPE:"CSS",CSS_PROP:i},n)}:null),a.length&&f.push(i+": "+a.join(" "))}}),u=f.length>0?f.join(" ; "):null,o&&b(o,t,l,c,u);break;case e.atype.ID:case e.atype.IDREF:case e.atype.IDREFS:case e.atype.GLOBAL_NAME:case e.atype.LOCAL_NAME:case e.atype.CLASSES:u=i?i(u):u,o&&b(o,t,l,c,u);break;case e.atype.URI:u=y(u,k(t,l),R(t,l),{TYPE:"MARKUP",XML_ATTR:l,XML_TAG:t},n),o&&b(o,t,l,c,u);break;case e.atype.URI_FRAGMENT:u&&"#"===u.charAt(0)?(u=u.substring(1),u=i?i(u):u,null!==u&&void 0!==u&&(u="#"+u)):u=null,o&&b(o,t,l,c,u);break;default:u=null,o&&b(o,t,l,c,u)}else u=null,o&&b(o,t,l,c,u);a[s+1]=u}return a}function C(t,a,n){return function(i,o){return e.ELEMENTS[i]&e.eflags.UNSAFE?void(n&&b(n,i,void 0,void 0,void 0)):{attribs:E(i,o,t,a,n)}}}function S(e,t){var a=[];return v(t)(e,a),a.join("")}function T(e,t,a,n){var i=C(t,a,n);return S(e,i)}var x,A,I;"undefined"!=typeof window&&(x=window.parseCssDeclarations,A=window.sanitizeCssProperty,I=window.cssSchema);var N={lt:"<",LT:"<",gt:">",GT:">",amp:"&",AMP:"&",quot:'"',apos:"'",nbsp:"Â "},M=/^#(\d+)$/,O=/^#x([0-9A-Fa-f]+)$/,D=/^[A-Za-z][A-za-z0-9]+$/,P="undefined"!=typeof window&&window.document?window.document.createElement("textarea"):null,j=/\0/g,L=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g,F=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/,U=/&/g,H=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,B=/[<]/g,z=/>/g,q=/\"/g,V=new RegExp("^\\s*([-.:\\w]+)(?:\\s*(=)\\s*((\")[^\"]*(\"|$)|(')[^']*('|$)|(?=[a-z][-\\w]*\\s*=)|[^\"'\\s]*))?","i"),G=3==="a,b".split(/(,)/).length,W=e.eflags.CDATA|e.eflags.RCDATA,$={},Y={},K=/^(?:https?|mailto)$/i,X={};return X.escapeAttrib=X.escapeAttrib=s,X.makeHtmlSanitizer=X.makeHtmlSanitizer=v,X.makeSaxParser=X.makeSaxParser=l,X.makeTagPolicy=X.makeTagPolicy=C,X.normalizeRCData=X.normalizeRCData=r,X.sanitize=X.sanitize=T,X.sanitizeAttribs=X.sanitizeAttribs=E,X.sanitizeWithPolicy=X.sanitizeWithPolicy=S,X.unescapeEntities=X.unescapeEntities=o,X}(n),s=o.sanitize;"undefined"!=typeof window&&(window.html=o,window.html_sanitize=s);var r={};r.escapeAttrib=o.escapeAttrib,r.makeHtmlSanitizer=o.makeHtmlSanitizer,r.makeSaxParser=o.makeSaxParser,r.makeTagPolicy=o.makeTagPolicy,r.normalizeRCData=o.normalizeRCData,r.sanitizeAttribs=o.sanitizeAttribs,r.sanitizeWithPolicy=o.sanitizeWithPolicy,r.unescapeEntities=o.unescapeEntities,r.escape=o.escapeAttrib,r.sanitize=function(e,t,a,n){return"string"==typeof e&&(e=e.replace(/<([a-zA-Z]+)([^>]*)\/>/g,"<$1$2></$1>")),e?o.sanitize(e,t,a,n):e},"undefined"!=typeof e&&e.exports&&(t=e.exports=r),t.Sanitizer=r},function(e,t,a){var n={};n.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10},n.ATTRIBS={"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0},n.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128},n.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:16,area:2,b:0,base:18,basefont:18,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,dd:1,del:0,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,font:0,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,hr:2,html:49,i:0,iframe:4,img:2,input:2,ins:0,isindex:18,kbd:0,label:0,legend:0,li:1,link:18,map:0,menu:0,meta:18,noframes:20,noscript:20,object:16,ol:0,optgroup:0,option:1,p:1,param:18,pre:0,q:0,s:0,samp:0,script:84,select:0,small:0,span:0,strike:0,strong:0,style:148,sub:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,title:24,tr:1,tt:0,u:0,ul:0,"var":0},n.URIEFFECTS={},n.LOADERTYPES={},"undefined"!=typeof e&&e.exports&&(t=e.exports=n),t.URI=n},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(4),o=n(i),s=a(5),r=n(s),l=a(535),u=n(l),c=a(99),d=n(c),f=a(9),h=n(f),p=a(121),_=n(p),m=a(536),g=a(545),v=n(g),y=a(90),b=n(y),w=a(167),R=n(w),k=new m.Validator,E=function(){function e(){(0,o["default"])(this,e)}return(0,r["default"])(e,[{key:"fetchGlanceMetadataForRoom",value:function(e){var t=this,a=d["default"].timings.now();h["default"].dispatch("API:fetch-all-glances-for-room",{room_id:e,timeout:_["default"].integrations.glance_remote_metadata_timeout},function(n){n.then(function(n){n.forEach(function(n){var i=n.promise,o=n.key;u["default"].glanceMetadataLoading(e,o),i.then(function(n){var i=n.path,s=n.data,r=n.result,l=t._createGlanceFromKey(o,i);t._processGlanceReturnedData(e,l,s,r,a)})}),u["default"].roomFinishedLoading(e,!0)})["catch"](function(t){b["default"].warn("[HC-Integrations]","Failed to fetch signed url for room "+e+" "+t),u["default"].roomFinishedLoading(e,!1)})})}},{key:"fetchGlanceRemoteMetadata",value:function(e,t){var a=this,n=d["default"].timings.now();h["default"].dispatch("API:request-with-signed-url",{extension:t,attribute:"query_url",room_id:e,timeout:_["default"].integrations.glance_remote_metadata_timeout},{},function(i,o){a._processGlanceReturnedData(e,t,i,o,n)})}},{key:"_processGlanceReturnedData",value:function(e,t,a,n,i){var o=Math.floor(d["default"].timings.now()-i);if(!a||a.error||n.status>=400)u["default"].glanceMetadataError(e,t,"Could not load data for this glance.",o);else{if(!this._validateMetadataFromRemote(a,t))return void u["default"].glanceMetadataError(e,t,"Could not validate data for this glance.",o);u["default"].glanceMetadataFetched(e,t,a,o)}}},{key:"_validateMetadataFromRemote",value:function(e,t){var a=k.validate(e,v["default"]);return a.errors.length>0?(b["default"].warn("[HC-Integrations]","Invalid schema from "+t.query_url+" for Glance "+t.full_key+": "+a),!1):!0}},{key:"_createGlanceFromKey",value:function(e,t){return{full_key:e,query_url:t,addon_key:R["default"].split_full_key(e)[0]}}}]),e}();t["default"]=new E,e.exports=t["default"]},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(9),i=a(173),o=a(90);t["default"]={fetchGlanceMetadata:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];n.dispatch("fetch-glance-metadata",e,t,a)},glanceMetadataLoading:function(e,t){n.dispatch("glance-metadata-loading",e,t)},glanceMetadataFetched:function(e,t,a,o){n.dispatch("glance-metadata-fetched",e,t.full_key,a),i.dispatch("analytics-event",{name:"hipchat.client.integrations.glance.fetch.success",properties:{room_id:e,addon_key:t.addon_key,glance_full_key:t.full_key,duration:o}})},glanceMetadataError:function(e,t,a,s){o.warn("[HC-Integrations]",a),n.dispatch("glance-metadata-fetched",e,t.full_key,{error:a}),i.dispatch("analytics-event",{name:"hipchat.client.integrations.glance.fetch.error",properties:{room_id:e,addon_key:t.addon_key,glance_full_key:t.full_key,error:a,duration:s}})},roomFinishedLoading:function(e,t){n.dispatch("glances-finished-loading-for-room",e,t)}},e.exports=t["default"]},function(e,t,a){"use strict";var n=e.exports.Validator=a(537);e.exports.ValidatorResult=a(544).ValidatorResult,e.exports.ValidationError=a(544).ValidationError,e.exports.SchemaError=a(544).SchemaError,e.exports.validate=function(e,t,a){var i=new n;return i.validate(e,t,a)}},function(e,t,a){"use strict";var n=a(538),i=a(543),o=a(544),s=o.ValidatorResult,r=o.SchemaError,l=o.SchemaContext,u=function d(){this.customFormats=Object.create(d.prototype.customFormats),this.schemas={},this.unresolvedRefs=[],this.types=Object.create(c),this.attributes=Object.create(i.validators)};u.prototype.customFormats={},u.prototype.schemas=null,u.prototype.types=null,u.prototype.attributes=null,u.prototype.unresolvedRefs=null,u.prototype.addSchema=function(e,t){if(!e)return null;var a=t||e.id;return this.addSubSchema(a,e),a&&(this.schemas[a]=e),this.schemas[a]},u.prototype.addSubSchema=function(e,t){if(t&&"object"==typeof t){if(t.$ref){var a=n.resolve(e,t.$ref);return void(void 0===this.schemas[a]&&(this.schemas[a]=null,this.unresolvedRefs.push(a)))}var i=t.id&&n.resolve(e,t.id),s=i||e;if(i){if(this.schemas[i]){if(!o.deepCompareStrict(this.schemas[i],t))throw new Error("Schema <"+t+"> already exists with different definition");return this.schemas[i]}this.schemas[i]=t;var r=i.replace(/^([^#]*)#$/,"$1");this.schemas[r]=t}return this.addSubSchemaArray(s,t.items instanceof Array?t.items:[t.items]),this.addSubSchemaArray(s,t["extends"]instanceof Array?t["extends"]:[t["extends"]]),this.addSubSchema(s,t.additionalItems),this.addSubSchemaObject(s,t.properties),this.addSubSchema(s,t.additionalProperties),this.addSubSchemaObject(s,t.definitions),this.addSubSchemaObject(s,t.patternProperties),this.addSubSchemaObject(s,t.dependencies),this.addSubSchemaArray(s,t.disallow),this.addSubSchemaArray(s,t.allOf),this.addSubSchemaArray(s,t.anyOf),this.addSubSchemaArray(s,t.oneOf),this.addSubSchema(s,t.not),this.schemas[i]}},u.prototype.addSubSchemaArray=function(e,t){if(t instanceof Array)for(var a=0;a<t.length;a++)this.addSubSchema(e,t[a])},u.prototype.addSubSchemaObject=function(e,t){if(t&&"object"==typeof t)for(var a in t)this.addSubSchema(e,t[a])},u.prototype.setSchemas=function(e){this.schemas=e},u.prototype.getSchema=function(e){return this.schemas[e]},u.prototype.validate=function(e,t,a,i){a||(a={});var o=a.propertyName||"instance",s=n.resolve(a.base||"/",t.id||"");if(i||(i=new l(t,a,o,s,Object.create(this.schemas)),i.schemas[s]||(i.schemas[s]=t)),t){var u=this.validateSchema(e,t,a,i);if(!u)throw new Error("Result undefined");return u}throw new r("no schema specified",t)},u.prototype.validateSchema=function(e,t,a,n){function u(e){var t="string"==typeof e?e:e.$ref;return"string"==typeof t?t:!1}function c(e,t){var a;return(a=u(e))?d.resolve(e,a,t).subschema:e}var d=this,f=new s(e,t,a,n);if(!t)throw new Error("schema is undefined");t["extends"]&&(t["extends"]instanceof Array?t["extends"].forEach(function(e){t=o.deepMerge(t,c(e,n))}):t=o.deepMerge(t,c(t["extends"],n)));var h;if(h=u(t)){var p=this.resolve(t,h,n),_=new l(p.subschema,a,n.propertyPath,p.switchSchema,n.schemas);return this.validateSchema(e,p.subschema,a,_)}var m=a&&a.skipAttributes||[];for(var g in t)if(!i.ignoreProperties[g]&&m.indexOf(g)<0){var v=null,y=d.attributes[g];if(y)v=y.call(d,e,t,a,n);else if(a.allowUnknownAttributes===!1)throw new r("Unsupported attribute: "+g,t);v&&f.importErrors(v)}if("function"==typeof a.rewrite){var b=a.rewrite.call(this,e,t,a,n);f.instance=b}return f},u.prototype.resolve=function(e,t,a){if(t=a.resolve(t),a.schemas[t])return{subschema:a.schemas[t],switchSchema:t};var i=n.parse(t),s=i&&i.hash,l=s&&s.length&&t.substr(0,t.length-s.length);if(!l||!a.schemas[l])throw new r("no such schema <"+t+">",e);var u=o.objectGetPath(a.schemas[l],s.substr(1));if(void 0===u)throw new r("no such schema "+s+" located in <"+l+">",e);return{subschema:u,switchSchema:t}},u.prototype.testType=function(e,t,a,n,i){if("function"==typeof this.types[i])return this.types[i].call(this,e);if(i&&"object"==typeof i){var o=this.validateSchema(e,i,a,n);return void 0===o||!(o&&o.errors.length)}return!0};var c=u.prototype.types={};c.string=function(e){return"string"==typeof e},c.number=function(e){return"number"==typeof e&&isFinite(e)},c.integer=function(e){return"number"==typeof e&&e%1===0},c["boolean"]=function(e){return"boolean"==typeof e},c.array=function(e){return e instanceof Array},c["null"]=function(e){return null===e},c.date=function(e){return e instanceof Date},c.any=function(e){return!0},c.object=function(e){return e&&"object"==typeof e&&!(e instanceof Array)&&!(e instanceof Date)},e.exports=u},function(e,t,a){function n(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function i(e,t,a){if(e&&u(e)&&e instanceof n)return e;var i=new n;return i.parse(e,t,a),i}function o(e){return l(e)&&(e=i(e)),e instanceof n?e.format():n.prototype.format.call(e)}function s(e,t){return i(e,!1,!0).resolve(t)}function r(e,t){return e?i(e,!1,!0).resolveObject(t):t}function l(e){return"string"==typeof e}function u(e){return"object"==typeof e&&null!==e}function c(e){return null===e}function d(e){return null==e}var f=a(539);t.parse=i,t.resolve=s,t.resolveObject=r,t.format=o,t.Url=n;var h=/^([a-z0-9.+-]+:)/i,p=/:[0-9]*$/,_=["<",">",'"',"`"," ","\r","\n","	"],m=["{","}","|","\\","^","`"].concat(_),g=["'"].concat(m),v=["%","/","?",";","#"].concat(g),y=["/","?","#"],b=255,w=/^[a-z0-9A-Z_-]{0,63}$/,R=/^([a-z0-9A-Z_-]{0,63})(.*)$/,k={javascript:!0,"javascript:":!0},E={javascript:!0,"javascript:":!0},C={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},S=a(540);n.prototype.parse=function(e,t,a){if(!l(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e;n=n.trim();var i=h.exec(n);if(i){i=i[0];var o=i.toLowerCase();this.protocol=o,n=n.substr(i.length)}if(a||i||n.match(/^\/\/[^@\/]+@[^@\/]+/)){var s="//"===n.substr(0,2);!s||i&&E[i]||(n=n.substr(2),this.slashes=!0)}if(!E[i]&&(s||i&&!C[i])){for(var r=-1,u=0;u<y.length;u++){var c=n.indexOf(y[u]);-1!==c&&(-1===r||r>c)&&(r=c)}var d,p;p=-1===r?n.lastIndexOf("@"):n.lastIndexOf("@",r),-1!==p&&(d=n.slice(0,p),n=n.slice(p+1),this.auth=decodeURIComponent(d)),r=-1;for(var u=0;u<v.length;u++){var c=n.indexOf(v[u]);-1!==c&&(-1===r||r>c)&&(r=c)}-1===r&&(r=n.length),this.host=n.slice(0,r),n=n.slice(r),this.parseHost(),this.hostname=this.hostname||"";var _="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!_)for(var m=this.hostname.split(/\./),u=0,T=m.length;T>u;u++){var x=m[u];if(x&&!x.match(w)){for(var A="",I=0,N=x.length;N>I;I++)A+=x.charCodeAt(I)>127?"x":x[I];if(!A.match(w)){var M=m.slice(0,u),O=m.slice(u+1),D=x.match(R);D&&(M.push(D[1]),O.unshift(D[2])),O.length&&(n="/"+O.join(".")+n),this.hostname=M.join(".");break}}}if(this.hostname.length>b?this.hostname="":this.hostname=this.hostname.toLowerCase(),!_){for(var P=this.hostname.split("."),j=[],u=0;u<P.length;++u){var L=P[u];j.push(L.match(/[^A-Za-z0-9_-]/)?"xn--"+f.encode(L):L)}this.hostname=j.join(".")}var F=this.port?":"+this.port:"",U=this.hostname||"";this.host=U+F,this.href+=this.host,_&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==n[0]&&(n="/"+n))}if(!k[o])for(var u=0,T=g.length;T>u;u++){var H=g[u],B=encodeURIComponent(H);B===H&&(B=escape(H)),n=n.split(H).join(B)}var z=n.indexOf("#");-1!==z&&(this.hash=n.substr(z),n=n.slice(0,z));var q=n.indexOf("?");if(-1!==q?(this.search=n.substr(q),this.query=n.substr(q+1),t&&(this.query=S.parse(this.query)),n=n.slice(0,q)):t&&(this.search="",this.query={}),n&&(this.pathname=n),C[o]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var F=this.pathname||"",L=this.search||"";this.path=F+L}return this.href=this.format(),this},n.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",a=this.pathname||"",n=this.hash||"",i=!1,o="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&u(this.query)&&Object.keys(this.query).length&&(o=S.stringify(this.query));var s=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||C[t])&&i!==!1?(i="//"+(i||""),a&&"/"!==a.charAt(0)&&(a="/"+a)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),s&&"?"!==s.charAt(0)&&(s="?"+s),a=a.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),s=s.replace("#","%23"),t+i+a+s+n},n.prototype.resolve=function(e){return this.resolveObject(i(e,!1,!0)).format()},n.prototype.resolveObject=function(e){if(l(e)){var t=new n;t.parse(e,!1,!0),e=t}var a=new n;if(Object.keys(this).forEach(function(e){a[e]=this[e]},this),a.hash=e.hash,""===e.href)return a.href=a.format(),a;if(e.slashes&&!e.protocol)return Object.keys(e).forEach(function(t){"protocol"!==t&&(a[t]=e[t])}),C[a.protocol]&&a.hostname&&!a.pathname&&(a.path=a.pathname="/"),a.href=a.format(),a;if(e.protocol&&e.protocol!==a.protocol){if(!C[e.protocol])return Object.keys(e).forEach(function(t){a[t]=e[t]}),a.href=a.format(),a;if(a.protocol=e.protocol,e.host||E[e.protocol])a.pathname=e.pathname;else{for(var i=(e.pathname||"").split("/");i.length&&!(e.host=i.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==i[0]&&i.unshift(""),i.length<2&&i.unshift(""),a.pathname=i.join("/")}if(a.search=e.search,a.query=e.query,a.host=e.host||"",a.auth=e.auth,a.hostname=e.hostname||e.host,a.port=e.port,a.pathname||a.search){var o=a.pathname||"",s=a.search||"";a.path=o+s}return a.slashes=a.slashes||e.slashes,a.href=a.format(),a}var r=a.pathname&&"/"===a.pathname.charAt(0),u=e.host||e.pathname&&"/"===e.pathname.charAt(0),f=u||r||a.host&&e.pathname,h=f,p=a.pathname&&a.pathname.split("/")||[],i=e.pathname&&e.pathname.split("/")||[],_=a.protocol&&!C[a.protocol];if(_&&(a.hostname="",a.port=null,a.host&&(""===p[0]?p[0]=a.host:p.unshift(a.host)),a.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===i[0]?i[0]=e.host:i.unshift(e.host)),e.host=null),f=f&&(""===i[0]||""===p[0])),u)a.host=e.host||""===e.host?e.host:a.host,a.hostname=e.hostname||""===e.hostname?e.hostname:a.hostname,a.search=e.search,a.query=e.query,p=i;else if(i.length)p||(p=[]),p.pop(),p=p.concat(i),a.search=e.search,a.query=e.query;else if(!d(e.search)){if(_){a.hostname=a.host=p.shift();var m=a.host&&a.host.indexOf("@")>0?a.host.split("@"):!1;m&&(a.auth=m.shift(),a.host=a.hostname=m.shift())}return a.search=e.search,a.query=e.query,c(a.pathname)&&c(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.href=a.format(),a}if(!p.length)return a.pathname=null,a.search?a.path="/"+a.search:a.path=null,a.href=a.format(),a;for(var g=p.slice(-1)[0],v=(a.host||e.host)&&("."===g||".."===g)||""===g,y=0,b=p.length;b>=0;b--)g=p[b],"."==g?p.splice(b,1):".."===g?(p.splice(b,1),y++):y&&(p.splice(b,1),y--);if(!f&&!h)for(;y--;y)p.unshift("..");!f||""===p[0]||p[0]&&"/"===p[0].charAt(0)||p.unshift(""),v&&"/"!==p.join("/").substr(-1)&&p.push("");var w=""===p[0]||p[0]&&"/"===p[0].charAt(0);if(_){a.hostname=a.host=w?"":p.length?p.shift():"";var m=a.host&&a.host.indexOf("@")>0?a.host.split("@"):!1;m&&(a.auth=m.shift(),a.host=a.hostname=m.shift())}return f=f||a.host&&p.length,f&&!w&&p.unshift(""),p.length?a.pathname=p.join("/"):(a.pathname=null,a.path=null),c(a.pathname)&&c(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.auth=e.auth||a.auth,a.slashes=a.slashes||e.slashes,a.href=a.format(),a},n.prototype.parseHost=function(){var e=this.host,t=p.exec(e);t&&(t=t[0],":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,a){var n;(function(e,i){!function(o){function s(e){throw RangeError(M[e])}function r(e,t){for(var a=e.length,n=[];a--;)n[a]=t(e[a]);return n}function l(e,t){var a=e.split("@"),n="";a.length>1&&(n=a[0]+"@",e=a[1]),e=e.replace(N,".");var i=e.split("."),o=r(i,t).join(".");return n+o}function u(e){for(var t,a,n=[],i=0,o=e.length;o>i;)t=e.charCodeAt(i++),t>=55296&&56319>=t&&o>i?(a=e.charCodeAt(i++),56320==(64512&a)?n.push(((1023&t)<<10)+(1023&a)+65536):(n.push(t),i--)):n.push(t);return n}function c(e){return r(e,function(e){var t="";return e>65535&&(e-=65536,t+=P(e>>>10&1023|55296),e=56320|1023&e),t+=P(e)}).join("")}function d(e){return 10>e-48?e-22:26>e-65?e-65:26>e-97?e-97:w}function f(e,t){return e+22+75*(26>e)-((0!=t)<<5)}function h(e,t,a){var n=0;for(e=a?D(e/C):e>>1,e+=D(e/t);e>O*k>>1;n+=w)e=D(e/O);return D(n+(O+1)*e/(e+E))}function p(e){var t,a,n,i,o,r,l,u,f,p,_=[],m=e.length,g=0,v=T,y=S;for(a=e.lastIndexOf(x),0>a&&(a=0),n=0;a>n;++n)e.charCodeAt(n)>=128&&s("not-basic"),_.push(e.charCodeAt(n));for(i=a>0?a+1:0;m>i;){for(o=g,r=1,l=w;i>=m&&s("invalid-input"),u=d(e.charCodeAt(i++)),(u>=w||u>D((b-g)/r))&&s("overflow"),g+=u*r,f=y>=l?R:l>=y+k?k:l-y,!(f>u);l+=w)p=w-f,r>D(b/p)&&s("overflow"),r*=p;t=_.length+1,y=h(g-o,t,0==o),D(g/t)>b-v&&s("overflow"),v+=D(g/t),g%=t,_.splice(g++,0,v)}return c(_)}function _(e){var t,a,n,i,o,r,l,c,d,p,_,m,g,v,y,E=[];for(e=u(e),m=e.length,t=T,a=0,o=S,r=0;m>r;++r)_=e[r],128>_&&E.push(P(_));for(n=i=E.length,i&&E.push(x);m>n;){for(l=b,r=0;m>r;++r)_=e[r],_>=t&&l>_&&(l=_);for(g=n+1,l-t>D((b-a)/g)&&s("overflow"),a+=(l-t)*g,t=l,r=0;m>r;++r)if(_=e[r],t>_&&++a>b&&s("overflow"),_==t){for(c=a,d=w;p=o>=d?R:d>=o+k?k:d-o,!(p>c);d+=w)y=c-p,v=w-p,E.push(P(f(p+y%v,0))),c=D(y/v);E.push(P(f(c,0))),o=h(a,g,n==i),a=0,++n}++a,++t}return E.join("")}function m(e){return l(e,function(e){return A.test(e)?p(e.slice(4).toLowerCase()):e})}function g(e){return l(e,function(e){return I.test(e)?"xn--"+_(e):e})}var v=("object"==typeof t&&t&&!t.nodeType&&t,"object"==typeof e&&e&&!e.nodeType&&e,"object"==typeof i&&i);v.global!==v&&v.window!==v&&v.self!==v||(o=v);var y,b=2147483647,w=36,R=1,k=26,E=38,C=700,S=72,T=128,x="-",A=/^xn--/,I=/[^\x20-\x7E]/,N=/[\x2E\u3002\uFF0E\uFF61]/g,M={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},O=w-R,D=Math.floor,P=String.fromCharCode;y={version:"1.3.2",ucs2:{decode:u,encode:c},decode:p,encode:_,toASCII:g,toUnicode:m},n=function(){return y}.call(t,a,t,e),!(void 0!==n&&(e.exports=n))}(this)}).call(t,a(104)(e),function(){return this}())},function(e,t,a){"use strict";t.decode=t.parse=a(541),t.encode=t.stringify=a(542)},function(e,t){"use strict";function a(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,i){t=t||"&",n=n||"=";var o={};if("string"!=typeof e||0===e.length)return o;var s=/\+/g;e=e.split(t);var r=1e3;i&&"number"==typeof i.maxKeys&&(r=i.maxKeys);var l=e.length;r>0&&l>r&&(l=r);for(var u=0;l>u;++u){var c,d,f,h,p=e[u].replace(s,"%20"),_=p.indexOf(n);_>=0?(c=p.substr(0,_),d=p.substr(_+1)):(c=p,d=""),f=decodeURIComponent(c),h=decodeURIComponent(d),a(o,f)?Array.isArray(o[f])?o[f].push(h):o[f]=[o[f],h]:o[f]=h}return o}},function(e,t){"use strict";var a=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,i){return t=t||"&",n=n||"=",
null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map(function(i){var o=encodeURIComponent(a(i))+n;return Array.isArray(e[i])?e[i].map(function(e){return o+encodeURIComponent(a(e))}).join(t):o+encodeURIComponent(a(e[i]))}).join(t):i?encodeURIComponent(a(i))+n+encodeURIComponent(a(e)):""}},function(e,t,a){"use strict";function n(e,t,a,n){return this.validateSchema(e,n,t,a).valid}function i(e,t,a,n,i,o){if(!t.properties||void 0===t.properties[i])if(t.additionalProperties===!1)o.addError({name:"additionalProperties",argument:i,message:"additionalProperty "+JSON.stringify(i)+" exists in instance when not allowed"});else{var s=t.additionalProperties||{},r=this.validateSchema(e[i],s,a,n.makeChild(s,i));r.instance!==o.instance[i]&&(o.instance[i]=r.instance),o.importErrors(r)}}function o(e,t,a){var n,i=a.length;for(n=t+1,i;i>n;n++)if(s.deepCompareStrict(e,a[n]))return!1;return!0}var s=a(544),r=s.ValidatorResult,l=s.SchemaError,u={};u.ignoreProperties={id:!0,"default":!0,description:!0,title:!0,exclusiveMinimum:!0,exclusiveMaximum:!0,additionalItems:!0,$schema:!0,$ref:!0,"extends":!0};var c=u.validators={};c.type=function(e,t,a,n){if(void 0===e)return null;var i=new r(e,t,a,n),o=t.type instanceof Array?t.type:[t.type];if(!o.some(this.testType.bind(this,e,t,a,n))){var s=o.map(function(e){return e.id&&"<"+e.id+">"||e+""});i.addError({name:"type",argument:s,message:"is not of a type(s) "+s})}return i},c.anyOf=function(e,t,a,i){if(void 0===e)return null;var o=new r(e,t,a,i);if(!(t.anyOf instanceof Array))throw new l("anyOf must be an array");if(!t.anyOf.some(n.bind(this,e,a,i))){var s=t.anyOf.map(function(e,t){return e.id&&"<"+e.id+">"||e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+t+"]"});o.addError({name:"anyOf",argument:s,message:"is not any of "+s.join(",")})}return o},c.allOf=function(e,t,a,n){if(void 0===e)return null;if(!(t.allOf instanceof Array))throw new l("allOf must be an array");var i=new r(e,t,a,n),o=this;return t.allOf.forEach(function(t,s){var r=o.validateSchema(e,t,a,n);if(!r.valid){var l=t.id&&"<"+t.id+">"||t.title&&JSON.stringify(t.title)||t.$ref&&"<"+t.$ref+">"||"[subschema "+s+"]";i.addError({name:"allOf",argument:{id:l,length:r.errors.length,valid:r},message:"does not match allOf schema "+l+" with "+r.errors.length+" error[s]:"}),i.importErrors(r)}}),i},c.oneOf=function(e,t,a,i){if(void 0===e)return null;if(!(t.oneOf instanceof Array))throw new l("oneOf must be an array");var o=new r(e,t,a,i),s=t.oneOf.filter(n.bind(this,e,a,i)).length,u=t.oneOf.map(function(e,t){return e.id&&"<"+e.id+">"||e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+t+"]"});return 1!==s&&o.addError({name:"oneOf",argument:u,message:"is not exactly one from "+u.join(",")}),o},c.properties=function(e,t,a,n){if(void 0!==e&&e instanceof Object){var i=new r(e,t,a,n),o=t.properties||{};for(var s in o){var l=(e||void 0)&&e[s],u=this.validateSchema(l,o[s],a,n.makeChild(o[s],s));u.instance!==i.instance[s]&&(i.instance[s]=u.instance),i.importErrors(u)}return i}},c.patternProperties=function(e,t,a,n){if(void 0!==e&&this.types.object(e)){var o=new r(e,t,a,n),s=t.patternProperties||{};for(var l in e){var u=!0;for(var c in s){var d=new RegExp(c);if(d.test(l)){u=!1;var f=this.validateSchema(e[l],s[c],a,n.makeChild(s[c],l));f.instance!==o.instance[l]&&(o.instance[l]=f.instance),o.importErrors(f)}}u&&i.call(this,e,t,a,n,l,o)}return o}},c.additionalProperties=function(e,t,a,n){if(void 0!==e&&this.types.object(e)){if(t.patternProperties)return null;var o=new r(e,t,a,n);for(var s in e)i.call(this,e,t,a,n,s,o);return o}},c.minProperties=function(e,t,a,n){if(!e||"object"!=typeof e)return null;var i=new r(e,t,a,n),o=Object.keys(e);return o.length>=t.minProperties||i.addError({name:"minProperties",argument:t.minProperties,message:"does not meet minimum property length of "+t.minProperties}),i},c.maxProperties=function(e,t,a,n){if(!e||"object"!=typeof e)return null;var i=new r(e,t,a,n),o=Object.keys(e);return o.length<=t.maxProperties||i.addError({name:"maxProperties",argument:t.maxProperties,message:"does not meet maximum property length of "+t.maxProperties}),i},c.items=function(e,t,a,n){if(!(e instanceof Array))return null;var i=this,o=new r(e,t,a,n);return void 0!==e&&t.items?(e.every(function(e,s){var r=t.items instanceof Array?t.items[s]||t.additionalItems:t.items;if(void 0===r)return!0;if(r===!1)return o.addError({name:"items",message:"additionalItems not permitted"}),!1;var l=i.validateSchema(e,r,a,n.makeChild(r,s));return l.instance!==o.instance[s]&&(o.instance[s]=l.instance),o.importErrors(l),!0}),o):o},c.minimum=function(e,t,a,n){if("number"!=typeof e)return null;var i=new r(e,t,a,n),o=!0;return o=t.exclusiveMinimum&&t.exclusiveMinimum===!0?e>t.minimum:e>=t.minimum,o||i.addError({name:"minimum",argument:t.minimum,message:"must have a minimum value of "+t.minimum}),i},c.maximum=function(e,t,a,n){if("number"!=typeof e)return null;var i,o=new r(e,t,a,n);return i=t.exclusiveMaximum&&t.exclusiveMaximum===!0?e<t.maximum:e<=t.maximum,i||o.addError({name:"maximum",argument:t.maximum,message:"must have a maximum value of "+t.maximum}),o},c.divisibleBy=function(e,t,a,n){if("number"!=typeof e)return null;if(0==t.divisibleBy)throw new l("divisibleBy cannot be zero");var i=new r(e,t,a,n);return e/t.divisibleBy%1&&i.addError({name:"divisibleBy",argument:t.divisibleBy,message:"is not divisible by (multiple of) "+JSON.stringify(t.divisibleBy)}),i},c.multipleOf=function(e,t,a,n){if("number"!=typeof e)return null;if(0==t.multipleOf)throw new l("multipleOf cannot be zero");var i=new r(e,t,a,n);return e/t.multipleOf%1&&i.addError({name:"multipleOf",argument:t.multipleOf,message:"is not a multiple of (divisible by) "+JSON.stringify(t.multipleOf)}),i},c.required=function(e,t,a,n){var i=new r(e,t,a,n);return void 0===e&&t.required===!0?i.addError({name:"required",message:"is required"}):e&&"object"==typeof e&&Array.isArray(t.required)&&t.required.forEach(function(t){void 0===e[t]&&i.addError({name:"required",argument:t,message:"requires property "+JSON.stringify(t)})}),i},c.pattern=function(e,t,a,n){if("string"!=typeof e)return null;var i=new r(e,t,a,n);return e.match(t.pattern)||i.addError({name:"pattern",argument:t.pattern,message:"does not match pattern "+JSON.stringify(t.pattern)}),i},c.format=function(e,t,a,n){var i=new r(e,t,a,n);return i.disableFormat||s.isFormat(e,t.format,this)||i.addError({name:"format",argument:t.format,message:"does not conform to the "+JSON.stringify(t.format)+" format"}),i},c.minLength=function(e,t,a,n){if("string"!=typeof e)return null;var i=new r(e,t,a,n);return e.length>=t.minLength||i.addError({name:"minLength",argument:t.minLength,message:"does not meet minimum length of "+t.minLength}),i},c.maxLength=function(e,t,a,n){if("string"!=typeof e)return null;var i=new r(e,t,a,n);return e.length<=t.maxLength||i.addError({name:"maxLength",argument:t.maxLength,message:"does not meet maximum length of "+t.maxLength}),i},c.minItems=function(e,t,a,n){if(!(e instanceof Array))return null;var i=new r(e,t,a,n);return e.length>=t.minItems||i.addError({name:"minItems",argument:t.minItems,message:"does not meet minimum length of "+t.minItems}),i},c.maxItems=function(e,t,a,n){if(!(e instanceof Array))return null;var i=new r(e,t,a,n);return e.length<=t.maxItems||i.addError({name:"maxItems",argument:t.maxItems,message:"does not meet maximum length of "+t.maxItems}),i},c.uniqueItems=function(e,t,a,n){function i(e,t,a){for(var n=t+1;n<a.length;n++)if(s.deepCompareStrict(e,a[n]))return!1;return!0}var o=new r(e,t,a,n);return e instanceof Array?(e.every(i)||o.addError({name:"uniqueItems",message:"contains duplicate item"}),o):o},c.uniqueItems=function(e,t,a,n){if(!(e instanceof Array))return null;var i=new r(e,t,a,n);return e.every(o)||i.addError({name:"uniqueItems",message:"contains duplicate item"}),i},c.dependencies=function(e,t,a,n){if(!e||"object"!=typeof e)return null;var i=new r(e,t,a,n);for(var o in t.dependencies)if(void 0!==e[o]){var s=t.dependencies[o],l=n.makeChild(s,o);if("string"==typeof s&&(s=[s]),s instanceof Array)s.forEach(function(t){void 0===e[t]&&i.addError({name:"dependencies",argument:l.propertyPath,message:"property "+t+" not found, required by "+l.propertyPath})});else{var u=this.validateSchema(e,s,a,l);i.instance!==u.instance&&(i.instance=u.instance),u&&u.errors.length&&(i.addError({name:"dependencies",argument:l.propertyPath,message:"does not meet dependency required by "+l.propertyPath}),i.importErrors(u))}}return i},c["enum"]=function(e,t,a,n){if(!(t["enum"]instanceof Array))throw new l("enum expects an array",t);if(void 0===e)return null;var i=new r(e,t,a,n);return t["enum"].some(s.deepCompareStrict.bind(null,e))||i.addError({name:"enum",argument:t["enum"],message:"is not one of enum values: "+t["enum"].join(",")}),i},c.not=c.disallow=function(e,t,a,n){var i=this;if(void 0===e)return null;var o=new r(e,t,a,n),s=t.not||t.disallow;return s?(s instanceof Array||(s=[s]),s.forEach(function(s){if(i.testType(e,t,a,n,s)){var r=s&&s.id&&"<"+s.id+">"||s;o.addError({name:"not",argument:r,message:"is of prohibited type "+r})}}),o):null},e.exports=u},function(e,t,a){"use strict";var n=a(538),i=t.ValidationError=function(e,t,a,n,i,o){n&&(this.property=n),e&&(this.message=e),a&&(a.id?this.schema=a.id:this.schema=a),t&&(this.instance=t),this.name=i,this.argument=o,this.stack=this.toString()};i.prototype.toString=function(){return this.property+" "+this.message};var o=t.ValidatorResult=function(e,t,a,n){this.instance=e,this.schema=t,this.propertyPath=n.propertyPath,this.errors=[],this.throwError=a&&a.throwError,this.disableFormat=a&&a.disableFormat===!0};o.prototype.addError=function(e){var t;if("string"==typeof e)t=new i(e,this.instance,this.schema,this.propertyPath);else{if(!e)throw new Error("Missing error detail");if(!e.message)throw new Error("Missing error message");if(!e.name)throw new Error("Missing validator type");t=new i(e.message,this.instance,this.schema,this.propertyPath,e.name,e.argument)}if(this.throwError)throw t;return this.errors.push(t),t},o.prototype.importErrors=function(e){if("string"==typeof e||e&&e.validatorType)this.addError(e);else if(e&&e.errors){var t=this.errors;e.errors.forEach(function(e){t.push(e)})}},o.prototype.toString=function(e){return this.errors.map(function(e,t){return t+": "+e.toString()+"\n"}).join("")},Object.defineProperty(o.prototype,"valid",{get:function(){return!this.errors.length}});var s=t.SchemaError=function c(e,t){this.message=e,this.schema=t,Error.call(this,e),Error.captureStackTrace(this,c)};s.prototype=Object.create(Error.prototype,{constructor:{value:s,enumerable:!1},name:{value:"SchemaError",enumerable:!1}});var r=t.SchemaContext=function(e,t,a,n,i){this.schema=e,this.options=t,this.propertyPath=a,this.base=n,this.schemas=i};r.prototype.resolve=function(e){return n.resolve(this.base,e)},r.prototype.makeChild=function(e,t){var a=void 0===t?this.propertyPath:this.propertyPath+u(t),i=n.resolve(this.base,e.id||""),o=new r(e,this.options,a,i,Object.create(this.schemas));return e.id&&!o.schemas[i]&&(o.schemas[i]=e),o};var l=t.FORMAT_REGEXPS={"date-time":/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\.\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,date:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,time:/^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,email:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/,"ip-address":/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,uri:/^[a-zA-Z][a-zA-Z0-9+-.]*:[^\s]*$/,color:/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/,hostname:/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"host-name":/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,alpha:/^[a-zA-Z]+$/,alphanumeric:/^[a-zA-Z0-9]+$/,"utc-millisec":function(e){return"string"==typeof e&&parseFloat(e)===parseInt(e,10)&&!isNaN(e)},regex:function(e){var t=!0;try{new RegExp(e)}catch(a){t=!1}return t},style:/\s*(.+?):\s*([^;]+);?/g,phone:/^\+(?:[0-9] ?){6,14}[0-9]$/};l.regexp=l.regex,l.pattern=l.regex,l.ipv4=l["ip-address"],t.isFormat=function(e,t,a){if("string"==typeof e&&void 0!==l[t]){if(l[t]instanceof RegExp)return l[t].test(e);if("function"==typeof l[t])return l[t](e)}else if(a&&a.customFormats&&"function"==typeof a.customFormats[t])return a.customFormats[t](e);return!0};var u=t.makeSuffix=function(e){return e=e.toString(),e.match(/[.\s\[\]]/)||e.match(/^[\d]/)?e.match(/^\d+$/)?"["+e+"]":"["+JSON.stringify(e)+"]":"."+e};t.deepCompareStrict=function d(e,t){if(typeof e!=typeof t)return!1;if(e instanceof Array)return t instanceof Array?e.length!==t.length?!1:e.every(function(a,n){return d(e[n],t[n])}):!1;if("object"==typeof e){if(!e||!t)return e===t;var a=Object.keys(e),n=Object.keys(t);return a.length!==n.length?!1:a.every(function(a){return d(e[a],t[a])})}return e===t},e.exports.deepMerge=function f(e,t){var a=Array.isArray(t),n=a&&[]||{};return a?(e=e||[],n=n.concat(e),t.forEach(function(t,a){"object"==typeof t?n[a]=f(e[a],t):-1===e.indexOf(t)&&n.push(t)})):(e&&"object"==typeof e&&Object.keys(e).forEach(function(t){n[t]=e[t]}),Object.keys(t).forEach(function(a){"object"==typeof t[a]&&t[a]&&e[a]?n[a]=f(e[a],t[a]):n[a]=t[a]})),n},t.objectGetPath=function(e,t){for(var a,n=t.split("/").slice(1);"string"==typeof(a=n.shift());){var i=decodeURIComponent(a.replace(/~0/,"~").replace(/~1/g,"/"));if(!(i in e))return;e=e[i]}return e},t.encodePath=function(e){return e.map(function(e){return"/"+encodeURIComponent(e).replace(/~/g,"%7E")}).join("")}},function(e,t){e.exports={additionalProperties:!0,required:["label"],type:"object",properties:{status:{type:[{description:"A lozenge with a label text. See https://docs.atlassian.com/aui/latest/docs/lozenges.html",required:["type","value"],additionalProperties:!0,type:"object",properties:{type:{"enum":["lozenge"],type:"string"},value:{additionalProperties:!0,required:["type","label"],type:"object",properties:{type:{"enum":["default","success","error","current","new","moved"],type:"string"},label:{minLength:1,type:"string",maxLength:20}}}}},{description:"The icon for the glance",required:["type","value"],additionalProperties:!0,type:"object",properties:{type:{"enum":["icon"],type:"string"},value:{additionalProperties:!0,required:["url","url@2x"],type:"object",properties:{url:{type:"string",description:"An URL to the icon"},"url@2x":{type:"string",description:"An URL to the high resolution icon"}}}}}]},metadata:{additionalProperties:!0,type:"object",description:"Glance metadata for conditions"},label:{description:"Free form html label",required:["type","value"],additionalProperties:!0,type:"object",properties:{type:{"enum":["html"],type:"string"},value:{minLength:1,type:"string",maxLength:1e3}}}}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(420),o=n(i),s=a(535),r=n(s),l=a(523),u=n(l),c=a(329),d=n(c),f=a(547),h=n(f),p=a(313),m=n(p),g=a(437),v=n(g),y=a(314),b=n(y);t["default"]=React.createClass({displayName:"RightSideBarGlance",propTypes:{glance:React.PropTypes.shape({name:React.PropTypes.string.isRequired,full_key:React.PropTypes.string.isRequired,addon_key:React.PropTypes.string.isRequired,key:React.PropTypes.string.isRequired,icon:React.PropTypes.object,query_url:React.PropTypes.string,target:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.object]),dynamic:React.PropTypes.bool,internal:React.PropTypes.bool}).isRequired,room_id:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.number])},mixins:[b["default"]],getInitialState:function(){return{loading:this._isDynamic(),error:null,label:{value:this.props.glance.name},room_id:null,condition:null,status:{}}},componentWillMount:function(){var e=u["default"].getCachedMetadata(this.props.room_id,this.props.glance.full_key);_.isEmpty(e)||e.loading||this.setState(e)},componentDidMount:function(){this._isDynamic()&&u["default"].onGlanceMetadataChange(this.props.room_id,this.props.glance.full_key,this._onChange)},componentWillUpdate:function(){this._isDynamic()&&u["default"].offGlanceMetadataChange(this.props.room_id,this.props.glance.full_key,this._onChange)},componentDidUpdate:function(){this._isDynamic()&&u["default"].onGlanceMetadataChange(this.props.room_id,this.props.glance.full_key,this._onChange),this.isMounted()&&this._onChange()},componentWillUnmount:function(){this._isDynamic()&&u["default"].offGlanceMetadataChange(this.props.room_id,this.props.glance.full_key,this._onChange)},_fetchMetadata:function(){r["default"].fetchGlanceMetadata(this.props.room_id,this.props.glance,!0)},_onChange:function(){this.setState(this._getState())},_getState:function(){return u["default"].getCachedMetadata(this.props.room_id,this.props.glance.full_key)||this.getInitialState()},_onClick:function(){o["default"].open(this.props.glance.addon_key,this.props.glance.key,{},null,"glance")},_renderErrorGlance:function(){var e=(0,m["default"])({"hc-glance":!0,error:!0});return React.createElement("div",{className:e,ref:this.props.glance.full_key+"_link"},React.createElement("div",{className:"aui-nav-item","aria-label":this.props.glance.name,"data-tipsify-ignore":!0},this._renderIcon(),React.createElement("div",{className:"hc-glance-content"},React.createElement("div",{className:"hc-glance-label"},this.props.glance.name),React.createElement("div",{className:"hc-glance-status",onClick:this._fetchMetadata},v["default"].glance_fetch_error,React.createElement("button",{className:"aui-button aui-button-link"},v["default"].retry)))))},_isDynamic:function(){return!_.isEmpty(this.props.glance.query_url)},_renderLabel:function(){if(this.state.loading)return React.createElement("span",{className:"hc-glance-label"},v["default"].glance_loading);var e=void 0;return e="safe_html"===this.state.label.type?React.createElement("span",{className:"hc-glance-label",dangerouslySetInnerHTML:{__html:this.state.label.value}}):React.createElement("span",{className:"hc-glance-label"},this.props.glance.name)},_renderLozenge:function(e){var t="aui-lozenge aui-lozenge-"+e.type;return React.createElement("span",{className:t},e.label)},_renderStatusElement:function(){switch(this.state.status.type){case"lozenge":var e=this.state.status.value;return this._renderLozenge(e);case"icon":return React.createElement(h["default"],{icon:this.state.status.value});case"text":return React.createElement("span",{className:"hc-glance-status-text"},this.state.status.value);default:return null}},_renderStatus:function(){return React.createElement("span",{className:"hc-glance-status"},this._renderStatusElement())},_renderChildren:function(){return React.createElement("div",{className:"hc-glance-children"},this.props.children)},_renderIcon:function(){return this.props.glance.icon?React.createElement(h["default"],{icon:this.props.glance.icon}):null},render:function(){if(!_.isNull(this.state.error))return this._renderErrorGlance();var e=(0,m["default"])({"hc-glance":!0,loading:this.state.loading,clickable:!_.isUndefined(this.props.glance.target)});return React.createElement("div",{className:e,ref:this.props.glance.full_key+"_link",onClick:this.props.glance.target?this._onClick:null},React.createElement("div",{className:"aui-nav-item","aria-label":this.props.glance.name,"data-tipsify-ignore":!0},React.createElement("div",{className:"hc-glance-content"},this._renderIcon(),this._renderLabel(),this._renderStatus(),React.createElement("div",{className:"hc-spinner-container"},React.createElement(d["default"],{size:"small",spin:this.state.loading,zIndex:1})))),this._renderChildren())}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(190),o=n(i),s=a(313),r=n(s),l=a(314),u=n(l),c=function(e,t,a){return _.isUndefined(e.aui_icon)&&_.isUndefined(e[t])?new Error(t+" parameter is mandatory in IntegrationIcon"):void 0};t["default"]=React.createClass({displayName:"IntegrationIcon",propTypes:{icon:React.PropTypes.shape({url:c,"url@2x":c,aui_icon:React.PropTypes.string}).isRequired},mixins:[u["default"]],getInitialState:function(){return{error:!1}},componentDidMount:function(){$(ReactDOM.findDOMNode(this)).on("error",this._onError)},componentWillUnmount:function(){$(ReactDOM.findDOMNode(this)).off("error",this._onError)},_onError:function(){this.setState({error:!0})},render:function(){if(_.get(this.props.icon,"aui_icon")){var e=(0,r["default"])("aui-icon",this.props.icon.aui_icon);return React.createElement("span",{className:e})}var t=void 0;return t=this.state.error?o["default"].get("asset_base_uri")+"assets/svgs/fail_avatar.svg":HC.resolution>1?_.get(this.props.icon,"url@2x"):_.get(this.props.icon,"url"),React.createElement("img",{className:"aui-icon",src:t})}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(196),o=n(i),s=a(265),r=n(s),l=a(313),u=n(l),c=a(264),d=n(c),f=a(437),h=n(f),p=a(277),_=n(p);t["default"]=React.createClass({displayName:"AddIntegrationsGlance",_dismissAction:function(e){e.stopPropagation(),o["default"].roomIntegrationsGlanceDismissed(),r["default"].addRoomToIntegrationDiscoveryIgnoreList(this.props.room_id),_["default"].showAddIntegrationsHelperDialog({anchor:document.getElementById("hc-integrations-link")})},_openIntegrationsPage:function(){o["default"].roomIntegrationsGlanceClicked(),d["default"].openIntegrationsWindow()},render:function(){var e=(0,u["default"])({"hc-integration-advertisement":!0,"hc-glance":!0,clickable:!0});return React.createElement("div",{className:e},React.createElement("div",{className:"aui-nav-item",onClick:this._openIntegrationsPage},React.createElement("div",{className:"hc-glance-content"},React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-add"}),React.createElement("div",{className:"hc-glance-label"},h["default"].add_integrations,React.createElement("a",{"data-aui-trigger":!0,onClick:this._dismissAction,className:"hc-discovery-glance-close aui-icon aui-icon-small aui-iconfont-remove"})),React.createElement("div",{className:"hc-glance-status"}))))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(413),o=n(i),s=a(546),r=n(s),l=a(436),u=n(l),c=a(161),d=n(c),f=a(329),h=n(f),p=a(99),m=n(p),g=a(314),v=n(g),y=a(425),b=n(y),w=a(437),R=n(w),k=a(121),E=n(k);t["default"]=React.createClass({displayName:"RightSideBarIntegrationView",propTypes:{hideIntegrationView:React.PropTypes.func.isRequired,integration:React.PropTypes.shape({full_key:React.PropTypes.string.isRequired,addon_key:React.PropTypes.string.isRequired,key:React.PropTypes.string.isRequired,name:React.PropTypes.string.isRequired}).isRequired,room_id:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.number]),glance:React.PropTypes.shape({name:React.PropTypes.string.isRequired,full_key:React.PropTypes.string.isRequired,addon_key:React.PropTypes.string.isRequired,key:React.PropTypes.string.isRequired,icon:React.PropTypes.object.isRequired,query_url:React.PropTypes.string,target:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.object])}),url_template_values:React.PropTypes.object,init_event:React.PropTypes.object,loading:React.PropTypes.bool},mixins:[v["default"]],getInitialState:function(){var e=d["default"].get("theme");return _.extend({signed_url_loading:!0,frame_loading:!0,theme:e},this._getState())},componentDidMount:function(){u["default"].onIntegrationViewStatusChange(this.props.room_id,this.props.integration.full_key,this._onChange),d["default"].on("change:theme",this._onChange)},componentWillUnmount:function(){u["default"].offIntegrationViewStatusChange(this.props.room_id,this.props.integration.full_key,this._onChange),d["default"].off("change:theme",this._onChange)},_renderStaticHeader:function(){return React.createElement(r["default"],{glance:this.props.integration,room_id:this.props.room_id})},render:function(){var e=void 0;return e=_.isObject(this.props.glance)?React.createElement(r["default"],{glance:this.props.glance,room_id:this.props.room_id}):this._renderStaticHeader(),React.createElement("div",{className:"hc-integration-view-sidebar"},React.createElement("div",{className:"hc-integration-sidebar-header"},React.createElement("div",{className:"hc-integration-view-name"},e,React.createElement("span",{ref:"close_button",onClick:this.props.hideIntegrationView,className:"aui-icon aui-icon-small aui-iconfont-close-dialog close"}))),React.createElement(h["default"],{spin:this._loading(),zIndex:1,delay:this._spinnerDelay()}),this._content())},_loading:function(){return this.props.integration.internal?this.props.loading:this.state.signed_url_loading||this.state.signed_url&&this.state.frame_loading},_content:function(){return this.state.is_error?React.createElement("div",{className:"hc-integrations-error"},React.createElement("div",{className:"hc-integrations-error-image"}),React.createElement("p",null,R["default"].integration_failed_to_load),React.createElement("button",{onClick:this._retryLoadingPanel,className:"aui-button aui-button-primary"},R["default"].retry)):!this.props.integration.internal&&this.state.signed_url?this._renderIntegrationFrame():this.props.integration.internal?this.props.children:null},_renderIntegrationFrame:function(){var e=m["default"].appendQueryParameter(this.state.signed_url,"theme",this.state.theme);return React.createElement(o["default"],{integration:this.props.integration,signed_url:e,room_id:this.props.room_id,init_event:this.props.init_event})},_onChange:function(){this.setState(this._getState())},_getState:function(){var e=d["default"].get("theme"),t=u["default"].getIntegrationViewStatus(this.props.room_id,this.props.integration.full_key)||{};return t.theme=e,t},_retryLoadingPanel:function(){this.state.is_error&&b["default"].fetchSignedUrl(this.props.integration,this.props.room_id,this.state.url_template_values)},_spinnerDelay:function(){var e=this.state.signed_url&&this.state.frame_loading&&"none"===this.props.integration.authentication;return e?E["default"].integrations.spinner_delay:0}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(190),o=n(i),s=a(437),r=n(s),l=a(314),u=n(l),c=a(95),d=n(c),f=a(196),h=n(f),p=a(267),_=n(p);t["default"]=React.createClass({displayName:"IntegrationsConfigureButton",mixins:[u["default"]],getInitialState:function(){return this._getState()},componentDidMount:function(){o["default"].on(["change:web_server","change:current_user"],this._onChange)},componentWillUnmount:function(){o["default"].off(["change:web_server","change:current_user"],this._onChange)},_getState:function(){var e=o["default"].get("current_user");return{user_id:e.user_id,web_server:o["default"].get("web_server")}},_onChange:function(){this.setState(this._getState())},_onIntegrationsClick:function(){var e=_["default"].get("chat");d["default"].showIntegrationsManagementDialog({jid:e.jid,room_name:e.name}),h["default"].roomIntegrationsLinkClicked()},render:function(){return React.createElement("div",{className:"hc-integration-sidebar-footer hc-integrations-configure-button"},React.createElement("div",null,React.createElement("a",{id:"hc-integrations-link",onClick:this._onIntegrationsClick,target:"_blank",className:"aui-nav-item"},React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-configure "}),React.createElement("span",null,r["default"].configure_integrations))))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(99),o=n(i),s=a(483),r=n(s),l=a(161),u=n(l),c=a(271),d=n(c),f=a(169),h=n(f),p=a(552),m=n(p),g=a(553),v=n(g),y=a(313),b=n(y);e.exports=React.createClass({displayName:"RightSideBarRosterMini",propTypes:{max_items_to_render:React.PropTypes.number,force_update:React.PropTypes.bool},getDefaultProps:function(){return{max_items_to_render:32,force_update:!1}},getInitialState:function(){return _.assign(this._getState(),{hide_expander:!1,capacity:0})},_getContainerWidth:function(){var e=this.refs.roster_mini_container;return e?e.offsetWidth:0},_getItemWidth:function(){var e=this.refs.roster_mini_container;return!e||e.childNodes.length<1?0:e.childNodes[0].offsetWidth},_getCapacity:function(){var e=this._getContainerWidth();if(0!==e){var t=this._getItemWidth();if(0!==t){var a=Math.max(1,Math.floor(e/t));return 2*a}}},_getNumberOfPeopleToShow:function(){if(!this.state.capacity)return 0;var e=this.props.max_items_to_render<this.state.capacity?this.props.max_items_to_render:this.state.capacity;return Math.max(0,this.state.total_number_of_people<=e?this.state.total_number_of_people:e-1)},_shouldTheListBeTrimmed:function(){return this.state.capacity?this.props.max_items_to_render<this.state.capacity&&this.props.max_items_to_render<this.state.total_number_of_people:!1},_isRightSideBarWidthChanging:function(){return r["default"].get("rightSidebarVisibleWidthIsChanging")},_reOrderExpander:function(){var e=this._getCapacity(),t=this._isRightSideBarWidthChanging();this.setState(_.assign(this._getState(),{hide_expander:t,capacity:e}))},componentDidMount:function(){d["default"].on(["change:participants","change:admins"],this._onChange),u["default"].on(["change:rightColumnWidth"],this._reOrderExpander),r["default"].on(["change:rightSidebarVisibleWidthIsChanging"],this._reOrderExpander),this._reOrderExpander()},componentDidUpdate:function(){this._reOrderExpander()},componentWillUnmount:function(){d["default"].off(["change:participants","change:admins"],this._onChange),u["default"].off(["change:rightColumnWidth"],this._reOrderExpander),r["default"].off(["change:rightSidebarVisibleWidthIsChanging"],this._reOrderExpander)},shouldComponentUpdate:function(e,t){return this.props.force_update||e.max_items_to_render!==this.props.max_items_to_render||!_.isEqual(t.admins,this.state.admins)||!_.isEqual(t.all_people_to_show,this.state.all_people_to_show)||t.total_number_of_people!==this.state.total_number_of_people||t.hide_expander!==this.state.hide_expander||t.capacity!==this.state.capacity;
},_getState:function(){return{admins:d["default"].get("admins"),should_animate_gif_avatars:!h["default"].get("feature_flags").web_client_freeze_gifs,all_people_to_show:this.getAllPeopleFromStore(),total_number_of_people:this.getNumberOfPeopleFromStore()}},_onChange:function(){this.setState(this._getState())},_isAdmin:function(e){return o["default"].user.is_admin(this.state.admins,!1,e)},_copyUser:function(e){return{id:e.id,user_id:e.user_id,jid:e.jid,presence:{show:e.presence?e.presence.show:void 0,status:e.presence?e.presence.status:void 0},name:e.name,mention_name:e.mention_name,photo_url:e.photo_url,subscription:e.subscription}},getAllPeopleFromStore:function(){return d["default"].getSortedRosterByPresenceAndName(["members","guests"]).slice(0,this.props.max_items_to_render).map(this._copyUser)},getNumberOfPeopleFromStore:function(){return d["default"].getRosterCount(["members","guests"]).total},render:function(){var e=this,t=(0,b["default"])({"roster-wrap":!0}),a=(0,b["default"])({"hc-roster-mini":!0,"hc-sidebar-noscroll":!0}),n=this._getNumberOfPeopleToShow(),i=this._shouldTheListBeTrimmed(),o=0;return React.createElement("div",{className:t},React.createElement("div",{className:a},React.createElement("div",{ref:"roster_mini_container",className:"roster-mini-flex-list roster_mini_container","data-skate-ignore":!0},_.map(this.state.all_people_to_show,function(t){if(i&&o>=n)return!1;var a=n>o?"show":"overflow";return o++,React.createElement(v["default"],{size:"small",order:a,key:o,user_is_admin:e._isAdmin(t),user_name:t.name,user_mention_name:t.mention_name,user_presence_show:t.presence.show,user_presence_status:t.presence.status,user_photo_url:t.photo_url,user_jid:t.jid,user_id:t.id,shouldAnimate:e.state.should_animate_gif_avatars})}),React.createElement(m["default"],{size:"small",total_number_of_people:this.state.total_number_of_people,number_of_people_visible:n,hide:this.state.hide_expander}))))}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(314),o=n(i);t["default"]=React.createClass({displayName:"RosterMiniExpander",mixins:[o["default"]],propTypes:{size:React.PropTypes.string,hide:React.PropTypes.bool,total_number_of_people:React.PropTypes.number,number_of_people_visible:React.PropTypes.number},getDefaultProps:function(){return{size:"small",hide:!1,total_number_of_people:0,number_of_people_visible:0}},_getNumberToShow:function(){var e=Math.max(0,this.props.total_number_of_people-this.props.number_of_people_visible);return e>99?"99+":e.toString()},render:function(){if(this.props.hide)return!1;if(0===this.props.number_of_people_visible||0===this.props.total_number_of_people)return!1;if(this.props.number_of_people_visible>=this.props.total_number_of_people)return!1;var e="aui-avatar aui-avatar-project aui-avatar-"+this.props.size;return React.createElement("div",{className:"hc-roster-mini-expander","data-order":"expander"},React.createElement("span",{className:e},React.createElement("span",{className:"aui-avatar-inner"},React.createElement("div",{className:"hc-default-avatar"},this._getNumberToShow()))))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(310),o=n(i),s=a(510),r=n(s),l=a(314),u=n(l);t["default"]=React.createClass({displayName:"RosterMiniItem",mixins:[u["default"]],propTypes:{size:React.PropTypes.string,order:React.PropTypes.string,user_is_admin:React.PropTypes.bool,user_name:React.PropTypes.string.isRequired,user_mention_name:React.PropTypes.string.isRequired,user_presence_show:React.PropTypes.string,user_presence_status:React.PropTypes.string,user_photo_url:React.PropTypes.string,user_jid:React.PropTypes.string,user_id:React.PropTypes.oneOfType([React.PropTypes.number,React.PropTypes.string]),shouldAnimate:React.PropTypes.bool},getDefaultProps:function(){return{size:"small",order:"show",user_is_admin:!1,user_presence_show:"unknown",user_presence_status:""}},_getTooltip:function(){return r["default"].get_user_tooltip_flat(this.props.user_name,this.props.user_mention_name,this.props.user_is_admin,this.props.user_presence_show,this.props.user_presence_status)},_getAvatar:function(){return React.createElement(o["default"],{avatar_url:this.props.user_photo_url,presence:this.props.user_presence_show,name:this.props.user_name,size:this.props.size,shouldAnimate:this.props.shouldAnimate,uid:this.props.user_id})},render:function(){var e=this._getAvatar(),t=this._getTooltip();return React.createElement("div",{ref:"person",key:"user-"+this.props.user_id,className:"hc-roster-mini-item","data-order":this.props.order,"data-status":this.props.user_presence_show,"data-name":this.props.user_name,"aria-label":t},e)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){var e=c["default"].get("chat"),t=e.presence||{};return{type:c["default"].get("type"),initialized:c["default"].get("initialized"),path_prefix:c["default"].get("path_prefix"),name:e.name,jid:c["default"].get("active_chat"),room_id:e.id,privacy:e.privacy,topic:e.topic,guest_url:e.guest_url,is_archived:e.is_archived,title:e.title,photo_large:e.photo_large,loading_profile:e.loading_profile,presence_status:t.status,presence_show:t.show,mention_name:e.mention_name,time:e.time,email:e.email,active_chat:c["default"].get("active_chat"),do_emoticons:f["default"].shouldReplaceTextEmoticons(),should_animate_avatar:f["default"].shouldAnimateAvatars(),groupchat_active_panel:f["default"].getGroupChatActivePanel(),groupchat_show_sidebar:f["default"].shouldShowGroupChatSidebar(),chat_active_panel:f["default"].getChatActivePanel(),chat_show_sidebar:f["default"].shouldShowChatSidebar(),topic_editing:c["default"].get("topic_editing"),topic_input_value:e.topic,can_create_room:p["default"].canCreateRoom(),can_manage_room_integrations:p["default"].canManageRoomIntegrations(),can_view_guest_access:p["default"].canViewGuestAccess(),can_toggle_guest_access:p["default"].canToggleGuestAccess(),read_only_mode:m["default"].get("read_only_mode"),video_enabled:c["default"].get("video_enabled"),user_is_admin:p["default"].get("user_is_room_admin"),per_room_notifications_enabled:c["default"].get("per_room_notifications_enabled"),web_client_integrations_enabled:c["default"].get("web_client_integrations_enabled"),web_client_addlive_video_enabled:c["default"].get("web_client_addlive_video_enabled"),web_client_enso_video_enabled:c["default"].get("web_client_enso_video_enabled"),web_client_enso_room_video_enabled:c["default"].get("web_client_enso_room_video_enabled"),show_integrations_warning_icon:v["default"].get("should_show_warning_icon")}}var o=a(555),s=n(o),r=a(563),l=n(r),u=a(267),c=n(u),d=a(161),f=n(d),h=a(269),p=n(h),_=a(334),m=n(_),g=a(421),v=n(g),y=a(314),b=n(y),w=["change:should_show_warning_icon"];e.exports=React.createClass({displayName:"ChatHeader",mixins:[b["default"]],getInitialState:function(){return i()},componentDidMount:function(){c["default"].on("change",this._onChange),f["default"].on("change",this._onChange),p["default"].on("change",this._onChange),v["default"].on(w,this._onChange)},componentWillUnmount:function(){c["default"].off("change",this._onChange),f["default"].off("change",this._onChange),p["default"].off("change",this._onChange),v["default"].off(w,this._onChange)},_onChange:function(){this.setState(i())},_getHeader:function(){return"chat"===this.state.type?React.createElement(l["default"],{photo_large:this.state.photo_large,jid:this.state.jid,id:this.state.room_id,active_panel:this.state.chat_active_panel,show_sidebar:this.state.chat_show_sidebar,name:this.state.name,mention_name:this.state.mention_name,loading_profile:this.state.loading_profile,presence_status:this.state.presence_status,presence_show:this.state.presence_show,time:this.state.time,email:this.state.email,title:this.state.title,video_enabled:this.state.video_enabled,should_animate_avatar:this.state.should_animate_avatar,read_only_mode:this.state.read_only_mode,web_client_enso_video_enabled:this.state.web_client_enso_video_enabled,web_client_addlive_video_enabled:this.state.web_client_addlive_video_enabled,web_client_integrations_enabled:this.state.web_client_integrations_enabled}):"groupchat"===this.state.type?React.createElement(s["default"],{name:this.state.name,jid:this.state.jid,path_prefix:this.state.path_prefix,room_id:this.state.room_id,privacy:this.state.privacy,type:this.state.type,guest_url:this.state.guest_url,is_archived:this.state.is_archived,topic:this.state.topic,initialized:this.state.initialized,topic_editing:this.state.topic_editing,topic_input_value:this.state.topic_input_value,active_panel:this.state.groupchat_active_panel,show_sidebar:this.state.groupchat_show_sidebar,do_emoticons:this.state.do_emoticons,is_guest:this.props.is_guest,can_create_room:this.state.can_create_room,can_view_guest_access:this.state.can_view_guest_access,can_toggle_guest_access:this.state.can_toggle_guest_access,can_manage_room_integrations:this.state.can_manage_room_integrations,per_room_notifications_enabled:this.state.per_room_notifications_enabled,user_is_admin:this.state.user_is_admin,video_enabled:this.state.video_enabled,read_only_mode:this.state.read_only_mode,web_client_enso_video_enabled:this.state.web_client_enso_video_enabled,web_client_enso_room_video_enabled:this.state.web_client_enso_room_video_enabled,web_client_integrations_enabled:this.state.web_client_integrations_enabled,show_integrations_warning_icon:this.state.show_integrations_warning_icon}):React.createElement("div",null)},render:function(){var e=this._getHeader();return React.createElement("header",{className:"aui-page-header room-header"},e)}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(556),o=n(i),s=a(557),r=n(s),l=a(99),u=n(l),c=a(285),d=n(c),f=a(172),h=n(f),p=a(268),m=n(p),g=a(313),v=n(g),y=a(110),b=n(y),w=a(314),R=n(w),k=a(562),E=n(k),C=a(329),S=n(C),T=a(196),x=n(T);t["default"]=React.createClass({displayName:"GroupChatHeader",mixins:[R["default"]],propTypes:{do_emoticons:React.PropTypes.bool},componentDidUpdate:function(){b["default"]._replaceSpecials(ReactDOM.findDOMNode(this))},_getTopic:function(){var e;return e=this.props.topic_editing?this._getTopicInput():this._getTopicText()},_getTopicInput:function(){return React.createElement(o["default"],{topic_input_value:this.props.topic_input_value})},_getTopicText:function(){var e,t,a=this.props.is_guest?"":m["default"].default_topic;return null===this.props.topic?e=React.createElement("div",{className:"topic-spinner"},React.createElement(S["default"],{size:"small",spin:!0,left:"0",top:"0"})):""===this.props.topic?e=React.createElement("i",{className:"hc-page-header-topic",onDoubleClick:this._onTopicDoubleClick},a):(t=u["default"].escapeAndLinkify(this.props.topic,{escape_whitespace:!0,do_word_breaks:!1,do_emoticons:this.props.do_emoticons&&this.props.initialized}),e=React.createElement("div",{className:"hc-page-header-topic",title:this.props.topic,onClick:this._onClick,onDoubleClick:this._onTopicDoubleClick,onCopy:this._onCopy,dangerouslySetInnerHTML:{__html:"<span>"+t+"</span>"}})),e},_onCopy:function(){u["default"].link.identify_invite_link(window.getSelection().toString())&&x["default"].userInviteURLCopied()},_onClick:function(e){var t="a"===_.get(e,"target.tagName","").toLowerCase(),a=_.get(e,"target.href",null),n=this.props.jid,i=this.props.room_id;!this.props.is_guest&&t&&a&&u["default"].video.isVideoLink(a)&&(e.preventDefault(),h["default"].joinRoomVideoCall({url:a,jid:n,room_id:i}))},_onTopicDoubleClick:function(){this.props.is_guest||d["default"].editTopicInChatHeader()},_getGroupChatButtons:function(){return React.createElement(r["default"],this.props)},_getGuestAccessLozenge:function(){return this.props.guest_url?React.createElement("span",{id:"guest_access",className:"guest-access-lozenge aui-lozenge aui-lozenge-complete aui-lozenge-subtle",onMouseOver:this._showGuestAccessInformation},m["default"].guest_access_on):null},_showGuestAccessInformation:function(){E["default"].showGuestAccessInformation({anchor:document.getElementById("guest_access"),guest_url:this.props.guest_url})},render:function(){var e=(0,v["default"])({"aui-page-header-main":!0,"hc-page-header-main":!0,"hc-integrations-enabled":this.props.web_client_integrations_enabled}),t=(0,v["default"])({"aui-icon":!0,"hipchat-icon-huge":!0,"icon-private":"private"===this.props.privacy,"icon-public":"public"===this.props.privacy,"icon-dot":!this.props.privacy}),a=this._getTopic(),n=this._getGroupChatButtons(),i=this._getGuestAccessLozenge();return React.createElement("div",{className:"aui-page-header-inner hc-groupchat"},React.createElement("div",{className:"page-header-icon"},React.createElement("span",{className:t})),React.createElement("div",{className:e},React.createElement("div",{className:"hc-groupchat-header"},React.createElement("h3",null,this.props.name),i,React.createElement("br",null)),a),n)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(285),o=n(i),s=a(121),r=n(s),l=a(313),u=n(l),c=a(314),d=n(c),f=a(108),h=n(f),p=a(196),_=n(p);t["default"]=React.createClass({displayName:"TopicInput",mixins:[d["default"]],componentDidMount:function(){ReactDOM.findDOMNode(this.refs.topicInput).select(),document.addEventListener("click",this._onBlur)},componentWillUnmount:function(){document.removeEventListener("click",this._onBlur)},getInitialState:function(){return{topic_editing_value:null}},_handleTopicSubmit:function(e){e.preventDefault(),null!==this.state.topic_editing_value&&this._setTopic(),this._dismissTopicEdit()},_onKeydown:function(e){27===e.keyCode&&this._dismissTopicEdit()},_onKeyPressCancel:function(e){13===e.keyCode&&this._dismissTopicEdit()},_onBlur:function(e){var t=$(e.target);t.is(".change-topic-action > a")||this._dismissTopicEdit()},_preventBubbling:function(e){e.nativeEvent.stopImmediatePropagation()},_setTopic:function(){o["default"].changeTopic(this.state.topic_editing_value),this.state.topic_editing_value=null},_dismissTopicEdit:function(){this.topic_editing_value=null,o["default"].dismissTopicEdit()},_onValueChange:function(e){this.setState({topic_editing_value:e.target.value})},_onCopy:function(){h["default"].identify_invite_link(window.getSelection().toString())&&_["default"].userInviteURLCopied()},render:function(){var e=null!==this.state.topic_editing_value?this.state.topic_editing_value:this.props.topic_input_value,t=(0,u["default"])({text:!0,"topic-edit-input":!0,mousetrap:!0});return React.createElement("form",{ref:"topicForm",className:"aui",onSubmit:this._handleTopicSubmit,onKeyDown:this._onKeydown,onClick:this._preventBubbling},React.createElement("input",{type:"text",ref:"topicInput",id:"topic-input",maxLength:r["default"].max_topic_text_length,className:t,value:e,onCopy:this._onCopy,onChange:this._onValueChange}),React.createElement("button",{id:"topic-submit-btn",type:"submit",className:"aui-button"},React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-success"},"Success ")),React.createElement("button",{id:"topic-cancel-btn",type:"button",className:"aui-button",onKeyDown:this._onKeyPressCancel,onClick:this._dismissTopicEdit},React.createElement("span",{className:"aui-icon hipchat-icon-xsmall hc-close-icon icon-close"},"Close ")))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(268),o=n(i),s=a(285),r=n(s),l=a(558),u=n(l),c=a(560),d=n(c),f=a(333),h=n(f),p=a(332),_=n(p),m=a(314),g=n(m),v=a(99),y=n(v),b=a(313),w=n(b),R=React.PropTypes;t["default"]=React.createClass({displayName:"GroupChatHeaderButtons",mixins:[g["default"]],propTypes:{jid:R.string,name:R.string,guest_url:R.string,room_id:R.oneOfType([R.string,R.number]),privacy:R.string,type:R.string,active_panel:R.string,is_guest:R.bool,show_sidebar:R.bool,read_only_mode:R.bool,user_is_admin:R.bool,per_room_notifications_enabled:R.bool,can_create_room:R.bool,can_view_guest_access:R.bool,can_toggle_guest_access:R.bool,can_manage_room_integrations:R.bool,web_client_integrations_enabled:R.bool,web_client_enso_video_enabled:R.bool,web_client_enso_room_video_enabled:R.bool,show_integrations_warning_icon:React.PropTypes.bool},_startEnsoRoomVideo:function(){r["default"].startEnsoRoomVideo({jid:this.props.jid,room_id:this.props.room_id,name:this.props.name})},_selectPanel:function(e){this._clearButtonFocus(),r["default"].handlePanelSelect({type:e,room:this.props.jid})},_clearButtonFocus:function(){for(var e=ReactDOM.findDOMNode(this).querySelectorAll(".aui-button"),t=0;t<e.length;t++)e[t].blur()},_getDropDown:function(){return React.createElement(h["default"],{className:"aui-dropdown2-in-header",dropdownID:"room-actions-drop-down"},React.createElement(u["default"],this.props))},_getActionsButton:function(){var e=(0,w["default"])({"aui-button":!0,"aui-button-light":!0,"notification-badge":this.props.show_integrations_warning_icon});return React.createElement(_["default"],{id:"room-actions-btn",dropdownID:"room-actions-drop-down",className:e,arrowless:!0,"aria-label":o["default"].room_actions},React.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-more"},o["default"].room_actions))},_getNotificationIcon:function(){return this.props.per_room_notifications_enabled&&!this.props.is_guest?React.createElement(d["default"],{jid:this.props.jid,room_name:this.props.name}):null},_getVideoButton:function(){var e=y["default"].room.is_archived(this.props),t=e||this.props.read_only_mode;return this.props.web_client_enso_video_enabled&&this.props.web_client_enso_room_video_enabled&&!this.props.is_guest?React.createElement("button",{ref:"video_btn",className:"hc-video-call-btn-link aui-button aui-button-light",title:o["default"].video_call,onClick:this._startEnsoRoomVideo,disabled:t,"data-no-focus":!0},React.createElement("span",{className:"aui-icon hipchat-icon-small icon-camera-no-slash"},o["default"].video_call)):null},_getButtonTitle:function(e,t){return this.props.show_sidebar&&this.props.active_panel===e?o["default"]["hide_"+t]:o["default"]["show_"+t]},_renderButton:function(e,t,a){var n=this.props.active_panel===t&&this.props.show_sidebar?"active":"",i=this._getButtonTitle(t,e);return React.createElement("button",{ref:t+"_btn",className:"hc-"+t+"-btn-link aui-button aui-button-light "+n,onClick:this._selectPanel.bind(null,t),"aria-label":i},React.createElement("span",{className:"aui-icon "+a},o["default"][t]))},_getWebClientIntegrationsButtons:function(){var e=this._getNotificationIcon(),t=this.props.video_enabled?this._getVideoButton():null,a=this._renderButton("sidebar","integrations","hipchat-icon-small icon-integrations"),n=this.props.is_guest?!1:this._getActionsButton();return React.createElement("div",null,e,React.createElement("div",{className:"aui-buttons"},t),React.createElement("div",{className:"aui-buttons"},a,n))},_getButtons:function(){var e=this._getNotificationIcon(),t=this._getVideoButton(),a=this._renderButton("roster","roster","aui-icon-small aui-iconfont-user"),n=this._renderButton("files","files","hipchat-icon-small icon-file"),i=this._renderButton("links","links","hipchat-icon-small icon-link"),o=this.props.is_guest?!1:this._getActionsButton();return React.createElement("div",null,e,React.createElement("div",{className:"aui-buttons"},t),React.createElement("div",{className:"aui-buttons"},a,n,i),React.createElement("div",{className:"aui-buttons"},o))},render:function(){var e=(0,w["default"])({"aui-page-header-actions":!0,"hc-chat-header-actions":!0,"hc-integrations-chat-header-actions":this.props.web_client_integrations_enabled}),t=this.props.is_guest?!1:this._getDropDown(),a=this.props.web_client_integrations_enabled?this._getWebClientIntegrationsButtons():this._getButtons();return React.createElement("div",{className:e,ref:"actions"},a,t)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(95),o=n(i),s=a(196),r=n(s),l=a(268),u=n(l),c=a(287),d=n(c),f=a(99),h=n(f),p=a(169),_=n(p),m=a(559),g=n(m),v=a(320),y=n(v),b=a(197),w=n(b),R=a(204),k=n(R),E=a(203);t["default"]=React.createClass({displayName:"RoomDropDown",propTypes:{jid:React.PropTypes.string,name:React.PropTypes.string,guest_url:React.PropTypes.string,room_id:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.number]),privacy:React.PropTypes.string,is_archived:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.bool]),user_is_admin:React.PropTypes.bool,read_only_mode:React.PropTypes.bool,per_room_notifications_enabled:React.PropTypes.bool,can_view_guest_access:React.PropTypes.bool,can_toggle_guest_access:React.PropTypes.bool,can_manage_room_integrations:React.PropTypes.bool,show_integrations_warning_icon:React.PropTypes.bool},getInitialState:function(){return this._getState()},_getState:function(){return{user_id:_["default"].get("user_id"),web_server:_["default"].get("web_server")}},componentDidMount:function(){_["default"].on(["change:user_id","change:web_server"],this._onChange)},componentWillUnmount:function(){_["default"].off(["change:user_id","change:web_server"],this._onChange)},_onChange:function(){this.setState(this._getState())},_onRoomNotificationsClick:function(){o["default"].showRoomNotificationsDialog({jid:this.props.jid,room_name:this.props.name}),r["default"].roomNotificationDropdownClicked()},_onArchiveRoomClick:function(){o["default"].showArchiveRoomDialog({archive:!0})},_onUnarchiveRoomClick:function(){o["default"].showArchiveRoomDialog({archive:!1})},_onInviteUserClick:function(){o["default"].showInviteUsersDialog({type:w["default"].ROOM_MENU}),r["default"].roomMenuInviteClicked()},_onRemoveUserClick:function(){o["default"].showRemoveUsersDialog()},_onChangeTopicClick:function(){d["default"].editTopic()},_onChangePrivacyClick:function(){o["default"].showRoomPrivacyDialog({jid:this.props.jid,name:this.props.name,privacy:this.props.privacy})},_onRenameRoomClick:function(){o["default"].showRenameRoomDialog({jid:this.props.jid,name:this.props.name})},_onDeleteRoomClick:function(){o["default"].showDeleteRoomDialog({jid:this.props.jid,room_id:this.props.room_id,name:this.props.name})},_onEnableGuestClick:function(){d["default"].enableGuestAccess({jid:this.props.jid},this._enableGuestCallback)},_enableGuestCallback:function(e){e&&this._throwFlagError(e.message||E.enable_guest_fail)},_throwFlagError:function(e){k["default"].showFlag({type:"error",body:e,close:"auto"})},_onDisableGuestClick:function(){o["default"].showDisableGuestAccessDialog()},_allowInviteUser:function(){return("public"===this.props.privacy||"private"===this.props.privacy&&this.props.user_is_admin)&&this._isNotArchived()},_allowRemoveUser:function(){return"private"===this.props.privacy&&this.props.user_is_admin&&this._isNotArchived()},_allowAdminOnUnarchived:function(){return this.props.user_is_admin&&this._isNotArchived()},_allowConfigureIntegrations:function(){return this.props.can_manage_room_integrations&&this._isNotArchived()},_isArchived:function(){return h["default"].room.is_archived({is_archived:this.props.is_archived})},_isNotArchived:function(){return!this._isArchived()},_archiveEnabled:function(){return this.props.user_is_admin&&this._isNotArchived()},_unarchiveEnabled:function(){return this.props.user_is_admin&&this._isArchived()},render:function(){var e=this._renderLink(u["default"].invite_users,this._allowInviteUser,this._onInviteUserClick),t=this._renderLink(u["default"].remove_users,this._allowRemoveUser,this._onRemoveUserClick),a=this._renderLink(u["default"].archive,this._archiveEnabled,this._onArchiveRoomClick),n=this._renderLink(u["default"].unarchive,this._unarchiveEnabled,this._onUnarchiveRoomClick),i=this._renderLink(u["default"].change_topic,this._isNotArchived,this._onChangeTopicClick),o=this._renderLink(u["default"].change_privacy,this._allowAdminOnUnarchived,this._onChangePrivacyClick),s=this._renderLink(u["default"]["delete"],this._allowAdminOnUnarchived,this._onDeleteRoomClick),r=this._renderLink(u["default"].rename,this._allowAdminOnUnarchived,this._onRenameRoomClick),l=this.props.per_room_notifications_enabled?this._getRoomNotificationsItem():!1,c=this._getIntegrationsItem(),d=this.props.can_view_guest_access,f=this.props.can_toggle_guest_access;return React.createElement("div",{role:"application",className:"groupchat-room-dropdown"},React.createElement(y["default"],null,React.createElement("ul",{role:"list"},l,c)),React.createElement(y["default"],null,React.createElement("ul",{role:"list"},React.createElement("li",{className:"invite-user-action",role:"listitem"},e),React.createElement("li",{className:"remove-user-action",role:"listitem"},t))),React.createElement(y["default"],null,React.createElement("ul",{role:"list"},React.createElement("li",{className:"enable-guest-action",role:"listitem"},React.createElement(g["default"],{type:"radio",interactive:!1,checked:!!this.props.guest_url&&d,disabled:!(f&&!this.props.guest_url)||this.props.read_only_mode,onCheck:this._onEnableGuestClick},u["default"].enable_guest)),React.createElement("li",{className:"disable-guest-action",role:"listitem"},React.createElement(g["default"],{type:"radio",interactive:!1,checked:!this.props.guest_url&&d,disabled:!(f&&this.props.guest_url)||this.props.read_only_mode,onCheck:this._onDisableGuestClick},u["default"].disable_guest)))),React.createElement(y["default"],null,React.createElement("ul",{role:"list"},React.createElement("li",{className:"archive-room-action",role:"listitem"},a),React.createElement("li",{className:"unarchive-room-action",role:"listitem"},n),React.createElement("li",{className:"change-topic-action",role:"listitem"},i),React.createElement("li",{className:"change-privacy-action",role:"listitem"},o),React.createElement("li",{className:"delete-room-action",role:"listitem"},s),React.createElement("li",{className:"rename-room-action",role:"listitem"},r))))},_renderLink:function(e,t,a){var n=t(),i=function(){t()&&a()};return React.createElement("a",{title:e,className:n?"":"disabled","aria-disabled":n?"false":"true",onClick:i},e)},_getRoomNotificationsItem:function(){return React.createElement("li",{className:"room-notifications",role:"listitem"},React.createElement("a",{title:u["default"].room_notifications,onClick:this._onRoomNotificationsClick},u["default"].room_notifications))},_onIntegrationsClick:function(){o["default"].showIntegrationsManagementDialog({jid:this.props.jid,room_name:this.props.name}),r["default"].roomIntegrationsDropdownClicked(this.props.show_integrations_warning_icon)},_getIntegrationsWarningIcon:function(){return React.createElement("span",{className:"hc-integration-warning-icon aui-icon aui-icon-small aui-iconfont-warning"})},_getIntegrationsItem:function(){var e=this.props.show_integrations_warning_icon?this._getIntegrationsWarningIcon():null;return React.createElement("li",{className:"integrations-user-action",role:"listitem"},React.createElement("a",{title:u["default"].integrations,onClick:this._onIntegrationsClick},u["default"].integrations,e))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(157),o=n(i),s=a(313),r=n(s);t["default"]=React.createClass({displayName:"AUIDropdown2InteractiveLink",propTypes:{type:React.PropTypes.oneOf(["checkbox","radio"]).isRequired,interactive:React.PropTypes.bool,checked:React.PropTypes.bool,disabled:React.PropTypes.bool,onCheck:React.PropTypes.func,onUncheck:React.PropTypes.func},getDefaultProps:function(){return{interactive:!0,checked:!1,disabled:!1,onCheck:_.noop,onUncheck:_.noop}},componentDidMount:function(){AJS.$(this.refs.link).on({"aui-dropdown2-item-check":this._onCheck,"aui-dropdown2-item-uncheck":this._onUncheck})},componentWillUnmount:function(){AJS.$(this.refs.link).off()},_onCheck:function(){this.props.disabled||this.props.onCheck()},_onUncheck:function(){this.props.disabled||this.props.onUncheck()},render:function(){var e,t={ref:"link",id:this.props.id||_.uniqueId(),"aria-disabled":this.props.disabled,className:(0,r["default"])((e={},(0,o["default"])(e,this.props.className,!!this.props.className),(0,o["default"])(e,"aui-dropdown2-radio","radio"===this.props.type),(0,o["default"])(e,"aui-dropdown2-checkbox","checkbox"===this.props.type),(0,o["default"])(e,"interactive",this.props.interactive),(0,o["default"])(e,"aui-dropdown2-checked",this.props.checked),(0,o["default"])(e,"checked",this.props.checked),(0,o["default"])(e,"disabled",this.props.disabled),e))};return React.createElement("a",t,this.props.children)}}),e.exports=t["default"]},function(e,t,a){"use strict";var n=a(161),i=a(164),o=a(561),s=a(95),r=a(196),l=a(190);e.exports=React.createClass({displayName:"NotificationIcon",getInitialState:function(){return this._getState()},componentDidMount:function(){n.on(["change:"+i.ROOM_NOTIFICATION_OVERRIDES],this._onChange),n.on(["change:"+i.GLOBAL_NOTIFICATION_SETTING],this._onChange),l.on(["change:active_chat"],this._onChange),this._createTooltip()},componentWillUnmount:function(){n.off(["change:"+i.ROOM_NOTIFICATION_OVERRIDES],this._onChange),n.off(["change:"+i.GLOBAL_NOTIFICATION_SETTING],this._onChange),l.off(["change:active_chat"],this._onChange),this._destroyTooltip()},componentDidUpdate:function(){this._destroyTooltip(),this._createTooltip()},_onChange:function(){this.isMounted()&&this.setState(this._getState())},_getState:function(){var e=l.get("active_chat"),t=_.get(n.getRoomNotificationOverrides(),e),a=_.get(t,"level",n.getGlobalNotificationSetting());return{level:a}},_launchRoomNotificationsDialog:function(){s.showRoomNotificationsDialog({jid:l.get("active_chat"),room_name:this.props.room_name}),r.roomNotificationIconClicked()},_getIcon:function(){var e="icon-volume-"+this.state.level,t="aui-icon hipchat-icon-small "+e,a=""+o.level_prefix+o.level[this.state.level];return React.createElement("div",{ref:"notif_icon",className:"hc-room-notif-icon",onClick:this._launchRoomNotificationsDialog},React.createElement("span",{className:t,"aria-label":a,ref:"icon"}))},_createTooltip:function(){AJS.$(ReactDOM.findDOMNode(this.refs.icon)).tooltip({offset:10})},_destroyTooltip:function(){AJS.$(ReactDOM.findDOMNode(this.refs.icon)).tooltip("destroy")},render:function(){return this._getIcon()}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(183),o=n(i);t["default"]={level_prefix:"Room notifications: ",level:{loud:o["default"].loud,normal:o["default"].normal,quiet:o["default"].quiet}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(277),o=n(i);t["default"]={showGuestAccessInformation:function(e){o["default"].showGuestAccessInformation(e)}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(564),o=n(i),s=a(310),r=n(s),l=a(311),u=n(l),c=a(268),d=n(c),f=a(99),h=n(f),p=a(313),_=n(p),m=a(314),g=n(m);e.exports=React.createClass({displayName:"OTOHeader",mixins:[g["default"]],_getTitle:function(){var e;return this.props.title&&(e=React.createElement("span",{className:"hc-oto-title"},this.props.title)),e},_getStatus:function(){var e;return e=this.props.loading_profile?d["default"].loading:this.props.presence_status||h["default"].user.chat_header_status(this.props.presence_show)},_getHeaderButtons:function(){return React.createElement(o["default"],{jid:this.props.jid,name:this.props.name,active_panel:this.props.active_panel,
show_sidebar:this.props.show_sidebar,video_enabled:this.props.video_enabled,read_only_mode:this.props.read_only_mode,web_client_enso_video_enabled:this.props.web_client_enso_video_enabled,web_client_addlive_video_enabled:this.props.web_client_addlive_video_enabled,web_client_integrations_enabled:this.props.web_client_integrations_enabled})},render:function(){var e=(0,_["default"])({hidden:this.props.loading_profile}),t=(0,_["default"])({hidden:this.props.loading_profile,"mention-name":!0}),a=this._getTitle(),n=this._getHeaderButtons(),i=this._getStatus();return React.createElement("div",{className:"aui-page-header-inner hc-priv-chat",key:"oto-header-"+this.props.jid},React.createElement(r["default"],{avatar_url:this.props.photo_large,size:"large",shouldAnimate:this.props.should_animate_avatar,show_presence:!1}),React.createElement("div",{className:"aui-page-header-main hc-page-header-main"},React.createElement("h3",null,this.props.name),"Â ",React.createElement("span",{className:t},"(@"+this.props.mention_name+")"),React.createElement("p",null,React.createElement(u["default"],{presence:this.props.presence_show,uid:this.props.id}),React.createElement("span",{className:"hc-oto-status"},i),React.createElement("span",{className:e},React.createElement("span",{className:"hc-oto-time"},this.props.time),a,React.createElement("a",{href:"mailto:"+this.props.email},this.props.email)))),n)}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(268),o=n(i),s=a(285),r=n(s),l=a(565),u=n(l),c=a(314),d=n(c);t["default"]=React.createClass({displayName:"OTOHeaderButtons",mixins:[d["default"]],_selectPanel:function(e){this._clearButtonFocus(),r["default"].handlePanelSelect({type:e,room:this.props.jid})},_clearButtonFocus:function(){for(var e=ReactDOM.findDOMNode(this).querySelectorAll(".aui-button"),t=0;t<e.length;t++)e[t].blur()},_getVideoButton:function(){return React.createElement(u["default"],{jid:this.props.jid,name:this.props.name,read_only_mode:this.props.read_only_mode,web_client_enso_video_enabled:this.props.web_client_enso_video_enabled,web_client_addlive_video_enabled:this.props.web_client_addlive_video_enabled})},_getButtonTitle:function(e,t){return this.props.show_sidebar&&this.props.active_panel===e?o["default"]["hide_"+t]:o["default"]["show_"+t]},_renderButton:function(e,t,a){var n=this.props.active_panel===t&&this.props.show_sidebar?"active":"",i=this._getButtonTitle(t,e);return React.createElement("button",{ref:t+"_btn",className:"hc-"+t+"-btn-link aui-button aui-button-light "+n,onClick:this._selectPanel.bind(null,t),"aria-label":i},React.createElement("span",{className:"aui-icon "+a},o["default"][t]))},render:function(){var e=this.props.video_enabled?this._getVideoButton():null,t=this.props.web_client_integrations_enabled?null:this._renderButton("files","files","hipchat-icon-small icon-file"),a=this.props.web_client_integrations_enabled?null:this._renderButton("links","links","hipchat-icon-small icon-link"),n=this.props.web_client_integrations_enabled?this._renderButton("sidebar","integrations","hipchat-icon-small icon-integrations"):null;return React.createElement("div",{className:"aui-page-header-actions hc-chat-header-actions",ref:"actions"},e,React.createElement("div",{className:"aui-buttons"},t,a,n))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(268),o=n(i),s=a(285),r=n(s),l=a(313),u=n(l),c=a(333),d=n(c),f=a(332),h=n(f),p=a(314),_=n(p),m=a(174),g=n(m);t["default"]=React.createClass({displayName:"OTOHeaderVideoButtons",mixins:[_["default"]],_startAddliveVideoCall:function(){r["default"].startCall({jid:this.props.jid,name:this.props.name,service:"addlive",audio_only:!1})},_startEnsoVideoCall:function(){r["default"].startCall({jid:this.props.jid,name:this.props.name,service:"enso",audio_only:!1})},_getVideoSelectButton:function(){return React.createElement(h["default"],{className:"hc-video-call-btn-link aui-button aui-button-light",dropdownID:"video-chat-service-menu",title:o["default"].video_call,"data-no-focus":"true"},React.createElement("span",{className:"aui-icon hipchat-icon-small icon-camera-no-slash"},o["default"].video_call))},_getStandardVideoButton:function(e){return React.createElement("button",{ref:"video_btn",className:"hc-video-call-btn-link aui-button aui-button-light",onClick:e===g["default"].ENSO?this._startEnsoVideoCall:this._startAddliveVideoCall,title:o["default"].video_call,disabled:this.props.read_only_mode,"data-no-focus":"true"},React.createElement("span",{className:"aui-icon hipchat-icon-small icon-camera-no-slash"},o["default"].video_call))},_getVideoChatButton:function(){var e=[this.props.web_client_addlive_video_enabled,this.props.web_client_enso_video_enabled],t=void 0;switch(e.indexOf(!1)){case-1:t=this._getVideoSelectButton();break;case 0:t=this._getStandardVideoButton(g["default"].ENSO);break;case 1:t=this._getStandardVideoButton(g["default"].ADDLIVE)}return t},_getVideoChatExpandMenu:function(){return React.createElement(d["default"],{dropdownID:"video-chat-service-menu"},React.createElement("div",{className:"aui-dropdown2-section"},React.createElement("ul",null,React.createElement("li",null,React.createElement("a",{ref:"menu_enso_video_btn",className:"hc-enso-service",target:"_blank",onClick:this._startEnsoVideoCall},o["default"].enso_video,React.createElement("span",{className:"aui-lozenge aui-lozenge-current hc-video-service-lozenge"},"Beta"))),React.createElement("li",null,React.createElement("a",{ref:"menu_video_btn",className:"hc-video-service",target:"_blank",onClick:this._startAddliveVideoCall},o["default"].hipchat_video)))))},render:function(){var e=this.props.web_client_enso_video_enabled&&this.props.web_client_addlive_video_enabled,t=void 0;e&&(t=this._getVideoChatExpandMenu());var a=(0,u["default"])({"aui-buttons":!0,"hc-video-btn-expands":e});return React.createElement("div",{className:a},React.createElement("div",null,this._getVideoChatButton()),t)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){return c["default"].getAll()}function o(){return{addon_avatars:f["default"].get("addon_avatars")}}function s(){return _.extend(o(),i())}var r=a(567),l=n(r),u=a(599),c=n(u),d=a(421),f=n(d),h=a(99),p=n(h),m=a(178),g=n(m),v=React.addons.PureRenderMixin;e.exports=React.createClass({displayName:"ChatPanel",mixins:[v],getInitialState:function(){return s()},componentDidMount:function(){c["default"].on(["change"],this._onChatStateChange);var e=0,t=this.state.chats&&_.get(this.state,'chats["'+this.state.active_chat+'"].participants.members');t&&(e=t.length),g["default"].chatPanelMounted({id:this.state.active_chat,size:e}),f["default"].on("change:addon_avatars",this._onAddonAvatarsChanged)},componentWillUnmount:function(){c["default"].off(["change"],this._onChatStateChange),f["default"].off("change:addon_avatars",this._onAddonAvatarsChanged)},render:function(){var e,t={zoom:this.state.zoom_level};return this.state.active_chat&&p["default"].jid.is_chat(this.state.active_chat)&&this.state.chats[this.state.active_chat]&&(e=React.createElement(l["default"],{key:this.state.active_chat,chat:this.state.chats[this.state.active_chat],is_guest:this.props.is_guest,initialized:this.state.initialized,web_server:this.state.web_server,token:this.state.oauth2_token,addon_avatars:this.state.addon_avatars})),React.createElement("div",{className:"hc-chat-panel",style:t},e)},_onChatStateChange:function(){this.setState(i())},_onAddonAvatarsChanged:function(){this.setState(o())}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(59),o=n(i),s=a(568),r=n(s),l=a(178),u=n(l),c=a(121),d=n(c),f=a(9),h=n(f),p=a(161),m=n(p),g=a(421),v=n(g),y=a(166),b=n(y),w=a(164),R=n(w),k=a(313),E=n(k),C=a(569),S=n(C),T=a(329),x=n(T),A=a(570),I=n(A),N=a(571),M=n(N),O=a(99),D=n(O),P=a(90),j=n(P);(0,S["default"])();var L=["change:"+b["default"].HIDE_GIFS_BY_DEFAULT,"change:"+b["default"].HIDE_ATTACHED_CARDS_BY_DEFAULT,"change:"+b["default"].SHOW_UNREAD_DIVIDER,"change:"+R["default"].CHAT_VIEW,"change:"+R["default"].THEME,"change:"+R["default"].HIDE_PRESENCE_MESSAGES,"change:"+R["default"].USE_24_HR_FORMAT,"change:"+R["default"].NAME_DISPLAY,"change:"+b["default"].ANIMATED_AVATARS];t["default"]=React.createClass({displayName:"ChatWindowMessageList",getInitialState:function(){return{initialized:!1,use24hrTime:m["default"].shouldUse24HrTime(),shouldHideGifs:m["default"].shouldHideGifsByDefault(),shouldHideAttachedCards:m["default"].shouldHideAttachedCardsByDefault(),should_animate_avatar:m["default"].shouldAnimateAvatars(),show_join_leave_messages:!m["default"].getHidePresenceMessages(),chat_view:m["default"].getChatView(),theme:m["default"].getTheme(),showUnreadDivider:m["default"].shouldShowUnreadMessageDivider(),nameDisplay:m["default"].getNameDisplay(),has_scrolled_initial:!1}},componentWillMount:function(){this._createDebounced()},componentDidUpdate:function(){this.is_scrolling||this.props.chat.scroll_frozen||this._isHistoryEmpty()||this.will_freeze||!this.state.has_scrolled_initial?(this.props.chat.scroll_frozen||this.props.chat.ancient_history_is_empty||this.will_freeze)&&this.debouncedUnfreezeAbove():this._setScroll()},componentDidMount:function(){var e=this;this.props.chat.isScrolledToBottom=!1,this.should_interrupt_autoscroll=!1,this.scroll_is_bound=!1,this.is_animating=!1,this.will_freeze=!1,this.is_scrolling=!1,this.scrollbox=ReactDOM.findDOMNode(this.refs.scrollbox),this.$scrollbox=$(this.scrollbox),this._throttledShouldSetScroll=_.throttle(this._shouldSetScroll,100),h["default"].register("add-chat-state-message",this._changeChatStateMessage),h["default"].register("remove-chat-state-message",this._changeChatStateMessage),h["default"].register("preserve-scroll-value",this._throttledShouldSetScroll),h["default"].register("update-scroll-position",this._updateScrollPosition),h["default"].register("select-panel",this.debouncedResize),h["default"].register("left-column-width-updated",this.debouncedResize),h["default"].register("right-column-width-updated",this.debouncedResize),h["default"].register("scroll-down-on-zoom",this._onZoom),m["default"].on(L,this._prefsChanged),this._handleScrollPosition(),this._handleFrozenScroll(),_.forEach(["click","mousewheel","DOMMouseScroll"],function(t){e.scrollbox.addEventListener(t,e.debouncedOnUserAction)}),$(window).on("resize",this.debouncedResize),$(document).on("keydown",this.debouncedKeyDown)},componentWillUnmount:function(){var e=this;u["default"].setScrollValue({scrollTop:ReactDOM.findDOMNode(this).scrollTop,should_scroll_to_bottom:this.props.chat.should_scroll_to_bottom,isScrolledToBottom:this._isScrolledToBottom(),jid:this.props.chat.jid}),h["default"].unregister("add-chat-state-message",this._changeChatStateMessage),h["default"].unregister("remove-chat-state-message",this._changeChatStateMessage),h["default"].unregister("preserve-scroll-value",this._throttledShouldSetScroll),h["default"].unregister("update-scroll-position",this._updateScrollPosition),h["default"].unregister("select-panel",this.debouncedResize),h["default"].unregister("left-column-width-updated",this.debouncedResize),h["default"].unregister("right-column-width-updated",this.debouncedResize),h["default"].unregister("scroll-down-on-zoom",this._onZoom),m["default"].off(L,this._prefsChanged),u["default"].chatStoppedScroll(this.props.chat.jid),_.forEach(["click","mousewheel","DOMMouseScroll"],function(t){e.scrollbox.removeEventListener(t,e.debouncedOnUserAction)}),$(window).off("resize",this.debouncedResize),$(document).off("keydown",this.debouncedKeyDown),this.imageLoad&&clearTimeout(this.imageLoad),this.debouncedUnfreezeAbove.cancel(),this.debouncedUnfreezeBelow.cancel(),this.debouncedFreezeAbove.cancel(),this.debouncedFreezeBelow.cancel(),this.debouncedResize.cancel(),this.debouncedOnUserAction.cancel(),this.throttledSetScrollPosition.cancel(),this._unbindScroll(),clearTimeout(this.imageLoadTimeout)},_onKeyDown:function(e){if(!this.is_scrolling&&!this.props.chat.scroll_frozen){var t=this.scrollbox,a=void 0;e.keyCode===D["default"].keyCode.PageUp&&t.scrollTop>0&&(a=-t.offsetHeight),e.keyCode===D["default"].keyCode.PageDown&&t.scrollHeight>t.scrollTop+t.offsetHeight&&(a=t.offsetHeight),D["default"].platform.isMac()&&(e.keyCode===D["default"].keyCode.Home&&t.scrollTop>0&&(a=-t.scrollTop),e.keyCode===D["default"].keyCode.End&&t.scrollHeight>t.scrollTop+t.offsetHeight&&(a=t.scrollHeight-t.offsetHeight-t.scrollTop)),a&&this._animationPromise(a)}},_animationPromise:function(e){var t=this;j["default"].type("animate-scroll-position").log("delta:",e);var a=this.scrollbox;return new o["default"](function(n){t._unbindScroll();var i=d["default"].chat_scroll_duration,o=a.scrollTop,s=void 0,r=void 0;t.interruptAutoscroll(),t.is_animating=!0;var l=function u(l){s||(s=l);var c=Math.floor(l-s);i>=c?(r=Math.cos(Math.PI*c/i-Math.PI)+1,a.scrollTop=o+e/2*r,requestAnimationFrame(u)):(t.should_interrupt_autoscroll=!1,t.is_animating=!1,n())};requestAnimationFrame(l)}).then(function(){t._checkScrollForHistoryFetch(),t._checkScrollForScrolledToBottom(),t._setScrollPosition(),_.debounce(t._bindScroll,300,{leading:!1,trailing:!0})})},_handleFrozenScroll:function(){if(this.props.chat.scroll_frozen&&this.props.chat.oldest_mid_before_fetch&&!this.props.chat.scrollTop){this.props.chat.scroll_frozen=!1,this.state.has_scrolled_initial=!0;var e=$("[data-mid="+this.props.chat.oldest_mid_before_fetch+"]").parents(".hc-chat-row")[0];if(e){var t=ReactDOM.findDOMNode(this),a=$(t).find(".scroll-wrap")[0];this.props.chat.scrollTop=e.getBoundingClientRect().top-a.getBoundingClientRect().top-d["default"].frozen_scroll_offset,j["default"].type("message-list").log("Scroll to oldest element before fetch. mid:",this.props.chat.oldest_mid_before_fetch,this.props.chat.scrollTop)}}},_prefsChanged:function(){this.setState({shouldHideGifs:m["default"].shouldHideGifsByDefault(),shouldHideAttachedCards:m["default"].shouldHideAttachedCardsByDefault(),chat_view:m["default"].getChatView(),show_join_leave_messages:!m["default"].getHidePresenceMessages(),should_animate_avatar:m["default"].shouldAnimateAvatars(),use24hrTime:m["default"].shouldUse24HrTime(),nameDisplay:m["default"].getNameDisplay()})},_handleScrollPosition:function(){this.isMounted()&&(this.is_scrolling||this.is_animating||(this.props.chat.should_scroll_to_bottom?this._scrollToWithoutTrigger():(this._setScroll(),this._bindScroll())))},_onResize:function(){this.is_scrolling||this.is_animating?this._onZoom():this._isScrolledToBottom()?(this._setScroll(),this._bindScroll()):this._scrollToWithoutTrigger()},_onZoom:function(){this.is_scrolling=!1,this._scrollToWithoutTrigger()},_getFirstName:function(){return this.props.chat.name?this.props.chat.name.split(" ")[0]:void 0},render:function(){var e=(0,E["default"])({hidden:!this.props.chat.is_composing,"hc-composing-message":!0,"hc-classic-neue":"classic_neue"===this.state.chat_view}),t=_.isEmpty(this.props.chat.messages)&&this.props.chat.fetching_ancient,a=this.props.chat.ancient_history_is_empty?!1:this._getHistorySpinner(),n=(this.props.chat.has_no_message_history||!_.isEmpty(this.props.chat.messages)&&_.every(this.props.chat.messages,"is_presence_message")&&!this.state.show_join_leave_messages)&&!this.props.chat.has_been_cleared,i=void 0;return i=t?React.createElement("div",{className:"spinwrap"},React.createElement(x["default"],{spin:!0,spinner_class:"hc-loading-spinner medium-spinner"})):n?React.createElement(r["default"],{jid:this.props.chat.jid,type:this.props.chat.type,chatName:this.props.chat.name,firstName:this._getFirstName(),web_server:this.props.web_server}):React.createElement("div",{className:"scroll-wrap"},a,React.createElement(M["default"],{messages:this.props.chat.messages,show_join_leave_messages:this.state.show_join_leave_messages,should_animate_avatar:this.state.should_animate_avatar,shouldHideGifs:this.state.shouldHideGifs,shouldHideAttachedCards:this.state.shouldHideAttachedCards,use24hrTime:this.state.use24hrTime,showUnreadDivider:this.state.showUnreadDivider,nameDisplay:this.state.nameDisplay,chat_view:this.state.chat_view,chat_type:this.props.chat.type,chat_id:this.props.chat.id,is_guest:this.props.is_guest,integrationsEnabled:v["default"].get("enabled"),addon_avatars:this.props.addon_avatars}),React.createElement("div",{className:e,ref:"composing_msg"},this.props.chat.name+" is typing...")),React.createElement("div",{className:"hc-chat-scrollbox message-list",ref:"scrollbox"},i)},_getHistorySpinner:function(){return React.createElement("div",{style:{display:"none"},ref:"historySpinnerWrapper"},React.createElement(I["default"],null))},_checkScrollForHistoryFetch:function(){return!this.props.chat.ancient_history_is_empty&&ReactDOM.findDOMNode(this).scrollTop<=0&&!this.props.is_guest&&!this.props.chat.has_been_cleared?(this.fetchHistory(),!0):void 0},_checkScrollForScrolledToBottom:function(){this.props.chat.should_scroll_to_bottom=this._isScrolledToBottom()},_isScrolledToBottom:function(){var e=ReactDOM.findDOMNode(this),t=e.scrollTop+e.offsetHeight;return e.scrollHeight>t-d["default"].scroll_to_bottom_offset&&e.scrollHeight<t+d["default"].scroll_to_bottom_offset},_updateScrollPosition:function(e){!this.props.chat.should_scroll_to_bottom&&this.props.chat.scrollTop>e.offsetTop&&(this.$scrollbox.data("skipScrollStartEvent",!0),this.props.chat.scrollTop+=e.heightDiff)},_setScrollPosition:function(){this.props.chat.message_action_active||this._checkScrollForScrolledToBottom();var e=ReactDOM.findDOMNode(this),t=this.props.chat.should_scroll_to_bottom?e.scrollHeight:e.scrollTop;this.is_animating||this.props.chat.scroll_frozen||!this.state.has_scrolled_initial||u["default"].setScrollValue({scrollTop:t,isScrolledToBottom:this._isScrolledToBottom(),oldestVisibleMessageMid:this._getOldestVisibleMessageMid(),should_scroll_to_bottom:this.props.chat.should_scroll_to_bottom,jid:this.props.chat.jid})},_getOldestVisibleMessageMid:function(){return $(".msg-line:visible:first").data("mid")},_maintainScrollPosition:function(e,t,a){if(this.isMounted()){if(a&&"unfreeze"===e)return this._unbindScroll(),$(ReactDOM.findDOMNode(this)).find(".scroll-wrap").css({position:"relative",bottom:"",top:""}).parent(".message-list").css({overflowY:"auto"}),this._scrollToWithoutTrigger(),void(this.props.chat.scroll_frozen=!1);var n=ReactDOM.findDOMNode(this);this._unbindScroll();var i,o=$(n).find(".scroll-wrap")[0],s=o.getBoundingClientRect().bottom-n.getBoundingClientRect().bottom;switch(e){case"freeze":if(!this.props.chat.scroll_frozen)switch(this.$scrollbox.off("scrollstart"),this.$scrollbox.off("scrollstop"),this.props.chat.scroll_frozen=!0,i=n.getBoundingClientRect().top-o.getBoundingClientRect().top,t){case"above":n.scrollTop=0,$(o).css({position:"absolute",top:"",bottom:-s}).parent(".message-list").css({overflowY:"hidden"});break;case"below":n.scrollTop=0,$(o).css({position:"absolute",top:-i,bottom:""}).parent(".message-list").css({overflowY:"hidden"})}break;case"unfreeze":this.props.chat.scroll_frozen&&!this.props.chat.fetching_ancient&&($(ReactDOM.findDOMNode(this.refs.historySpinnerWrapper)).hide(),this.props.chat.scroll_frozen=!1,i=o.getBoundingClientRect().top-n.getBoundingClientRect().top,$(o).css({position:"relative",bottom:"",top:""}).parent(".message-list").css({overflowY:"auto"}),this._checkScrollForScrolledToBottom(),this._scrollToWithoutTrigger(-i),this.props.chat.scrollTop=-i,this._bindScroll())}}},_createDebounced:function(){function e(){this._maintainScrollPosition("unfreeze","above",this.props.chat.should_scroll_to_bottom)}function t(){this._maintainScrollPosition("unfreeze","below",this.props.chat.should_scroll_to_bottom)}function a(){this._maintainScrollPosition("freeze","above",this.props.chat.should_scroll_to_bottom)}function n(){this._maintainScrollPosition("freeze","below",this.props.chat.should_scroll_to_bottom)}this.debouncedBindScroll=_.debounce(this._bindScroll,300,{leading:!1,trailing:!0}),this.debouncedUnfreezeAbove=_.debounce(e,600,{leading:!1,trailing:!0}),this.debouncedUnfreezeBelow=_.debounce(t,600,{leading:!1,trailing:!0}),this.debouncedFreezeAbove=_.debounce(a,500,{leading:!0,trailing:!1}),this.debouncedFreezeBelow=_.debounce(n,500,{leading:!0,trailing:!1}),this.debouncedResize=_.debounce(this._onResize,200,{leading:!1,trailing:!0}),this.debouncedKeyDown=_.debounce(this._onKeyDown,20,{leading:!0,trailing:!1}),this.throttledSetScrollPosition=_.throttle(this._setScrollPosition,50,{leading:!1,trailing:!0}),this.debouncedOnUserAction=_.throttle(this._onUserAction,200,{leading:!0,trailing:!0}),this.initialized=!0},_shouldSetScroll:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];!this.isMounted()||this.is_scrolling||this.props.chat.scroll_frozen||this._isHistoryEmpty()||this.will_freeze||!this.props.chat.should_scroll_to_bottom||this._isScrolledToBottom()||this._setScroll(e)},_isHistoryEmpty:function(){return this.props.chat.ancient_history_is_empty&&0===this.props.chat.messages.length},_setScroll:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=ReactDOM.findDOMNode(this);this.is_scrolling||this.props.chat.scroll_frozen||this.is_animating||this.props.chat.message_action_active||(this.props.chat.should_scroll_to_bottom?this.state.has_scrolled_initial&&e.animation?this._animateScroll():(this._scrollToWithoutTrigger(),this.state.has_scrolled_initial||(this.state.has_scrolled_initial=!0,this._setScrollPosition())):(this._bindScroll(),this.state.has_scrolled_initial||(this.state.has_scrolled_initial=!0),t.scrollTop=this.props.chat.scrollTop,this._setScrollPosition()))},_animateScroll:function(e){var t=this,a=ReactDOM.findDOMNode(this);if(e||this.scrollbox.scrollHeight-a.offsetHeight-a.scrollTop>2){var n=new o["default"](function(n){t._unbindScroll();var i=d["default"].chat_scroll_duration,o=(e||t.scrollbox.scrollHeight)-a.offsetHeight;t.interruptAutoscroll();var s,r,l=a.scrollTop,u=o-l,c=0;t.is_animating=!0;var f=function h(e){s||(s=e);var o=e-s;i>o&&!t.should_interrupt_autoscroll?(c+=1,r=Math.cos(Math.PI*o/i-Math.PI)+1,a.scrollTop=l+u/2*r,requestAnimationFrame(h)):(!t.should_interrupt_autoscroll&&t.props.chat.should_scroll_to_bottom&&t._scrollToWithoutTrigger(),t.should_interrupt_autoscroll=!1,a.scrollTop=a.scrollHeight,t.props.chat.should_scroll_to_bottom=!0,t.is_animating=!1,n())};requestAnimationFrame(f)});n.then(function(){_.debounce(t._bindScroll,300,{leading:!1,trailing:!0})})}},_changeChatStateMessage:function(e){if(this.props.chat.should_scroll_to_bottom&&this.props.chat.jid===e.jid&&this.props.chat.is_composing){var t=ReactDOM.findDOMNode(this).getBoundingClientRect().bottom-ReactDOM.findDOMNode(this.refs.composing_msg).getBoundingClientRect().top;t&&this._animateScroll(ReactDOM.findDOMNode(this).scrollHeight-t)}},_scrollToWithoutTrigger:function(e){var t=this;if(!this.is_scrolling){this._unbindScroll();try{var a=ReactDOM.findDOMNode(this);a.scrollTop=e||a.scrollHeight,this.props.chat.scrollTop=a.scrollTop,e||(this.props.chat.should_scroll_to_bottom=!0,this.props.chat.isScrolledToBottom=!0),this.$scrollbox.bind("scroll.resolver",function(){t.$scrollbox.unbind("scroll.resolver")})}finally{this.debouncedBindScroll()}}},interruptAutoscroll:function(){this.is_animating&&(this.should_interrupt_autoscroll=!0)},_onUserAction:function(){this.should_interrupt_autoscroll=!0,this._bindScroll()},fetchHistory:function(){var e=this;if(!this.props.chat.ancient_history_is_empty){this._unbindScroll();var t=ReactDOM.findDOMNode(this.refs.historySpinnerWrapper);this.props.chat.should_scroll_to_bottom=!1,this.props.chat.scrollTop=0,this.should_interrupt_autoscroll=!0,this.will_freeze=!0,u["default"].requestAncientHistory({jid:this.props.chat.jid}),$(t).slideDown(200,function(){e.props.chat.ancient_history_is_empty||(e.will_freeze=!1,e.debouncedFreezeAbove())})}},_chatIsScrolling:function(){u["default"].chatStartedScroll(this.props.chat.jid),this.is_scrolling=!0},_scrollStop:function(){j["default"].type("message-list").log("Scroll stop"),this.should_interrupt_autoscroll=!1,this.is_animating=!1,this.is_scrolling=!1,u["default"].chatStoppedScroll(this.props.chat.jid),this._checkScrollForHistoryFetch(),this._checkScrollForScrolledToBottom(),this._setScrollPosition()},_unbindScroll:function(){this.$scrollbox.unbind("scroll.resolver"),this.scroll_is_bound&&(this.$scrollbox.off(),this.is_scrolling=!1,this.scroll_is_bound=!1)},_bindScroll:function(){this.scroll_is_bound||(j["default"].type("message-list").log("Bind scroll"),this.$scrollbox.on("scrollstart",this._chatIsScrolling),this.$scrollbox.on("scrollstop",this._scrollStop),this.$scrollbox.on("scroll",this.throttledSetScrollPosition),this.scroll_is_bound=!0)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(314),o=n(i);t["default"]=React.createClass({displayName:"ChatWindowEmptyState",propTypes:{chatName:React.PropTypes.string,firstName:React.PropTypes.string,type:React.PropTypes.string,jid:React.PropTypes.string,web_server:React.PropTypes.string},mixins:[o["default"]],getDefaultProps:function(){return{chatName:"",firstName:"",jid:"",web_server:"",type:""}},_getEmptyState:function(){var e;return e="chat"===this.props.type?this._getOTOEmptyState():this._getGroupChatEmptyState()},_getGroupChatEmptyState:function(){return React.createElement("div",{ref:"empty_state",className:"empty-state groupchat"},React.createElement("div",{className:"empty-state-img"}),React.createElement("div",{className:"empty-state-msg"},React.createElement("p",{className:"empty-header"},"Welcome to the ",this.props.chatName," room!"),React.createElement("p",{className:"empty-msg"},"This window is kinda empty, huh? It fills up fast when you",React.createElement("br",null),"start chatting with your friends. Happy chatting!")))},_getOTOEmptyState:function(){return React.createElement("div",{ref:"empty_state",className:"empty-state chat"},React.createElement("div",{className:"empty-state-img"}),React.createElement("div",{className:"empty-state-msg"},React.createElement("p",{className:"empty-header"},"Say Hello to ",this.props.chatName,"!"),React.createElement("p",{className:"empty-msg"},"You haven't talked to ",this.props.firstName," before. Why not break the ice with",React.createElement("br",null),"an emoticon? (fonzie) ",React.createElement("img",{src:"https://"+this.props.web_server+"/wc/assets/img/embedded/fonzie@3x.png",width:"34",height:"25"}))))},render:function(){return React.createElement("div",{className:"empty"},this._getEmptyState())}}),e.exports=t["default"]},function(e,t){"use strict";e.exports=function(){var e=$.event.dispatch||$.event.handle,t=$.event.special,a="D"+ +new Date,n="D"+(+new Date+1);t.scrollstart={setup:function(n){var i=this,o=$.extend({latency:t.scrollstop.latency},n),s=function(t){var a=this;t.type="scrollstart";for(var n=arguments.length,i=Array(n>1?n-1:0),o=1;n>o;o++)i[o-1]=arguments[o];e.apply(a,[t].concat(i))}.bind(this),r=_.debounce(s,o.latency,{leading:!0,trailing:!1});$(this).on("scroll",function(e){$(i).data("skipScrollStartEvent")?$(i).data("skipScrollStartEvent",!1):r(e)}).data(a,r)},teardown:function(){$(this).data(a).cancel(),$(this).off("scroll",$(this).data(a)),$(this).removeData(a)}},t.scrollstop={latency:250,setup:function(a){var i=$.extend({latency:t.scrollstop.latency},a),o=_.debounce(function(t){var a=this,n=arguments;t.type="scrollstop",e.apply(a,n),$(this).data("skipScrollStartEvent",!1)}.bind(this),i.latency,{leading:!1,trailing:!0});$(this).on("scroll",o).data(n,o)},teardown:function(){$(this).data(n).cancel(),$(this).off("scroll",$(this).data(n)),$(this).removeData(n)}}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i),s=a(329),r=n(s),l=a(314),u=n(l);t["default"]=React.createClass({displayName:"HistorySpinner",mixins:[u["default"]],getInitialState:function(){return{history_loading:!1}},componentDidMount:function(){o["default"].register({"requesting-ancient-history":this._requestingAncientHistory,"ancient-history-fetched":this._ancientHistoryFetched})},componentWillUnmount:function(){o["default"].unregister({"requesting-ancient-history":this._requestingAncientHistory,"ancient-history-fetched":this._ancientHistoryFetched})},_requestingAncientHistory:function(){this.setState({history_loading:!0})},_ancientHistoryFetched:function(){this.setState({history_loading:!1})},render:function(){return React.createElement(r["default"],{spin:this.state.history_loading,spinner_class:"hc-chat-spinner medium-spinner"})}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return e.sender_id||t.sender_id?e.sender_id===t.sender_id:e.sender===t.sender}function o(e,t,a){return i(e,a)&&a.time-t.time<=300&&e.color===a.color&&!t.last_read_message&&!~R.indexOf(a.type)&&!~R.indexOf(e.type)&&"failed"!==a.status&&"failed"!==t.status&&("image"!==a.type||"image"===a.type&&"image"===e.type&&d["default"].getRealMid(e.mid)===d["default"].getRealMid(a.mid))}function s(e,t,a){var n=d["default"].getAttachToMid(t)||t.mid,i=d["default"].getAttachToMid(a);return e&&m["default"].isValidCard(a.card)&&n===i}function r(e){var t=[],a=null,n=null;return e.forEach(function(e){var i=d["default"].format_time_for_separator(e.sortTime||e.time);null===a||a!==i?(a=i,n={date:i,messages:[e]},t.push(n)):n.messages.push(e)}),t}function l(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],a=[],n=null,i=null;return e.forEach(function(r,l){null===n||!o(n,e[l-1],r)&&!s(t,e[l-1],r)?(n=r,i={key:"msg-group-"+r.mid,messages:[r]},a.push(i)):i.messages.push(r)}),a}function u(e){return!!~_.findLastIndex(e.messages,{last_read_message:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.doSendersMatch=i,t.shouldGroupMessage=o,t.shouldAttachMessage=s,t.groupByDate=r,t.groupNearbyMessages=l,t.groupContainsLastRead=u;var c=a(99),d=n(c),f=a(9),h=n(f),p=a(572),m=n(p),g=a(169),v=n(g),y=a(573),b=n(y),w=React.addons.PureRenderMixin,R=["notification","twitter_user","twitter_status","info"];t["default"]=React.createClass({displayName:"ChatWindowMessages",mixins:[w],renderMessageGroup:function(e){var t=this.props,a=u(e),n=_.get(this.feature_flags,"web_client_attach_to_collapsable_enabled");return React.createElement(b["default"],{group:e,key:e.key,shouldHideGifs:t.shouldHideGifs,shouldHideAttachedCards:t.shouldHideAttachedCards,should_animate_avatar:t.should_animate_avatar,attachedCardsToggleEnabled:n,use24hrTime:t.use24hrTime,shouldShowLastViewed:t.showUnreadDivider,lastReadGroup:a,nameDisplay:t.nameDisplay,chat_view:t.chat_view,chat_type:t.chat_type,chat_id:t.chat_id,is_guest:t.is_guest,integrationsEnabled:t.integrationsEnabled,addon_avatars:t.addon_avatars,honest_messages_enabled:this.feature_flags.web_client_honest_messages,message_editing_enabled:this.feature_flags.web_client_message_editing})},componentWillMount:function(){this.feature_flags=v["default"].get("feature_flags"),h["default"].register("updated:config",this._updateConfig)},componentWillUnmount:function(){h["default"].unregister("updated:config",this._updateConfig)},renderDateMessages:function(e){var t=e.date,a=e.messages,n=_.get(this.feature_flags,"web_client_attach_to_rendering_enabled")&&m["default"].cardsEnabled(this.feature_flags),i=l(a,n);return React.createElement("div",{className:"date-block",key:t.replace(/\s/g,"")},React.createElement("div",{className:"date-divider","data-copyable":'{"format": "date-divider"}'},React.createElement("span",null,t)),i.map(this.renderMessageGroup))},render:function(){var e=this.props.messages;return this.props.show_join_leave_messages||(e=e.filter(function(e){
return!e.is_presence_message})),React.createElement("div",{className:"hc-messages"},r(e).map(this.renderDateMessages))},_updateConfig:function(e){this.feature_flags=_.get(e,"feature_flags")}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(525),o=n(i),s=a(90),r=new o["default"](["link","media","file","image","application"]),l={cardsEnabled:function(e){return e&&e.web_client_cards_enabled},isValidStyle:function(e){return e&&r.has(e.style)},isLink:function(e){return e&&"link"===e.style},isMedia:function(e){return e&&"media"===e.style},isFile:function(e){return e&&"file"===e.style},isImage:function(e){return e&&"image"===e.style},isApplication:function(e){return e&&"application"===e.style},isValidCard:function(e){if(!e)return!1;if(!l.isValidStyle(e))return!1;if(void 0===e.id)return s.warn("Card does not have an id"),!1;if(l.isLink(e)){if(void 0===e.title)return s.warn("Link Card needs a title"),!1;if(void 0===e.description)return s.warn("Link Cards needs a description"),!1}return l.isImage(e)&&void 0===e.url?(s.warn("Image Card does not have a url"),!1):!0}};e.exports=l},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(157),o=n(i),s=a(196),r=n(s),l=a(178),u=n(l),c=a(367),d=n(c),f=a(185),h=n(f),p=a(313),m=n(p),g=a(572),v=n(g),y=a(99),b=n(y),w=a(90),R=n(w),k=a(447),E=n(k),C=a(574),S=n(C),T=a(578),x=n(T),A=a(579),I=n(A),N=a(581),M=n(N),O=a(583),D=n(O),P=a(584),j=n(P),L=a(587),F=n(L),U=a(588),H=n(U),B=a(589),z=n(B),q=a(590),V=n(q),G=a(591),W=n(G),$=a(597),Y=n($),K=a(598),X=n(K),J=a(310),Q=n(J),Z=a(121),ee=n(Z),te={message:E["default"],notification:S["default"],info:x["default"],file:I["default"],file_error:M["default"],link:D["default"],image:j["default"],video:F["default"],user_state:H["default"],twitter_status:z["default"],twitter_user:V["default"]},ae=[E["default"],S["default"],M["default"],I["default"],j["default"]],ne=[E["default"],I["default"],M["default"]],ie=React.addons.CSSTransitionGroup;t["default"]=React.createClass({displayName:"ChatWindowMessageGroup",mixins:[d["default"]],getMsg:function(){return this.props.group.messages[0]},doesNeedFullMessaging:function(e){return!_.includes(["image","user_state","twitter_status","twitter_user","info"],e.type)},getSeparator:function(e){return e?React.createElement("span",{className:"separator"},"Â·"):!1},_getTimeDisplay:function(e,t){var a,n=this.getMsg();return this.doesNeedFullMessaging(n)&&(a=React.createElement("span",{className:"hc-chat-status-time"},this.getSeparator(t),React.createElement("span",{className:"hc-chat-time"},b["default"].format_time(n.date,this.props.use24hrTime)))),a},_getEditedIndicator:function(e){return this.doesNeedFullMessaging(this.getMsg())&&_.some(this.props.group.messages,"replace")?React.createElement("span",{className:"hc-chat-status-edited"},this.getSeparator(e),React.createElement("span",{className:"hc-chat-edited"},h["default"].edited)):void 0},_getUnconfirmedMessaging:function(e,t){var a,n=this.getMsg();return this.doesNeedFullMessaging(n)&&(a=React.createElement("span",{className:"hc-chat-status-unconfirmed"},this.getSeparator(t),React.createElement("span",{ref:"unconfirmed_messaging",className:"unconfirmed-messaging"},h["default"].unconfirmed_message_group))),a},_getFailedMessaging:function(e,t){var a,n=this.getMsg();return this.doesNeedFullMessaging(n)&&(a=React.createElement("span",{className:"hc-chat-status-failed"},this.getSeparator(t),React.createElement("span",{ref:"failed_messaging",className:"failed-messaging"},h["default"].failed_message),React.createElement("span",{ref:"failed_message_actions",className:"failed-message-actions"},React.createElement("a",{onClick:this.onFailedMessageRetryClick},h["default"].failed_message_retry),React.createElement("a",{onClick:this.onFailedMessageCancelClick},h["default"].failed_message_cancel)))),a},onFailedMessageRetryClick:function(){u["default"].onFailedRetry(this.getMsg()),r["default"].failedMessageRetried()},onFailedMessageCancelClick:function(){u["default"].onFailedCancel(this.getMsg()),r["default"].failedMessageCanceled()},_getSenderText:function(e){var t=void 0,a=this.getMsg();return t="image"===a.type?"Image":a.isEmote?"":"mentions"===e&&a.sender_mention?"@"+a.sender_mention:a.sender},_getAvatarUrl:function(){var e=this.getMsg(),t=_.get(e,"notification_sender");return"addon"===_.get(t,"type","")?_.get(this.props.addon_avatars,[t.id,"url"]):e.sender_avatar},_getAvatarDisplay:function(e){var t=this.getMsg(),a=this._getAvatarUrl(),n=a&&"info"!==t.type,i=e?this.onSenderClicked:_.noop;if(n)return React.createElement(Q["default"],{name:t.sender,size:"medium",avatar_url:a,show_presence:!1,shouldAnimate:this.props.should_animate_avatar,onClick:i});var o=_.get(t,"notification_sender");return!this._isAddon(o)&&this._isAvatarRequired(t)?this._getAvatarWithInitials(t.sender):!1},_isAddon:function(e){return"addon"===_.get(e,"type","")},_isAvatarRequired:function(e){return"message"===e.type},_getAvatarWithInitials:function(e){var t=ee["default"].default_guest_avatar_bg;return React.createElement(Q["default"],{name:e,size:"medium",avatar_bg_color:t,show_presence:!1})},_getSenderName:function(e){var t=this.getMsg(),a="info"!==t.type;return a?React.createElement("span",{ref:"sender_text",className:"sender-name",onClick:this.onSenderClicked,"aria-label":e.tooltip},e.sender):void 0},render:function(){var e,t=this.getMsg(),a=this._getSenderText(this.props.nameDisplay),n=this._getSenderText("mentions"===this.props.nameDisplay?"name":"mentions"),i=this.isUnconfirmedGroup(),s=this.isFailedGroup(),r=(0,m["default"])((e={"hc-chat-row":!0},(0,o["default"])(e,"hc-msg-"+t.color+" hc-msg-"+t.type,!s),(0,o["default"])(e,"hc-classic-neue",this.isClassicNeueView()),(0,o["default"])(e,"hc-chat-row-unconfirmed",i),(0,o["default"])(e,"hc-chat-row-failed",s),(0,o["default"])(e,"unread-line-row",this.props.lastReadGroup),e)),l=(0,m["default"])({"hc-chat-msg":!0,"image-link":"image"===t.type});return this.isClassicNeueView()?this._renderClassicNeueView({rowClasses:r,chatClasses:l,sender:a,tooltip:n,isFailedGroup:s,isUnconfirmedGroup:i}):this._renderStandardView({rowClasses:r,chatClasses:l,sender:a,tooltip:n,isFailedGroup:s,isUnconfirmedGroup:i})},isClassicNeueView:function(){return"classic_neue"===this.props.chat_view&&!this.props.is_guest},isUnconfirmedGroup:function(){return _.every(this.props.group.messages,{status:"unconfirmed"})&&this.props.honest_messages_enabled},isFailedGroup:function(){return"failed"===this.getMsg().status},_renderStandardView:function(e){var t,a=this.getMsg(),n=(0,m["default"])({"hc-chat-from":!0,invisible:"user_state"===a.type});return e.isFailedGroup&&(t=this._getFailedMessaging(a.mid,!1)),React.createElement("div",{className:e.rowClasses,ref:"message_group_root",onClick:this._onMessageClicked},React.createElement("div",{className:n},React.createElement("span",{onClick:this.onSenderClicked,ref:"sender_text",className:"sender-name","aria-label":e.tooltip},e.sender)),React.createElement("div",{className:e.chatClasses},this._renderMessages(),t))},_renderClassicNeueView:function(e){var t,a,n,i,o=this.getMsg(),s="addon"===_.get(o,"notification_sender.type","user"),r=this._getAvatarUrl(),l=r&&"info"!==o.type,u=l&&!s,c=(0,m["default"])({"hc-chat-from":!0,"no-action":!u,invisible:"user_state"===o.type});return e.isFailedGroup?a=this._getFailedMessaging(o.mid,!0):e.isUnconfirmedGroup?n=this._getUnconfirmedMessaging(o.mid,!0):(t=this._getTimeDisplay(o.mid,!0),i=this._getEditedIndicator(!0)),React.createElement("div",{className:e.rowClasses,ref:"message_group_root",onClick:this._onMessageClicked},React.createElement("div",{className:c},this._getAvatarDisplay(u)),React.createElement("div",{className:e.chatClasses},this._getSenderName(e),React.createElement(ie,{transitionName:"message-confirm-state",transitionAppear:!1,transitionEnterTimeout:150,transitionLeaveTimeout:150},n,a,t,i),this._renderMessages()))},_renderBlueLine:function(){return this.props.shouldShowLastViewed?React.createElement("div",{className:"unread-line",key:"unread-line-"+_.uniqueId()},React.createElement("hr",null)):void 0},_renderMessages:function(){var e=this,t=this.props.integrationsEnabled,a=_.uniq(this.props.group.messages),n=this.props.attachedCardsToggleEnabled,i=_.uniq(a.reduce(function(e,t){if(v["default"].isValidCard(t.card)){var a=b["default"].getAttachToMid(t);a&&e.push(a)}return e},[])),o=null,s=[];return a.forEach(function(a,r,l){try{var u=te[a.type];if(!u)return;var c=React.createElement(u,{key:"msg-"+a.mid,ref:"msg_"+a.mid,msg:a,use24hrTime:e.props.use24hrTime,shouldHideAttachedCards:e.props.shouldHideAttachedCards,shouldHideGifs:e.props.shouldHideGifs});if(n&&i.indexOf(a.mid)>=0){o=b["default"].isAttachedCardsCollapsed(a,e.props.shouldHideAttachedCards)?a.mid:null;var d=React.createElement(Y["default"],{key:a.mid,mid:a.mid,collapsed:!!o});c=[d,c]}else c=[c];var f=e._getTimeDisplay(a.mid,!1),h=e._getEditedIndicator(!1);if(0===r&&!e.isClassicNeueView())if(e.isUnconfirmedGroup()){var p=e._getUnconfirmedMessaging(a.mid,!1);c.unshift(p)}else f&&!e.isFailedGroup()&&(h&&c.unshift(h),c.unshift(f));if(o&&v["default"].isValidCard(a.card)){var m=b["default"].getAttachToMid(a);if(o===m)return}var g=void 0,y=_.includes(ne,u),w=_.includes(ae,u);g=w&&t&&"groupchat"===e.props.chat_type||w&&e.props.message_editing_enabled&&"chat"===e.props.chat_type?React.createElement(W["default"],{key:"actionable-message-"+a.mid,msg:a,is_editable:y&&a.sender_is_current_user&&""!==a.body,chat_type:e.props.chat_type,message_editing_enabled:e.props.message_editing_enabled},c):c,s.push(React.createElement(X["default"],{key:"msg-wrapper-"+a.mid,messageStatus:a.status,innerMessage:g,is_guest:e.props.is_guest,chat_id:e.props.chat_id,honest_messages_enabled:e.props.honest_messages_enabled,msg:a})),a.last_read_message&&s.push(e._renderBlueLine())}catch(k){R["default"].warn(a)}}),s},onSenderClicked:function(e){e.preventDefault();var t=this.getMsg(),a=t.sender_mention;a?u["default"].senderClick({mention:"@"+a}):R["default"].warn("Sender mention does not exists",t)},_onMessageClicked:function(e){if(e.target){var t=y.dom.findParentMatching(e.target,y.dom.matchers.tag("a"),ReactDOM.findDOMNode(this.refs.message_group_root));t&&(_.get(window,"HC.isEmbeddedComponent")||(t.hasAttribute("rel")||t.setAttribute("rel","noreferrer"),t.setAttribute("target","_blank")))}}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(191),o=n(i),s=a(575),r=n(s),l=a(449),u=n(l),c=a(367),d=n(c),f=a(450),h=n(f),p=a(99),m=a(576),g=n(m),v=a(451),y=n(v),b=a(452),w=n(b),R=a(453),k=n(R);t["default"]=React.createClass({displayName:"NotificationMessageType",mixins:[u["default"],d["default"],h["default"]],componentDidMount:function(){this._createTooltips()},componentWillUnmount:function(){this._destroyTooltips()},render:function(){var e=this.getCard(),t=this.renderNotification();return e?this.renderCard(e,t):t},getCard:function(){return _.get(this.props,"msg.card")},renderCard:function(e,t){return React.createElement(r["default"],(0,o["default"])({},e,{fallback:t,_setScroll:this.props._setScroll,onClick:this.onLinkClick}))},renderNotification:function(){var e=void 0,t=void 0,a=this.props.msg;return e="html"===a.format?a.xhtml_im_body:a.rendered_body,t="quotation"===a.format?React.createElement("div",{className:"notification msg-line","data-mid":a.mid,onClick:this.onLinkClick},React.createElement(y["default"],{mid:a.mid,body:e})):"code"===a.format?React.createElement("div",{className:"notification msg-line","data-mid":a.mid,onClick:this.onLinkClick},React.createElement(w["default"],{mid:a.mid,body:e})):"monospace"===a.format?React.createElement("div",{className:"notification msg-line","data-mid":a.mid,onClick:this.onLinkClick},React.createElement(k["default"],{mid:a.mid,body:e})):React.createElement("div",{className:"notification msg-line","data-mid":a.mid,"data-copyable":'{"format": "notification", "mid": "'+a.mid+'"}',dangerouslySetInnerHTML:{__html:e},onClick:this.onLinkClick})},onLinkClick:function(e){if(e.target){var t=p.dom.findParentMatching(e.target,p.dom.matchers.tag("a"),ReactDOM.findDOMNode(this));if(t){var a=t.getAttribute("data-target"),n=t.getAttribute("data-target-options"),i=t.getAttribute("href");g["default"].handleNotificationLink(a,n,i,this.props.msg)&&(e.stopPropagation(),e.preventDefault())}}}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(91),o=n(i),s=a(90),r=n(s),l=a(121),u=n(l),c=a(169),d=n(c),f=a(435),h=n(f),p=a(177),m=n(p),g=a(178),v=n(g),y=a(572),b=n(y),w=React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.shape({url:React.PropTypes.string.isRequired,"url@2x":React.PropTypes.string})]);t["default"]=React.createClass({displayName:"Card",propTypes:{id:React.PropTypes.string.isRequired,title:React.PropTypes.string.isRequired,description:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.object]),style:React.PropTypes.oneOf(["file","link","image","application","media"]),icon:w,format:React.PropTypes.oneOf(["medium","compact"]),thumbnail:React.PropTypes.shape({url:React.PropTypes.string.isRequired,"url@2x":React.PropTypes.string,width:React.PropTypes.number,height:React.PropTypes.number}),attributes:React.PropTypes.arrayOf(React.PropTypes.shape({label:React.PropTypes.string,value:React.PropTypes.shape({icon:w,label:React.PropTypes.string.isRequired})})),fallback:React.PropTypes.element,show_always:React.PropTypes.bool},options:{type:"link",format:"compact",responsive:!1},shouldComponentUpdate:function(){return!1},getDefaultProps:function(){return{onClick:_.noop}},getInitialState:function(){return this._getState()},componentDidMount:function(){var e=ReactDOM.findDOMNode(this);this.thumbnailLink=e.querySelector(".atlascard .thumbnail > a"),this.title=e.querySelector(".atlascard .title > a"),this.activity=e.querySelector(".atlascard .activity-expander"),this.thumbnailLink&&this.thumbnailLink.addEventListener("click",this._onClick),this.title&&this.title.addEventListener("click",this._onClick),this.activity&&this.activity.addEventListener("click",this._onActivityExpanded)},componentWillUnmount:function(){this.thumbnailLink&&this.thumbnailLink.removeEventListener("click",this._onClick),this.title&&this.title.removeEventListener("click",this._onClick),this.activity&&this.activity.removeEventListener("click",this._onActivityExpanded)},render:function(){if(!this.cardsEnabled()||!this.isValid())return this.fallback();var e=_.clone(this.props);e.fallback={},e.date=0;var t=_.clone(this.options);try{this.processCard(t,e);var a=new CardDrawer(e,t);return React.createElement("div",{"data-mid":this.props.mid,onClick:this.props.onClick,dangerouslySetInnerHTML:{__html:a.render()}})}catch(n){return this._logError(n,this.props),this.fallback()}},_onClick:function(e){var t={url:this.props.url};m["default"].shouldOpenFileViewer(e)&&m["default"].fileViewerSupports(t)&&(e.preventDefault(),h["default"].openInFileViewer(t))},_onActivityExpanded:function(e){var t=$(ReactDOM.findDOMNode(this)),a=t.offset().top>$(window).height()/2;a&&v["default"].preserveScrollValue({animation:!1})},_getState:function(){return{feature_flags:d["default"].get("feature_flags")}},processCard:function(e,t){this.isImage()||this.isFile()?(e.format="narrow",t.title=t.title||this.props.url.match("[^/]*$")):this.isLink()||this.isMedia()?(e.format=_.get(t,"format","compact"),t.site=this._getHostname(this.props.url)):this.isApplication()&&(e.format=_.get(t,"format","compact"),e.type=t.type="application"),this.state.feature_flags.web_client_cards_feedback_enabled&&(e.feedback={url:this._feedbackUrl(t),label:"Feedback",tooltip:"Let the HipChat team know what you think about cards."})},isValid:function(){return b["default"].isValidCard(this.props)},fallback:function(){return this.props.fallback?this.props.fallback:React.createElement("div",null)},cardsEnabled:function(){return this.props.show_always||b["default"].cardsEnabled(this.state.feature_flags)},isValidStyle:function(){return b["default"].isValidStyle(this.props)},isLink:function(){return b["default"].isLink(this.props)},isMedia:function(){return b["default"].isMedia(this.props)},isFile:function(){return b["default"].isFile(this.props)},isImage:function(){return b["default"].isImage(this.props)},isApplication:function(){return b["default"].isApplication(this.props)},_getHostname:function(e){var t=document.createElement("a");return t.href=e,t.hostname},_feedbackUrl:function(e){return u["default"].cards.feedback_url+encodeURIComponent((0,o["default"])(e))},_logError:function(e,t){r["default"].error(e),r["default"].error(t),this.valid=!1}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(_.isString(e)&&!_.isEmpty(e))try{e=JSON.parse(e)}catch(t){v["default"].error("[ChatPanel:routeLinkAction]","target options are not valid JSON",t.message),e={}}return e||{}}function o(e,t,a){var n=h["default"].split_full_key(t),i=a;if(e){var o=h["default"].extractIntegrationParametersFromMessage(e);i=_.extend({urlTemplateValues:{message:o},parameters:o},a)}var s=e.notification_sender;s&&"addon"===s.type?2===n.length?s.id===n[0]?m["default"].open(n[0],n[1],i,null,"link"):v["default"].error("[HC-Integrations]","Unable to invoke action for '"+n[0]+"' from plugin '"+s.id+"'"):1===n.length?m["default"].open(s.id,n[0],i,null,"link"):v["default"].error("[HC-Integrations]","Unknown link target from notification: '"+t+"'"):v["default"].error("[HC-Integrations]","Unable to invoke action link - message not sent from addon: '"+t+"'")}Object.defineProperty(t,"__esModule",{value:!0});var s=a(196),r=n(s),l=a(169),u=n(l),c=a(95),d=n(c),f=a(167),h=n(f),p=a(420),m=n(p),g=a(90),v=n(g),y=a(577),b=n(y),w=a(142),R=n(w);t["default"]={handleNotificationLink:function(e,t,a,n){var s=R["default"].parse(a),l=i(t),c="dialog"===e;if(s&&c)return r["default"].connectDialogLinkClickedEvent(s.getDomain()),d["default"].showAddonDialog({addon_key:s.getDomain(),module_key:"module-key",addon_url:a,addon_options:l}),!0;if(s&&s.isHipchatNative(u["default"].get("base_url"))){s.containsRoom()?b["default"].selectRoom(s.getRoom(),!0):s.containsUser()?b["default"].selectOTO(s.getUser(),!0):v["default"].error("[HC-Integrations], `malformed native link`");var f=s.getParameterValue("target");return(f||e)&&o(n,f||e,l),!0}return e?(o(n,e,l),!0):!1}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i),s=a(190),r=n(s),l=a(430),u=n(l),c=a(204),d=n(c),f=a(183),h=n(f),p=[u["default"].get("idToUser"),u["default"].get("jidToUser"),u["default"].get("halfJidToUser"),u["default"].get("mentionNameToUser")],m=[u["default"].get("idToRoom"),u["default"].get("jidToRoom"),u["default"].get("halfJidToRoom"),u["default"].get("nameToRoom")];t["default"]={selectRoom:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],a=_.reduce(m,function(t,a){return _.isUndefined(t)&&a.handle(e)?a.convert(e):t},a);if(_.isUndefined(a))d["default"].showFlag({type:"warning",body:h["default"].room_not_found,close:"auto",title:"",delay:5e3});else{var n=_.get(r["default"].data,"active_chat");t&&o["default"].dispatch("set-route",{jid:a.jid}),_.get(r["default"].data,'activeRooms["'+a.jid+'"]')||o["default"].dispatch("open-room",{jid:a.jid}),n!==a.jid&&o["default"].dispatch("new-active-chat",{jid:a.jid})}},selectOTO:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],a=_.reduce(p,function(t,a){return _.isUndefined(t)&&a.handle(e)?a.convert(e):t},a);if(_.isUndefined(a))d["default"].showFlag({type:"warning",body:h["default"].user_not_found,close:"auto",title:"",delay:3e3});else{var n=_.get(r["default"].data,"active_chat");t&&o["default"].dispatch("set-route",{jid:a.jid}),_.get(r["default"].data,'activeRooms["'+a.jid+'"]')||o["default"].dispatch("open-room",{jid:a.jid}),n!==a.jid&&o["default"].dispatch("new-active-chat",{jid:a.jid})}}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(110),o=n(i),s=a(367),r=n(s);t["default"]=React.createClass({displayName:"InfoMessageType",mixins:[r["default"]],componentDidMount:function(){o["default"]._replaceSpecials(ReactDOM.findDOMNode(this))},render:function(){return React.createElement("div",{className:"info msg-line","data-copyable":'{"format": "info"}',"data-mid":this.props.msg.mid,"data-presence-message":this.props.msg.is_presence_message,dangerouslySetInnerHTML:{__html:this.props.msg.rendered_body}})}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(99),o=n(i),s=a(435),r=n(s),l=a(177),u=n(l),c=a(185),d=n(c),f=a(313),h=n(f),p=a(178),_=n(p),m=a(195),g=n(m),v=a(449),y=n(v),b=a(367),w=n(b),R=a(450),k=n(R),E=a(580),C=n(E);t["default"]=React.createClass({displayName:"FileMessageType",mixins:[w["default"],y["default"],k["default"]],getInitialState:function(){return{userExpanded:null}},componentWillMount:function(){var e=this.props.msg;this._initRenderStrategies(),this._renderStrategies[e.file_data.file_type]?this.renderStrategy=this._renderStrategies[e.file_data.file_type]:this.renderStrategy=this._renderStrategies.file},_isUserExpanded:function(){return!this.props.msg.is_collapsed},_shouldBeExpanded:function(){return this.props.shouldHideAttachedCards?!1:this.props.shouldHideGifs?"gif"!==this.props.msg.file_data.file_ext:!0},_isExpanded:function(){return null===this.state.userExpanded?this._shouldBeExpanded()?this._isUserExpanded():!1:this.state.userExpanded},_getDescription:function(){return this.props.msg.rendered_body?React.createElement("span",{className:"description",dangerouslySetInnerHTML:{__html:this.props.msg.rendered_body}}):""},render:function(){return this.renderStrategy()},_initRenderStrategies:function(){this._renderStrategies={img:this._renderImgMessage,video:this._renderVideoMessage,file:this._renderFileMessage}},_renderImgMessage:function(){var e=this.props.msg,t=e.file_data.file_name,a=this._isExpanded(),n=(0,h["default"])({"toggle-image":!0,collapse:a,expand:!a}),i=(0,h["default"])({"file-meta":!0,"with-preview":!0,compact:!a});return React.createElement("div",{"data-mid":e.mid,className:"msg-line","data-copyable":'{"format": "file", "mid": "'+e.mid+'"}'},React.createElement("div",{className:"toggle-wrap",onClick:this._toggleImage},React.createElement("span",{className:n})),this._renderThumbnail(),React.createElement("div",{className:i},React.createElement("a",{href:e.file_data.url,onClick:this._onClick},t),React.createElement("span",{className:"file-size"},e.file_data.file_size)),this._getDescription())},_renderThumbnail:function(){return this._isExpanded()?React.createElement(C["default"],{file:this.props.msg.file_data,onClick:this._onClick}):React.createElement("div",{className:"file-preview-wrapper info"},React.createElement("i",null,d["default"].image_hidden))},_renderVideoMessage:function(){var e=this.props.msg,t=e.file_data.file_name;return React.createElement("div",{"data-mid":e.mid,className:"msg-line","data-copyable":'{"format": "file", "mid": "'+e.mid+'"}'},React.createElement("div",{className:"file-preview-wrapper video-wrap"},React.createElement("span",{className:"file-video-default-poster",onClick:this._onClick})),React.createElement("div",{className:"file-meta with-preview"},React.createElement("a",{href:e.file_data.url,onClick:this._onClick},t),React.createElement("span",{className:"file-size"},e.file_data.file_size)),this._getDescription())},_renderFileMessage:function(){var e=this.props.msg,t=e.file_data.file_name,a=(0,h["default"])({"aui-icon":!0,"hipchat-icon-small":!0,"hc-file-icon":!0});return a=a+" "+o["default"].file.get_icon_class(t),React.createElement("div",{"data-mid":e.mid,className:"msg-line","data-copyable":'{"format": "file", "mid": "'+e.mid+'"}'},React.createElement("div",{className:"file-meta"},React.createElement("span",{className:a}),React.createElement("a",{href:e.file_data.url,onClick:this._onClick},t),React.createElement("span",{className:"file-size"},e.file_data.file_size)),this._getDescription())},_toggleImage:function(){var e=this._isExpanded();this.setState({userExpanded:!e}),_["default"].toggleImage({jid:this.props.msg.room,mid:this.props.msg.mid})},_videoTypeSupported:function(e){var t=document.createElement("video");return t.canPlayType?{mp4:t.canPlayType('video/mp4; codecs="mp4v.20.8"')||t.canPlayType('video/mp4; codecs="avc1.42E01E"')||t.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"'),m4v:t.canPlayType('video/mp4; codecs="mp4v.20.8"')||t.canPlayType('video/mp4; codecs="avc1.42E01E"')||t.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"'),ogv:t.canPlayType('video/ogg; codecs="theora"'),webm:t.canPlayType('video/webm; codecs="vp8, vorbis"')}[e]:!1},_onClick:function(e){if(u["default"].shouldOpenFileViewer(e))if(e.preventDefault(),e.metaKey){var t=this.props.msg.file_data.url;g["default"].openExternalWindow(t,"_blank")}else r["default"].openInFileViewer(this.props.msg.file_data)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(59),o=n(i),s=a(177),r=n(s),l=a(121),u=n(l),c=a(178),d=n(c),f=a(9),h=n(f),p=a(581),_=n(p),m=a(99),g=n(m);t["default"]=React.createClass({displayName:"FileThumbnail",propTypes:{file:React.PropTypes.object.isRequired,onClick:React.PropTypes.func.isRequired},getInitialState:function(){return{thumbIsLoading:!1,thumbIsLoaded:!1,imageIsMounted:!1,error:null}},componentWillMount:function(){h["default"].register({"thumbnail-is-loading":this._thumbnailIsLoading,"thumbnail-loaded-success":this._thumbnailLoadedSuccess,"thumbnail-loaded-error":this._thumbnailLoadedError}),"img"===this.props.file.file_type&&this.tryFetchThumbnail(this.props.file)},componentDidMount:function(){"img"===this.props.file.file_type&&this._appendThumbnail()},componentDidUpdate:function(){"img"!==this.props.file.file_type||this.state.imageIsMounted||this._appendThumbnail()},componentWillUnmount:function(){h["default"].unregister({"thumbnail-is-loading":this._thumbnailIsLoading,"thumbnail-loaded-success":this._thumbnailLoadedSuccess,"thumbnail-loaded-error":this._thumbnailLoadedError})},_thumbnailIsLoading:function(e){e===this&&this.setState({thumbIsLoading:!0})},_thumbnailLoadedSuccess:function(e){e===this&&this.setState({thumbIsLoaded:!0,thumbIsLoading:!1,error:null})},_thumbnailLoadedError:function(e){e.instance===this&&this.setState({thumbIsLoaded:!0,thumbIsLoading:!1,error:e.error,imageIsMounted:!1})},_appendThumbnail:function(){var e=ReactDOM.findDOMNode(this.refs.preview_thumbnail_container);null!==e&&(e.appendChild(this.props.file.preview_thumbnail),this.setState({imageIsMounted:!0}))},render:function(){return this.state.error?React.createElement(_["default"],{code:this.state.error.code,isLoading:this.state.thumbIsLoading,onClick:this.tryFetchThumbnail}):React.createElement("div",{className:"file-preview-wrapper",onClick:this.props.onClick},React.createElement("a",{href:this.props.file.url,target:"_blank",title:r["default"].basename(this.props.file.name),onClick:this._onClick,ref:"preview_thumbnail_container"}))},tryFetchThumbnail:function(){var e=this;this.loadThumbnail().then(function(){d["default"].thumbnailLoadedSuccess(e)},function(t){t=t||null,d["default"].thumbnailLoadedError({error:t,instance:e})})},loadThumbnail:function(){var e=this,t=this.props.file,a=new o["default"](function(a,n){var i=u["default"].message_image_loading_timeout;return t.preview_thumbnail._isLoaded?o["default"].resolve(!0):(t.is_authenticated?d["default"].fetchSignedThumbnail(t,function(e){g["default"].image.changeSrc(t.preview_thumbnail,e.temp_url,i).then(a,n)},function(e){if(e.status){var t={code:e.status};n(t)}}):g["default"].image.changeSrc(t.preview_thumbnail,t.thumb_url,i).then(a,n),void d["default"].thumbnailIsLoading(e))});return a}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(582),o=n(i),s=a(314),r=n(s),l=a(329),u=n(l),c=a(313),d=n(c);t["default"]=React.createClass({displayName:"FileErrorMessageType",mixins:[r["default"]],propTypes:{code:React.PropTypes.number.isRequired,title:React.PropTypes.string,isLoading:React.PropTypes.bool,description:React.PropTypes.string,onClick:React.PropTypes.func},render:function(){var e=o["default"][this.props.code]||o["default"].default_error,t=this.props.title||e.title,a=this.props.description||e.description,n=(0,d["default"])({"file-error-message":!0});return React.createElement("div",{className:n},React.createElement("h3",null,t),React.createElement("div",null,a),React.createElement("div",null,this.props.onClick?this.renderTryAgainButton():""))},renderTryAgainButton:function(){return this.props.isLoading?React.createElement("div",{className:"file-error-spinner"},React.createElement(u["default"],{size:"small",spin:!!this.props.isLoading})):React.createElement("a",{onClick:this.props.onClick},"Try again")}}),e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={401:{title:"Not authenticated",description:"We couldn't authenticate your account. If this keeps happening, try logging in again."},403:{title:"Not authorized",description:"You don't have permission to view this file."},404:{title:"File not found",description:"We couldn't find the file."},default_error:{title:"We couldn't load the file",description:"There's a problem loading the file from the server."}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(191),o=n(i),s=a(367),r=n(s),l=a(575),u=n(l);t["default"]=React.createClass({displayName:"LinkMessageType",mixins:[r["default"]],render:function(){var e=_.clone(this.props.msg.link_details);return e.icon=e.favicon_url||e.icon&&e.icon.url,e.description=e.desc||e.description,e.url=e.id=e.full_url||e.url,e.title=e.header_text||e.title,e.style="link",React.createElement(u["default"],(0,o["default"])({},e,{show_always:"true"}))},_getHostname:function(e){var t=document.createElement("a");return t.href=e,t.hostname}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(99),o=n(i),s=a(185),r=n(s),l=a(585),u=n(l),c=a(586),d=n(c),f=a(313),h=n(f),p=a(177),m=n(p),g=a(435),v=n(g),y=a(178),b=n(y),w=a(367),R=n(w);t["default"]=React.createClass({displayName:"ImageMessageType",mixins:[R["default"]],getInitialState:function(){return{userExpanded:null,timeout:!1}},_isGifV:function(){return"image"===this.props.msg.type&&!!_.get(this.props.msg,"link_details.mp4")},_isUserExpanded:function(){return!this.props.msg.is_collapsed},_shouldBeExpanded:function(){var e=o["default"].file.get_extension(this.props.msg.link_details.image);return this.props.shouldHideAttachedCards?!1:this.props.shouldHideGifs?!/^gif/.test(e):!0},_isExpanded:function(){return null===this.state.userExpanded?this._shouldBeExpanded()?this._isUserExpanded():!1:this.state.userExpanded},_getCollapsedImage:function(){return React.createElement("div",{className:"info"},React.createElement("i",null,r["default"].image_hidden))},_getExpandedImage:function(){var e,t={ref:"image",msg:this.props.msg};return e=this._isGifV()?React.createElement(d["default"],t):React.createElement(u["default"],t),React.createElement("div",{className:"image-preview-wrapper"
},e)},_onClick:function(e){m["default"].shouldOpenFileViewer(e)&&(e.preventDefault(),v["default"].openInFileViewer(this.props.msg.link_details))},_toggleImage:function(){var e=this._isExpanded();this.setState({userExpanded:!e}),b["default"].toggleImage({jid:this.props.msg.room,mid:this.props.msg.mid})},render:function(){var e,t=this._isExpanded(),a=(0,h["default"])({"toggle-image":!0,collapse:t,expand:!t});return e=t?this._getExpandedImage():this._getCollapsedImage(),React.createElement("div",{className:"msg-line","data-mid":this.props.msg.mid},React.createElement("div",{className:"toggle-wrap",onClick:this._toggleImage},React.createElement("span",{className:a})),e)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(435),o=n(i),s=a(177),r=n(s),l=a(367),u=n(l),c=a(450),d=n(c);t["default"]=React.createClass({displayName:"ImageComponentType",mixins:[u["default"],d["default"]],componentDidMount:function(){if(this._setImageSrc(),this.props.msg.media_loaded){var e=ReactDOM.findDOMNode(this.refs.image),t=_.get(this.props.msg,"media_sizes",{})[this.props.msg.link_details.image];t&&t.width&&t.height&&(e.width=t.width,e.height=t.height)}},componentDidUpdate:function(){this.state.failed||this._setImageSrc()},_setImageSrc:function(){var e=ReactDOM.findDOMNode(this.refs.image),t=this.props.msg.link_details.image;e.src!==t&&(e.src=this.props.msg.link_details.image)},_onClick:function(e){r["default"].shouldOpenFileViewer(e)&&(e.preventDefault(),o["default"].openInFileViewer(this.props.msg.link_details))},render:function(){return React.createElement("a",{href:this.props.msg.link_details.url,target:"_blank",title:r["default"].basename(this.props.msg.link_details.url),onClick:this._onClick},React.createElement("img",{ref:"image",src:""}))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(367),o=n(i),s=a(450),r=n(s),l=a(585),u=n(l);t["default"]=React.createClass({displayName:"gifv",mixins:[o["default"],r["default"]],componentDidMount:function(){var e=ReactDOM.findDOMNode(this.refs.video),t=ReactDOM.findDOMNode(this.refs.mp4),a=ReactDOM.findDOMNode(this.refs.webm),n=this.props.msg.link_details.mp4,i=this._getWebM();if(e&&(this._canPlayMp4()?e.src=n:e.src=i,t.src=n,a.src=i,this.props.msg.media_loaded)){var o=this._canPlayMp4()?n:i,s=_.get(this.props.msg,"media_sizes",{})[o];s&&s.width&&s.height?(e.width=s.width,e.height=s.height):this.setState({failed:!0})}},getVideo:function(){return React.createElement("a",{href:this.props.msg.link_details.url,target:"_blank",title:this.props.msg.link_details.name||this.props.msg.link_details.url},React.createElement("video",{ref:"video",mute:"true",loop:"true",src:"",autoPlay:"true"},React.createElement("source",{ref:"mp4",src:""}),React.createElement("source",{ref:"webm",src:""})))},getFailedState:function(){return React.createElement(u["default"],this.props)},render:function(){return this.state.failed?this.getFailedState():this.getVideo()},_getWebM:function(){return this.props.msg.link_details.webm||this.props.msg.link_details.mp4.replace(/\.mp4/,".webm")},_canPlayMp4:function(){var e=ReactDOM.findDOMNode(this.refs.video);return e.canPlayType&&e.canPlayType("video/mp4")}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(99),o=n(i),s=a(435),r=n(s),l=a(177),u=n(l),c=a(575),d=n(c),f=a(367),h=n(f);t["default"]=React.createClass({displayName:"VideoMessageType",mixins:[h["default"]],render:function(){return React.createElement(d["default"],{id:this.props.msg.mid,url:this.props.msg.link_details.url,style:"link",thumbnail:{url:this.props.msg.link_details.thumb},icon:"/wc/assets/img/youtube-favicon-32.png",title:this.props.msg.link_details.title,description:"",fallback:this.getFallbackMessage(),mid:this.props.msg.mid})},getFallbackMessage:function(){return React.createElement("div",{className:"msg-line","data-mid":this.props.msg.mid},React.createElement("div",{"data-mid":this.props.msg.mid,className:"video-wrap"},React.createElement("a",{href:this.props.msg.link_details.url,className:"file-video-default-poster",onClick:this._onClick},React.createElement("img",{src:this.props.msg.link_details.thumb})),React.createElement("p",{className:"linkTitle"},React.createElement("a",{href:this.props.msg.link_details.url,target:"_blank"},this.props.msg.link_details.title)),React.createElement("p",{className:"linkDesc"},o["default"].formatNumber(this.props.msg.link_details.views)," views",React.createElement("br",null),this.props.msg.link_details.author)))},_onClick:function(e){u["default"].shouldOpenFileViewer(e)&&(e.preventDefault(),r["default"].openInFileViewer(this.props.msg.link_details))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(367),o=n(i);t["default"]=React.createClass({displayName:"UserStateMessageType",mixins:[o["default"]],render:function(){return React.createElement("div",{className:"state info msg-line","data-mid":this.props.msg.mid},this.props.msg.body)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i),s=a(121),r=n(s),l=a(367),u=n(l);t["default"]=React.createClass({displayName:"TwitterStatusMessageType",mixins:[u["default"]],componentWillMount:function(){this.onTwitterEmbedRendered=function(e){o["default"].dispatch("twitter-card-rendered",{element:e.target}),twttr.events.unbind("rendered",this.onTwitterEmbedRendered)},this._isEmbedded=!(!window.HC||!HC.isEmbeddedComponent),!this._isEmbedded&&r["default"].render_twitter_cards&&(this._debouncedTwttrLoad=_.debounce(twttr.widgets.load,100,{leading:!0,trailing:!1}),twttr.events.bind("rendered",this.onTwitterEmbedRendered))},componentDidMount:function(){!this._isEmbedded&&r["default"].render_twitter_cards&&this._debouncedTwttrLoad()},componentWillUnmount:function(){!this._isEmbedded&&r["default"].render_twitter_cards&&twttr.events.unbind("rendered",this.onTwitterEmbedRendered)},render:function(){var e;return e=this._isEmbedded||!r["default"].render_twitter_cards?React.createElement("div",{"data-mid":this.props.msg.mid,className:"link-wrap",dangerouslySetInnerHTML:{__html:'<a class="linkImage" name="link" target="_blank" href="http://twitter.com/'+(this.props.msg.link_details.screen_name||this.props.msg.link_details.screenName)+'" ><img class="twitterAvatar" height="48" width="48" src="'+(this.props.msg.link_details.profile_image_url||this.props.msg.link_details.profileImageUrl)+'" /></a><p class="tweet">'+this.props.msg.body+'</p><p class="linkDesc tweet">â '+this.props.msg.link_details.name+' (<a target="_blank" href="http://twitter.com/'+(this.props.msg.link_details.screen_name||this.props.msg.link_details.screenName)+'" >@'+(this.props.msg.link_details.screen_name||this.props.msg.link_details.screenName)+"</a>) via "+this.props.msg.link_details.source+"</p>"}}):React.createElement("blockquote",{className:"twitter-tweet hidden"},React.createElement("p",null,this.props.msg.body),React.createElement("a",{href:this.props.msg.link_details.url},this.props.msg.link_details.url)),React.createElement("div",{className:"msg-line","data-mid":this.props.msg.mid},e)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(99),o=n(i),s=a(367),r=n(s);t["default"]=React.createClass({displayName:"TwitterUserMessageType",mixins:[r["default"]],render:function(){return React.createElement("div",{className:"msg-line","data-mid":this.props.msg.mid},React.createElement("div",{"data-mid":this.props.msg.mid,className:"link-wrap",dangerouslySetInnerHTML:{__html:'<a class="linkImage" name="link" target="_blank" href="http://twitter.com/'+(this.props.msg.link_details.screen_name||this.props.msg.link_details.screenName)+'" ><img class="twitterAvatar" height="48" width="48" src="'+(this.props.msg.link_details.profile_image_url||this.props.msg.link_details.profileImageUrl)+'" /></a><p class="linkDesc tweet">'+this.props.msg.link_details.name+' (<a target="_blank" href="http://twitter.com/'+(this.props.msg.link_details.screen_name||this.props.msg.link_details.screenName)+'" >@'+(this.props.msg.link_details.screen_name||this.props.msg.link_details.screenName)+'</a>)</p><p class="followers">'+o["default"].formatNumber(this.props.msg.link_details.followers)+" followers</p>"}}))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(313),o=n(i),s=a(178),r=n(s),l=a(9),u=n(l),c=a(421),d=n(c),f=a(437),h=n(f),p=a(592),m=n(p),g=a(593),v=n(g),y=a(167),b=n(y),w=a(594),R=n(w),k=a(596),E=n(k);t["default"]=React.createClass({displayName:"ActionableMessageWrapper",propTypes:{msg:React.PropTypes.shape({mid:React.PropTypes.string,room:React.PropTypes.string}),onActive:React.PropTypes.func,onInactive:React.PropTypes.func},getInitialState:function(){return{active:!1}},componentWillUnmount:function(){u["default"].unregister("chat-is-scrolling",this._dismiss)},_onShow:function(){r["default"].displayMessageAction({jid:this.props.msg.room}),u["default"].registerOnce("chat-is-scrolling",this._dismiss),this.setState({active:!0})},_onDismiss:function(){r["default"].hideMessageAction({jid:this.props.msg.room}),u["default"].unregister("chat-is-scrolling",this._dismiss),this.setState({active:!1})},render:function(){var e=(0,o["default"])({"actionable-msg-container":!0,"msg-line":!0,"hc-message-actions-active":this.state.active}),t=React.createElement(m["default"],{icon:"aui-iconfont-more",dropdown_id:"message-actions-"+this.props.msg.mid,lazy_options:this._renderOptions,location_horizontal:"left",onShow:this._onShow,onHide:this._onDismiss});return React.createElement("div",{className:e,key:this.props.msg.mid},t,this.props.children)},_renderOptions:function(){var e=this,t=d["default"].getExtensionsByLocationAndContext("hipchat.message.action",{message:this.props.msg}),a=[],n=void 0;t.length>0?a=_.map(t,function(t){return React.createElement(v["default"],{action:t,msg:e.props.msg,key:b["default"].to_full_key(t.addon_key+":"+t.key)})}):this.props.is_editable&&this.props.message_editing_enabled||(a=[React.createElement("li",{key:this.props.msg.mid},React.createElement("a",{className:"disabled",title:h["default"].empty_message_actions_title},h["default"].empty_message_actions))]),this.props.message_editing_enabled&&this.props.is_editable&&(n=React.createElement("div",{className:"aui-dropdown2-section"},React.createElement("ul",null,React.createElement(R["default"],{msg:this.props.msg}),React.createElement(E["default"],{msg:this.props.msg}))));var i=void 0;return i=this.props.message_editing_enabled&&n&&a.length>0?React.createElement("div",{className:"aui-dropdown2-section"},React.createElement("ul",{className:"aui-list-truncate"},a)):React.createElement("ul",{className:"aui-list-truncate"},a),React.createElement("div",null,n,i)},_dismiss:function(){r["default"].dismissActionsDropDown()}}),e.exports=t["default"]},function(e,t,a){"use strict";var n=a(9);e.exports=React.createClass({displayName:"ActionsDropDown",propTypes:{dropdown_id:React.PropTypes.string,lazy_options:React.PropTypes.func,onShow:React.PropTypes.func,onHide:React.PropTypes.func,default_option:React.PropTypes.oneOf(["first","last"])},getDefaultProps:function(){return{onShow:_.noop,onHide:_.noop,onItemSelect:_.noop,button_class:"aui-button aui-button-subtle aui-dropdown2-trigger-arrowless",default_option:"first"}},shouldComponentUpdate:function(){return!1},componentDidMount:function(){this._getContainer().on("aui-dropdown2-hide",this._onDismiss),this._getContainer().on("aui-dropdown2-show",this._onShow)},componentWillUnmount:function(){this._getContainer().off(),$(window).off("resize",this._dismiss),n.unregister("dismiss-active-actions-dropdown",this._dismiss)},render:function(){return React.createElement("div",{className:"hc-dropdown"},this._renderTrigger(),this._renderContainer())},_onShow:function(){var e=this._getTrigger(),t=this._getContainer();this.props.lazy_options&&ReactDOM.render(this._renderOptions(),t[0]),($("body").height()<t.position().top+t.height()||"above"===this.props.location)&&(t.css("top",t.position().top-t.outerHeight()-e.outerHeight()+"px"),t.addClass("hc-dropdown-above"),e.addClass("hc-dropdown-above")),"left"===this.props.location_horizontal&&t.css("left",e.offset().left+e.outerWidth()-t.outerWidth()),n.registerOnce("dismiss-active-actions-dropdown",this._dismiss),$(window).one("resize",this._dismiss),"last"===this.props.default_option&&t.one("aui-dropdown2-item-selected",function(){t.find(".active.aui-dropdown2-active").removeClass("active aui-dropdown2-active"),t.find("a").last().addClass("active aui-dropdown2-active")}),this.props.onShow()},_onDismiss:function(){var e=this._getContainer(),t=this._getTrigger();e.removeAttr("style"),e.removeClass("hc-dropdown-above"),t.removeClass("hc-dropdown-above"),$(window).off("resize",this._dismiss),n.unregister("dismiss-active-actions-dropdown",this._dismiss),this.props.lazy_options&&ReactDOM.unmountComponentAtNode(e[0]),this.props.onHide()},_renderContainer:function(){var e;return this.props.lazy_options||(e=this._renderOptions()),React.createElement("div",{className:"aui-style-default aui-dropdown2 hc-dropdown-container",id:this.props.dropdown_id,"aria-hidden":"true"},e)},_renderTrigger:function(){return React.createElement("button",{className:"hc-dropdown-trigger aui-dropdown2-trigger "+this.props.button_class,"aria-owns":this.props.dropdown_id,"aria-haspopup":"true","data-container":this.props.container,id:this.props.dropdown_id+"-trigger","data-no-focus":!0},React.createElement("span",{className:"aui-icon aui-icon-small "+this.props.icon}))},_renderOptions:function(){var e=this.props.children;return this.props.lazy_options&&(e=this.props.lazy_options()),React.createElement("div",{className:"aui-dropdown2-section"},e)},_getContainer:function(){return AJS.$("#"+this.props.dropdown_id)},_getTrigger:function(){return AJS.$("#"+this.props.dropdown_id+"-trigger")},_dismiss:function(){this._getTrigger().trigger("aui-button-invoke")}})},function(e,t,a){"use strict";var n=a(420);e.exports=React.createClass({displayName:"ActionsDropDownItem",propTypes:{msg:React.PropTypes.shape({mid:React.PropTypes.string,room:React.PropTypes.string}),action:React.PropTypes.shape({addon_key:React.PropTypes.string,full_key:React.PropTypes.string,key:React.PropTypes.string,target:React.PropTypes.shape({key:React.PropTypes.string})}),action_type:React.PropTypes.string},componentDidMount:function(){ReactDOM.findDOMNode(this.refs.element).addEventListener("click",this._onClick)},componentWillUnmount:function(){ReactDOM.findDOMNode(this.refs.element).removeEventListener("click",this._onClick)},render:function(){var e=this.props.action;return React.createElement("li",{key:e.full_key},React.createElement("a",{ref:"element","data-addon_key":e.addon_key,"data-action_key":e.key},e.name))},_onClick:function(){n.invokeAction(this.props.action,{msg:this.props.msg})}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(263),o=n(i),s=a(595),r=n(s);t["default"]=React.createClass({displayName:"EditMessage",propTypes:{msg:React.PropTypes.shape({mid:React.PropTypes.string,room:React.PropTypes.string,body:React.PropTypes.string})},render:function(){return React.createElement("a",{title:o["default"].edit_message,onClick:this._onClick},o["default"].edit_message)},_onClick:function(){r["default"].initiateMessageEdit(this.props.msg)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(9),o=n(i);t["default"]={initiateMessageEdit:function(e){o["default"].dispatch("initiate-edit-message",e)},initiateMessageDelete:function(e){o["default"].dispatch("initiate-delete-message",e)}},e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(263),o=n(i),s=a(595),r=n(s);t["default"]=React.createClass({displayName:"DeleteMessage",propTypes:{msg:React.PropTypes.shape({mid:React.PropTypes.string,room:React.PropTypes.string,body:React.PropTypes.string})},render:function(){return React.createElement("a",{title:o["default"].delete_message,onClick:this._onClick},o["default"].delete_message)},_onClick:function(){r["default"].initiateMessageDelete(this.props.msg)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(313),o=n(i),s=a(178),r=n(s);t["default"]=React.createClass({displayName:"AttachedCardsToggle",propTypes:{mid:React.PropTypes.string,collapsed:React.PropTypes.bool},_onToggle:function(){r["default"].toggleAttachedCards(this.props.mid)},render:function(){var e=this.props.collapsed,t=(0,o["default"])({"toggle-attached":!0,expand:e,collapse:!e}),a=e?"Show card":"Hide card";return React.createElement("div",{className:"toggle-attached-container",title:a,onClick:this._onToggle},React.createElement("span",{className:t},a))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(132),o=n(i),s=a(172),r=n(s);t["default"]=React.createClass({displayName:"ChatWindowMessageWrapper",_onClick:function(e){var t="a"===_.get(e,"target.tagName","").toLowerCase(),a=_.get(e,"target.href",null),n=this.props.msg.room,i=this.props.chat_id;!this.props.is_guest&&t&&a&&o["default"].isVideoLink(a)&&(e.preventDefault(),r["default"].joinRoomVideoCall({url:a,jid:n,room_id:i}))},render:function(){var e=void 0,t=void 0;return"failed"===this.props.messageStatus?(e="failed_message",t="msg-status msg-failed"):"flaky"===this.props.messageStatus?(e="flaky_message",t="msg-status msg-fail-container msg-flaky hc-msg-loading"):"unconfirmed"===this.props.messageStatus?(e="unconfirmed_message",t=this.props.honest_messages_enabled?"msg-status msg-unconfirmed":"msg-status msg-confirmed"):(e="confirmed_message",t="file"===this.props.msg.type?"msg-status msg-confirmed hc-msg-file":"msg-status msg-confirmed"),React.createElement("div",{ref:e,onClick:this._onClick,className:t},this.props.innerMessage)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return(0,B["default"])(e)||(0,U["default"])(e),_.isArray(e)?e.forEach(i):_.isObject(e)&&_.forOwn(e,i),e}function o(e,t){return _.isFunction(t)&&(t=t(e)),_.defaultsDeep({},t,e)}function s(e){return[e.sortTime||e.time,e.time]}function r(e,t){var a=_.sortedLastIndexBy(e,t,s);e.splice(a,0,t)}function l(e,t,a){var n=_.findIndex(e.messages,{mid:t});if(-1!==n){var s=e.messages[n],l=o(s,a),u=_.clone(e.messages);return s.time===l.time?u.splice(n,1,l):(u.splice(n,1),r(u,l)),i(u),e.messages=u,l}}function u(e){return he.lastIndex=0,he.test(e)||!!_.findKey(le.smileys,function(t){return t.regex.lastIndex=0,t.regex.test(e)})}function c(e){return _.sortBy(e,s)}function d(e){return e.is_presence_message||e.is_missed_call_message||_.includes(["unconfirmed","failed","flaky"],e.status)}function f(e){return _.reject(e,d)}function h(e,t){var a=e.unreadCount||0;if(e.isScrolledToBottom)return ne["default"].chat_room_trim_buffer+a;var n=t.length-_.findLastIndex(t,{mid:e.oldestVisibleMessageMid});return ne["default"].chat_room_trim_buffer+a+n}function p(e,t){return e.isScrolledToBottom&&t.length>ne["default"].chat_room_trim_buffer?t.length-1:t.length}function m(e,t){var a=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];if(a&&!e.sortTime){var n=q["default"].getAttachToMid(e);if(n){var i=t(n);if(i){e.sortTime=i.time;var o=(e.time-i.time)/60;o>ne["default"].notification_attach_to_reorder_limit_mins&&(e.sortTime=e.time)}}}}function g(e,t){function a(a){var n=void 0;return o||(o=_.keyBy(t,"mid")),n=o[a],n||(s||(s=_.keyBy(e,"mid")),n=s[a]),n}var n=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];if(!t.length)return e;var i=_.clone(e),o=null,s=null;return t.forEach(function(e){m(e,a,n);var t=_.findIndex(i,{mid:e.mid});t>-1?i.splice(t,1,e):r(i,e)}),i}Object.defineProperty(t,"__esModule",{value:!0});var v=a(59),y=n(v),b=a(100),w=n(b),R=a(117),k=n(R),E=a(114),C=n(E),S=a(157),T=n(S),x=a(10),A=n(x),I=a(4),N=n(I),M=a(5),O=n(M),D=a(22),P=n(D),j=a(51),L=n(j),F=a(136),U=n(F),H=a(600),B=n(H);t.hasEmoticons=u,t.sortMessages=c,t.withoutManufacturedMessages=f,t.getMessageCountToPreserveInBg=h,t.getMessageCountToPreserve=p,t.addSortTime=m,t.addNewMessages=g;var z=a(99),q=n(z),V=a(103),G=n(V),W=a(206),$=n(W),Y=a(97),K=n(Y),X=a(161),J=n(X),Q=a(9),Z=n(Q),ee=a(173),te=n(ee),ae=a(121),ne=n(ae),ie=a(90),oe=n(ie),se=a(218),re=n(se),le=a(110),ue=a(196),ce=n(ue),de=a(603),fe=i([]),he=/\([a-z0-9]*\)/gi,pe=function(e){function t(){(0,N["default"])(this,t);var e=(0,P["default"])(this,(0,A["default"])(t).call(this));return e.local={should_queue_changes:{},queued_messages:{},echoed_chats:{},replacement_messages:{},flaky_network_failed_timestamp:!1,flaky_network_recoverable_timestamp:!1,failed_messages:[],messages_timers:{},history_timers:{}},e}return(0,L["default"])(t,e),(0,O["default"])(t,[{key:"getNowTimestamp",value:function(){var e=Date.now()/1e3;return q["default"].format_time_for_history(e)}},{key:"getChatDefaults",value:function(){return{name:"",jid:"",messages:[],oldest_timestamp:"",newest_timestamp:this.getNowTimestamp(),oldest_mid:"",newest_mid:"",scrollTop:"",isScrolledToBottom:!0,active:!1,fully_initialized:!1,fetching_recent:!1,fetching_ancient:!1,ancient_history_is_empty:!1,has_no_message_history:!1,should_scroll_to_bottom:!0,ancient_msgs:{},recent_msgs:{},is_composing:!1,last_active:!1,has_been_cleared:!1}}},{key:"getDefaults",value:function(){return{current_user:{},chats:{},active_chat:!1,active_chat_changed_token:null,mentionRegex:null,emoticons:{},preferences:{},initialized:!1,replace_text_emoticons:J["default"].shouldReplaceTextEmoticons(),chat_show_sidebar:J["default"].shouldShowChatSidebar(),groupchat_show_sidebar:J["default"].shouldShowGroupChatSidebar(),zoom_level:1,web_server:""}}},{key:"registerListeners",value:function(){var e=this;Z["default"].registerOnce({"hc-init":function(){e.set("active_chat",J["default"].getChatToFocus())},"initialize-chat-window-store":function(t){e.set(t)}}),Z["default"].register({"updated:config":function(t){e.set({attach_reordering_enabled:_.get(t,"feature_flags.web_client_attach_to_message_reorder_enabled"),honest_messages_enabled:_.get(t,"feature_flags.web_client_honest_messages")})},"updated:emoticons":function(t){e.updateEmoticons(t)},"updated:web_server":function(t){e.data.web_server=t},"updated:current_user":function(t){e.data.current_user.user_jid=t.user_jid,e.data.current_user.is_guest=t.is_guest},"updated:mentionRegex":function(t){e.data.mentionRegex=t},"updated:activeRooms":function(t){e.updateRooms(t)},"updated:newMessages":function(t){e.updateChatMessages(t)},"updated:preferences":function(t){e._onPreferencesUpdated(t)},"before:updated:active_chat":function(t){var a=e.data.chats[e.data.active_chat];a&&(t!==e.data.active_chat&&(a.last_read_indicated=null),e.data.chats[e.data.active_chat].fully_initialized&&(e.flushQueue(e.data.active_chat),e.updateMessageBounds(a),a.last_active=new Date))},"updated:active_chat":function(t){q["default"].jid.is_chat(t)&&e.data.chats[t]&&e.data.initialized?e.handleRoomSelect(t):e.set("active_chat",t),Z["default"].dispatch("close-file-viewer")},"send-message":function(t){e.data.chats[t.jid].should_scroll_to_bottom=!0,e.data.chats[t.jid].fetching_ancient||e.flushQueue(t.jid)},"upload-file":function(t){e.data.chats[t.jid].should_scroll_to_bottom=!0},"toggle-image":function(t){e.toggleImage(t.jid,t.mid)},"retry-failed-message":function(t){e.resendMessage(t)},"cancel-failed-message":function(t){e.removeFailedMessage(t)},"clear-messages":function(t){var a=e.data.chats[t.jid];a&&(a.messages=fe,a.has_been_cleared=!0,e.updateChats(t.jid))},"app-state-ready":function(){e.data.current_user.is_guest&&(e.data.chats[e.data.active_chat].fully_initialized=!0),e.set("initialized",!0),q["default"].jid.is_chat(e.data.active_chat)&&e.handleRoomSelect(e.data.active_chat)},"readstate-received":function(){q["default"].jid.is_chat(e.data.active_chat)&&e.data.chats[e.data.active_chat]&&e.handleRoomSelect(e.data.active_chat)},"initial-join-presence-sent":function(t){e.data.chats[t.jid]&&t.with_history&&(e.initialJoinWithHistory(t.jid),e.handleRoomSelect(t.jid))},"set-scroll-value":function(t){_.assign(e.data.chats[t.jid],{scrollTop:t.scrollTop,isScrolledToBottom:t.isScrolledToBottom,should_scroll_to_bottom:t.should_scroll_to_bottom})},"message-media-loaded":function(t){if(!e.data.chats[t.jid])return void oe["default"].type("message-media-loaded").error("Room is not found",t.jid);var a=l(e.data.chats[t.jid],t.mid,{media_loaded:!0});a&&e.updateChats(a.room)},"message-media-size-found":function(t){if(!e.data.chats[t.jid])return void oe["default"].type("message-media-size-found").error("Room is not found",t.jid);var a=l(e.data.chats[t.jid],t.mid,{media_sizes:(0,T["default"])({},t.src,t.size)});a&&e.updateChats(a.room)},"display-message-action":function(t){var a=_.get(e.data.chats,t.jid,{}),n=a.should_scroll_to_bottom,i=a.message_action_active||!1,o={should_scroll_to_bottom:n,message_action_active:i},s=_.get(a,"message_action_previous_state",[]);s.push(o),_.assign(e.data.chats[t.jid],{should_scroll_to_bottom:!1,isScrolledToBottom:!1,message_action_active:!0,message_action_previous_state:s})},"hide-message-action":function(t){var a=_.get(e.data.chats,t.jid,{}),n=_.get(a,"message_action_previous_state",[{should_scroll_to_bottom:a.should_scroll_to_bottom,message_action_active:!1}]),i=n.pop(),o=i.should_scroll_to_bottom,s=i.message_action_active;_.assign(e.data.chats[t.jid],{should_scroll_to_bottom:o,message_action_active:s,message_action_previous_state:n}),e.updateChats(t.jid)},"chat-is-scrolling":function(t){e.local.should_queue_changes[t.jid]=t.scrolling,t.scrolling||e.flushQueue(t.jid)},"requesting-ancient-history":function(t){e.data.current_user.is_guest||e.fetchXMPPHistory(t.jid)},"network-down":function(){e.local.flaky_network_failed_timestamp=q["default"].now()+$["default"].Connection.getSessionRecoveryTime(),e.local.flaky_network_recoverable_timestamp=q["default"].now()+ne["default"].flaky_network_message_timeout},"network-up":function(){e.local.flaky_network_failed_timestamp=!1,e.local.flaky_network_recoverable_timestamp=!1},"strophe-reconnected":function(){Z["default"].registerOnce("after:updated:config",function(){Z["default"].dispatch("hide-join-messages"),e.local.flaky_network_failed_timestamp=!1,e.local.flaky_network_recoverable_timestamp=!1,e.data.current_user.is_guest||(_.forEach(_.filter(e.data.chats,"fully_initialized"),function(t){e.fetchAPIHistory(t.jid)}),_.forEach(e.data.chats,function(t){t.fetching_ancient&&e.fetchXMPPHistory(t.jid,!0)}),q["default"].jid.is_chat(e.data.active_chat)&&e.data.chats[e.data.active_chat]&&!e.data.chats[e.data.active_chat].fully_initialized&&e.fetchXMPPHistory(e.data.active_chat,!0))})},"show-empty-state":function(t){e.data.chats[t.jid].ancient_history_is_empty=!0,e.updateChats(t.jid)},"status-message-received":function(t){e.handleUserStateMessage(t)},"replacement-message-received":function(t){e.local.replacement_messages[t.jid]?e.local.replacement_messages[t.jid].push(t):e.local.replacement_messages[t.jid]=[t]},"set-chat-panel-zoom":function(t){e.set({zoom_level:t.zoom})},"toggle-attached-cards":function(t){e.toggleAttachedCards(t)},"before:API:fetched-recent-history":function(t){var a=e.data.chats[t.jid];a&&t.mid&&-1===_.map(t.results,"id").indexOf(t.mid)&&e.removeChatMessages(t.jid)},"API:fetched-recent-history":function(t){e.handleRecentHistoryFetched(t)},"get-last-message-sent-by-current-user":function(t){t.cb(e.getLastSentMessageByCurrentUser(t.jid))},"get-public-url-from-thumbnail":function(t,a,n){e.getPublicUrlFromThumbnail(t,a,n)}})}},{key:"updateEmoticons",value:function(e){this.data.emoticons=e}},{key:"getPublicUrlFromThumbnail",value:function(e,t,a){var n=null,i=null,o=this.get("chats")[t],s=o&&o.messages||[],r=!0,l=!1,u=void 0;try{for(var c,d=(0,C["default"])(s);!(r=(c=d.next()).done);r=!0){var f=c.value;if(f.file_data&&f.file_data.preview_thumbnail&&f.file_data.preview_thumbnail.src===e){n=f.file_data;break}}}catch(h){l=!0,u=h}finally{try{!r&&d["return"]&&d["return"]()}finally{if(l)throw u}}n&&n.is_authenticated&&(i=n.url),a(i)}},{key:"updateRooms",value:function(e){var t,a=this,n=_.keys(e),i=_.difference(_.keys(this.data.chats),n);i.length?(this.data.chats=_.omit(this.data.chats,i),t=!0):_.forEach(n,function(n){a.data.chats[n]?(a.data.chats[n].name!==e[n].name&&(a.data.chats[n].name=e[n].name,t=!0),_.assign(a.data.chats[n],e[n])):(a.data.chats[n]=_.assign({},a.getChatDefaults(),{name:e[n].name,jid:n,active:n===a.data.active_chat,last_active:new Date}),a.data.chats[n].messages=fe,t=!0)}),t&&this.set({chats:this.data.chats,active_chat_changed_token:{}})}},{key:"handleRoomSelect",value:function(e){var t=this.data.chats[e];t.fully_initialized&&""!==t.newest_mid||t.has_no_message_history||this.data.current_user.is_guest||this.fetchXMPPHistory(e),this.updateMessageBounds(t);var a=t.messages;e!==this.data.active_chat&&(t.messages=this.updateLastReadForMessages(t),this.data.active_chat=e),a!==t.messages&&i(t.messages),t.has_been_cleared||this.checkIfEmpty(e),this.updateAncientHistoryMarker(e),this.updateChats(e)}},{key:"updateLastReadForMessages",value:function(e){var t=[];return _.get(e,"last_read_message.mid")!==_.get(e,"most_recent_message.mid")&&(e.last_read_indicated=_.clone(e.last_read_message)),e.messages.forEach(function(a,n,i){var s=Number(a.ts)||Number(a.time),r=i[n+1],l=null,u=_.get(e,"last_read_indicated.timestamp");if(r&&(l=Number(r.ts)||Number(r.time)),_.get(a,"last_read_message")&&(a=o(a,{last_read_message:!1})),u>=s&&r&&l>u){if(_.get(r,"attach-to.id")!==a.mid)return t.push(o(a,{last_read_message:!0}));e.last_read_indicated={mid:r.mid,timestamp:r.ts}}return t.push(a)}),t}},{key:"updateMessageBounds",value:function(e){if(_.isEmpty(e.messages))return void this.resetMessageBounds(e);var t=f(e.messages);if(t.length){var a=_.head(t),n=_.last(t);_.assign(e,{newest_timestamp:q["default"].format_time_for_history(n.time),newest_mid:n.mid.split("-link")[0],oldest_timestamp:q["default"].format_time_for_history(a.time),oldest_mid:a.mid.split("-link")[0]})}}},{key:"resetMessageBounds",value:function(e){_.assign(e,{oldest_timestamp:"",newest_timestamp:this.getNowTimestamp(),oldest_mid:"",newest_mid:""})}},{key:"trimMessages",value:function(e){var t,a,n=f(e.messages);if(t=this.chatIsBackgrounded(e.jid)?h(e,n):p(e,n),a=n.length-t,a>0){var i,o=_.take(n,a);return(i=_).without.apply(i,[e.messages].concat((0,k["default"])(o)))}return e.messages}},{key:"chatIsBackgrounded",value:function(e){var t=this.getChat(e),a=(0,G["default"])().subtract(ne["default"].chat_room_idle_timeout_minutes,"minutes");return t&&t.jid!==this.data.active_chat&&t.last_active!==!1&&(0,G["default"])(t.last_active).isBefore(a)}},{key:"getChat",value:function(e){return this.data.chats[e]}},{key:"updateChatMessages",value:function(e){var t,a=this;_.forEach(e,function(e,n){if(t=a.data.chats[n]){var i=n!==a.data.active_chat&&_.isEmpty(t.messages),o=_.reject(e,"is_presence_message").length;!t.fetching_ancient&&!i||t.fetching_recent||(_.merge(t.ancient_msgs,e),i&&!HC.isEmbeddedComponent&&!a.data.current_user.is_guest&&o&&a.fetchXMPPHistory(n)),
i&&!o||a.addMessages(n,_.keyBy(e,"mid"))}})}},{key:"_onPreferencesUpdated",value:function(){var e={preferences:J["default"].getAll()};this.get("replace_text_emoticons")!==J["default"].shouldReplaceTextEmoticons()&&(e.replace_text_emoticons=J["default"].shouldReplaceTextEmoticons(),e.chats=this._getFormattedChats()),e.chat_show_sidebar=J["default"].shouldShowChatSidebar(),e.groupchat_show_sidebar=J["default"].shouldShowGroupChatSidebar(),this.set(e)}},{key:"_getFormattedChats",value:function(){var e=_.clone(this.get("chats")),t=void 0,a=void 0,n=function(e,t){var a=t;return u(t.body)&&(a=o(t,{rendered_body:q["default"].escapeAndLinkify(t.body,{do_emoticons:J["default"].shouldReplaceTextEmoticons()})})),e.push(a),e};return _.forOwn(e,function(i,o){t=i.messages,a=t?t.reduce(n,[]):[],i.messages=a,e[o]=i}),e}},{key:"removeChatMessages",value:function(e){var t=this.data.chats[e];t&&(t.messages=fe,t.hasMessages=!1,this.resetMessageBounds(t),this.updateChats(e))}},{key:"scheduleConfirmationFailed",value:function(e,t){var a=this;if(e&&_.includes(["unconfirmed","failed"],t.status)){var n=this.local.messages_timers[e.jid]||{};this.local.messages_timers[e.jid]=n;var i=n[t.mid]||{};if(n[t.mid]=i,!i.failed_timer){var o=this.local.flaky_network_failed_timestamp?this.local.flaky_network_failed_timestamp-q["default"].now():ne["default"].default_message_confirmation_timeout;re["default"].isOnline()&&$["default"].isConnected()||(o=0),i.failed_timer=setTimeout(function(){var n=l(e,t.mid,{status:"failed"});n&&(a.cancelMessageTimers(e.jid,t.mid),a.local.failed_messages.push(n),a.updateChats(n.room))},o)}if(!i.flaky_timer&&!this.data.honest_messages_enabled){var s=this.local.flaky_network_recoverable_timestamp?this.local.flaky_network_recoverable_timestamp-q["default"].now():ne["default"].flaky_network_message_timeout;i.flaky_timer=setTimeout(function(){var n=l(e,t.mid,{status:"flaky"});n&&(a.cancelMessageTimers(e.jid,t.mid,"flaky_timer"),a.updateChats(n.room))},s)}}}},{key:"cancelMessageTimers",value:function(e,t,a){var n=this.local.messages_timers[e];if(n){var i=n[t];i&&(a?(clearTimeout(i[a]),i[a]=void 0):(clearTimeout(i.failed_timer),clearTimeout(i.flaky_timer),delete n[t]))}}},{key:"removeFailedMessage",value:function(e){var t=_.get(this.data,["chats",e.room]);if(t){var a=this.maybeRemoveMsg(t,e.mid);_.remove(this.local.failed_messages,{mid:e.mid}),a&&this.updateChats(e.room)}}},{key:"resendMessage",value:function(e){Z["default"].dispatch("resend-message",{text:e.original_body||e.body,jid:e.room,id:e.mid});var t=this.data.chats[e.room];if(t){var a=_.last(t.messages).time+1;l(t,e.mid,{status:"unconfirmed",time:a}),this.scheduleConfirmationFailed(t,e),this.updateChats(e.room)}}},{key:"addMessages",value:function(e,t){var a=this.data.chats[e];if(a&&!_.isEmpty(t)){if(a.has_no_message_history=!1,a.has_been_cleared=!1,this.local.should_queue_changes[e]){var n=this.local.queued_messages[e]||{};return void(this.local.queued_messages[e]=_.merge(n,t))}_.forEach(t,this.scheduleConfirmationFailed.bind(this,a));var o=a.messages,s=this.filterMessages(e,t);if(s.length){var r;a.messages=(r=_).without.apply(r,[a.messages].concat((0,k["default"])(s)))}var l=_.values(t);this.removeOldPresenceMessages(a,l),a.messages=g(a.messages,l,this.data.attach_reordering_enabled),this.chatIsBackgrounded(e)&&(a.messages=this.trimMessages(a)),a.messages=this.replaceMessageContent(e);var u=a.newest_mid;this.updateMessageBounds(a),e!==this.get("active_chat")&&u!==a.newest_mid&&(a.should_scroll_to_bottom=!0),!this.chatIsBackgrounded(e)&&a.fetching_ancient&&(a.messages=this.updateLastReadForMessages(a)),o!==a.messages&&i(a.messages),a.fully_initialized&&(a.hasMessages=!0,a.fetching_recent=!1,a.fetching_ancient=!1,this.updateChats(e))}}},{key:"flushQueue",value:function(e){this.local.should_queue_changes[e]=!1,this.addMessages(e,this.local.queued_messages[e]),this.local.queued_messages[e]={}}},{key:"updateChats",value:function(e){if(this.data.chats[e]){var t={chats:this.data.chats,active_chat:this.data.active_chat};e===this.data.active_chat&&(t.active_chat_changed_token={}),this.set(t)}}},{key:"handleUserStateMessage",value:function(e){var t=this,a=q["default"].jid.bare_jid(e.message.from),n=this.data.chats[a],i=q["default"].jid.bare_jid(_.get(e,"message.delay.from_jid"))||q["default"].jid.bare_jid(_.get(e,"message.from"));if(n&&i){switch(e.type){case"active":i!==this.data.current_user.user_jid&&(this.removeChatStateMessage(a),clearTimeout(this.local.composing_timeout));break;case"composing":if(i!==this.data.current_user.user_jid){var o=_.findLast(n.messages,{mid:n.newest_mid});(!o||e.message.ts-o.ts>1)&&(this.addChatStateMessage(a),clearTimeout(this.local.composing_timeout),this.local.composing_timeout=setTimeout(function(e){t.removeChatStateMessage(e)},ne["default"].composing_message_linger_timeout,a))}}this.updateChats(a)}}},{key:"fetchAPIHistory",value:function(e){this.data.chats[e]&&!this.data.current_user.is_guest&&(this.data.chats[e].fetching=!0,Z["default"].dispatch("API:fetch-recent-history",{params:{"not-before":this.data.chats[e].newest_mid||"","max-results":ne["default"].message_retrieval_chunk_size},path:{identifier:/@chat/.test(e)?q["default"].jid.user_id(e):this.data.chats[e].id,type:/@chat/.test(e)?"user":"room"},jid:e}))}},{key:"initialJoinWithHistory",value:function(e){this.data.current_user.is_guest||(this.data.chats[e].fetching_ancient=!0,this.local.should_queue_changes[e]=!0)}},{key:"fetchXMPPHistoryCallback",value:function(e){var t=this,a=e.from,n=e.id,i=e.error;if(i){if(oe["default"].type("fetch-history").error(a,e.error),this.local.history_timers[a]||(this.local.history_timers[a]={timer:null,attempts:0}),this.local.history_timers[a].attempts===ne["default"].chat_history_fetching_attempts)return void oe["default"].type("fetch-history").info("We are reaching max attempts for fetching history:",a);this.local.history_timers[a].timer=setTimeout(function(){var e=t.data.chats[a];e&&!e.fully_initialized&&t.fetchXMPPHistory(a,!0)},ne["default"].chat_history_fetching_attempt_timeout),this.local.history_timers[a].attempts++}else this.handleAncientHistoryLoaded({jid:a,id:n}),delete this.local.history_timers[a]}},{key:"fetchXMPPHistory",value:function(e,t){if(this.data.current_user.is_guest)return!1;if(te["default"].dispatch("analytics-request-history",{jid:e}),!this.data.chats[e].fetching_ancient||t){var a=this.data.chats[e].oldest_timestamp||null,n=this.fetchXMPPHistoryCallback.bind(this);this.data.chats[e].oldest_mid_before_fetch=_.get(this.data.chats[e],"messages[0].mid",""),this.data.chats[e].fetching_ancient=!0,this.local.should_queue_changes[e]=!0,Z["default"].dispatch("request-ancient-history",{jid:e,oldest:a},n)}}},{key:"handleRecentHistoryFetched",value:function(e){var t=this.data.chats[e.jid];q["default"].jid.is_chat(e.jid)&&t&&(t.populated_recent=!0,this.checkIfEmpty(e.jid)),this.updateAncientHistoryMarker(e.jid)}},{key:"handleAncientHistoryLoaded",value:function(e){var t=this.data.chats[e.jid];if(t){var a=0;this.flushQueue(e.jid),_.isEmpty(t.ancient_msgs)?t.ancient_history_is_empty=!0:(a=(0,w["default"])(t.ancient_msgs).length,t.ancient_msgs={}),t.fetching_ancient=!1,t.fully_initialized||(t.fully_initialized=!0,Z["default"].dispatch("chat-fully-initialized",{jid:e.jid})),this.checkIfEmpty(e.jid),this.updateChats(e.jid),Z["default"].dispatch("ancient-history-fetched",{}),this.sendHistoryLoadedAnalytics({jid:e.jid,size:a,id:_.get(this.data.chats,[e.jid,"id"])})}}},{key:"sendHistoryLoadedAnalytics",value:function(e){te["default"].dispatch("analytics-history-loaded",e),de.uiAvailablePromise.then(function(){ce["default"].handleLaunchToChatComplete(e)})}},{key:"updateAncientHistoryMarker",value:function(e){var t=this.data.chats[e];t&&t.messages.length>=ne["default"].message_retrieval_chunk_size&&(t.ancient_history_is_empty=!1)}},{key:"checkIfEmpty",value:function(e){var t=this.data.chats[e];!t||t.fetching_ancient||t.fetching_recent||!_.isEmpty(t.messages)||this.local.queued_messages[e]&&!_.isEmpty(this.local.queued_messages[e])||(t.has_no_message_history=!0,t.fully_initialized||(t.fully_initialized=!0))}},{key:"filterMessages",value:function(e,t){var a=this,n=this.data.chats[e],i=[];return _.forEach(t,function(o){var s=_.find(n.messages,{mid:o.id});if(s)a._markEchoedMessage(e,o),i.push(s);else if(ne["default"].slash_replacement_regex.test(o.body)&&o.id&&!o.is_history_message){var r=a.local.replacement_messages[e],l=_.findIndex(r,{mid:o.mid});r.splice(l,1),delete t[o.mid]}else t[o.id]?(a._markEchoedMessage(e,o),delete t[o.id]):a._wasMessagesAlreadyEchoed(e,o)?(a._markEchoedMessage(e,o),delete t[o.mid]):e===q["default"].jid.bare_jid(o.from)&&(n.is_composing=!1,clearTimeout(a.local.composing_timeout))}),i}},{key:"_wasMessagesAlreadyEchoed",value:function(e,t){return this.local.echoed_chats[e]&&this.local.echoed_chats[e].messages[t.id]}},{key:"_markEchoedMessage",value:function(e,t){this.cancelMessageTimers(e,t.id),t.is_echo=!0;var a=_.findIndex(this.local.failed_messages,{mid:t.id});-1!==a&&this.local.failed_messages.splice(a,1),this.local.echoed_chats[e]||(this.local.echoed_chats[e]={messages:{}}),this.local.echoed_chats[e].messages[t.id]=t}},{key:"addChatStateMessage",value:function(e){this.data.chats[e].is_composing||(e===this.data.active_chat&&this.smoothChangeChatStateMessage(e,!0),this.data.chats[e].is_composing=!0)}},{key:"removeChatStateMessage",value:function(e){this.data.chats[e].is_composing&&(e===this.data.active_chat?this.smoothChangeChatStateMessage(e,!1):this.data.chats[e].is_composing=!1)}},{key:"smoothChangeChatStateMessage",value:function(e,t){var a=this;this.local.should_queue_changes[e]=!0;var n=t?"add":"remove",i=new y["default"](function(t){setTimeout(function(){t(e)},ne["default"].chat_scroll_duration),Z["default"].dispatch(n+"-chat-state-message",{jid:e})});i.then(function(e){a.data.chats[e].is_composing=t,a.flushQueue(e),a.updateChats(e)})}},{key:"replaceMessageContent",value:function(e){var t=this.local.replacement_messages[e],a=this.data.chats[e].messages;return _.isEmpty(t)?a:(a=_.clone(a),t.forEach(function(e){var t=_.findLastIndex(a,{mid:e.mid});if(t>-1&&a.splice(t,1),t=_.findLastIndex(a,function(t){return t.time<=e.time&&String(t.sender_id)===String(e.sender_id)}),t>-1&&!e.edited_message){var n=a[t],i=void 0;if(n.isEmote){var s=n.body.slice(0,3),r=n.body.slice(3);i=r.replace(e.text_to_replace,e.replacement_text),i=q["default"].replaceEmoteMessage(s+i,n.sender)}else i=n.body.replace(e.text_to_replace,e.replacement_text);var l=o(n,{body:i});q["default"].formatMessageBody(l),a.splice(t,1,l)}if(t=_.findIndex(a,{mid:_.get(e,"replace.id")}),t>-1&&e.edited_message||t>-1&&e.is_deleted){var u={body:e.edited_message,replace:e.replace,is_deleted:e.is_deleted};_.get(a[t],"file_data.desc",!1)&&(u.file_data={desc:e.edited_message,is_deleted:e.is_deleted});var c=o(a[t],u);q["default"].formatMessageBody(c),a.splice(t,1,c)}}),this.local.replacement_messages[e].length=0,_.sortBy(a,"time"))}},{key:"toggleImage",value:function(e,t){var a=this.data.chats[e],n=void 0;if(a&&a.messages&&(n=_.find(a.messages,function(e){return e.mid===t}))){var i=!!n.is_collapsed;l(a,t,{is_collapsed:!i}),this.updateChats(e)}}},{key:"toggleAttachedCards",value:function(e){var t=this.data.chats[this.data.active_chat],a=void 0;if(t&&t.messages&&(a=_.find(t.messages,function(t){return t.mid===e}))){var n=J["default"].shouldHideAttachedCardsByDefault(),i=q["default"].isAttachedCardsCollapsed(a,n);l(t,e,{is_attached_cards_collapsed:!i}),this.updateChats(this.data.active_chat)}this.updateChats(this.data.active_chat)}},{key:"getLastSentMessageByCurrentUser",value:function(e){var t=this,a={message:!0,file:!0},n=_.filter(this.data.chats[e].messages,function(e){var n=q["default"].jid.user_id(t.data.current_user.user_jid);return e.sender_id===n&&a[e.type]});return _.last(_.sortBy(n,"time"))}},{key:"removeOldPresenceMessages",value:function(e,t){var a=this;if(!_.isObject(e)||!_.isArray(t))return!0;var n=t.reduce(function(e,t){return t.is_presence_message&&t.user_jid&&e.push(t.user_jid),e},[]);if(n.length&&_.isArray(e.messages)){var i=e.messages.filter(function(e){return e.is_presence_message&&_.includes(n,e.user_jid)});i.forEach(function(t){return a.maybeRemoveMsg(e,t.mid)})}}},{key:"maybeRemoveMsg",value:function(e,t){var a=_.findIndex(e.messages,{mid:t});if(-1===a)return!1;var n=_.clone(e.messages);return n.splice(a,1),i(n),e.messages=n,!0}}]),t}(K["default"]);t["default"]=new pe},function(e,t,a){e.exports={"default":a(601),__esModule:!0}},function(e,t,a){a(602),e.exports=a(18).Object.isFrozen},function(e,t,a){var n=a(44);a(15)("isFrozen",function(e){return function(t){return n(t)?e?e(t):!1:!0}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.uiAvailablePromise=void 0;var i=a(59),o=n(i),s=a(9),r=n(s),l=new o["default"](function(e,t){r["default"].registerOnce("updated:ui_available",e)});t.uiAvailablePromise=l},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(605),o=n(i),s=a(474),r=n(s),l=a(334),u=n(l),c=a(271),d=n(c),f=a(161),h=n(f),p=a(313),_=n(p),m=a(314),g=n(m);e.exports=React.createClass({displayName:"ChatInputBox",mixins:[g["default"]],getInitialState:function(){return this.getInputBoxState()},componentDidMount:function(){d["default"].on(["change:chat_type"],this._onChange),h["default"].on(["change:showChatSidebar","change:showGroupChatSidebar"],this._onChange),u["default"].on(["change:read_only_mode","change:read_only_input_markdown"],this._onChange)},componentWillUnmount:function(){d["default"].off(["change:chat_type"],this._onChange),h["default"].off(["change:showChatSidebar","change:showGroupChatSidebar"],this._onChange),u["default"].off(["change:read_only_mode","change:read_only_input_markdown"],this._onChange)},getInputBoxState:function(){return{chat_type:d["default"].get("chat_type"),chat_sidebar_visible:h["default"].shouldShowChatSidebar(),groupchat_sidebar_visible:h["default"].shouldShowGroupChatSidebar(),read_only_mode:u["default"].get("read_only_mode"),read_only_input_markdown:u["default"].get("read_only_input_markdown")}},_onChange:function(){this.setState(this.getInputBoxState())},_sidebarVisible:function(){return this.state[this.state.chat_type+"_sidebar_visible"]},render:function(){var e,t=(0,_["default"])({"hc-chat-box":!0,"sidebar-hidden":!this._sidebarVisible(),"hc-read-only-mode":this.state.read_only_mode});return e=this.state.read_only_mode?React.createElement(r["default"],null,this.state.read_only_input_markdown):React.createElement(o["default"],{is_guest:this.props.is_guest,chat_type:this.state.chat_type}),React.createElement("div",{className:t},e)}})},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}function o(){var e=!1;return"undefined"!=typeof window.getSelection?e=window.getSelection().toString():"undefined"!=typeof document.selection&&"Text"===document.selection.type&&(e=document.selection.createRange().text),e}function s(e){var t=e.target.correspondingUseElement||e.target;e.target===document||$(t).is(".hc-ac-name, #hc-message-input")||(g["default"].dismissMentionAutoComplete(),g["default"].dismissEmoticonAutoComplete())}Object.defineProperty(t,"__esModule",{value:!0});var r=a(270),l=i(r),u=a(204),c=i(u),d=a(261),f=i(d),h=a(260),p=i(h),m=a(606),g=i(m),v=a(595),y=i(v),b=a(607),w=i(b),R=a(613),k=i(R),E=a(614),C=i(E),S=a(460),T=i(S),x=a(9),A=i(x),I=a(99),N=i(I),M=a(262),O=i(M),D=a(174),P=i(D),j=a(257),L=i(j),F=a(121),U=i(F),H=a(173),B=i(H),z=a(196),q=i(z),V=a(615),G=i(V),W=a(184),Y=i(W),K=a(313),X=i(K),J=a(603),Q=a(275),Z=n(Q),ee=a(187),te=i(ee),ae=function(){return l["default"].getAll()},ne=0,ie=U["default"].sent_active_message_delay,oe=void 0,se=U["default"].sent_composing_message_interval,re=void 0,le="#upload-progress-bar";t["default"]=React.createClass({displayName:"ChatInput",getInitialState:function(){return ae()},componentDidMount:function(){var e=ReactDOM.findDOMNode(this.refs.message);this._setTextAreaLayout(e),document.addEventListener("click",this._focusIfAllowed),l["default"].on("change",this._onChange),this._debouncedOnCaretUpdate=_.debounce(this._onCaretUpdate,20,{leading:!0,trailing:!0}),this._debouncedWindowResize=_.debounce(function(){return $(window).trigger("resize")},100,{leading:!0,trailing:!1}),this._debouncedShouldSendChatStateMessage=_.debounce(this._shouldSendChatStateMessage,200,{leading:!0,trailing:!1}),A["default"].register("application-focused",this._focusIfAllowed),A["default"].register("new-active-chat",this._focusIfAllowed),A["default"].register("hide-modal-dialog",this._focusIfAllowed),A["default"].register("hide-inline-dialog",this._focusIfAllowed),this._focus(),this._moveCaretToEnd(),$(document).on("click",s),AJS.$(document).on("aui-dropdown2-show",this._blur),AJS.$(document).on("aui-dropdown2-hide",this._focusIfAllowed),J.uiAvailablePromise.then(this._sendLaunchToChat),this.state.text&&this._autoSize(),this._setUploadProgress(this.state.upload_progress,null),this.state.file&&this.state.attachment_expanded&&this.state.file.file_obj&&!this.state.file_error&&!this.state.uploading&&f["default"].openTooltip({type:"upload_preview",data:{file:this.state.file.file_obj}})},componentWillUnmount:function(){this._debouncedOnCaretUpdate.cancel(),this._debouncedWindowResize.cancel(),this._debouncedShouldSendChatStateMessage.cancel(),document.removeEventListener("click",this._focusIfAllowed),l["default"].off("change",this._onChange),A["default"].unregister("application-focused",this._focusIfAllowed),A["default"].unregister("new-active-chat",this._focusIfAllowed),A["default"].unregister("hide-modal-dialog",this._focusIfAllowed),A["default"].unregister("hide-inline-dialog",this._focusIfAllowed),$(document).off("click",s),AJS.$(document).off("aui-dropdown2-show",this._blur),AJS.$(document).off("aui-dropdown2-hide",this._focusIfAllowed),g["default"].dismissMentionAutoComplete(),g["default"].dismissEmoticonAutoComplete(),f["default"].closeTooltip({type:"upload_preview"})},componentWillUpdate:function(e,t){this.state.active_chat!==t.active_chat?(t.attachment_expanded&&t.file.file_obj||f["default"].closeTooltip({type:"upload_preview"}),B["default"].dispatch("analytics-active-chat-changed",{jid:t.active_chat})):!this.state.text&&t.text&&B["default"].dispatch("analytics-set-message-value",t.text)},componentDidUpdate:function(e,t){this._autoSize(),this.state.active_chat_id!==t.active_chat_id?this._moveCaretToEnd():this.state.new_forced_caret_position&&(N["default"].setCaretPosition(ReactDOM.findDOMNode(this.refs.message),this.state.new_forced_caret_position),f["default"].resetNewForcedCaretPosition()),t.file&&this.state.file&&t.file.file_obj&&!this.state.file.file_obj&&f["default"].closeTooltip({type:"upload_preview"}),this._setUploadProgress(this.state.upload_progress,t.upload_progress)},_setUploadProgress:function(e,t){document.querySelector(le)&&(null!==e?AJS.progressBars.update(le,e):null===e&&null!==t&&AJS.progressBars.setIndeterminate(le))},_setTextAreaLayout:function(e){var t=window.getComputedStyle(e,null);this._textAreaLayout.maxHeight=parseInt(t.maxHeight,10)||210,this._textAreaLayout.scrollHeight=e.clientHeight},_textAreaLayout:{maxHeight:0,scrollHeight:0},_sendLaunchToChat:function(){var e=l["default"].get("active_chat"),t=N["default"].jid.is_room(e),a=t?0:1;q["default"].handleLaunchToChat({size:a})},_autoSize:function(){var e=ReactDOM.findDOMNode(this.refs.message);if(this._textAreaLayout.scrollHeight!==e.scrollHeight){var t=ReactDOM.findDOMNode(this);t.style.height=t.clientHeight+"px",e.style.height=0,e.style.height=e.scrollHeight+"px",t.style.height="",e.scrollHeight>=this._textAreaLayout.maxHeight?"visible"!==e.style.overflowY&&(e.style.overflowY="visible",$(ReactDOM.findDOMNode(this)).find(".hc-text-input").addClass("hc-textarea-has-scroll")):"hidden"!==e.style.overflowY&&(e.style.overflowY="hidden",$(ReactDOM.findDOMNode(this)).find(".hc-text-input").removeClass("hc-textarea-has-scroll")),this._textAreaLayout.scrollHeight=e.scrollHeight,this._debouncedWindowResize()}},_getAutoComplete:function(){var e;return"mention"===this.state.active_autocomplete&&this.state.mention_list.length?e=React.createElement(w["default"],{ref:"mentionAC",mention_text:this.state.mention_text,mention_list:this.state.mention_list,mention_results_count:this.state.mention_results_count,mention_selected_item:this.state.mention_selected_item,should_animate_avatar:this.state.should_animate_avatar,textarea_ref:this.refs.message}):"emoticon"===this.state.active_autocomplete&&this.state.emoticon_list.length?e=React.createElement(k["default"],{ref:"emoticonAC",emoticon_text:this.state.emoticon_text,emoticon_list:this.state.emoticon_list,emoticon_results_count:this.state.emoticon_results_count,emoticon_selected_item:this.state.emoticon_selected_item,path_prefix:this.state.path_prefix,textarea_ref:this.refs.message}):"slash_command"===this.state.active_autocomplete&&this.state.slash_command_list.length&&(e=React.createElement(C["default"],{ref:"slash_commandAC",slash_command_results_count:this.state.slash_command_results_count,slash_command_selected_item:this.state.slash_command_selected_item,slash_commands_list:this.state.slash_command_list,textarea_ref:this.refs.message})),e},render:function(){var e=(0,X["default"])({"hc-textwrapper":!0,"hc-text-input":!0,"hc-file-sharing-disabled":!this.state.can_share_files}),t=(0,X["default"])({mousetrap:!0,textarea:!0,"hc-textarea":!0}),a=this._getAutoComplete();return React.createElement("form",{className:"aui"},React.createElement("table",{width:"100%",height:"100%",cellSpacing:"0"},React.createElement("tbody",null,React.createElement("tr",null,React.createElement(G["default"],{ref:"file_btn",active_chat:this.state.active_chat,on_keydown:this._onKeydown,file_name:this.state.file_name,attachment_expanded:this.state.attachment_expanded,uploading:this.state.uploading,file_error:this.state.file_error,file_error_message:this.state.file_error_message,file_extension:this.state.file_extension,can_share_files:this.state.can_share_files,chat_type:this.props.chat_type}),React.createElement("td",{height:"100%"},React.createElement("div",{className:"hc-text-input-autocomplete-container"},a),React.createElement("div",{className:e},React.createElement("textarea",{id:U["default"].chat_input_id,className:t,rows:"1",onChange:this._onValueChange,onKeyDown:this._onKeydown,onKeyUp:this._debouncedOnCaretUpdate,onClick:this._debouncedOnCaretUpdate,onPaste:this._onPaste,value:this.state.text,ref:"message"}),React.createElement("div",{className:"smiley-icon",onClick:this._onSmileyClick},React.createElement("span",{className:"aui-icon hipchat-icon-small icon-emoticon"},"Emoticons"),React.createElement(T["default"],{type:"smiley_selector"}))))))))},_onChange:function(e){this._debouncedOnCaretUpdate(e),this.setState(ae())},_onCaretUpdate:function(e){"chat"===this.state.chat_type&&e.keyCode&&this._debouncedShouldSendChatStateMessage(e);var t=ReactDOM.findDOMNode(this.refs.message),a=N["default"].getCaretPosition(t),n=t.value,i=n,o=N["default"].getEndSelection(t);if(o!==a&&(i=n.slice(0,a)+n.slice(o)),a!==ne||a===ne&&N["default"].keyCode.isSelected(e)){ne=a,this._processEmoticonText(n,a);var s=this.state.active_chat;N["default"].jid.is_private_chat(s)||this._processMentionText(i,a),this._processSlashCommandText(n,a),f["default"].setCaretPosition(a)}},_processMentionText:function(e,t){"mention"!==this.state.active_autocomplete&&this.state.active_autocomplete||g["default"].processMentionText({text:e,caret_position:t})},_processEmoticonText:function(e,t){"emoticon"!==this.state.active_autocomplete&&this.state.active_autocomplete||g["default"].processEmoticonText({text:e,caret_position:t})},_processSlashCommandText:function(e,t){"slash_command"!==this.state.active_autocomplete&&this.state.active_autocomplete||g["default"].processSlashCommandText({text:e,caret_position:t})},_processPresence:function(e){var t,a=e.indexOf(" "),n=e,i={type:"showAndStatus"};switch(_.includes(e," ")&&(t=e.substr(a).trim(),t&&(i.status=t),n=n.substr(0,a)),n.substr(1)){case"available":case"here":case"back":i.show=Y["default"].AVAILABLE;break;case"away":i.show=Y["default"].AWAY;break;case"dnd":i.show=Y["default"].DND}L["default"].changeStatus(i)},_clearFileInput:function(){var e=document.getElementById("fileInput");e&&(e.value=null)},_onKeydown:function(e){if(this.state.initialized){if(this.state.text=N["default"].strings.stripHiddenCharacters(this.state.text),this.state.active_autocomplete){te["default"].useLatest();var t=$(ReactDOM.findDOMNode(this.refs[this.state.active_autocomplete+"AC"]));if(t.find(".aui-inline-dialog.show").length&&(e.keyCode===N["default"].keyCode.UpArrow&&(g["default"].navigateAutoComplete({autocomplete:this.state.active_autocomplete,direction:"up"}),e.preventDefault()),e.keyCode===N["default"].keyCode.DownArrow&&(g["default"].navigateAutoComplete({autocomplete:this.state.active_autocomplete,direction:"down"}),e.preventDefault()),e.keyCode===N["default"].keyCode.Tab||e.keyCode===N["default"].keyCode.Enter))return"mention"===this.state.active_autocomplete?g["default"].mentionSelected():"emoticon"===this.state.active_autocomplete?g["default"].emoticonSelected():"slash_command"===this.state.active_autocomplete&&g["default"].slashCommandSelected(),void e.preventDefault()}else{if(e.keyCode===N["default"].keyCode.Tab)return void(this.state.attachment_expanded&&e.shiftKey||e.preventDefault());if(e.keyCode===N["default"].keyCode.Enter&&(e.ctrlKey||e.altKey))return void(e.shiftKey=!0)}if(e.keyCode===N["default"].keyCode.Esc&&(this.state.active_autocomplete||(ReactDOM.findDOMNode(this.refs.message).focus(),f["default"].closeTooltip({type:"upload_preview"}),f["default"].closeAttachment({jid:this.state.active_chat})),g["default"].dismissMentionAutoComplete(),g["default"].dismissEmoticonAutoComplete(),e.preventDefault()),this.state.message_editing_enabled&&""===this.state.text&&e.keyCode===N["default"].keyCode.UpArrow&&!N["default"].keyCode.isModified(e)&&(e.preventDefault(),f["default"].getLastMessageSentByCurrentUser(this.state.active_chat,y["default"].initiateMessageEdit)),e.keyCode===N["default"].keyCode.Enter&&!e.shiftKey)if(e.preventDefault(),this.state.text&&this._invalidMessageLength(this.state.text))f["default"].showMessageLengthError();else if(this.state.uploading||!this.state.attachment_expanded||this.state.file_error){if(this.state.text.trim().length){var a=Z.matchCommand({text:this.state.text,jid:this.state.active_chat,is_guest:this.props.is_guest,video_enabled:this.state.video_enabled,room_video_enabled:this.state.video_enabled&&this.state.web_client_enso_video_enabled&&this.state.web_client_enso_room_video_enabled});if(Z.executeCommand(a,{jid:this.state.active_chat,text:this.state.text,videoService:this.state.web_client_enso_video_enabled?P["default"].ENSO:P["default"].ADDLIVE,room_id:this.state.active_chat_id,room_is_archived:this.state.room_is_archived}),a&&q["default"].slashCommandUsed({room:N["default"].jid.is_room(this.state.active_chat)?this.state.active_chat_id:null,slashUsed:a.name}),a&&a.should_send_message||!a){if(N["default"].jid.is_private_chat(this.state.active_chat)&&!this.state.can_use_oto_chats)return void c["default"].showFlag({type:"warning",close:"auto",body:O["default"].fail.oto_chats_disabled});if(this.state.room_is_archived)return void c["default"].showFlag({type:"warning",close:"auto",body:O["default"].fail.sent_message_in_archived_room});f["default"].sendMessage({text:this.state.text,jid:this.state.active_chat,id:this.state.message_id,active_chat_id:this.state.active_chat_id,chat_type:this.state.chat_type})}}}else this.state.text&&this._invalidFileDescriptionLength(this.state.text)?f["default"].showFileDescriptionLengthError():(p["default"].uploadFile({file:this.state.file,fileName:this.state.file_name,jid:this.state.active_chat,room_id:this.state.active_chat_id,message:this.state.text}),this._sendUploadAnalyticsEvent(),f["default"].closeTooltip({type:"upload_preview"}),ReactDOM.findDOMNode(this.refs.message).focus(),this._clearFileInput())}},_shouldSendChatStateMessage:function(e){return e.keyCode===N["default"].keyCode.Delete||e.keyCode===N["default"].keyCode.Backspace?!1:(this._updateDelay(),void(this.state.text.trim().length&&!re&&"active"===this.state.user_state?this._sendComposingStateMessage():"composing"===this.state.user_state&&(this.state.text.trim().length&&oe||this._sendActiveStateMessage())))},_updateDelay:function(){var e=this;clearTimeout(oe),oe=setTimeout(function(){e._sendActiveStateMessage(),clearTimeout(oe),oe=null},ie)},_sendComposingStateMessage:function(){var e=this;this._sentState("composing"),re=setInterval(function(){e._sentState("composing")},se)},_sendActiveStateMessage:function(){clearInterval(re),re=null,this._sentState("active")},_sentState:function(e){f["default"].setUserState({jid:this.state.active_chat,type:"chat",state:e})},_onValueChange:function(e){this.state.initialized&&f["default"].setMsgValue({text:e.target.value})},_invalidMessageLength:function(e){return e.length>=U["default"].max_message_text_length},_invalidFileDescriptionLength:function(e){return e.length>U["default"].max_file_description_length},_focusingDisabled:function(){var e=!1;return window.HC&&window.HC.Config&&window.HC.Config.composeMessageDisabled&&(e=window.HC.Config.composeMessageDisabled),e},_focusIfAllowed:function(e){var t=this;e&&$(e.target).closest("[data-no-focus]").length||_.delay(function(){var e=_.get(document.activeElement,"tagName");!t.isMounted()||t._focusingDisabled()||_.includes(["INPUT","TEXTAREA"],e)||0!==document.querySelectorAll(".aui-blanket").length||0!==$(".aui-dropdown2[aria-hidden='false']").length||t._focus()},U["default"].modal_transition_allowance)},_focus:function(){var e=o();this._isFocused()||e||ReactDOM.findDOMNode(this.refs.message).focus()},_blur:function(){ReactDOM.findDOMNode(this.refs.message).blur()},_moveCaretToEnd:function(){this.state.text&&(N["default"].setCaretPosition(ReactDOM.findDOMNode(this.refs.message),this.state.text.length),f["default"].setCaretPosition(this.state.text.length))},_isFocused:function(){return ReactDOM.findDOMNode(this.refs.message)===document.activeElement},_onSmileyClick:function(e){var t=e.currentTarget.className;~t.indexOf(" selected")?e.currentTarget.className=t.replace(" selected",""):(e.currentTarget.className+=" selected",B["default"].dispatch("analytics-event",{name:"hipchat.client.emoticon.dialog.launched"})),f["default"].toggleTooltip({type:"smiley_selector",data:{smileys:this.state.smileys,user_is_admin:this.state.user_is_admin,web_server:this.state.web_server}})},_sendUploadAnalyticsEvent:function(){var e=N["default"].file.get_selected_file_type(this.state.file),t="groupchat"===N["default"].room.detect_chat_type(this.state.active_chat)?"room":"oto";q["default"].fileUploadRequested(e.minor,t,this.state.file_selection_source)},_onPaste:function(e){this.state.uploading||p["default"].filePasted(e)}}),e.exports=t["default"]},function(e,t,a){"use strict";var n=a(9),i={processEmoticonText:function(e){n.dispatch("process-emoticon-text",{text:e.text,caret_position:e.caret_position})},dismissEmoticonAutoComplete:function(){n.dispatch("dismiss-emoticon-autocomplete")},emoticonSelected:function(){n.dispatch("emoticon-selected")},processMentionText:function(e){n.dispatch("process-mention-text",{text:e.text,caret_position:e.caret_position})},processSlashCommandText:function(e){var t=e.text,a=e.caret_position;n.dispatch("process-slash-command-text",{text:t,caret_position:a})},dismissMentionAutoComplete:function(){n.dispatch("dismiss-mention-autocomplete")},navigateAutoComplete:function(e){n.dispatch("navigate-autocomplete",{autocomplete:e.autocomplete,direction:e.direction})},mentionSelected:function(){n.dispatch("mention-selected");
},menuItemHovered:function(e){n.dispatch("menu-item-hovered",{type:e.type,index:e.index})},slashCommandSelected:function(){n.dispatch("slash-command-selected")}};e.exports=i},function(e,t,a){"use strict";var n=a(608),i=a(99);e.exports=React.createClass({displayName:"MentionAutoComplete",componentDidUpdate:function(){this.props.mention_results_count>0&&this._scrollIntoView()},_scrollIntoView:function(){var e=$(ReactDOM.findDOMNode(this)),t=e.find(".aui-inline-dialog-contents.contents").get(0);i.scrollIntoViewIfNeeded(e.find("li.hc-autocomplete-item-selected").get(0),t,!1)},render:function(){return React.createElement("div",{className:"hc-mention-ac hc-chat-input-autocomplete"},React.createElement(n,{key:"mention_auto_complete",type:"mention",list:this.props.mention_list,should_animate_avatar:this.props.should_animate_avatar,textarea_ref:this.props.textarea_ref,selected_item:this.props.mention_selected_item,ref:"acBox"}))}})},function(e,t,a){"use strict";var n=a(609),i=a(610),o=a(611),s=a(612),r=a(110),l=a(313);e.exports=React.createClass({displayName:"AutoCompleteBox",getDefaultProps:function(){return{list:[]}},_boxParams:{boxArrowType:"left",arrow_offsets:{left:30,top:10},offset_left:30,offset_top:10,offset_left_shift:200},componentDidMount:function(){this._positionAutoComplete()},componentDidUpdate:function(){this._positionAutoComplete()},_positionAutoComplete:function(){if(this.refs.caret){var e=this._boxParams.arrow_offsets,t=$(ReactDOM.findDOMNode(this.refs.acBox)),a=$(ReactDOM.findDOMNode(this.refs.caret)).find(".hc-textarea-caret"),n=$(ReactDOM.findDOMNode(this.props.textarea_ref)),i=n.width(),o=a.position().left,s={},r=void 0,l=void 0,u=this._isRightBoxType(i,o);a.length?(r=a.position().left-e.left,l=a.position().top-n.scrollTop()-$(ReactDOM.findDOMNode(this.refs.container)).height()-e.top,u?(this._boxParams.boxArrowType="right",r-=this._boxParams.offset_left_shift):this._boxParams.boxArrowType="left",s.left=r+"px",s.top=l+"px"):(l=n.scrollTop()-$(ReactDOM.findDOMNode(this.refs.container)).height()-e.top,s.top=l+"px"),t.css(s)}},_isRightBoxType:function(e,t){return t>e/2},_getMentionAutoCompleteContent:function(){var e=this,t=this.props.list.map(function(t,a){var n=!1,o="@"+t.mention_match_markup;return a===e.props.selected_item&&(n=!0),React.createElement(i,{show:t.presence.show,hidden_presence:t.hidden_presence,photo_url:t.photo_url,name_match_markup:t.name_match_markup,mention_match_markup:o,selected:n,should_animate_avatar:e.props.should_animate_avatar,key:a,idx:a,user_id:t.id})});return t},_getEmoticonAutoCompleteContent:function(){var e=this,t=this.props.list.map(function(t,a){var n=!1;return a===e.props.selected_item&&(n=!0),React.createElement(o,{src:_.get(r._getEmoticonInfo(t.shortcut),"src"),match_markup:t.match_markup,shortcut:t.shortcut,selected:n,key:a,idx:a})});return t},_getSlashCommandAutoCompleteContent:function(){var e=this,t=this.props.list.map(function(t,a){var n=!1;return a===e.props.selected_item&&(n=!0),React.createElement(s,{name:t.name,description:t.description,usage:t.usage,selected:n,key:a,idx:a})});return t},_getAutoCompleteContent:function(){var e;if(this.props.type)switch(this.props.type){case"mention":e=this._getMentionAutoCompleteContent();break;case"emoticon":e=this._getEmoticonAutoCompleteContent();break;case"slash_command":e=this._getSlashCommandAutoCompleteContent()}return e},render:function(){var e=this._getAutoCompleteContent(),t="right"===this._boxParams.boxArrowType,a=l({"aui-inline-dialog":!0,show:this.props.list.length>0}),i=l("aui-inline-dialog-arrow","arrow","aui-css-arrow","aui-bottom-arrow",{right:t});return React.createElement("div",null,React.createElement("div",{className:a,ref:"acBox"},React.createElement("div",{className:"aui-inline-dialog-contents contents",ref:"container"},React.createElement("ul",null,e)),React.createElement("div",{className:i})),React.createElement(n,{ref:"caret",textarea_ref:this.props.textarea_ref}))}})},function(e,t,a){"use strict";var n=a(99);e.exports=React.createClass({displayName:"TextAreaCaretMirror",render:function(){if(!this.props.textarea_ref)return React.createElement("div",null);var e=$(this.props.textarea_ref);if(e.length<1)return React.createElement("div",null);for(var t=n.getCaretPosition(e.get(0)),a=e.val().substring(0,t),i=e.val().substring(t),o={position:"absolute",overflow:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word",top:0,left:-9999},s={position:"absolute"},r=["boxSizing","height","width","paddingBottom","paddingLeft","paddingRight","paddingTop","fontFamily","fontSize","fontStyle","fontVariant","fontWeight","wordSpacing","letterSpacing","lineHeight","textDecoration","textIndent","textTransform","direction"],l=0;l<r.length;l++)o[r[l]]=e.css(r[l]);return React.createElement("div",{style:o},a,React.createElement("span",{ref:"caret",className:"hc-textarea-caret",style:s}),i)}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(606),o=n(i),s=a(310),r=n(s),l=a(313),u=n(l),c=a(314),d=n(c),f=a(187),h=n(f);t["default"]=React.createClass({displayName:"MentionAutoCompleteRow",mixins:[d["default"]],_onMentionMenuItemHover:function(e){h["default"].hasChanged(e)&&o["default"].menuItemHovered({type:"mention",index:this.props.idx})},_onMentionSelected:function(){o["default"].mentionSelected()},_getAvatar:function(){var e=void 0;return e=this.props.photo_url?React.createElement(r["default"],{size:"small",presence:this.props.show,avatar_url:this.props.photo_url,active:!0,shouldAnimate:this.props.should_animate_avatar,key:this.props.user_id,uid:this.props.user_id}):React.createElement("span",{className:"aui-avatar aui-avatar-project aui-avatar-small"},React.createElement("span",{className:"aui-avatar-inner"},React.createElement("div",{className:"mention-group-icon"})))},render:function(){var e=this._getAvatar(),t=(0,u["default"])({"hc-autocomplete-item":!0,"hc-autocomplete-item-selected":this.props.selected});return React.createElement("li",{className:t,onClick:this._onMentionSelected,"data-index":this.props.idx},React.createElement("div",{className:"hc-ac-row",onMouseOver:this._onMentionMenuItemHover},React.createElement("div",{className:"hc-ac-avatar"},e),React.createElement("span",{className:"hc-ac-name",dangerouslySetInnerHTML:{__html:this.props.name_match_markup||""}}),React.createElement("span",{className:"hc-ac-mention-name",dangerouslySetInnerHTML:{__html:this.props.mention_match_markup||""}})))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(606),o=n(i),s=a(313),r=n(s),l=a(314),u=n(l),c=a(108),d=n(c),f=a(187),h=n(f),p=20;t["default"]=React.createClass({displayName:"EmoticonAutoCompleteItem",propTypes:{match_markup:React.PropTypes.string.isRequired},mixins:[u["default"]],_onEmoticonMenuItemHover:function(e){h["default"].hasChanged(e)&&o["default"].menuItemHovered({type:"emoticon",index:this.props.idx})},_onEmoticonSelected:function(){o["default"].emoticonSelected()},_onRetinaImageNonExistent:function(e){e.target.src=d["default"].remove_resolution(e.target.src)},_getWidth:function(){return this.props.width&&this.props.width<p?this.props.width:p},render:function(){var e=(0,r["default"])({"hc-autocomplete-item":!0,"hc-autocomplete-item-selected":this.props.selected});return React.createElement("li",{className:e,onClick:this._onEmoticonSelected,"data-index":this.props.idx},React.createElement("div",{onMouseOver:this._onEmoticonMenuItemHover},React.createElement("div",{className:"hc-ac-preview"},React.createElement("img",{src:this.props.src,alt:this.props.shortcut,key:this.props.shortcut,onError:this._onRetinaImageNonExistent})),React.createElement("span",{className:"hc-ac-name",dangerouslySetInnerHTML:{__html:this.props.match_markup||""}})))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(606),o=n(i),s=a(313),r=n(s),l=a(314),u=n(l),c=a(187),d=n(c);t["default"]=React.createClass({displayName:"SlashCommandAutoCompleteItem",propTypes:{name:React.PropTypes.string.isRequired,usage:React.PropTypes.string,description:React.PropTypes.string.isRequired},mixins:[u["default"]],_onMenuItemHover:function(e){d["default"].hasChanged(e)&&o["default"].menuItemHovered({type:"slash_command",index:this.props.idx})},_onMenuItemSelected:function(){o["default"].slashCommandSelected()},render:function(){var e=(0,r["default"])({"hc-autocomplete-item":!0,"hc-autocomplete-item-selected":this.props.selected});return React.createElement("li",{className:e,onClick:this._onMenuItemSelected,"data-index":this.props.idx},React.createElement("div",{onMouseOver:this._onMenuItemHover},React.createElement("div",{className:"hc-ac-name-container"},React.createElement("span",{className:"hc-ac-name"},this.props.name),React.createElement("span",{className:"hc-ac-usage"},this.props.usage)),React.createElement("div",{className:"hc-ac-description"},this.props.description)))}}),e.exports=t["default"]},function(e,t,a){"use strict";var n=a(608),i=a(99);e.exports=React.createClass({displayName:"EmoticonAutoComplete",componentDidUpdate:function(){this.props.emoticon_results_count>0&&this._scrollIntoView()},_scrollIntoView:function(){var e=$(ReactDOM.findDOMNode(this)),t=e.find(".aui-inline-dialog-contents.contents").get(0);i.scrollIntoViewIfNeeded(e.find("li.hc-autocomplete-item-selected").get(0),t,!1)},render:function(){return React.createElement("div",{className:"hc-emoticon-ac hc-chat-input-autocomplete"},React.createElement(n,{key:"emoticon_auto_complete",type:"emoticon",path_prefix:this.props.path_prefix,list:this.props.emoticon_list,box_type:this.props.box_type,textarea_ref:this.props.textarea_ref,selected_item:this.props.emoticon_selected_item,ref:"acBox"}))}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(608),o=n(i),s=a(99),r=n(s);t["default"]=React.createClass({displayName:"SlashCommandAutoComplete",componentDidUpdate:function(){this.props.slash_command_results_count>0&&this._scrollIntoView()},_scrollIntoView:function(){var e=$(ReactDOM.findDOMNode(this)),t=e.find(".aui-inline-dialog-contents.contents").get(0);r["default"].scrollIntoViewIfNeeded(e.find("li.hc-autocomplete-item-selected").get(0),t,!1)},render:function(){return React.createElement("div",{className:"hc-slash-command-ac hc-chat-input-autocomplete"},React.createElement(o["default"],{key:"slash_command_auto_complete",type:"slash_command",offset_left:-20,list:this.props.slash_commands_list,selected_item:this.props.slash_command_selected_item,textarea_ref:this.props.textarea_ref,ref:"acBox"}))}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){return{integrations:k["default"].getExtensionsByLocation("hipchat.input.action"),integrations_enabled:k["default"].get("enabled")}}var o=a(593),s=n(o),r=a(616),l=n(r),u=a(592),c=n(u),d=a(617),f=n(d),h=a(618),p=n(h),m=a(460),g=n(m),v=a(260),y=n(v),b=a(261),w=n(b),R=a(421),k=n(R),E=a(173),C=n(E),S=a(167),T=n(S),x=a(263),A=n(x),I=a(313),N=n(I),M=a(99),O=n(M);e.exports=React.createClass({displayName:"ChatActionsButton",getInitialState:function(){return i()},componentDidMount:function(){k["default"].on(["change:integrations","change:integrations_enabled","change:active_chat"],this._updateState)},componentWillUpdate:function(e){e.attachment_expanded&&!this.props.attachment_expanded&&w["default"].dismissActionsDropDown(),e.active_chat!==this.props.active_chat&&this._clearFileInputValue()},componentWillUnmount:function(){k["default"].off(["change:integrations","change:integrations_enabled","change:active_chat"],this._updateState)},_updateState:function(){return this.setState(i())},_onFileChosen:function(e){y["default"].fileChosen(e,"browse")},_openFilePicker:function(e){e.preventDefault(),this.props.attachment_expanded||y["default"].openFilePicker()},_clearFileInputValue:function(){var e=ReactDOM.findDOMNode(this.refs.fileInput);e&&(e.value=null)},_getContentsState:function(){var e="upload";return e=this.props.attachment_expanded?"uploading":this.state.integrations_enabled&&this.state.integrations.length>0&&"groupchat"===this.props.chat_type?"integrations":"upload"},_getFileIcon:function(){return"uploading"===this._getContentsState()?O["default"].file.get_icon_class(this.props.file_name):"icon-attachment"},_getAttachButton:function(){var e=this._getFileIcon(),t=(0,N["default"])("aui-icon","hipchat-icon-small","hc-file-icon",e);return React.createElement("a",{className:"hc-attach",onClick:this._openFilePicker},React.createElement("span",{className:t,title:A["default"].attachment}))},_getIntegrationsDropDown:function(){return React.createElement(c["default"],{dropdown_id:"input_actions_dropdown",icon:"aui-iconfont-add",lazy_options:this._renderOptions,onShow:this._onShow,location:"above",default_option:"last"})},_getFileButtonContents:function(e){var t;switch(e){case"uploading":case"upload":t=this._getAttachButton();break;case"integrations":t=this._getIntegrationsDropDown()}return t},render:function(){var e=this._getContentsState(),t=this._getFileButtonContents(e),a=this.props.file_error&&this.props.attachment_expanded,n=a?this._getFileError():null,i=(0,N["default"])({"hc-file-btn":"uploading"===e||"upload"===e,"has-file":"uploading"===e,input_actions_trigger:"integrations"===e,hidden:!this.props.can_share_files});return React.createElement("td",{id:"hc-chat-actions",ref:"fileBtn",className:i},React.createElement("input",{className:"hidden",ref:"fileInput",type:"file",id:"fileInput",onChange:this._onFileChosen,multiple:"false"}),React.createElement(g["default"],{type:"upload_preview"}),n,t,React.createElement(f["default"],{on_keydown:this.props.on_keydown,file_name:this.props.file_name,file_error:this.props.file_error,file_extension:this.props.file_extension,attachment_expanded:this.props.attachment_expanded,uploading:this.props.uploading,active_chat:this.props.active_chat}))},_renderOptions:function(){var e=this,t=_.map(this.state.integrations,function(t){return React.createElement(s["default"],{key:T["default"].to_full_key(t.addon_key,t.key),action:t,msg:e.props.msg})});return[React.createElement("ul",{key:"items",className:"aui-list-truncate"},t,React.createElement(l["default"],{onClick:this._openFilePicker,key:"upload-file",item_id:"hc-chat-actions-upload-file",title:A["default"].upload_file})),React.createElement("div",{key:"arrow",id:"hc-chat-actions-arrow"})]},_onShow:function(){C["default"].dispatch("analytics-event",{name:"hipchat.client.integrations.input.action.open"})},_getFileError:function(){return React.createElement(p["default"],{anchor:ReactDOM.findDOMNode(this.refs.fileBtn),error:this.props.file_error_message})}})},function(e,t){"use strict";e.exports=React.createClass({displayName:"GenericDropDownAction",propTypes:{onClick:React.PropTypes.func,title:React.PropTypes.string,item_id:React.PropTypes.string},componentDidMount:function(){ReactDOM.findDOMNode(this.refs.element).addEventListener("click",this._onClick)},componentWillUnmount:function(){ReactDOM.findDOMNode(this.refs.element).removeEventListener("click",this._onClick)},render:function(){return React.createElement("li",null,React.createElement("a",{id:this.props.item_id,ref:"element"},this.props.title))},_onClick:function(e){this.props.onClick(e)}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(260),o=n(i),s=a(261),r=n(s),l=a(263),u=n(l),c=a(313),d=n(c),f=a(99),h=n(f);e.exports=React.createClass({displayName:"ChatInputFileUploader",componentWillUpdate:function(e){e.attachment_expanded&&!this.props.attachment_expanded&&_.defer(this._checkShouldFocus)},_checkShouldFocus:function(){var e=new RegExp("^"+u["default"].upload_default_name+"\\.");e.test(this.props.file_name)&&this._focusAndSelect()},_focusAndSelect:function(){var e=ReactDOM.findDOMNode(this.refs.name_input);e!==document.activeElement&&e.focus()},_onFileNameClick:function(e){this._onFocus(e)},_onFileNameChange:function(e){o["default"].changeFileName({file_name:e.target.value})},_onFocus:function(e){var t=e.target;_.defer(function(){var e=t.value.lastIndexOf(".");-1!==e&&t.setSelectionRange(0,e)})},_onBlur:function(e){var t=e.target;t.value?this.props.file_extension&&!/\.\S+$/.test(t.value)&&(-1===t.value.indexOf(".")?t.value+="."+this.props.file_extension:t.value+=this.props.file_extension):t.value=u["default"].upload_default_name+"."+this.props.file_extension,this._onFileNameChange(e)},_onKeyDown:function(e){e.keyCode===h["default"].keyCode.Tab?e.shiftKey&&e.preventDefault():this.props.on_keydown(e)},_closeAttachmentInput:function(e){e.stopPropagation();var t=document.getElementById("fileInput");t&&(t.value=null),r["default"].closeTooltip({type:"upload_preview"}),r["default"].closeAttachment({jid:this.props.active_chat})},render:function(){var e=(0,d["default"])({hidden:!this.props.attachment_expanded,"upload-input":!0}),t=(0,d["default"])({hidden:this.props.uploading,"close-upload":!0}),a=(0,d["default"])({hidden:!this.props.uploading,"aui-progress-indicator":!0}),n=(0,d["default"])({hidden:this.props.uploading,error:this.props.file_error});return React.createElement("div",{ref:"file_uploader",className:e},React.createElement("input",{ref:"name_input",id:"upload-name-input",type:"text",value:this.props.file_name,onClick:this._onFileNameClick,onChange:this._onFileNameChange,onFocus:this._onFocus,onBlur:this._onBlur,className:n,onKeyDown:this._onKeyDown}),React.createElement("a",{ref:"file_link",className:t,onClick:this._closeAttachmentInput},React.createElement("span",{className:"aui-icon hipchat-icon-small hc-close-icon icon-close"})),React.createElement("div",{ref:"upload_progress",id:"upload-progress-bar",className:a},React.createElement("span",{className:"aui-progress-indicator-value"})))}})},function(e,t){"use strict";e.exports=React.createClass({displayName:"FileErrorTooltip",componentDidMount:function(){this._positionTooltip()},componentDidUpdate:function(){this._positionTooltip()},_positionTooltip:function(){if(!this.props.anchor)return!0;var e=ReactDOM.findDOMNode(this),t=this.props.anchor,a=t.offsetHeight,n=-e.offsetWidth/2+t.offsetWidth/2;e.style.bottom=a+"px",e.style.left=n+"px"},render:function(){return React.createElement("div",{className:"tipsy aui-form-notification-tooltip aui-form-notification-tooltip-error tipsy-s",role:"tooltip"},React.createElement("div",{className:"tipsy-arrow tipsy-arrow-s"}),React.createElement("div",{className:"tipsy-inner"},this.props.error))}})},function(e,t,a){"use strict";var n=a(313);e.exports=React.createClass({displayName:"ResizeOverlay",getDefaultProps:function(){return{"show-overlay":!1}},render:function(){var e=n({overlay:!0,"resize-overlay":!0,"show-overlay":this.props.show_overlay});return React.createElement("div",{className:e})}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){var e=function(){var e=g["default"].clientSubType.isMac(w["default"].get("client_subtype")),t=w["default"].get("asset_base_uri");return e&&(t="/wc/"),t},t=function(e){return{"pdf-viewer":"pdf-view"}[e]},a={"pdf-config":{workerSrc:e()+"vendor/pdfjs/pdf.worker.min.js",viewer:e()+"vendor/pdfjs/"},"pdf-viewer":null};return function(n){return a[n]||!function(){var i=new $.Deferred,o=e();"pdf-viewer"===n?k["default"].fetchPdfViewerResources(n,o).then(function(e){i.resolve(FileViewer.require(t(n)))})["catch"](function(e){i.reject(e)}):"pdf-config"===n?i.resolve(a[n]):i.reject("Module "+n+" is undefined."),a[n]=i.promise()}(),a[n]}}var o=a(9),s=n(o),r=a(435),l=n(r),u=a(173),c=n(u),d=a(177),f=n(d),h=a(90),p=n(h),m=a(99),g=n(m),v=a(271),y=n(v),b=a(190),w=n(b),R=a(93),k=n(R),E=f["default"].transformForFileViewer.bind(f["default"]),C=f["default"].fileViewerSupports.bind(f["default"]),S=f["default"]._guessMimeType.bind(f["default"]);e.exports=React.createClass({displayName:"FileViewer",componentWillMount:function(){s["default"].register({"open-in-file-viewer":this._open,"open-external-file-in-file-viewer":this._openExternalFile,"file-download-stop":this._stopDownloadIndicator,"close-file-viewer":this._closeFileViewer})},componentWillUnmount:function(){s["default"].unregister({"open-in-file-viewer":this._open,"open-external-file-in-file-viewer":this._openExternalFile,"file-download-stop":this._stopDownloadIndicator,"close-file-viewer":this._closeFileViewer,"files-fetched":this._updateCollection,"links-fetched":this._updateCollection}),this._viewer&&(this._viewer.isOpen()&&this._viewer.close(),this._viewer.off(),this._viewer=null)},render:function(){var e={display:"none"};return React.createElement("div",{style:e})},_viewer:null,_closeFileViewer:function(){null!==this._viewer&&this._viewer.isOpen()&&this._viewer.close()},_onViewerClose:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("click",!1,!1,null),document.dispatchEvent(e),l["default"].fileViewerClosed()},_open:function(e){var t=E(e);if("undefined"==typeof FileViewer)return!1;this._viewer||this._setupViewer();var a=this._combineFilesAndLinks();this._filesHaveBeenFetched()||this._fetchFiles(),this._linksHaveBeenFetched()||this._fetchLinks();var n=this._findFilesToShow(t,a);this._viewer.setFiles(n),this._viewer.open({srcDownload:t.srcDownload},"main")},_openExternalFile:function(e){var t=e.file,a=E(t);if("undefined"!=typeof FileViewer){this._viewer||this._setupViewer();for(var n=e.filesList||[a],i=n.length-1;i>=0;i--){var o=n[i];o.url===a.url&&(o.src=a.src),n[i]=E(o)}var s=this._findFilesToShow(a,n);this._viewer.setFiles(s),this._viewer.open({srcDownload:a.srcDownload},"main")}},_setupViewer:function(){this._viewer=new FileViewer({metaBar:{defaultAvatar:""},moduleBackend:i(),analyticsBackend:this._sendAnalytics,isPreviewGenerated:this._isPreviewGenerated,generatePreview:this._fetchSignedURL}),this.debouncedInitiateDownload=_.debounce(this._initiateDownload,2e3,{leading:!0,trailing:!1}),AJS.I18n.keys["cp.error.default.header"]="We couldn't authenticate your account.",this._viewer.on("fv.close",this._onViewerClose),this._viewer.on("fv.download",this._onFileDownload),videojs.options.techOrder=["html5","youtube"],s["default"].register({"files-fetched":this._updateCollection,"links-fetched":this._updateCollection})},_onFileDownload:function(e){var t=this._viewer.getCurrent();t.is_authenticated&&(e.preventDefault(),e.stopPropagation(),this.debouncedInitiateDownload(t))},_initiateDownload:function(e){this._fetchSignedURL(e,!0).then(function(e){k["default"].downloadFile(e)}).fail(function(e){p["default"].warn(e)})},_startDownloadIndicator:function(){var e=this;_.attempt(function(){e._viewer._view.fileContentView.getLayerForName("content").$el.hide(),e._viewer._view.fileContentView.getLayerForName("spinner").startSpin()})},_stopDownloadIndicator:function(){var e=this;_.attempt(function(){e._viewer._view.fileContentView.getLayerForName("spinner").stopSpin(),e._viewer._view.fileContentView.getLayerForName("content").$el.show()})},_filesHaveBeenFetched:function(){return y["default"].get("files").length},_linksHaveBeenFetched:function(){return y["default"].get("links").length},_fetchFiles:function(){s["default"].dispatch("fetch-files",{room:y["default"].data.active_chat})},_fetchLinks:function(){s["default"].dispatch("fetch-links",{room:y["default"].data.active_chat})},_fetchSignedURL:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],a=new $.Deferred,n=function(e){a.resolve(t?e.temp_download_url:e.temp_url,S(e))},i=function(e){a.reject(e)};return l["default"].fetchSignedFile({url:e.srcDownload||e.attributes.src},n,i),a.promise()},_isPreviewGenerated:function(e){var t=new $.Deferred;return e.attributes.is_authenticated?t.resolve(!1):t.resolve(!0,e.attributes.url,e.attributes.type),t},_combineFilesAndLinks:function(){var e=y["default"].get("files"),t=y["default"].get("links").filter(C);return _.sortBy(e.concat(t),"date").map(E)},_updateCollection:function(){if(this._viewer.isOpen()){var e=this._combineFilesAndLinks(),t=this._viewer.getCurrent(),a=t&&t.srcDownload,n=this._findFilesToShow(t,e);this._viewer.setFiles(n,{srcDownload:a})}},_findFilesToShow:function(e,t){var a;return a=this._fileIsInList(e,t)?t:[e]},_fileIsInList:function(e,t){var a=_.find(t,function(t){return t.srcDownload===e.srcDownload});return!!a},_sendAnalytics:function(e,t){c["default"].dispatch("analytics-event",{name:e,properties:t})}})},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(121);t["default"]=React.createClass({displayName:"Tipsify",mixin:[React.addons.PureRenderMixin],debouncedMouseOver:null,getInitialState:function(){return{showTooltip:!1,tooltip:"",currentTarget:null}},componentWillMount:function(){var e=this;this.debouncedMouseOver=_.debounce(function(t){return e._onMouseOver(t)},n.tipsify.delay),document.addEventListener("mouseover",this.debouncedMouseOver),document.addEventListener("mouseout",this._onDocumentMouseOut),window.addEventListener("blur",this._hideTooltip)},componentWillUnmount:function(){document.removeEventListener("mouseover",this.debouncedMouseOver),document.removeEventListener("mouseout",this._onDocumentMouseOut),window.removeEventListener("blur",this._hideTooltip),this.debouncedMouseOver=null},componentDidUpdate:function(){this.refs.content&&this.state.currentTarget&&this._positionTooltip()},_onDocumentMouseOut:function(e){this.debouncedMouseOver.cancel()},_onMouseOver:function(e){var t=this._getTarget(e.target);if(t&&!this._isSameTarget(t)){var a=this._getTooltip(t);this._showTooltip(a,t)}},_onMouseOut:function(e){this._isSameTarget(this._getTarget(e.toElement))||this._hideTooltip()},_onClick:function(){this._hideTooltip()},_getTarget:function(e){if(!e||e===document.body)return null;for(var t=0,a=null;e&&!a&&t<=n.tipsify.max_dom_traverse_depth;){if(a=this._getTooltip(e))return e;e=e.parentElement,t++}return null},_getTooltip:function(e){return!e||e.hasAttribute("data-tipsify-ignore")?null:e.getAttribute("aria-label")},_showTooltip:function(e,t){this.setState({showTooltip:!0,tooltip:this._stripTags(e).replace(/\n/g,"<br />"),currentTarget:t}),t.addEventListener("mouseout",this._onMouseOut),t.addEventListener("click",this._onClick)},_hideTooltip:function(){this.state.currentTarget&&(this.state.currentTarget.removeEventListener("mouseout",this._onMouseOut),this.state.currentTarget.removeEventListener("click",this._onClick),this.setState({showTooltip:!1,tooltip:"",currentTarget:null}))},_stripTags:function(e){return e.replace(/<\/?[^>]+>/g,"")},_isSameTarget:function(e){return e===this.state.currentTarget},_isInvalidPosition:function(e){return 0===e.left&&0===e.right&&0===e.top&&0===e.bottom&&0===e.width&&0===e.height},_positionTooltip:function(){var e=ReactDOM.findDOMNode(this.refs.content);e.style.padding="0";var t=e.getBoundingClientRect(),a=document.body.getBoundingClientRect(),i=this.state.currentTarget.getBoundingClientRect(),o=i.left+(i.width-t.width)/2,s=i.top+i.height+n.tipsify.distance,r=o+t.width-(a.width-n.tipsify.window_margin),l=s+t.height-(a.height-n.tipsify.window_margin);return this._isInvalidPosition(i)?void this._hideTooltip():(r>0&&(o-=r,e.style.padding="0 "+2*r+"px 0 0"),l>0&&(s=i.top-t.height-n.tipsify.distance,e.className="tipsify-content reversed"),e.style.left=o+"px",e.style.top=s+"px",void AJS.layer(e))},_renderTooltip:function(){if(!this.state.showTooltip)return null;var e={__html:this.state.tooltip};return React.createElement("div",{className:"tipsify-content",ref:"content"},React.createElement("div",{className:"tipsify-content-inner",dangerouslySetInnerHTML:e}))},render:function(){var e=this._renderTooltip();return React.createElement("div",{id:"tipsify"},e)}}),e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(51),h=n(f),p=a(97),m=n(p),g=a(190),v=n(g),y=a(161),b=n(y),w=a(9),R=n(w),k=a(173),E=n(k),C=a(623),S=n(C),T=a(90),x=n(T),A=function(e){function t(){(0,r["default"])(this,t);var e=(0,d["default"])(this,(0,o["default"])(t).call(this));return e.router=(0,S["default"])(),e.data={active_chat:"",initialized:!1},e.throttledSelectRoom=_.throttle(function(t){e.setHash(t.jid)},100,{leading:!0,trailing:!1}),e.registerCallbacks(),e}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"registerCallbacks",value:function(){var e=this;R["default"].registerOnce({"hc-init":function(){e.setBodyClasses()},"before:app-state-ready":function(){"/chat/search"===window.location.pathname?e.setHash(b["default"].get("chatToFocus")):e.router.route(window.location.pathname+window.location.search),e.data.initialized=!0}}),R["default"].register({"set-route":function(t){e.data.initialized&&t.jid!==e.data.active_chat&&e.throttledSelectRoom(t)},"set-multiple-routes":function(t){e.data.initialized&&t.jid!==e.data.active_chat&&e.setHash(t.jid)},"updated:active_chat":function(t){e.data.active_chat=t},"updated:preferences":function(){e.setBodyClasses()}}),E["default"].registerOnce({"analytics-history-loaded":function(t){e.sendWindowAnalytics()}})}},{key:"getAppDimensions",value:function(){var e=b["default"].shouldShowNavigationSidebar(),t=e?b["default"].getLeftColumnWidth():0,a=b["default"].shouldShowGroupChatSidebar(),n=a?b["default"].getRightColumnWidth():0;return{leftSidebarWidth:t,rightSidebarWidth:n,chatPanelWidth:window.innerWidth-t-n,windowWidth:window.innerWidth,windowHeight:window.innerHeight}}},{key:"sendWindowAnalytics",value:function(){E["default"].dispatch("analytics-event",{name:"hipchat.client.app.dimensions",properties:this.getAppDimensions()})}},{key:"setHash",value:function(e){var t=v["default"].get("allRooms"),a=this.router.reverse(e,t);if(a!==window.location.pathname)try{this.router.route(a)}catch(n){x["default"].error(n),x["default"].type("router").error(n)}}},{key:"setBodyClasses",value:function(){var e=[b["default"].getDensity(),b["default"].getTheme()].join(" "),t=document.body;t.className!==e&&(t.className=e)}}]),t}(m["default"]);e.exports=new A},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){c["default"].dispatch("show-flag",{type:"warning",body:g["default"].integration_does_not_exist,close:"auto",title:""})}function o(e){c["default"].dispatch("show-flag",{type:"warning",body:g["default"].room_doesnt_exist,close:"auto",title:""}),c["default"].dispatch("close-room",{jid:e})}function s(e,t){var a=void 0,n="/chat",i=void 0;if(p["default"].jid.is_chat(e))if(a=p["default"].jid.is_room(e)?"room":"user","room"===a){var s=t[e];if(!s)return o(e),!1;i=n+"/"+a+"/"+encodeURIComponent(s.id)}else{var r=p["default"].jid.user_id(e);i=n+"/"+a+"/"+encodeURIComponent(r)}else a=p["default"].jid.is_search(e)?"search":"lobby",i=n+"/"+a;return i}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(){return{route:l["default"],reverse:s}};var r=a(624),l=n(r),u=a(9),c=n(u),d=a(190),f=n(d),h=a(99),p=n(h),m=a(185),g=n(m),v=a(420),y=n(v),b=a(577),w=n(b),R={"/chat/user/:id":function(e){w["default"].selectOTO(decodeURIComponent(e.params.id))},"/chat/room/:id":function(e){w["default"].selectRoom(decodeURIComponent(e.params.id))},"/chat/room/:roomId/addon/:addonKey/module/:moduleKey":function(e){var t=decodeURIComponent(e.params.roomId),a=decodeURIComponent(e.params.addonKey),n=decodeURIComponent(e.params.moduleKey);w["default"].selectRoom(t),y["default"].open(a,n)||i(t,a,n)},"/chat/lobby":function(){c["default"].dispatch("new-active-chat",{jid:"lobby"})},"/chat/search":function(){c["default"].dispatch("new-active-chat",{jid:"search"})}};c["default"].registerOnce({"hipchat-client-configured":function(){l["default"].start({hashbang:!f["default"].get("html5_routing_enabled"),click:!1}),_.forOwn(R,function(e,t){(0,l["default"])(t,e)});
}}),e.exports=t["default"]},function(e,t,a){(function(t){"use strict";function n(e,t){if("function"==typeof e)return n("*",e);if("function"==typeof t)for(var a=new r(e),i=1;i<arguments.length;++i)n.callbacks.push(a.middleware(arguments[i]));else"string"==typeof e?n["string"==typeof t?"redirect":"show"](e,t):n.start(e)}function i(e){if(!e.handled){var t;t=y?v+_.hash.replace("#!",""):_.pathname+_.search,t!==e.canonicalPath&&(n.stop(),e.handled=!1,_.href=e.canonicalPath)}}function o(e){return"string"!=typeof e?e:g?decodeURIComponent(e.replace(/\+/g," ")):e}function s(e,t){"/"===e[0]&&0!==e.indexOf(v)&&(e=v+(y?"#!":"")+e);var a=e.indexOf("?");if(this.canonicalPath=e,this.path=e.replace(v,"")||"/",y&&(this.path=this.path.replace("#!","")||"/"),this.title=document.title,this.state=t||{},this.state.path=e,this.querystring=~a?o(e.slice(a+1)):"",this.pathname=o(~a?e.slice(0,a):e),this.params={},this.hash="",!y){if(!~this.path.indexOf("#"))return;var n=this.path.split("#");this.path=n[0],this.hash=o(n[1])||"",this.querystring=this.querystring.split("#")[0]}}function r(e,t){t=t||{},this.path="*"===e?"(.*)":e,this.method="GET",this.regexp=d(this.path,this.keys=[],t)}function l(e){if(1===u(e)&&!(e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented)){for(var a=e.path?e.path[0]:e.target;a&&"A"!==a.nodeName;)a=a.parentNode;if(a&&"A"===a.nodeName&&!a.hasAttribute("download")&&"external"!==a.getAttribute("rel")){var i=a.getAttribute("href");if((y||a.pathname!==_.pathname||!a.hash&&"#"!==i)&&!(i&&i.indexOf("mailto:")>-1)&&!a.target&&c(a.href)){var o=a.pathname+a.search+(a.hash||"");"undefined"!=typeof t&&o.match(/^\/[a-zA-Z]:\//)&&(o=o.replace(/^\/[a-zA-Z]:\//,"/"));var s=o;0===o.indexOf(v)&&(o=o.substr(v.length)),y&&(o=o.replace("#!","")),v&&s===o||(e.preventDefault(),n.show(s))}}}}function u(e){return e=e||window.event,null===e.which?e.button:e.which}function c(e){var t=_.protocol+"//"+_.hostname;return _.port&&(t+=":"+_.port),e&&0===e.indexOf(t)}var d=a(625);e.exports=n;var f,h,p="undefined"!=typeof document&&document.ontouchstart?"touchstart":"click",_="undefined"!=typeof window&&(window.history.location||window.location),m=!0,g=!0,v="",y=!1;n.callbacks=[],n.exits=[],n.current="",n.len=0,n.base=function(e){return 0===arguments.length?v:void(v=e)},n.start=function(e){if(e=e||{},!f&&(f=!0,!1===e.dispatch&&(m=!1),!1===e.decodeURLComponents&&(g=!1),!1!==e.popstate&&window.addEventListener("popstate",b,!1),!1!==e.click&&document.addEventListener(p,l,!1),!0===e.hashbang&&(y=!0),m)){var t=y&&~_.hash.indexOf("#!")?_.hash.substr(2)+_.search:_.pathname+_.search+_.hash;n.replace(t,null,!0,m)}},n.stop=function(){f&&(n.current="",n.len=0,f=!1,document.removeEventListener(p,l,!1),window.removeEventListener("popstate",b,!1))},n.show=function(e,t,a,i){var o=new s(e,t);return n.current=o.path,!1!==a&&n.dispatch(o),!1!==o.handled&&!1!==i&&o.pushState(),o},n.back=function(e,t){n.len>0?(history.back(),n.len--):e?setTimeout(function(){n.show(e,t)}):setTimeout(function(){n.show(v,t)})},n.redirect=function(e,t){"string"==typeof e&&"string"==typeof t&&n(e,function(e){setTimeout(function(){n.replace(t)},0)}),"string"==typeof e&&"undefined"==typeof t&&setTimeout(function(){n.replace(e)},0)},n.replace=function(e,t,a,i){var o=new s(e,t);return n.current=o.path,o.init=a,o.save(),!1!==i&&n.dispatch(o),o},n.dispatch=function(e){function t(){var e=n.exits[r++];return e?void e(o,t):a()}function a(){var t=n.callbacks[s++];return e.path!==n.current?void(e.handled=!1):t?void t(e,a):i(e)}var o=h,s=0,r=0;h=e,o?t():a()},n.exit=function(e,t){if("function"==typeof e)return n.exit("*",e);for(var a=new r(e),i=1;i<arguments.length;++i)n.exits.push(a.middleware(arguments[i]))},n.Context=s,s.prototype.pushState=function(){n.len++,history.pushState(this.state,this.title,y&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},s.prototype.save=function(){history.replaceState(this.state,this.title,y&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},n.Route=r,r.prototype.middleware=function(e){var t=this;return function(a,n){return t.match(a.path,a.params)?e(a,n):void n()}},r.prototype.match=function(e,t){var a=this.keys,n=e.indexOf("?"),i=~n?e.slice(0,n):e,s=this.regexp.exec(decodeURIComponent(i));if(!s)return!1;for(var r=1,l=s.length;l>r;++r){var u=a[r-1],c=o(s[r]);void 0===c&&hasOwnProperty.call(t,u.name)||(t[u.name]=c)}return!0};var b=function(){var e=!1;if("undefined"!=typeof window)return"complete"===document.readyState?e=!0:window.addEventListener("load",function(){setTimeout(function(){e=!0},0)}),function(t){if(e)if(t.state){var a=t.state.path;n.replace(a,t.state)}else n.show(_.pathname+_.hash,void 0,void 0,!1)}}();n.sameOrigin=c}).call(t,a(113))},function(e,t,a){function n(e){for(var t,a=[],n=0,i=0,o="";null!=(t=m.exec(e));){var s=t[0],l=t[1],u=t.index;if(o+=e.slice(i,u),i=u+s.length,l)o+=l[1];else{o&&(a.push(o),o="");var c=t[2],d=t[3],f=t[4],h=t[5],p=t[6],_=t[7],g="+"===p||"*"===p,v="?"===p||"*"===p,y=c||"/",b=f||h||(_?".*":"[^"+y+"]+?");a.push({name:d||n++,prefix:c||"",delimiter:y,optional:v,repeat:g,pattern:r(b)})}}return i<e.length&&(o+=e.substr(i)),o&&a.push(o),a}function i(e){return o(n(e))}function o(e){for(var t=new Array(e.length),a=0;a<e.length;a++)"object"==typeof e[a]&&(t[a]=new RegExp("^"+e[a].pattern+"$"));return function(a){for(var n="",i=a||{},o=0;o<e.length;o++){var s=e[o];if("string"!=typeof s){var r,l=i[s.name];if(null==l){if(s.optional)continue;throw new TypeError('Expected "'+s.name+'" to be defined')}if(_(l)){if(!s.repeat)throw new TypeError('Expected "'+s.name+'" to not repeat, but received "'+l+'"');if(0===l.length){if(s.optional)continue;throw new TypeError('Expected "'+s.name+'" to not be empty')}for(var u=0;u<l.length;u++){if(r=encodeURIComponent(l[u]),!t[o].test(r))throw new TypeError('Expected all "'+s.name+'" to match "'+s.pattern+'", but received "'+r+'"');n+=(0===u?s.prefix:s.delimiter)+r}}else{if(r=encodeURIComponent(l),!t[o].test(r))throw new TypeError('Expected "'+s.name+'" to match "'+s.pattern+'", but received "'+r+'"');n+=s.prefix+r}}else n+=s}return n}}function s(e){return e.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")}function r(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function l(e,t){return e.keys=t,e}function u(e){return e.sensitive?"":"i"}function c(e,t){var a=e.source.match(/\((?!\?)/g);if(a)for(var n=0;n<a.length;n++)t.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return l(e,t)}function d(e,t,a){for(var n=[],i=0;i<e.length;i++)n.push(p(e[i],t,a).source);var o=new RegExp("(?:"+n.join("|")+")",u(a));return l(o,t)}function f(e,t,a){for(var i=n(e),o=h(i,a),s=0;s<i.length;s++)"string"!=typeof i[s]&&t.push(i[s]);return l(o,t)}function h(e,t){t=t||{};for(var a=t.strict,n=t.end!==!1,i="",o=e[e.length-1],r="string"==typeof o&&/\/$/.test(o),l=0;l<e.length;l++){var c=e[l];if("string"==typeof c)i+=s(c);else{var d=s(c.prefix),f=c.pattern;c.repeat&&(f+="(?:"+d+f+")*"),f=c.optional?d?"(?:"+d+"("+f+"))?":"("+f+")?":d+"("+f+")",i+=f}}return a||(i=(r?i.slice(0,-2):i)+"(?:\\/(?=$))?"),i+=n?"$":a&&r?"":"(?=\\/|$)",new RegExp("^"+i,u(t))}function p(e,t,a){return t=t||[],_(t)?a||(a={}):(a=t,t=[]),e instanceof RegExp?c(e,t,a):_(e)?d(e,t,a):f(e,t,a)}var _=a(626);e.exports=p,e.exports.parse=n,e.exports.compile=i,e.exports.tokensToFunction=o,e.exports.tokensToRegExp=h;var m=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g")},function(e,t){e.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(308),o=n(i),s=a(338),r=n(s),l=a(465),u=n(l),c=a(475),d=n(c),f=a(628),h=n(f),p=a(620),_=n(p),m=a(621),g=n(m);a(622),t["default"]=React.createClass({displayName:"GuestLayout",mixins:[r["default"]],render:function(){return React.createElement("div",{id:"page"},React.createElement(o["default"],{is_guest:this.props.is_guest}),React.createElement(h["default"],{is_guest:this.props.is_guest}),React.createElement(u["default"],{is_guest:this.props.is_guest}),React.createElement(d["default"],null),React.createElement(_["default"],{ref:"fileViewer",items:this.props.files}),React.createElement(g["default"],null))}}),e.exports=t["default"]},function(e,t,a){"use strict";var n=a(482),i=a(483),o=a(498),s=a(629);e.exports=React.createClass({displayName:"GuestBodyLayout",getInitialState:function(){return{errors:n.get("errors"),ready:i.get("ready"),web_server:n.get("web_server")}},componentDidMount:function(){n.on("change",this._onChange),i.on("change:ready",this._onChange)},componentWillUnmount:function(){n.off("change",this._onChange),i.off("change:ready",this._onChange)},componentDidUpdate:function(){$(window).trigger("resize")},_onChange:function(){this.setState(this.getInitialState())},render:function(){var e;return e=this.state.errors.length?React.createElement(s,{errors:this.state.errors}):React.createElement("div",{className:"hc-layout"},React.createElement(o,{ref:"main_column",is_guest:this.props.is_guest}))}})},function(e,t,a){"use strict";var n=a(630),i=a(631);e.exports=React.createClass({displayName:"GeneralErrorDisplay",render:function(){var e,t=this.props.errors[0];return e="500"===t.error.code?React.createElement(i,{error:t,web_server:this.props.web_server}):React.createElement(n,{error:t,web_server:this.props.web_server})}})},function(e,t,a){"use strict";function n(e){var t=_.get(e,"error.text.__text");return t?e.error.text.__text:"An error occurred"}var i=a(183);e.exports=React.createClass({displayName:"GeneralError403",render:function(){var e=n(this.props.error);return React.createElement("section",{role:"main",className:"general-error-display aui-page-notification aui-page-size-medium"},React.createElement("div",{className:"aui-page-panel"},React.createElement("div",{className:"aui-page-pannel-inner"},React.createElement("section",{className:"aui-page-panel-content"},React.createElement("h1",null,React.createElement("img",{src:"https://"+this.props.web_server+"/wc/assets/img/embedded/notsureif@3x.png",alt:"Not sure if",title:"Not sure if",className:"error-emoticon",width:"38",height:"50"})," ",i.youre_welcome),React.createElement("div",{className:"aui-page-notification-description"},React.createElement("p",null,React.createElement("strong",null,e)),React.createElement("p",null,React.createElement("a",{href:"https://"+this.props.web_server+"/sign_in"},i.sign_in)))))))}})},function(e,t){"use strict";function a(e){var t=_.get(e,"error.text.__text");return t?e.error.text.__text:"An error occurred"}e.exports=React.createClass({displayName:"GeneralError500",render:function(){var e=a(this.props.error);return React.createElement("section",{role:"main",className:"general-error-display aui-page-notification aui-page-size-medium"},React.createElement("div",{className:"aui-page-panel"},React.createElement("div",{className:"aui-page-pannel-inner"},React.createElement("section",{className:"aui-page-panel-content"},React.createElement("h1",null,"Whoa! What did you do!? ",React.createElement("img",{className:"error-emoticon",src:"https://"+this.props.web_server+"/wc/assets/img/embedded/troll@3x.png",width:"50",height:"50"})),React.createElement("div",{className:"aui-page-notification-description"},React.createElement("p",null,React.createElement("strong",null,e)))))))}})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(4),o=n(i),s=a(5),r=n(s),l={},u=function(){function e(t){(0,o["default"])(this,e),this.callback=t||function(){}}return(0,r["default"])(e,[{key:"_normalizeError",value:function(e){var t={};return e instanceof Error?t=e:"undefined"!=typeof ErrorEvent&&e instanceof ErrorEvent&&(t=e.error||e),t}},{key:"trigger",value:function(e){var t=this;_.each(l,function(a,n){var i=!1;try{i=a.detect(e)}catch(o){}if(i){var s=Date.now();s<=a._last+a.time?a._count++:a._count=1,a._count>a.threshold&&(a._count=0,t.callback.call(t,n,e)),a._last=s}})}},{key:"install",value:function(){var e=this;window.addEventListener("error",function(t){var a=e._normalizeError(t);e.trigger(a)})}},{key:"addRule",value:function(e,t){l[e]=t}}]),e}();t["default"]=u,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(10),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(22),d=n(c),f=a(51),h=n(f),p=a(97),m=n(p),g=a(9),v=n(g),y=a(121),b=n(y),w=a(99),R=n(w),k=a(634),E=n(k),C=a(176),S=n(C),T=a(174),x=n(T),A=a(169),I=n(A),N=a(161),M=n(N),O=a(190),D=n(O),P=a(93),j=n(P),L=a(257),F=n(L),U=function(e){function t(){(0,r["default"])(this,t);var e=(0,d["default"])(this,(0,o["default"])(t).call(this));return e.local={},e}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"getDefaults",value:function(){return{video_sessions:[],video_enabled:I["default"].get("video_enabled"),delayed_video_messages:{},incoming_invites:[],active_chat:"",profiles:{},current_user:{},web_server:b["default"].default_web_server,video_chat_uri:I["default"].get("video_chat_uri")}}},{key:"registerListeners",value:function(){var e=this;v["default"].registerOnce({"app-state-ready":function(){e.videoChat=new E["default"](e)}}),v["default"].register({"updated:config":function(t){e.set("video_chat_uri",t.video_chat_uri)},"updated:current_user":function(t){e.data.current_user=t},"updated:web_server":function(t){e.set("web_server",t)},"updated:active_chat":function(t){e.data.active_chat=t},"updated:profiles":function(t){e.handleProfiles(t)},"addlive.video-window-event":function(t){e.handleExternalWindowEvent(t)},"addlive.start-video-call":function(t){e.initiateVideoCall(t)},"addlive.invite-to-audio-video-call":function(t){t.sender.jid!==e.data.current_user.user_jid&&e.handleVideoCallInvite(t)},"addlive.answer-audio-video-call":function(t){e.answerIncomingVideoCall(t)},"addlive.audio-video-call-accepted":function(t){e.videoCallAcceptedByRemoteUser(t)},"addlive.audio-video-call-declined":function(t){e.handleDeclinedMessage(t)},"addlive.decline-audio-video-call":function(t){e.declineIncomingVideoCall(t)},"addlive.audio-video-call-hung-up":function(t){e.handleHangupMessage(t)},"addlive.focus-video-window":function(t){var a=e.getVideoSession(t.jid);a&&a.window&&a.window.focus()}})}},{key:"handleProfiles",value:function(e){var t=this;_.forOwn(e,function(e,a){t.data.profiles[a]||(t.data.profiles[a]={jid:a,name:e.name,title:e.title,timezone:e.timezone||"",timezone_utc_diff:e.timezone?parseFloat(e.timezone.utc_offset):0,email:e.email,photo:e.photo_large,photo_small:e.photo_small})})}},{key:"handleVideoCallInvite",value:function(e){var t,a=this,n=this.getCaller(e.sender.jid),i=this.getCurrentSession();if(this.videoChat.triggerVideoCall(n),i){if(i.jid!==e.message.from)return;if(i.window&&i.window.isConnected)return!0;t=!0}else v["default"].dispatch("show-flag",{id:"video-flag-"+R["default"].now(),type:"video",sender:e.sender.name,photo:n.photo_url,message:e.message,service:x["default"].ADDLIVE});this.videoChat.notifyForIncomingCall(n,M["default"].getShowToasters());var o={caller:n,missed_timer:setTimeout(function(){a.handleMissedCall(n)},b["default"].missed_video_call_timeout)};this.data.incoming_invites.push(o),t&&this.handleVideoInterruptMessage(e.message)}},{key:"removeInvite",value:function(e){var t=_.find(this.data.incoming_invites,{caller:this.getCaller(e)});t&&(clearTimeout(t.missed_timer),this.videoChat.stopAllSounds(),_.pull(this.data.incoming_invites,t),v["default"].dispatch("hide-modal-dialog"))}},{key:"answerIncomingVideoCall",value:function(e){this.videoChat.stopAllSounds(),this.videoChat.stopIncomingNotification(e.from),this.removeInvite(e.from);var t=!_.get(e,"x.call",{}).hasOwnProperty("video"),a=_.get(e,"x.url","");v["default"].dispatch("send-video-message",{jid:e.from,type:"accept",service:x["default"].ADDLIVE}),this.initiateVideoCall({jid:e.from,type:"accept",audio_only:t,url:a,service:a?x["default"].ENSO:x["default"].ADDLIVE}),window.app.get_profile(e.from,function(t){j["default"].callAnswered(e.from,t),window.app.request_addlive_credentials(e.from,function(e,t){j["default"].addLiveCredentialsReceived(t)})})}},{key:"declineIncomingVideoCall",value:function(e){this.videoChat.stopAllSounds(),this.videoChat.stopIncomingNotification(e.from),this.removeInvite(e.from),v["default"].dispatch("send-video-message",{jid:e.from,type:"decline",service:x["default"].ADDLIVE})}},{key:"handleMissedCall",value:function(e){this.videoChat.stopAllSounds(),this.videoChat.stopIncomingNotification(e.jid);var t={body:S["default"].missed_call_message(e.name),type:"missed-call",from:e.jid,delay:!1,sender:" "};v["default"].dispatch(x["default"].ADDLIVE+".missed-call",t),v["default"].dispatch("hide-modal-dialog")}},{key:"createCallSession",value:function(e){var t=e.jid,a=e.type,n=e.uri;this.data.video_sessions.push({jid:t,type:a,window:this.videoChat.openVideoUI(n,t)}),F["default"].onCall()}},{key:"isNativeAddLiveWindow",value:function(){return!!I["default"].get("feature_flags").web_client_native_addlive_window}},{key:"initiateVideoCall",value:function(e){var t=this,a=this.getCurrentSession();if(!a){var n=this.get("video_chat_uri");return e.uri=n?n+"?user_id=":"https://"+this.get("web_server")+"/chat/video/",e.uri+=""+encodeURIComponent(R["default"].jid.user_id(e.jid)),e.audio_only&&(e.uri+=n?"&":"?",e.uri+="voice"),this.isNativeAddLiveWindow()||this.createCallSession(e),void("call"===e.type&&window.app.get_profile(e.jid,function(a){j["default"].callPlaced(e.jid,a),t.isNativeAddLiveWindow()&&v["default"].dispatch("send-video-message",{jid:e.jid,type:"call",audio_only:e.audio_only,service:x["default"].ADDLIVE}),window.app.request_addlive_credentials(e.jid,function(e,t){j["default"].addLiveCredentialsReceived(t)})}))}if(e.jid===a.jid&&a.window){var i=a.window.isConnected,o=_.isUndefined(a.window.isConnected);if(i||o)return void a.window.focus()}confirm(S["default"].confirm_leave)&&a.window&&(this.deleteVideoSession(a.jid),a.window.close(),this.createCallSession(e))}},{key:"handleDeclinedMessage",value:function(e){var t=this.getCurrentSession();if(!t||t.jid===e.message.from){this.videoChat.stopAllSounds();var a=R["default"].jid.bare_jid(e.from),n=this.getCaller(a);this.videoChat.triggerVideoDeclined(n),F["default"].leaveCall(),window.app.get_profile(e.message.from,function(t){j["default"].callDeclined(e.message.from,t)})}}},{key:"handleVideoInterruptMessage",value:function(e){var t=this.getCaller(e.from);this.videoChat.triggerVideoInterrupt(t)}},{key:"handleHangupMessage",value:function(e){var t=this.getCurrentSession();if(!t||t.jid===e.sender.jid){var a=_.get(e,"message.from")||_.get(e,"sender.jid");this.videoChat.stopAllSounds(),this.videoChat.triggerVideoHangup(e.sender),this.removeInvite(a),F["default"].leaveCall(),window.app.get_profile(e.sender.jid,function(t){j["default"].callHungup(e.sender.jid,t)})}}},{key:"videoCallAcceptedByRemoteUser",value:function(e){this.videoChat.stopAllSounds();var t=R["default"].jid.bare_jid(e.message.from),a=this.getCaller(t);this.videoChat.triggerVideoAccept(a)}},{key:"deleteVideoSession",value:function(e,t){this.videoChat.stopAllSounds();var a=this.getVideoSession(e);t&&a&&(a.timeout=setTimeout(function(t){a===t.getCurrentSession()&&t.destroyVideoSession(e)},b["default"].missed_video_call_timeout,this))}},{key:"sendVideoMessage",value:function(e,t){"string"==typeof t&&(t=JSON.parse(t)),"join"===t.type&&(t.type="accept");var a=this.determineMessageType(e,t),n=_.get(t,"audio_only",!1);switch(a){case"call":t.url||this.videoChat.notifyForOutgoingCall();break;case"hangup":this.videoChat.stopAllSounds(),F["default"].leaveCall();break;case"accept":this.videoChat.stopAllSounds()}v["default"].dispatch("send-video-message",{jid:e,type:a,audio_only:n,url:t.url||"",service:x["default"].ADDLIVE})}},{key:"handleExternalWindowEvent",value:function(e){switch(e.type){case"video_session_started":this.videoChat.stopAllSounds();break;case"video_joined":return this.removeInvite(e.data),F["default"].onCall(),void this.videoChat.triggerVideoAccept(this.getCaller(e.data));case"video_hangup":e.data===this.data.current_user.user_jid&&(this.sendVideoMessage(e.data,{type:"hangup"}),F["default"].leaveCall());break;case"video_declined":this.sendVideoMessage(e.data,{type:"decline"}),this.deleteVideoSession(e.data);break;case"video_session_ended":e.data.reloading||(v["default"].dispatch("send-video-message",{jid:e.data.jid,type:"hangup",service:x["default"].ADDLIVE}),this.videoChat.stopAllSounds(),this.destroyVideoSession(e.data.jid),F["default"].leaveCall())}}},{key:"determineMessageType",value:function(e,t){var a=this.getVideoSession(e);return"decline"===t.type||"hangup"===t.type?t.type:"call"===a.type&&"accept"===t.type?"call":"accept"}},{key:"destroyVideoSession",value:function(e){var t=this.getVideoSession(e);if(t&&t.window){var a=t.window;t.window=null,a.close()}this.data.video_sessions=_.reject(this.data.video_sessions,{jid:e})}},{key:"getVideoSession",value:function(e){return _.find(this.data.video_sessions,{jid:e})}},{key:"getCurrentSession",value:function(){return _.find(this.data.video_sessions,function(e){return e.window&&!e.timeout})}},{key:"getCaller",value:function(e){var t=this.getRoster();return _.find(t,{jid:e})}},{key:"getRoster",value:function(){return _.values(D["default"].get("roster"))}}]),t}(m["default"]);t["default"]=new U,e.exports=t["default"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(4),o=n(i),s=a(5),r=n(s),l=a(180),u=a(195),c=a(99),d=a(121),f=a(9),h=a(176),p=a(190),m=a(93),g=function(){function e(t){(0,o["default"])(this,e),this.events=$(document),this.attachBridgeComponents(t),this.subscribeToExternalWindowEvents(this.events)}return(0,r["default"])(e,[{key:"attachBridgeComponents",value:function(e){window.chat={events:this.events,current_message_id:0,delete_video_session:_.bind(e.deleteVideoSession,e),cancel_delete_video_session:function(e){var t=this.get_video_session(e);t&&t.timeout&&(clearTimeout(t.timeout),delete t.timeout)},get_video_session:function(t){return _.find(e.get("video_sessions"),{jid:t})},set_video_session_type:function(e,t){var a=this.get_video_session(e);a&&(a.type=t)},next_message_id:function(){return this.current_message_id++}},window.app={get_user_info:function(t,a){var n=util.jid.bare_jid(t),i=_.find(e.getRoster(),{jid:n});return i?i:a?{name:""}:null},current_user_jid:e.get("current_user").user_jid,send_video_message:function(t,a){e.sendVideoMessage(t,a)},get_video_session:function(t){return _.find(e.get("video_sessions"),{jid:t})},send_delayed_video_message:function(t,a){var n=""+t;"string"==typeof a&&(a=JSON.parse(a));var i="msg-"+a.message_id;return"hangup"!==a.type&&"decline"!==a.type||l.stopSounds(),e.data.delayed_video_messages[i]={cancel:function(){delete e.data.delayed_video_messages[i],clearTimeout(this.timeout)},timeout:setTimeout(function(){delete e.data.delayed_video_messages[i],e.sendVideoMessage(n,{type:a.type})},a.timeout||5e3,n)},i},attributes:{},set_video_attribute:function(e,t){this[""+e]=""+t},get_video_attribute:function(e){return this[e]},remove_video_attribute:function(e){delete this[e]},cancel_delayed_video_message:function(t){var a=e.get("delayed_video_messages")[t];return a?(a.cancel(),!0):!1},request_addlive_credentials:function(e,t){f.dispatch("request-addlive-credentials",{jid:e},t)},get_profile:function(t,a){var n=e.get("profiles")[t];n?a(n):f.dispatch("request-profile",t,function(e){if(e&&e.query){var n=e.query,i={jid:t,name:n.name,title:n.title,timezone:n.timezone||"",timezone_utc_diff:n.timezone?parseFloat(n.timezone.utc_offset):0,email:n.email,photo:n.photo_large,photo_small:n.photo_small};a(i)}})}},window.util=c,window.hipchat=console||{log:_.noop}}},{key:"notifyForIncomingCall",value:function(e,t){l.playSound("incoming_call",!0),l.setTitleNotification({id:e.jid,text:h.incoming_call_notification(e.name)}),t&&u.showNotification({group_id:p.get("config").group_id,group_name:p.get("config").group_name,jid:e.jid,title:e.name,body:h.incoming_call_notification(e.name),icon:p.get("asset_base_uri")+d.notification_icon,type:"incoming_call"})}},{key:"notifyForOutgoingCall",value:function(){l.playSound("outgoing_call",!0)}},{key:"stopAllSounds",value:function(){l.stopSounds()}},{key:"stopIncomingNotification",value:function(e){l.unsetTitleNotification(e)}},{key:"openVideoUI",value:function(e,t){var a=c.video.size_window(d.video_width,d.video_height,640,360),n=a.width,i=a.height,o=n/d.video_width,s=i/d.video_height;1>o&&1>s?s>o?n=Math.floor(d.video_width*s):i=Math.floor(d.video_height*o):1>s?n=Math.floor(d.video_width*s):1>o&&(i=Math.floor(d.video_height*o));var r=c.video.center_window(n,i),l="resizable=yes,width="+n+",height="+i+",top="+r.top+",left="+r.left,u=m.openInternalWindow(e,"HipChat",l);return u&&($(u).on("beforeunload",function(e){f.dispatch("addlive.video-window-event",{type:"video_session_ended",data:{jid:t,reloading:e.currentTarget.reloading}})}),u.focus(),window.video_window=u),u}},{key:"subscribeToExternalWindowEvents",value:function(e){e.on("video_session_ended video_session_started video_declined video_joined video_hangup",function(e,t){f.dispatch("addlive.video-window-event",{type:e.type,data:t})})}},{key:"triggerVideoCall",value:function(e){this.events.trigger("video_call",e)}},{key:"triggerVideoAccept",value:function(e){this.events.trigger("video_accept",e)}},{key:"triggerVideoHangup",value:function(e){this.events.trigger("video_hangup",e)}},{key:"triggerVideoDeclined",value:function(e){this.events.trigger("video_decline",e)}},{key:"triggerVideoInterrupt",value:function(e){this.events.trigger("video_interrupt",e)}},{key:"triggerVideoUnsupported",value:function(e){this.events.trigger("video_unsupported",e)}}]),e}();e.exports=g},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(117),o=n(i),s=a(4),r=n(s),l=a(5),u=n(l),c=a(599),d=n(c),f=a(636),h=n(f),p=a(103),m=n(p),g=function(){function e(){(0,r["default"])(this,e),this._initialize()}return(0,u["default"])(e,[{key:"_initialize",value:function(){$(document).on("copy",this._doCopy.bind(this))}},{key:"_doCopy",value:function(e){var t=window.getSelection(),a=this._getSelectionRanges(t);if(t.rangeCount&&$(e.target).parents(".hc-chat-panel").length){var n=this._getCopyableElements(a);if(!(n.length<2)){var i=this._getFormattedContent(n),o=$("<textarea>").css({width:"1px",height:"1px",padding:"0px"}).text(i),s=$("<div id='clipboard-container'>").css({position:"fixed",left:"0px",top:"0px",width:"0px",height:"0px","z-index":"100",display:"block",opacity:"0"}).append(o).appendTo(document.body);o.focus().select();try{document.execCommand("copy")}catch(r){}_.defer(function(){t.removeAllRanges(),a.forEach(function(e){return t.addRange(e)}),s.remove()})}}}},{key:"_getCopyableElements",value:function(e){var t=[];return t=_.map(e,function(e){var t=e.cloneContents();return[].concat((0,o["default"])(t.querySelectorAll("[data-copyable]")))}),_.flatten(t)}},{key:"_getFormattedContent",value:function(e){var t=this,a=_.reduce(e,function(e,a){var n=t._formatElement(a);return _.isEmpty(n)||e.push(n),e},[]);return _.join(a,"\n")||""}},{key:"_getSelectionRanges",value:function(e){for(var t=[],a=0,n=e.rangeCount;n>a;++a)t.push(e.getRangeAt(a));return t}},{key:"_formatElement",value:function(e){var t="",a="",n="",i="",o=JSON.parse(e.dataset.copyable),s=o.format;if(o.mid&&(t=this._getMessageByMid(o.mid),a=(0,m["default"])(t.date).format("h:mm A"),n=t.sender),"plain-message"===s)return i=this._formatBodyText(e),"["+a+"] "+n+": "+i;if("notification"===s)return i=this._formatBodyText(e),"["+a+"] "+n+": "+i;if("info"===s)return i=this._formatBodyText(e),i=i.split("\n"),i=_.transform(i,function(e,t){return e.push("    "+t)},[]),i=i.join("\n"),""+i;if("quotation"===s)return i=this._formatBodyText(e),i=i.split("\n"),i=_.transform(i,function(e,t){return e.push("    |  "+t)},[]),i=i.join("\n"),"["+a+"] "+n+":\n"+i;if("code"===s){var r=$("li",e);return r.length>0?(i=[],$("li",e).each(function(e,t){i.push("    "+t.lastElementChild.textContent)}),i=i.join("\n")):(i=this._formatBodyText(e),i="    "+i),"["+a+"] "+n+":\n"+i}if("file"===s){var l=t.file_data.file_name,u=t.file_data.url;return i=this._formatBodyText(t.rendered_body),"["+a+"] "+n+": "+i+"\n    "+h["default"].file_uploaded+": "+l+"\n    ["+u+"]"}return"date-divider"===s?(i=this._formatBodyText(e),"---- "+i+" ----"):e.lastElementChild.textContent}},{key:"_getMessageByMid",value:function(e){var t=d["default"].data.chats[d["default"].data.active_chat].messages;return _.find(t,{mid:e})}},{key:"_formatBodyText",value:function(e){var t="",a=$.parseHTML(e.innerHTML||e);return a&&(a.forEach(function(e){t+="BR"===e.nodeName?"\n":"IMG"===e.nodeName&&$(e).hasClass("remoticon")?e.alt:e.textContent}),t=t.trim(),t=t.replace(/\n\n/g,"")),t}}]),e}();t["default"]=new g,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={file_uploaded:"File uploaded"},e.exports=t["default"]}]);
//# sourceMappingURL=app-4.30.3.js.map